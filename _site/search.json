[
  
    {
      "title"       : "DDPG(Deep Deterministic Policy Gradient) êµ¬í˜„",
      "category"    : "",
      "tags"        : "DDPG, Deep Deterministic Policy Gradient, DQN, pytorch",
      "url"         : "./DDPG2_code.html",
      "date"        : "2024-05-07 12:32:20 +0900",
      "description" : "DDPG(Deep Deterministic Policy Gradient) êµ¬í˜„",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ í•´ë‹¹ ë‚´ìš©ì€ ë‹¤ìŒì˜ ê°•ì˜ ë‚´ìš©ì„ ê°œì¸ì ìœ¼ë¡œ ì¬í•™ìŠµ í•˜ê¸° ìœ„í•´ ì‘ì„±ë¨. ì¸í”„ëŸ° - ìœ ë‹ˆí‹° ë¨¸ì‹ ëŸ¬ë‹ ì—ì´ì „íŠ¸ ì™„ì „ì •ë³µ (ê¸°ì´ˆí¸) | ë¯¼ê·œì‹0. ì½”ë“œ ìš”ì•½í•´ë‹¹ code ëŠ” DDPG ë¥¼ ì ìš©í•œ ì‹ ê²½ë§ í•™ìŠµ ì½”ë“œì´ë©°, ê·¸ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ &amp; íŒŒë¼ë¯¸í„° ì„¤ì • OU Noise class : ì—°ì†ì ì¸ í–‰ë™ì„ ì„ íƒí•  ë•Œ íƒí—˜ì„ ìœ„í•œ noise í´ë˜ìŠ¤ Actor class : state ì…ë ¥ì„ í†µí•´ action ì„ ì„ íƒí•˜ëŠ” ì‹ ê²½ë§ í´ë˜ìŠ¤ Critic class: state, action ì…ë ¥ì„ í†µí•´ q ê°’ì„ ë°˜í™˜í•˜ëŠ” ì‹ ê²½ë§ í´ë˜ìŠ¤ Agent class Main í•¨ìˆ˜í•´ë‹¹ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì½”ë“œì˜ ì•Œê³ ë¦¬ì¦˜ ì§„í–‰ í”„ë¡œì„¸ìŠ¤ì™€ ML-agents ì™€ ì—°ë™í•˜ì—¬ ì–´ë–»ê²Œ í”„ë¡œê·¸ë¨ ë¡œì§ì´ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ ìœ„ì£¼ë¡œ ì„¤ëª…í•  ì˜ˆì •ì„. í•´ë‹¹ ì½”ë“œì—ì„œì˜ PyTroch , ML-agents ë“± ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ë° í™˜ê²½ ì„¤ì •ì— ëŒ€í•œ ì„¤ëª…ì€ ì´ì „ í¬ìŠ¤íŠ¸ (Deep Q-Network + ML-agents êµ¬í˜„)[https://y2gon2.github.io/DQN_ml_agents.html] ì™€ ìœ ì‚¬í•¨ìœ¼ë¡œ í•´ë‹¹ í¬ìŠ¤íŠ¸ë¥¼ ì°¸ì¡°.1. ë¼ì´ë¸ŒëŸ¬ë¦¬ &amp; íŒŒë¼ë¯¸í„° ì„¤ì •import numpy as npimport randomimport copyimport datetimeimport platformimport torchimport torch.nn.functional as Ffrom torch.unils.tensorboard import SummaryWriterfrom collections import dequefrom mlagents_envs.environment import UnityEnvironment, ActionTuplefrom mlagents_envs.side_channel.engine_configuration_channel import EngineConfigurationChannel# DDPG íŒŒë¼ë¯¸í„° state_size = 9 # (1)action_size = 3 # ê° ì¶•ë°©í–¥ ê°’load_model = Falsetrain_mode = Truebatch_size = 128mem_maxlen = 50000discount_factor = 0.9actor_lr = 1e-4 # actor network í•™ìŠµë¥ critic_lr = 5e-4 # critic network í•™ìŠµë¥ tau = 1e-3 # soft target update parameter# OU noise íŒŒë¼ë¯¸í„°mu = 0 # íšŒê·€í•  í‰ê· ê°’theta = 1e-3 # íšŒê·€ ì†ë„sigma = 2e-3 # ëœë¤ í”„ë¡œì„¸ìŠ¤ì˜ ë³€ë™ì„±run_step = 50000 if train_mode else 0test_step = 10000train_start_step = 5000print_interval = 10save_interval = 100# ìœ ë‹ˆí‹° í™˜ê²½ ê²½ë¡œgame = \"Drone\"os_name = platform.system()if os_name == 'Windows': env_name = f\"../envs/{game}_{os_name}/{game}\"elif os_name == 'Darwin': env_name = f\"../envs/{game}_{os_name}\"# ëª¨ë¸ ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸° ê²½ë¡œdate_time = datetime.datetime.now().strftime(\"%Y%m%d%H%M%S\")save_path = f\"./saved_models/{game}/DDPG/{date_time}\"load_path = f\"./saved_models/{game}/DDPG/202405071234\"# ì—°ì‚°ì¥ì¹˜device = torch.device(\"cuda\" if torch.cudoa.is_available() else \"cpu\")(1) state_size = 9í˜„ì¬ ë“œë¡ ì˜ ìœ„ì¹˜ - ê³¨ì¸ ì§€ì ì˜ ìœ„ì¹˜ (x, y, z) í˜„ì¬ ë“œë¡ ì˜ ì†ë„ (x, y, z) í˜„ì¬ ë“œë¡ ì˜ ê°ì†ë„ (x, y, z)=&gt; ì´ 9ê°œì˜ ìƒíƒœê°’ ì‚¬ìš©2. OU Noise classclass OU_noise: def __init__(self): self.reset() def reset(self): # noise reset self.X = np.ones((1, action_size), dtype=np.float32) * mu # (1) def sample(self): # noise sampling dx = theta * (mu - self.X) + sigma * np.random.randn(len(self.X)) # (2) self.X += dx return self.x(1) self.X = np.ones((1, action_size), dtype=np.floate32) * mu ëª¨ë‘ 1.0 ê°’ì„ ê°€ì§€ëŠ” (1 * 3) í¬ê¸°ì˜ np array * 0 = [[0.0, 0.0, 0.0]](2) dx = theta * (mu - self.X) + sigma * np.random.randn(len(self.X)) len(self.X) = 1 (1 * 3 size np array ì´ë¯€ë¡œ) np.random.randn(1) : í‰ê·  0, í‘œì¤€í¸ì 1 ì •ê·œë¶„í¬ ë‚´ ì„ì˜ì˜ ê°’ 1ê°œ3. Actor classclass Actor(torch.nn.Module): def __init__(self): super(Actor, self).__init__() self.fc1 = torch.nn.Linear(state_size, 128) self.fc2 = torch.nn.Linear(128, 128) self.mu = torch.nn.Linear(128, action_size) def forward(self, state): x = torch.relu(self.fc1(state)) x = torch.relu(self.fc2(x)) return torch.tanh(self.mu(x)) # (1)(1) torch.tanh(self.mu(x))ë¹„í™”ì„±í™” í•¨ìˆ˜ torch.tanh() ëŠ” í•´ë‹¹ ê²°ê³¼ë¥¼ -1 ~ 1 ì‚¬ì´ ê°’ì„ ê°–ëŠ” ê²°ê³¼ë¥¼ ì¶œë ¥í•œë‹¤. ê·¸ëŸ°ë° ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” relu() ê°€ ì•„ë‹Œ tanh() ì‚¬ìš©í•œ ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ? (by ChatGPT) tanh()â€‹ ì¶œë ¥ ë²”ìœ„ ì œí•œ:ì•¡ì…˜ ê³µê°„(action space)ì´ ì—°ì†ì ì´ê³  íŠ¹ì • ë²”ìœ„ ë‚´ì—ì„œ ì •ì˜ë  ë•Œ (ì˜ˆ: ë¡œë´‡ íŒ”ì˜ ê´€ì ˆ ê°ë„ë‚˜ ì°¨ëŸ‰ì˜ ì¡°í–¥ ê°ë„), ì•¡ì…˜ì˜ í¬ê¸°ë¥¼ ì ì ˆíˆ ì œí•œí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. tanh í•¨ìˆ˜ëŠ” ìì—°ìŠ¤ëŸ½ê²Œ ì¶œë ¥ì„ -1ì—ì„œ 1 ì‚¬ì´ë¡œ ìŠ¤ì¼€ì¼ë§í•˜ì—¬, ì•¡ì…˜ì˜ ë²”ìœ„ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì œì–´í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ë¯¸ë¶„ ê°€ëŠ¥ì„±ê³¼ ë¹„ì„ í˜•ì„±:tanh í•¨ìˆ˜ëŠ” ì—°ì†ì ì´ë©° ë¯¸ë¶„ ê°€ëŠ¥í•œ ë¹„ì„ í˜• í•¨ìˆ˜ë¡œì„œ, ì‹ ê²½ë§ì˜ í•™ìŠµ ê³¼ì •ì—ì„œ ê·¸ë¼ë””ì–¸íŠ¸ ê¸°ë°˜ ìµœì í™” ë°©ë²•ì„ ì‚¬ìš©í•  ë•Œ ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤. ë¹„ì„ í˜• í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨, ë„¤íŠ¸ì›Œí¬ëŠ” ë” ë³µì¡í•œ ì•¡ì…˜ ì„ íƒ ì „ëµì„ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Zero-Centered ì¶œë ¥:tanhëŠ” ì¶œë ¥ì´ ì¤‘ì‹¬(0)ì„ ê¸°ì¤€ìœ¼ë¡œ ëŒ€ì¹­ì´ë¼ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” í•™ìŠµ ê³¼ì •ì—ì„œ ë„¤íŠ¸ì›Œí¬ê°€ í¸í–¥ë˜ì§€ ì•Šê²Œ í•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë¡œë´‡ì´ ì•ìœ¼ë¡œ ê°€ê±°ë‚˜ ë’¤ë¡œ ê°€ëŠ” ì•¡ì…˜ì„ ì„ íƒí•  ë•Œ, tanhëŠ” ì–‘ì˜ ë°©í–¥ê³¼ ìŒì˜ ë°©í–¥ì„ ëª¨ë‘ ë™ì¼í•œ ë²”ìœ„ë¡œ ì œê³µí•˜ì—¬ ê· í˜• ì¡íŒ í•™ìŠµì„ ì´‰ì§„í•©ë‹ˆë‹¤. ìì—°ìŠ¤ëŸ¬ìš´ ì „í™˜:tanh í•¨ìˆ˜ëŠ” -1ê³¼ 1 ê·¼ì²˜ì—ì„œ í¬í™”(saturation)ë˜ëŠ” ì„±ì§ˆì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë§¤ìš° ë†’ê±°ë‚˜ ë‚®ì€ ì…ë ¥ ê°’ì— ëŒ€í•´ ì¶œë ¥ì˜ ë³€í™”ê°€ ì ì–´ì§ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ í¬í™” íŠ¹ì„±ì€ ë•Œë•Œë¡œ ë„¤íŠ¸ì›Œí¬ê°€ ê·¹ë‹¨ì ì¸ ì•¡ì…˜ì„ ì·¨í•˜ëŠ” ê²ƒì„ ìì—°ìŠ¤ëŸ½ê²Œ ì œí•œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Actor Networkâ€‹ì´ë¯¸ì§€ ì¶œì²˜4. Critic classclass Critic(torch.nn.Module): def __init__(self): super(Critic, self).__init__() self.fc1 = torch.nn.Linear(state_size, 128) self.fc2 = torch.nn.Linear(128 + action_size, 128) self.q = torch.nn.Linear(128, 1) # q ê°’ ë°˜í™˜ def forward(self, state, action): x = torch.relu(self.fc1(state)) x = torch.cat((x, action), dim=-1) # (1) x = torch.relu(self.fc2(x)) return self.q(x)(1) x = torch.cat((x, action), dim=-1)critic network ì— input parameter ëŠ” state ì™€ action ë‘ ê°œ ì´ë‹¤. ë‘ ìš”ì†Œê°€ ì„œë¡œ ê´€ë ¨ì€ ìˆì§€ë§Œ, ìˆ˜ì‹ì ìœ¼ë¡œ ë™ë“±í•œ ìš”ì†Œë¡œ ì·¨ê¸‰í•´ë„ ë˜ëŠ” ê²ƒì¼ê¹Œ? ë‘ ìš”ì†Œë¥¼ ë‹¤ë¥´ê²Œ ì·¨ê¸‰í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ? (by ChatGPT)ìƒíƒœ(state)ì™€ í–‰ë™(action) ì •ë³´ë¥¼ ê°™ì€ ì²« ë²ˆì§¸ ì¸µì— ë™ì‹œì— ë„£ëŠ” ê²ƒ ëŒ€ì‹  ë‘ ë²ˆì§¸ ì¸µì—ì„œ ê²°í•©í•˜ëŠ” ë°©ì‹ì„ ì„ íƒí•˜ëŠ” ì´ìœ ëŠ” ì‹ ê²½ë§ì˜ í•™ìŠµ ë™ì—­í•™ê³¼ ê´€ë ¨ëœ ëª‡ ê°€ì§€ ì¤‘ìš”í•œ ê³ ë ¤ì‚¬í•­ ë•Œë¬¸ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ ê³ ë ¤í•˜ëŠ” ì ‘ê·¼ ë°©ì‹ì€ ì•Œê³ ë¦¬ì¦˜ì˜ ì„±ëŠ¥ê³¼ ì¼ë°˜í™” ëŠ¥ë ¥ì„ ìµœì í™”í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤. ì •ë³´ ì²˜ë¦¬ì˜ ë‹¨ê³„ì  ì ‘ê·¼:ìƒíƒœ(state) ì •ë³´ëŠ” í™˜ê²½ì— ëŒ€í•œ ì „ë°˜ì ì¸ ë§¥ë½ì„ ì œê³µí•˜ê³ , í–‰ë™(action) ì •ë³´ëŠ” íŠ¹ì • ìƒí™©ì—ì„œ ì·¨í•  êµ¬ì²´ì ì¸ ì¡°ì¹˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì²« ë²ˆì§¸ ì¸µì—ì„œ ìƒíƒœ ì •ë³´ë§Œ ì²˜ë¦¬í•¨ìœ¼ë¡œì¨ ë„¤íŠ¸ì›Œí¬ëŠ” ë¨¼ì € ìƒíƒœì— ëŒ€í•œ íŠ¹ì§•ì„ ì¶”ì¶œí•˜ê³  ì´í•´í•˜ëŠ” ë° ì§‘ì¤‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ, ë‘ ë²ˆì§¸ ì¸µì—ì„œ ì´ ìƒíƒœ íŠ¹ì§•ì„ í–‰ë™ ì •ë³´ì™€ ê²°í•©í•¨ìœ¼ë¡œì¨, íŠ¹ì • ìƒíƒœì—ì„œ íŠ¹ì • í–‰ë™ì„ ì·¨í–ˆì„ ë•Œì˜ ê²°ê³¼(ì˜ˆ: Q-ê°’)ë¥¼ í•™ìŠµí•˜ëŠ” ë° í•„ìš”í•œ ê´€ê³„ë¥¼ ë” íš¨ê³¼ì ìœ¼ë¡œ ëª¨ë¸ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•™ìŠµì˜ íš¨ìœ¨ì„±:ìƒíƒœì™€ í–‰ë™ì„ ê°ê° ë‹¤ë¥¸ ì¸µì—ì„œ ì²˜ë¦¬í•¨ìœ¼ë¡œì¨ í•™ìŠµ ê³¼ì •ì—ì„œ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì •ë³´ë¥¼ ì¡°í•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒíƒœ ì •ë³´ì— ê¸°ë°˜í•œ íŠ¹ì§•ì€ í–‰ë™ì— ë…ë¦½ì ìœ¼ë¡œ ìœ ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ìƒíƒœì˜ ì¤‘ìš”í•œ íŠ¹ì„±ì„ ë” ë„“ì€ ë§¥ë½ì—ì„œ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì ‘ê·¼ì€ íŠ¹íˆ í–‰ë™ ê³µê°„ì´ í´ ë•Œ ìœ ìš©í•˜ë©°, í–‰ë™ê³¼ ìƒíƒœ ì‚¬ì´ì˜ ë³µì¡í•œ ìƒí˜¸ì‘ìš©ì„ í•™ìŠµí•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤. ëª¨ë“ˆì„±ê³¼ ìœ ì—°ì„±:ìƒíƒœì™€ í–‰ë™ì„ ë³„ë„ì˜ ì¸µì—ì„œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì€ ì‹ ê²½ë§ì˜ ëª¨ë“ˆì„±ì„ ì¦ê°€ì‹œí‚¤ê³ , ê°ê°ì˜ ì…ë ¥ ìœ í˜•ì— íŠ¹í™”ëœ ì²˜ë¦¬ ë°©ì‹ì„ ì ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ëŠ” ì‹ ê²½ë§ì´ ë” ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ ë¬¸ì œì— ì ì‘í•˜ê³ , ìƒíƒœ ë˜ëŠ” í–‰ë™ì˜ í‘œí˜„ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ ì‰½ê²Œ í™•ì¥í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ë…¸ì´ì¦ˆì™€ ë¶ˆí™•ì‹¤ì„± ê´€ë¦¬:ìƒíƒœ ë°ì´í„°ëŠ” ì¢…ì¢… ë…¸ì´ì¦ˆê°€ ë§ê³  ë¶ˆí™•ì‹¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒíƒœ ì •ë³´ë¥¼ ë¨¼ì € ì²˜ë¦¬í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ í–‰ë™ê³¼ ê²°í•©í•¨ìœ¼ë¡œì¨, ë„¤íŠ¸ì›Œí¬ëŠ” ë…¸ì´ì¦ˆê°€ ê²°ê³¼ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ìµœì†Œí™”í•  ìˆ˜ ìˆìœ¼ë©°, ë” ì •í™•í•œ Q-ê°’ ì˜ˆì¸¡ì„ ìœ„í•œ ì •ë³´ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤. ì´ëŸ¬í•œ ì´ìœ ë¡œ, ìƒíƒœì™€ í–‰ë™ì„ ë‹¤ë¥¸ ì¸µì—ì„œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì€ ì¼ë°˜ì ìœ¼ë¡œ ë” ë‚˜ì€ ê²°ê³¼ë¥¼ ì œê³µí•˜ë©°, ê°•í™” í•™ìŠµ ì•Œê³ ë¦¬ì¦˜ì—ì„œ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì ‘ê·¼ ë°©ì‹ì…ë‹ˆë‹¤.ìœ„ì™€ ê°™ì€ ì´ìœ ë¡œ ì²«ë²ˆì§¸ layer ì— state ë¥¼ ë„£ê³ , ë‘ë²ˆì§¸ layer ì— action ì„ ì¶”ê°€í•˜ê¸° ìœ„í•´, layer ì˜ units ì„ í™•ì¥(concatenate) ì‹œí‚¬ ìˆ˜ ìˆëŠ” torch.cat((x, action), dim=-1) ë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤. ì—¬ê¸°ì„œ dim=-1ì€ x, ì™€ action í…ì„œì˜ ë§ˆì§€ë§‰ ì°¨ì›(ì—´) ê°¯ìˆ˜ì˜ í•©ìœ¼ë¡œ units í™•ì¥í•˜ì—¬ ê²°í•©ì‹œí‚¨ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.ë”°ë¼ì„œ í•´ë‹¹ ë„¤íŠ¸ì›Œí¬ë¥¼ ë„ì‹í™” í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.â€‹ì´ë¯¸ì§€ ì¶œì²˜5. Agent classclass DDPGAgent(): def __init__(self): self.actor = Actor().to(device) self.target_actor = copy.deepcopy(self.actor) self.actor_optimizer = torch.optim.Adam(self.actor.parameters(), lr=actor_lr) self.critic = Critic().to(device) self.target_critic = copy.deepcopy(self.cirtic) self.critic_optimizer = torch.optim.Adam(self.critic.parameters(), lr=critic_lr) self.OU = OU_noise() self.memory = deque(maxlen=mem_maxlen) self.writer = SummaryWriter(save_path) if load_model == True: checkpoint = torch.load(load_path+'/ckpt', map_location=device) self.actor.load_state_dict(checkpoint[\"actor\"]) self.target_actor.load_state_dict(checkpoint[\"actor\"]) self.actor_mitimizer.load_state_dict(checkpoint[\"actor_optimizer\"]) self.critic.load_state_dict(checkpoint[\"critic\"]) self.critic_optimizer.load_state_dic(checkpoint[\"critic_optimizer\"]) # OU noise ê¸°ë²•ì— ë”°ë¼ í–‰ë™ê²°ì • def get_action(self, state, training=True): # ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ ì„¤ì • self.actor.train(training) # í›ˆë ¨ ìƒíƒœë¡œ ì¤€ë¹„ (ex. Dropout layer ì¼ë¶€ ë…¸ë“œ ë¬´ì‘ìœ„ ë¹„í™œì„±í™”, ì…ë ¥ ì •ê·œí™” (BatchNorm layer)) action = self.actor(torch.FloatTensor(state).to(device)).cpu().detach().numpy() # train_mode -&gt; action + noise ë°˜í™˜ # test_mode -&gt; action ë°˜í™˜ return action + self.OU.sample() if training else action # ë¦¬í”Œë ˆì´ ë©”ëª¨ë¦¬ì— ë°ì´í„° ì¶”ê°€ (ìƒíƒœ, í–‰ë™, ë³´ìƒ, ë‹¤ìŒ ìƒíƒœ, ê²Œì„ ì¢…ë£Œ ì—¬ë¶€) def append_sample(self, state, action, reward, next_state, done): self.memory.append((state, action, reward, next_state, done)) def train_model(self): batch = random.sample(self.memory, batch_size) state = np.stack([b[0] for b in batch], axis=0) action = np.stack([b[1] for b in batch], axis=0) reward = np.stack([b[2] for b in batch], axis=0) next_state = np.stack([b[3] for b in batch], axis=0) done = np.stack([b[4] for b in batch], axis=0) state, action, reward, next_state, done = map( lambda x: torch.FloatTensor(x).to(device), [state, action, reward, next_state, done] ) # Critic update next_actions = self.target_action(next_state) # (1) next_q = self.target_critic(next_state, next_actions) # (2) target_q = reward + (1 - done) * discount_factor * next_q # (3) q = self.critic(state, action) # (4) critic_loss = F.mse_loss(target_q, q) # (5) # (6) self.critic_optimizer.zero_grad() critic_loss.backward() self.critic_optimizer.step() # Actor update action_pred = self.actor(state) # (7) actor_loss = -self.critic(state, action_pred).mean() # (8) # (9) self.actor_optimizer.zero_grad() actor_loss.backward() self.actor_optimizer.step() return actor_loss.item(), critic_loss.item() # soft target update def soft_update_target(self): for target_param, local_param in zip(self.target_actor.parameters(), self.actor.parameters()): target_param.data.copy_(tau * local_param.data + (1.0 - tau) * target_param.data) for target_param, local_param in zip(self.target_critic.parameters(), self.critic.parameters()): target_param.data.copy_(tau * local_param.data + ( 1.0 - tau) * target_param.data) # ë„¤íŠ¸ì›Œí¬ ëª¨ë¸ ì €ì¥ def save_model(self): print(f\"... Save Model to {save_path}/ckpt ...\") torch.save({ \"actor\" : self.actor.state_dict(), \"actor_optimizer\" : self.actor_optimizer.state_dict(), \"critic\" : self.critic.state_dict(), \"critic_optimizer\" : self.critic_optimizer.state_dict(), }, save_path+'/ckpt') # í•™ìŠµ ê¸°ë¡ def write_summary(self, score, actor_loss, critic_loss, step): self.writer.add_scalar(\"run/score\", score, step) self.writer.add_scalar(\"model/actor_loss\", actor_loss, step) self.writer.add_scalar(\"model/critic_loss\", critic_loss, step)train_model ë©”ì„œë“œ process ì§„í–‰ ê³¼ì • ë„ì‹ë„â€‹ì´ë¯¸ì§€ ì¶œì²˜6. Main í•¨ìˆ˜if __name__ == '__main__': # ìœ ë‹ˆí‹° í™˜ê²½ ê²½ë¡œ ì„¤ì • (file name) engine_configuration_channel = EngineConfigurationChannel() env = UnityEnvironment( file_name=env_name, side_channels=[engine_configuration_channel] ) env.reset() # ìœ ë‹ˆí‹° ë¸Œë ˆì¸ ì„¤ì • behavior_name = list(env.behavior_specs.keys())[0] spec = env.behavior_specs[behavior_name] engine_configuration_channel.set_configuration_parameters(time_scale=12.0) dec, term = env.get_steps(behavior_name) # DDPGAgent í´ë˜ìŠ¤ë¥¼ agent ë¡œ ì •ì˜ agent = DDPGAgent() actor_losses, critic_losses, scores, episode, score = [], [], [], 0, 0 for step in range(run_step + test_step): if step == run_step: if train_mode: agent.save_model() print(\"TEST START\") train_mode = False engine_configuration_channel.set_configuration_parameters(time_scale=1.0) state = dec.obs[0] # (1) action = agent.get_action(state, train_mode) # (2) action_tuple = ActionTuple() action_tuple.add_continuous(action) env.set_actions(behavior_name, action_tuple) # (3) env.step() # (4) dec, term = env.get_steps(behavior_name) # (5) done = len(term.agent_id) &gt; 0 reward = term.reward if done else dec.reward #(5.1) next_state = term.obs[0] if done else dec.obs[0] # (5.2) score += reward[0] if train_mode: # (6) agent.append_sample(state[0], action[0], reward, next_state[0], [done]) if train_mode and step &gt; max(batch_size, train_start_step): # í•™ìŠµìˆ˜í–‰ actor_loss, critic_loss = agent.train_model() # (7) actor_losses.append(actor_loss) critic_losses.append(critic_loss) # íƒ€ê²Ÿ ë„¤íŠ¸ì›Œí¬ ì†Œí”„ìŠ¤ ì—…ë°ì´íŠ¸ agent.soft_update_target() # (8) if done: episode += 1 scores.append(score) score = 0 # ê²Œì„ ì§„í–‰ ìƒí™© ì¶œë ¥ ë° í…ì„œë³´ë“œì— ë³´ìƒê³¼ ì†ì‹¤í•¨ìˆ˜ ê°’ ê¸°ë¡ if episode % print_interval == 0: mean_score = np.mean(scores) mean_actor_loss = np.mean(actor_losses) mean_critic_loss = np.mean(critic_losses) agent.write_summary(mean_score, mean_actor_loss, mean_critic_loss, step) actor_losses, critic_losses, scores = [], [], [] print(f\"{episode} Episode / Step: {step} / Score: {mean_score:.2f} / \"+\\ f\"Actor loss: {mean_actor_loss:.2f} / Critic loss: {mean_critic_loss:.4f}\") # ë„¤íŠ¸ì›Œí¬ ëª¨ë¸ ì €ì¥ if train_mode and episode % save_interval == 0: agent.save_model() env.close()í”„ë¡œê·¸ë¨ ì‹¤í–‰ ë„ì‹ë„â€‹ì´ë¯¸ì§€ ì¶œì²˜7. ì „ì²´ ì½”ë“œimport numpy as npimport randomimport copyimport datetimeimport platformimport torchimport torch.nn.functional as Ffrom torch.unils.tensorboard import SummaryWriterfrom collections import dequefrom mlagents_envs.environment import UnityEnvironment, ActionTuplefrom mlagents_envs.side_channel.engine_configuration_channel import EngineConfigurationChannel# DDPG íŒŒë¼ë¯¸í„° state_size = 9# í˜„ì¬ ë“œë¡ ì˜ ìœ„ì¹˜ - ê³¨ì¸ ì§€ì ì˜ ìœ„ì¹˜ (x, y, z)# í˜„ì¬ ë“œë¡ ì˜ ì†ë„ (x, y, z)# í˜„ì¬ ë“œë¡ ì˜ ê°ì†ë„ (x, y, z)# =&gt; ì´ 9ê°œ action_size = 3 # ê° ì¶•ë°©í–¥ ê°’load_model = Falsetrain_mode = Truebatch_size = 128mem_maxlen = 50000discount_factor = 0.9actor_lr = 1e-4 # actor network í•™ìŠµë¥ critic_lr = 5e-4 # critic network í•™ìŠµë¥ tau = 1e-3 # soft target update parameter# OU noise íŒŒë¼ë¯¸í„°mu = 0 # íšŒê·€í•  í‰ê· ê°’theta = 1e-3 # íšŒê·€ ì†ë„sigma = 2e-3 # ëœë¤ í”„ë¡œì„¸ìŠ¤ì˜ ë³€ë™ì„±run_step = 50000 if train_mode else 0test_step = 10000train_start_step = 5000print_interval = 10save_interval = 100# ìœ ë‹ˆí‹° í™˜ê²½ ê²½ë¡œgame = \"Drone\"os_name = platform.system()if os_name == 'Windows': env_name = f\"../envs/{game}_{os_name}/{game}\"elif os_name == 'Darwin': env_name = f\"../envs/{game}_{os_name}\"# ëª¨ë¸ ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸° ê²½ë¡œdate_time = datetime.datetime.now().strftime(\"%Y%m%d%H%M%S\")save_path = f\"./saved_models/{game}/DDPG/{date_time}\"load_path = f\"./saved_models/{game}/DDPG/202405071234\"# ì—°ì‚°ì¥ì¹˜device = torch.device(\"cuda\" if torch.cudoa.is_available() else \"cpu\")# OU noise í´ë˜ìŠ¤ -&gt; ou noise ì •ì˜ ë° íŒŒë¼ë¯¸í„° ê²°ì •class OU_noise: def __init__(self): self.reset() def reset(self): # noise reset self.X = np.ones((1, action_size), dtype=np.float32) * mu # [[0.0, 0.0, 0.0]] def sample(self): # noise sampling dx = theta * (mu - self.X) + sigma * np.random.randn(len(self.X)) # len(self.X) = 1 (1 * 3 size np array ì´ë¯€ë¡œ) # np.random.randn(1) : í‰ê·  0, í‘œì¤€í¸ì 1 ì •ê·œë¶„í¬ ë‚´ ì„ì˜ì˜ ê°’ 1ê°œ self.X += dx return self.x # Actor í´ë˜ìŠ¤class Actor(torch.nn.Module): def __init__(self): super(Actor, self).__init__() self.fc1 = torch.nn.Linear(state_size, 128) self.fc2 = torch.nn.Linear(128, 128) self.mu = torch.nn.Linear(128, action_size) def forward(self, state): x = torch.relu(self.fc1(state)) x = torch.relu(self.fc2(x)) return torch.tanh(self.mu(x)) # -1 ~ 1# Critic classclass Critic(torch.nn.Module): def __init__(self): super(Critic, self).__init__() self.fc1 = torch.nn.Linear(state_size, 128) self.fc2 = torch.nn.Linear(128 + action_size, 128) self.q = torch.nn.Linear(128, 1) # q ê°’ ë°˜í™˜ def forward(self, state, action): x = torch.relu(self.fc1(state)) x = torch.cat((x, action), dim=-1) x = torch.relu(self.fc2(x)) return self.q(x) # DDPGAgent class DDPGAgent(): def __init__(self): self.actor = Actor().to(device) self.target_actor = copy.deepcopy(self.actor) self.actor_optimizer = torch.optim.Adam(self.actor.parameters(), lr=actor_lr) self.critic = Critic().to(device) self.target_critic = copy.deepcopy(self.cirtic) self.critic_optimizer = torch.optim.Adam(self.critic.parameters(), lr=critic_lr) self.OU = OU_noise() self.memory = deque(maxlen=mem_maxlen) self.writer = SummaryWriter(save_path) if load_model == True: checkpoint = torch.load(load_path+'/ckpt', map_location=device) self.actor.load_state_dict(checkpoint[\"actor\"]) self.target_actor.load_state_dict(checkpoint[\"actor\"]) self.actor_mitimizer.load_state_dict(checkpoint[\"actor_optimizer\"]) self.critic.load_state_dict(checkpoint[\"critic\"]) self.critic_optimizer.load_state_dic(checkpoint[\"critic_optimizer\"]) # OU noise ê¸°ë²•ì— ë”°ë¼ í–‰ë™ê²°ì • def get_action(self, state, training=True): # ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ ì„¤ì • self.actor.train(training) # í›ˆë ¨ ìƒíƒœë¡œ ì¤€ë¹„ (ex. Dropout layer ì¼ë¶€ ë…¸ë“œ ë¬´ì‘ìœ„ ë¹„í™œì„±í™”, ì…ë ¥ ì •ê·œí™” (BatchNorm layer)) action = self.actor(torch.FloatTensor(state).to(device)).cpu().detach().numpy() # train_mode -&gt; action + noise ë°˜í™˜ # test_mode -&gt; action ë°˜í™˜ return action + self.OU.sample() if training else action # ë¦¬í”Œë ˆì´ ë©”ëª¨ë¦¬ì— ë°ì´í„° ì¶”ê°€ (ìƒíƒœ, í–‰ë™, ë³´ìƒ, ë‹¤ìŒ ìƒíƒœ, ê²Œì„ ì¢…ë£Œ ì—¬ë¶€) def append_sample(self, state, action, reward, next_state, done): self.memory.append((state, action, reward, next_state, done)) def train_model(self): batch = random.sample(self.memory, batch_size) state = np.stack([b[0] for b in batch], axis=0) action = np.stack([b[1] for b in batch], axis=0) reward = np.stack([b[2] for b in batch], axis=0) next_state = np.stack([b[3] for b in batch], axis=0) done = np.stack([b[4] for b in batch], axis=0) state, action, reward, next_state, done = map( lambda x: torch.FloatTensor(x).to(device), [state, action, reward, next_state, done] ) # Critic update next_actions = self.target_action(next_state) # (1) next_q = self.target_critic(next_state, next_actions) # (2) target_q = reward + (1 - done) * discount_factor * next_q # (3) q = self.critic(state, action) # (4) critic_loss = F.mse_loss(target_q, q) # (5) # (6) self.critic_optimizer.zero_grad() critic_loss.backward() self.critic_optimizer.step() # Actor update action_pred = self.actor(state) # (7) actor_loss = -self.critic(state, action_pred).mean() # (8) # (9) self.actor_optimizer.zero_grad() actor_loss.backward() self.actor_optimizer.step() return actor_loss.item(), critic_loss.item() # soft target update def soft_update_target(self): for target_param, local_param in zip(self.target_actor.parameters(), self.actor.parameters()): target_param.data.copy_(tau * local_param.data + (1.0 - tau) * target_param.data) for target_param, local_param in zip(self.target_critic.parameters(), self.critic.parameters()): target_param.data.copy_(tau * local_param.data + ( 1.0 - tau) * target_param.data) # ë„¤íŠ¸ì›Œí¬ ëª¨ë¸ ì €ì¥ def save_model(self): print(f\"... Save Model to {save_path}/ckpt ...\") torch.save({ \"actor\" : self.actor.state_dict(), \"actor_optimizer\" : self.actor_optimizer.state_dict(), \"critic\" : self.critic.state_dict(), \"critic_optimizer\" : self.critic_optimizer.state_dict(), }, save_path+'/ckpt') # í•™ìŠµ ê¸°ë¡ def write_summary(self, score, actor_loss, critic_loss, step): self.writer.add_scalar(\"run/score\", score, step) self.writer.add_scalar(\"model/actor_loss\", actor_loss, step) self.writer.add_scalar(\"model/critic_loss\", critic_loss, step)# Mainif __name__ == '__main__': # ìœ ë‹ˆí‹° í™˜ê²½ ê²½ë¡œ ì„¤ì • (file name) engine_configuration_channel = EngineConfigurationChannel() env = UnityEnvironment( file_name=env_name, side_channels=[engine_configuration_channel] ) env.reset() # ìœ ë‹ˆí‹° ë¸Œë ˆì¸ ì„¤ì • behavior_name = list(env.behavior_specs.keys())[0] spec = env.behavior_specs[behavior_name] engine_configuration_channel.set_configuration_parameters(time_scale=12.0) dec, term = env.get_steps(behavior_name) # DDPGAgent í´ë˜ìŠ¤ë¥¼ agent ë¡œ ì •ì˜ agent = DDPGAgent() actor_losses, critic_losses, scores, episode, score = [], [], [], 0, 0 for step in range(run_step + test_step): if step == run_step: if train_mode: agent.save_model() print(\"TEST START\") train_mode = False engine_configuration_channel.set_configuration_parameters(time_scale=1.0) state = dec.obs[0] # (1) action = agent.get_action(state, train_mode) # (2) action_tuple = ActionTuple() action_tuple.add_continuous(action) env.set_actions(behavior_name, action_tuple) # (3) env.step() # (4) dec, term = env.get_steps(behavior_name) # (5) done = len(term.agent_id) &gt; 0 reward = term.reward if done else dec.reward #(5.1) next_state = term.obs[0] if done else dec.obs[0] # (5.2) score += reward[0] if train_mode: # (6) agent.append_sample(state[0], action[0], reward, next_state[0], [done]) if train_mode and step &gt; max(batch_size, train_start_step): # í•™ìŠµìˆ˜í–‰ actor_loss, critic_loss = agent.train_model() # (7) actor_losses.append(actor_loss) critic_losses.append(critic_loss) # íƒ€ê²Ÿ ë„¤íŠ¸ì›Œí¬ ì†Œí”„ìŠ¤ ì—…ë°ì´íŠ¸ agent.soft_update_target() # (8) if done: episode += 1 scores.append(score) score = 0 # ê²Œì„ ì§„í–‰ ìƒí™© ì¶œë ¥ ë° í…ì„œë³´ë“œì— ë³´ìƒê³¼ ì†ì‹¤í•¨ìˆ˜ ê°’ ê¸°ë¡ if episode % print_interval == 0: mean_score = np.mean(scores) mean_actor_loss = np.mean(actor_losses) mean_critic_loss = np.mean(critic_losses) agent.write_summary(mean_score, mean_actor_loss, mean_critic_loss, step) actor_losses, critic_losses, scores = [], [], [] print(f\"{episode} Episode / Step: {step} / Score: {mean_score:.2f} / \"+\\ f\"Actor loss: {mean_actor_loss:.2f} / Critic loss: {mean_critic_loss:.4f}\") # ë„¤íŠ¸ì›Œí¬ ëª¨ë¸ ì €ì¥ if train_mode and episode % save_interval == 0: agent.save_model() env.close()"
    } ,
  
    {
      "title"       : "DDPG(Deep Deterministic Policy Gradient) Algorithm ì´í•´",
      "category"    : "",
      "tags"        : "DDPG, Deep Deterministic Policy Gradient, DQN",
      "url"         : "./DDPG1.html",
      "date"        : "2024-05-07 09:32:20 +0900",
      "description" : "DDPG(Deep Deterministic Policy Gradient) Algorithm ì´í•´",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ í•´ë‹¹ ë‚´ìš©ì€ ë‹¤ìŒì˜ ê°•ì˜ ë‚´ìš©ì„ ê°œì¸ì ìœ¼ë¡œ ì¬í•™ìŠµ í•˜ê¸° ìœ„í•´ ì‘ì„±ë¨. ì¸í”„ëŸ° - ìœ ë‹ˆí‹° ë¨¸ì‹ ëŸ¬ë‹ ì—ì´ì „íŠ¸ ì™„ì „ì •ë³µ (ê¸°ì´ˆí¸) | ë¯¼ê·œì‹1. ê¸°ì¡´ DQN ì˜ í•œê³„ì„ íƒí•˜ëŠ” action ì´ ì´ì‚°ì ì¸ í–‰ë™(ex. ìƒ, í•˜, ì¢Œ, ìš°)í™˜ê²½ì—ë§Œ ì ìš© ê°€ëŠ¥. ë”°ë¼ì„œ ë¡œë´‡ íŒ”ì˜ ì›€ì§ì„, ë¡œì½§ì˜ ì—”ì§„ ë¶„ì¶œëŸ‰ ì¡°ì ˆê³¼ ê°™ì€ ì—°ì†ì ì¸ ì„ íƒì˜ í™˜ê²½ì—ì„œ ì ìš© ë¶ˆê°€2. Deep Deterministic Policy Gradient (DDPG) Actor-Critic ê¸°ë°˜ ê°•í™”í•™ìŠµ ì•Œê³ ë¦¬ì¦˜ DPG(Deterministic Policy Gradient) ì•Œê³ ë¦¬ì¦˜ì„ ì‹ ê²½ë§ network ì— ì ìš© ì—°ì†ì ì¸ ê°’ ì¤‘ì—ì„œ í•œê°€ì§€ í–‰ë™ ê°’ì„ ì¶œë ¥ í–‰ë™ì„ ì„ íƒí•˜ëŠ” actor ì™€ í•´ë‹¹ í–‰ë™ì„ ì‹¤ì œë¡œ ìˆ˜í–‰í–ˆì„ ë•Œ ë‹¤ìŒ ìƒíƒœì—ì„œì˜ q ê°’ì„ í™•ì¸í•˜ëŠ” critic ìœ¼ë¡œ ê°•í™”í•™ìŠµì„ êµ¬í˜„3. DDPG ì•Œê³ ë¦¬ì¦˜ ê¸°ë²•3.1 ê²½í—˜ ë¦¬í”Œë ˆì´ (Experience Replay)DQN ì—ì„œ ì‚¬ìš©í•œ ë°”ì™€ ê°™ì´, í•™ìŠµì„ ìˆ˜í–‰í•˜ë©´ì„œ ê²½í—˜í•˜ëŠ” ì •ë³´ë¥¼ ì¼ì •ë‘ ë³´ê´€í•˜ê³ , í•´ë‹¹ ë°ì´í„°ë¥¼ ì„ì˜ì˜ Batch í¬ê¸°ë§Œí¼ì”© ê°€ì ¸ì™€ì„œ í›ˆë ¨ì‹œ ì‚¬ìš©. ë°ì´í„°ê°„ ìƒê´€ê´€ê³„ ë¬¸ì œë¥¼ í•´ê²°3.2 íƒ€ê²Ÿ ë„¤íŠ¸ì›Œí¬ (Target Network) - Soft Target Update ê¸°ë²•ê¸°ì¡´ DQN ì—ì„œëŠ” Target Network ì˜ ê²½ìš°, ë§¤ step ë§ˆë‹¤ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²½ìš°, Target ì•  ë§¤ í•™ìŠµë§ˆë‹¤ ë³€í™”í•˜ëŠ” ë¬¸ì œë¥¼ ë°œìƒì‹œí‚¤ê¸° ë•Œë¬¸ì—, Target Network ëŠ” ê³ ì •ì‹œí‚¨ ìƒíƒœë¡œ í•™ìŠµì„ ì§„í–‰. ì¼ì • ì£¼ê¸°ë§ˆë‹¤ í•™ìŠµ Network ì™€ ë™ê¸°í™” ì‹œì¼œ ì‚¬ìš©í•˜ì˜€ë‹¤.ê·¸ëŸ¬ë‚˜ ì—°ì†ì ì¸ ì„ íƒì—ì„œ ì´ëŸ¬í•œ Target Network update ëŠ” ë§ì§€ ì•Šì•„ Soft Target Update ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë§¤ step update ë¥¼ ì§„í–‰í•¨. ì§€ìˆ˜ì´ë™í‰ê· (Exponential Moving Average, EMA) ê³¼ ê°™ì€ ë°©ë²•ì„ í†µí•œ ì—…ë°ì´íŠ¸ Î¸ : í•™ìŠµì„ í†µí•´ ì‚°ì¶œëœ íŒŒë¼ë¯¸í„° Î¸- : Target Network íŒŒë¼ë¯¸í„° 0 &lt;= Ï„ &lt;= 1 ê°’ì„ í†µí•´ ê¸°ì¡´ Target Network Parameters ì—…ë°ì´íŠ¸ ìˆ˜ì¤€ì„ ì¡°ì ˆ. Ï„ == 0 : í•™ìŠµëœ íŒŒë¼ë¯¸í„°ë¡œ ì™„ì „ ì—…ë°ì´íŠ¸ (ê¸°ì¡´ DQN ë°©ì‹) 0 &lt; Ï„ &lt; 1 : ì¼ì • ë¹„ìœ¨ë¡œ ë¹„ë¡€í•´ì„œ í•™ìŠµëœ íŒŒë¼ë¯¸í„° ê°’ì„ ê¸°ì¡´ íƒ€ê²Ÿ ë„¤íŠ¸ì›Œí¬ íŒŒë¼ë¯¸í„°ì— ë°˜ì˜ 3.3 OU Noise ë¥¼ ì‚¬ìš©í•œ íƒí—˜ ì—­ì‹œ ì—°ì†ëœ í–‰ë™ í™˜ê²½ì—ì„œ ì„ íƒ ê°€ëŠ¥í•œ í–‰ë™ì˜ ìˆ˜ê°€ ë¬´í•œì´ë¯€ë¡œ ê¸°ì¡´ì˜ epsilon-greedy ê¸°ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ. ì‹¤ìˆ˜ ë²”ìœ„ì—ì„œ í–‰ë™ì„ ì„ íƒí•˜ì—¬ íƒí—˜í•  ìˆ˜ ìˆëŠ” ëœë¤ í‰ê·  íšŒê·€ ë…¸ì´ì¦ˆ ìƒì„± 1 ë²ˆ ì‹ì„ í†µí•´ í˜„ì¬ ìƒíƒœê°’ Xt ì—ì„œ ë‹¤ìŒ ìƒíƒœ Xt+1 ë¡œ ë³€ê²½ì‹œí‚¤ëŠ” ê·¸ ë³€ìœ„ dx ëŠ” 2ë²ˆ ì‹ê³¼ ê°™ì€ í˜•íƒœë¡œ êµ¬ì„±ëœë‹¤. 2 ë²ˆ ì‹ì˜ ìš°ë³€ ê°’ì„ ê²°ì •í•˜ëŠ” ìš”ì†Œë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. Î¸ : í‰ê·  íšŒê·€ ì†ë„, ì¦‰ ë³€ìˆ˜ê°€ í‰ê·  ê°’ ğœ‡ë¡œ ëŒì•„ê°€ë ¤ëŠ” ì†ë„ Î¼ : í‰ê·  ê°’ìœ¼ë¡œ, ì‹œìŠ¤í…œì´ ì¥ê¸°ì ìœ¼ë¡œ ì•ˆì •ë˜ë ¤ëŠ” ëª©í‘œ ìƒíƒœ Ïƒ : ë…¸ì´ì¦ˆì˜ í¬ê¸° ë˜ëŠ” ê°•ë„, ì‹œìŠ¤í…œì˜ ë³€ë™ì„±ì„ ê²°ì • dt : ì‹œê°„ ì¦ë¶„, ì¼ë°˜ì ìœ¼ë¡œ ë¯¸ë¶„ ë°©ì •ì‹ì„ ì‹œë®¬ë ˆì´ì…˜í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ì‹œê°„ì˜ ë‹¨ìœ„ dWt : ìœ„ë„ˆ ê³¼ì •(Wiener process) ë˜ëŠ” ë¸Œë¼ìš´ ìš´ë™ìœ¼ë¡œë¶€í„° íŒŒìƒëœ ì„ì˜ì˜ ì¶©ê²©. dt ì‹œê°„ ë™ì•ˆì˜ ë¬´ì‘ìœ„ ì›€ì§ì„ì„ í‘œí˜„ ì¦‰, Î¼ âˆ’ Xt ëŠ” Xt ê°€ ğœ‡ë¡œ íšŒê·€í•˜ë ¤ëŠ” ì •ë„ ë˜ëŠ” í˜„ì¬ ìœ„ì¹˜ì—ì„œ ëª©í‘œ ìœ„ì¹˜ê¹Œì§€ì˜ ì°¨ì´ë¥¼ ì˜ë¯¸í•œë‹¤. ê·¸ë¦¬ê³  ê·¸ íšŒê·€ê°€ ì–¼ë§ˆë‚˜ ë¹ ë¥¸ê°€ëŠ” Î¸ ì— ë¹„ë¡€í•œë‹¤. ë‹¤ë§Œ ÏƒdWt (ë…¸ì´ì¦ˆ * dt ì‹œê°„ ë™ì•ˆì˜ ë¬´ì‘ìœ„ ì›€ì§ì„) ê°€ í•­ìƒ ë”í•´ì§€ê³  ìˆìœ¼ë¯€ë¡œ, ëª©í‘œê°’ì— ë„ë‹¬í•˜ë”ë¼ë„ ì¼ì • ìˆ˜ì¤€ì˜ ì—°ì†ì ì¸ ë³€ë™ì´ ë°œìƒí•œë‹¤. â€‹ì´ë¯¸ì§€ ì¶œì²˜3.4 Critic Network UpdateDQN ê³¼ ë™ì¼í•˜ê²Œ ë²¨ë§Œ ë°©ì •ì‹ì„ ì‚¬ìš©í•˜ì—¬ Q(x) ê°€ ìµœëŒ€ì¸ ê°’ì„ íƒ€ê²Ÿê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•œë‹¤. â€‹ì†ì‹¤í•¨ìˆ˜ì˜ ê²½ìš°ë„ DQN ê³¼ ë™ì¼í•œ, ì°¨ì´ ì œê³± í‰ê·  (MSE) ì ìš©â€‹actor network update ëŠ” ëª©í‘œ í•¨ìˆ˜ê°’ë¥¼ ìµœëŒ€í•˜í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì •ì±…ì„ ì—…ë°ì´íŠ¸â€‹ì´ë¯¸ì§€ ì¶œì²˜ëª©í‘œ í•¨ìˆ˜ë¥¼ ìµœëŒ€í™” í•˜ëŠ” ë°©í–¥ ê³„ì‚°ì„ ìœ„í•œ gradient (ì•„ë˜ ìœ ë„ ê³¼ì •ì€ ì•„ì§ ì´í•´ X ;;)â€‹ì´ë¯¸ì§€ ì¶œì²˜4. DDPG ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œ network í•™ìŠµ í”„ë¡œì„¸ìŠ¤â€‹ì´ë¯¸ì§€ ì¶œì²˜ Agent ê°€ í™˜ê²½ê³¼ ìƒí˜¸ì‘ìš© (ìƒíƒœ ì „ì´) ìƒí˜¸ì‘ìš©ì‹œ Agent ì˜ í–‰ë™ì„ ê²°ì •í•˜ëŠ” ê²ƒì€ Actor Network (input: í˜„ì¬ ìƒíƒœ s -&gt; output : í–‰ë™ a)ë‹¤ë§Œ ì´ë•Œ, í–‰ë™ì€ ì—°ì†ì ë©°, ì´ëŸ° ì—°ì†ì  í–‰ë™ ì„ íƒì—ì„œ OU noise ë¥¼ ì¶”ê°€í•˜ì—¬ íƒí—˜ì„ ìˆ˜í–‰ 2ë²ˆìœ¼ë¡œ ì„ íƒëœ í–‰ë™ì„ í™˜ê²½ì— ì ìš©, ë‹¤ìŒ ë‹¨ê³„ì˜ ìƒíƒœ (ê²½í—˜) ì„ ìƒì„±. ê²½í—˜ ë°ì´í„°ë¥¼ replay memory ì— ì €ì¥ (ê²½í—˜ ë°ì´í„°ê°€ ì¼ì •ëŸ‰ ì´ìƒ ìŒ“ì´ ì´í›„), mini batch data ë¥¼ sampling í•˜ì—¬ í•™ìŠµì„ ìˆ˜í–‰ critic network í•™ìŠµ (input : ìƒíƒœ, í–‰ë™ -&gt; output : Q(s, a) ê°’) 6.1 (ì¼ë°˜) Critic Network (input : s, a -&gt; output: q) 6.2 Traget Critic Network (input : sâ€™, aâ€™ -&gt; output: qâ€™) 6.3 6.1 6.2 ê²°ê³¼ê°’ì˜ ì°¨ì´ë¥¼ í†µí•´ ì†ì‹¤ê°’ì„ ê³„ì‚° 6.4 ì†ì‹¤ê°’ì´ ìµœì†Œí™” ë˜ë„ë¡ critic network ë¥¼ update 6.5 ë§¤ step ë§ˆë‹¤ soft target update ë¡œ critic network ë¥¼ í†µí•´ target critic network ë¥¼ update Critic Network ì˜ q ê°’ì„ ìµœëŒ€í™”í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ Policy Gradient ë¥¼ í†µí•´ Actor Network ì„ í•™ìŠµì‹œí‚´. 6.5 ì™€ ë™ì¼í•˜ê²Œ ë§¤ step ë§ˆë‹¤ (ì¼ë°˜) soft target update ë¡œ actor network ë¥¼ í†µí•´ target actor network ë¥¼ update"
    } ,
  
    {
      "title"       : "Deep Q-Network + ML-agents êµ¬í˜„",
      "category"    : "",
      "tags"        : "cuda, pytorch, unity, dqn, ml-agents",
      "url"         : "./DQN_ml_agents.html",
      "date"        : "2024-05-03 09:32:20 +0900",
      "description" : "Deep Q-Network + ML-agents êµ¬í˜„",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ í•´ë‹¹ ë‚´ìš©ì€ ë‹¤ìŒì˜ ê°•ì˜ ë‚´ìš©ì„ ê°œì¸ì ìœ¼ë¡œ ì¬í•™ìŠµ í•˜ê¸° ìœ„í•´ ì‘ì„±ë¨. ì¸í”„ëŸ° - ìœ ë‹ˆí‹° ë¨¸ì‹ ëŸ¬ë‹ ì—ì´ì „íŠ¸ ì™„ì „ì •ë³µ (ê¸°ì´ˆí¸) | ë¯¼ê·œì‹ DQN ì•Œê³ ë¦¬ì¦˜ì˜ ì „ì²´ íë¦„ ì´ë¯¸ì§€ ì¶œì²˜0. ì „ì²´ ì½”ë“œ ìš”ì•½ì „ì²´ ì½”ë“œëŠ” ë‹¤ìŒì˜ ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±ëœë‹¤. í”„ë¡œê·¸ë¨ ê¸°ë³¸ ì„¤ì • í•„ìš”í•œ íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸° íŒŒë¼ë¯¸í„° ì„¤ì • ìœ ë‹ˆí‹° ì—°ê²° í™˜ê²½ ì„¤ì • í•™ìŠµëœ ëª¨ë¸ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ì—°ì‚°ì¥ì¹˜ (CPU or GPU) ì„ íƒ Deep Q-Network class ì •ì˜ Layer êµ¬í˜„ (ì…/ì¶œë ¥, Convolution layer ì •ì˜) ì‹ ê²½ë§ í•¨ìˆ˜ DQNAgent class ì •ì˜ Agent êµ¬í˜„ í™˜ê²½ ì •ì˜(ex. network, optimizer, memory) network ë¥¼ í†µí•œ action ì„ íƒ í•¨ìˆ˜ replay memory ì— ë°ì´í„° ì¶”ê°€ í•¨ìˆ˜ network parameter í•™ìŠµ ì‹œí‚¤ëŠ” í•¨ìˆ˜ target_network update í•¨ìˆ˜ ëª¨ë¸ ì €ì¥ í•¨ìˆ˜ tensorboard ê¸°ë¡ í•¨ìˆ˜ í”„ë¡œê·¸ë¨ ë™ì‘ êµ¬í˜„ (main) unity ì™€ ìƒí˜¸ ì‘ìš©ì´ ê°€ëŠ¥í•œ UnityEnvironment ì¸ìŠ¤í„´ìŠ¤(env) ìƒì„± env ë¡œ ë¶€í„° ê´€ì¸¡/target ê³µê°„ ì •ë³´, step ì§„í–‰ í›„ ì •ë³´ ë° êµ¬ë™ í™˜ê²½(time scale) ì„¤ì • ë°˜ë³µë¬¸ì„ í†µí•´ run_step + test_step ë™ì•ˆ í•™ìŠµì„ ì§„í–‰ì‹œí‚´ (run_step ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œ ëª¨ë¸ì„ ì €ì¥í•˜ê³  test_mode ë¡œ ì „í™˜) ì „ì²˜ë¦¬: ì‹œê°ì  ê´€ì¸¡ ì •ë³´ì™€ ëª©ì ì§€ ê´€ì¸¡ ì •ë³´ë¥¼ ì „ì²˜ë¦¬í•˜ì—¬ state ë¡œ ì €ì¥ agent ë¥¼ í†µí•´ action ì„ ê²°ì •í•˜ê³ , í•´ë‹¹ action ìœ¼ë¡œ unity ì—ì„œ ë‹¤ìŒ step ì„ ì§„í–‰ì‹œí‚´ ì§„í–‰ëœ í˜„ì¬ step ì •ë³´ ê°€ì ¸ì˜´ ì¢…ë£Œ(termination) í™•ì¸ ë° next_step -&gt; next_state ì •ë³´ë¡œ ì „ì²˜ë¦¬ (train mode ì¼ ê²½ìš°) next_state ë¥¼ replay memory ì— ì €ì¥ ì¶©ë¶„íˆ ë©”ëª¨ë¦¬ì— state ì •ë³´ê°€ ì°¨ ìˆë‹¤ë©´, ëª¨ë¸ í•™ìŠµìœ¼ë¡œ ì†ì‹¤ê°’ì„ ê³„ì‚°í•˜ê³ , ì¼ì • ì£¼ê¸°ë¡œ target_model ì„ update í•¨. episode ì¢…ë£Œ ì‹œ, í•„ìš”í•œ ì„¤ì •ê°’ì„ ì¡°ì •í•˜ê³ , tensorboard ì— ë³´ìƒ/ì†ì‹¤ ê°’ì„ ê¸°ë¡, í•„ìš” ì¡°ê±´ë§ˆë‹¤ í›ˆë ¨ëœ ëª¨ë¸ ì €ì¥ 1. í”„ë¡œê·¸ë¨ ê¸°ë³¸ ì„¤ì •1.1 í•„ìš”í•œ íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°import numpy as npimport randomimport copyimport datetimeimport platform # system (OS) ê´€ë ¨import torchimport torch.nn.functional as Ffrom troch.utils.tensorboard import SummaryWriterfrom collections import dequefrom mlagetns_envs.environment import UnityEnvironment, ActionTuple # (1)from malagents_envs.side_channel.engine_configuration_channel import EngineConfigurationChannel # (2)(1) ìœ ë‹ˆí‹° í™˜ê²½ í´ë˜ìŠ¤, ì•¡ì…˜ì„ í™˜ê²½ì— ì „ë‹¬í•˜ê¸° ìœ„í•œ í™˜ê²½ ê°ì²´ (2) ìœ ë‹ˆí‹° í™˜ê²½ ì¡°ê±´ì„ ì¡°ì •í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ex. íƒ€ì„ ìŠ¤ì¼€ì¼ ì¡°ì ˆ)1.2 íŒŒë¼ë¯¸í„° ì„¤ì •state_size = [3*2, 64, 84] # goal-plus RGB + goal-ex RGB =&gt; 6 ì±„ë„ * h * w (ì•„ë˜ ì´ë¯¸ì§€ ì°¸ì¡°)action_size = 4 # ì˜¤ë¥¸ìª½, ì™¼ìª½, ìœ„, ì•„ë˜load_model = False # ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ê¸° ì—¬ë¶€train_mode = True # ëª¨ë¸ í•™ìŠµ ì—¬ë¶€ (True : í•™ìŠµëª¨ë“œ, False: í‰ê°€ëª¨ë“œ)batch_size = 32mem_maxlen = 10000 # replay memory ìµœëŒ€ í¬ê¸°discount_factor = 0.9 # ë¯¸ë˜ì— ëŒ€í•œ ë³´ìƒ ê°ê°€ìœ¨learning_rate = 0.00025 # ë„¤íŠ¸ì›Œí¬ í•™ìŠµë¥ run_step = 50000 if train_mode else 0 # í•™ìŠµëª¨ë“œì—ì„œ ì§„í–‰í•  ìŠ¤í… ìˆ˜ ì„¤ì • (í‰ê°€ ëª¨ë“œ = 0)test_step = 5000 # í‰ê°€ ëª¨ë“œì—ì„œ ì§„í–‰í•  ìŠ¤í… ìˆ˜train_start_step = 5000 # í•™ìŠµ ì‹œì‘ ì „ì— ë¦¬í”Œë ˆì´ ë©”ëª¨ë¦¬ì— ì¶©ë¶„í•œ ë°ì´í„°ë¥¼ ëª¨ìœ¼ê¸° ìœ„í•´ ëª‡ ìŠ¤í…ë™ì•ˆ ì„ì˜ì˜ í–‰ë™ìœ¼ë¡œ ê²Œì„ ì§„í–‰í•  ê²ƒì¸ì§€ ì„¤ì •target_update_step = 500 # íƒ€ê²Ÿ ë„¤íŠ¸ì›Œí¬ë¥¼ ëª‡ ìŠ¤í… ì£¼ê¸°ë¡œ ì—…ë°ì´íŠ¸ í• ì§€ ì„¤ì •print_interval = 10 # í•™ìŠµ ì§„í–‰ ìƒí™©ì„ í…ì„œë³´ë“œì— ê¸°ë¡í•  ì£¼ê¸°save_interval = 100 # í•™ìŠµ ëª¨ë¸ì„ ì €ì¥í•  ì—í”¼ìŠ¤ë“œ ì£¼ê¸° ì„¤ì •epsilon_eval = 0.05 # í‰ê°€ëª¨ë“œì˜ eps ê°’epsilon_init = 1.0 if train_mode else epsilon_eval # eps ì´ˆê¸°ê°’epsilon_min = 0.1 # í•™ìŠµêµ¬ê°„ì—ì„œì˜ eps ìµœì†Œê°’explore_step = run_step * 0.8 # eps ì´ ê°ì†Œë˜ëŠ” êµ¬ê°„eplsilon_data = (epsilon_init - epsilon_min) / explore_step if train_mode else 0.05 # í•œìŠ¤í…ë‹¹ ê°ì†Œí•˜ëŠ” eps ë³€í™”ëŸ‰# ë‹¤ìŒì˜ íŒŒë¼ë¯¸í„° ê°’ë“¤ì€ ì‹¤ì œ ë°ì´í„°ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì¸ë±ìŠ¤, ì¦‰ enum ê³¼ ìœ ì‚¬í•œ ê°œë…ìœ¼ë¡œ ì‚¬ìš©ë¨.VISUAL_OBS = 0 # ì‹œê°ì  ê´€ì¸¡ ë°ì´í„°. ì—ì´ì „íŠ¸ê°€ ì´ë¯¸ì§€ í˜•íƒœë¡œ ê´€ì¸¡í•˜ëŠ” ì •ë³´ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì¸ë±ìŠ¤ GOAL_OBS = 1 # ëª©ì ì§€ ê´€ì¸¡ ë°ì´í„°. ì—ì´ì „íŠ¸ê°€ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ëŠ”ë° í•„ìš”í•œ ì •í¬ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì¸ë±ìŠ¤VECTOR_OBS = 2 # ìˆ˜ì¹˜ì  ê´€ì¸¡ ì¸ë±ìŠ¤. ì—ì´ì „íŠ¸ê°€ ë²¡í„° í˜•íƒœë¡œ ê´€ì¸¡í•˜ëŠ” ì •ë³´ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì¸ë±ìŠ¤OBS = VISUAL_OBS # DQN ì—ì„œëŠ” ì‹œê°ì  ê´€ì¸¡ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš© state_size = [3*2, 64, 84] ê´€ë ¨ ì´ë¯¸ì§€ì´ë¯¸ì§€ ì¶œì²˜ epsilon-greedy ë¥¼ ì ìš©í•œ í•™ìŠµì—ì„œ ê° íŒŒë¼ë¯¸í„°ë“¤ì˜ ì‚¬ìš© ê·¸ë˜í”„ì´ë¯¸ì§€ ì¶œì²˜1.3 ìœ ë‹ˆí‹° ì—°ê²° í™˜ê²½ ì„¤ì •game = \"GridWorld\" # í™˜ê²½ ë¹Œë“œëª… os_name = platform.system() # í˜„ì¬ ì‚¬ìš© OSif os_name == 'Windows': env_name = f\"../envs/{game}_{os_name}/{game}\" # ë¶ˆëŸ¬ì˜¬ ìœ ë‹ˆí‹° í™˜ê²½ ê²½ë¡œelif os_name == 'Darwin': # Mac OS env_name = f\"../envs/{game}_{os_name}\"1.4 í•™ìŠµëœ ëª¨ë¸ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°date_time = datetime.datetime.now().strftime(\"%Y%m%d%H%M%S\")save_path = f\"./saved_models/{game}/DQN/{date_time}\" # ëª¨ë¸ íŒŒì¼ì¼ ì €ì¥ë  ê²½ë¡œload_path = f\"./saved_models/{game}/DQN/20240503201212\" # ë¶ˆëŸ¬ì˜¬ ëª¨ë¸ íŒŒì¼ ê²½ë¡œ1.5 ì—°ì‚°ì¥ì¹˜ (CPU or GPU) ì„ íƒdevice = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\") # ì—°ì‚° ì¥ì¹˜ (CPU or GPU)2. Deep Q-Network class ì •ì˜class DQN(torch.nn.Module): # 2.1 Layer êµ¬í˜„ (ì…/ì¶œë ¥, Convolution layer ì •ì˜) def __init__(self, **kwargs): super(DQN, self).__init__(**kwargs) self.conv1 = torch.nn.Conv2d( in_channels=state_size[0], out_channels=32, kernel_size=8, stride=4 ) dim1 = ((state_size[1] - 8)//4 + 1, (state_size[2] - 8)//4 + 1) self.conv2 = torch.nn.Conv2d( in_channels=32, out_channels=64, kernel_size=4, stride=2 ) dim2 = ((dim1[0] - 4)//2 + 1, (dim1[1] - 4)//2 + 1) self.conv3 = torch.nn.Conv2d( in_channels=64, out_channels=64, kernel_size=3, stride=1 ) dim3 = ((dim2[0] - 3)//1 + 1, (dim2[1] - 3)//1 + 1) self.flat = torch.nn.Flatten() # ì „ì²´ í…ì„œë¥¼ 1ì°¨ì›ì„ ë³€í™˜ self.fc1 = torch.nn.Linear(64*dim3[0]*dim3[1], 512) # ì™„ì „ ì—°ê²° ë ˆì´ì–´ë¥¼ ë§Œë“¤ì–´ ì£¼ê¸° ìœ„í•¨. self.q = torch.nn.Linear(512, action_size) # 2.2 ì‹ ê²½ë§ í•¨ìˆ˜ def forward(self, x): x = x.permute(0, 3, 1, 2) # ë°ì´í„° ì°¨ì› ìˆœì„œ ë³€í™˜ input : unity data (H, W, Ch) -&gt; pytorch data (Ch, H, W) x = F.relu(self.conv1(x)) x = F.relu(self.conv2(x)) x = F.relu(self.conv3(x)) x = self.flat(x) x = F.relu(self.fc1(x)) return self.q(x)2.1 Layer êµ¬í˜„ (ì…/ì¶œë ¥, Convolution layer ì •ì˜)ML-Agents ë¥¼ ì‚¬ìš©í•˜ì—¬ unity ë¶€í„° ìƒíƒœ ì •ë³´ë¥¼ ë°›ì„ ë•Œ, agent ì— ì„¤ì •ëœ ì¹´ë©”ë¼ë¥¼ í†µí•œ ì´ë¯¸ì§€ë¥¼ ë°›ì•„ ì‚¬ìš©í•˜ê±°ë‚˜, í•´ë‹¹ í™˜ê²½ì—ì„œì˜ ì¢Œí‘œê°’ (vector) ê°’ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í•´ë‹¹ ëª¨ë¸ì—ì„œëŠ” ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬í•  ê²ƒì´ë¯€ë¡œ, ì´ë¯¸ì§€ ì²˜ë¦¬ì— ì í•©í•œ convolution layer ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬í•˜ëŠ” ê²ƒìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆë‹¤. convolution layer + flattent layer + linear layer ì˜ ì—°ê²° ì´ë¯¸ì§€ì´ë¯¸ì§€ ì¶œì²˜2.2 ì‹ ê²½ë§ í•¨ìˆ˜ì¼ë°˜ì ìœ¼ë¡œ PyTorch ì—ì„œ ì‹ ê²½ë§ ëª¨ë¸ êµ¬í˜„ í´ë˜ìŠ¤ëŠ” torch.nn.Module ì„ ìƒì†ë°›ì•„ ì‚¬ìš©í•œë‹¤. í•´ë‹¹ ë¶€ëª¨ class ì— __call__ ë©”ì„œë“œ ìƒ ì •ì˜ì— ì˜í•´ í•´ë‹¹ class ëª…ìœ¼ë¡œ ìš”ì²­ (ex. DQN())ì‹œ forward ë©”ì„œë“œê°€ ì‹¤í–‰ ìš”ì²­ëœë‹¤. êµ¬í˜„ëœ ì‹ ê²½ë§ ëª¨ë¸ ê°œë…ë„ì´ë¯¸ì§€ ì¶œì²˜3. DQNAgent class ì •ì˜class DQNAgent: # 3.1 Agent êµ¬í˜„ í™˜ê²½ ì •ì˜(ex. network, optimizer, memory) def __init__(self): self.network = DQN().to(device) self.target_network = copy.deepcopy(self.network) self.optimizer = torch.optim.Adam(self.network.parameters(), lr=learning_rate) self.memory = deque(maxlen=mem_maxlen) self.epsilon = epsilon_init self.writer = SummaryWriter(save_path) if load_model == True: print(f\"... Load Model from {load_path}/ckpt\") checkpoint = torch.load(load_path+'/ckpt', map_location=device) self.network.load_state_dict(checkpoint[\"network\"]) self.target_network.load_state_dict(checkpoint[\"network\"]) self.optimizer.load_state_dict(checkpoint[\"optimizer\"]) # 3.2 network ë¥¼ í†µí•œ action ì„ íƒ í•¨ìˆ˜ def get_action(self, state, training=True): self.network.train(training) epsilon = self.epsilon if training else epsilon_eval if epsilon &gt; random.random(): action = np.random.randint(0, action_size, size=(state.shape[0], 1)) else: q = self.network(torch.FloatTensor(state).to(device)) action = torch.argmax(q, axis=-1, keepdim=True).data.cpu().numpy() return action # 3.3 replay memory ì— ë°ì´í„° ì¶”ê°€ í•¨ìˆ˜ def append_sample(self, state, action, reward, next_state, done): self.memory.append((state, action, reward, next_state, done)) # 3.4 network parameter í•™ìŠµ ì‹œí‚¤ëŠ” í•¨ìˆ˜ def train_model(self): batch = random.sample(self.memory, batch_size) state = np.stack([b[0] for b in batch], axis=0) action = np.stack([b[1] for b in batch], axis=0) reward = np.stack([b[2] for b in batch], axis=0) next_state = np.stack([b[3] for b in batch], axis=0) done = np.stack([b[4] for b in batch], axis=0) state, action, reward, next_state, done = map( lambda x: torch.FloatTensor(x).to(device), [state, action, reward, next_state, done] ) eye = torch.eye(action_size).to(device) one_hot_action = eye[action.view(-1).long()] q = (self.network(state) * one_hot_action).sum(1, keepdims=True) with torch.no_grad(): next_q = self.target_network(next_state) target_q = reward + next_q.max(1, keepdims=True).values * ((1 - done) * discount_factor) loss = F.smooth_l1_loss(q, target_q) self.optimizer.zero_grad() loss.backward() self.optimizer.step() self.epsilon = max(epsilon_min, self.epsilon - eplsilon_data) return loss.item() # 3.5 target_network update í•¨ìˆ˜ def update_target(self): self.target_network.load_state_dict(self.network.state_dict()) # ëª¨ë¸ ì €ì¥ í•¨ìˆ˜ def save_model(self): print(f\"... Save Model to {save_path}/ckpt ...\") torch.save({ \"network\" : self.network.state_dict(), \"optimizer\" : self.optimizer.state_dict(), }, save_path+'/ckpt') # tesorboard ê¸°ë¡ def write_summary(self, score, loss, epsilon, step): self.writer.add_scalar(\"run/score\", score, step) self.writer.add_scalar(\"model/loss\", loss, step) self.writer.add_scalar(\"model/epsilon\", epsilon, step)3.1 Agent êµ¬í˜„ í™˜ê²½ ì •ì˜(ex. network, optimizer, memory) def __init__(self): self.network = DQN().to(device) # (1) self.target_network = copy.deepcopy(self.network) # (2) self.optimizer = torch.optim.Adam(self.network.parameters(), lr=learning_rate) self.memory = deque(maxlen=mem_maxlen) # (3) self.epsilon = epsilon_init # (4) self.writer = SummaryWriter(save_path) if load_model == True: # (5) print(f\"... Load Model from {load_path}/ckpt\") checkpoint = torch.load(load_path+'/ckpt', map_location=device) self.network.load_state_dict(checkpoint[\"network\"]) self.target_network.load_state_dict(checkpoint[\"network\"]) self.optimizer.load_state_dict(checkpoint[\"optimizer\"])(1) self.network = DQN().to(device) í›ˆë ¨ì— ì‚¬ìš©í•  network ë¥¼ DQN ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì—°ì‚° device ë©”ëª¨ë¦¬ì— ë„£ëŠ”ë‹¤.(2) self.target_network = copy.deepcopy(self.network) ì´ˆê¸° Target_network ì„¤ì •ì€ í›ˆë ¨ìš©ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •ë˜ë¯€ë¡œ ê·¸ëŒ€ë¡œ ê¹Šì€ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©(3) self.memory = deque(maxlen=mem_maxlen) replay memory ë¡œ ì‚¬ìš©ë  ìë£Œ êµ¬ì¡°ëŠ” FIFO êµ¬ì¡°ì¸ deque ë¥¼ ì‚¬ìš©(4) self.epsilon = epsilon_init ì´ˆê¸° ì„¤ì • epsilon ê°’ìœ¼ë¡œ ì‚¬ìš©ë˜ë©°, í›ˆë ¨ì´ ë°˜ë³µë˜ë©´ì„œ ì•ì—ì„œ ì–¸ê¸‰ëœ ê·¸ë˜í”„ì˜ í˜•íƒœì™€ ê°™ì´ epsilon ê°’ì„ ì‘ê²Œ í•˜ì—¬ ë¬´ì‘ìœ„ ìš”ì†Œë¥¼ ì ì°¨ ì¤„ì—¬ ë‚˜ê°„ë‹¤.(5) if load_model == True: ë§Œì•½ ê¸°ì¡´ì— ì €ì¥ëœ model ì„ ì‚¬ìš©í•˜ê³ ì í•  ê²½ìš°, í•´ë‹¹ ì¡°ê±´ë¬¸ ì‹¤í–‰ìœ¼ë¡œ ê¸°ì¡´ ëª¨ë¸ì„ ê°€ì ¸ì™€ì„œ ì‹¤í–‰3.2 network ë¥¼ í†µí•œ action ì„ íƒ í•¨ìˆ˜ def get_action(self, state, training=True): self.network.train(training) epsilon = self.epsilon if training else epsilon_eval if epsilon &gt; random.random(): action = np.random.randint(0, action_size, size=(state.shape[0], 1)) else: q = self.network(torch.FloatTensor(state).to(device)) action = torch.argmax(q, axis=-1, keepdim=True).data.cpu().numpy() return actionë‹¤ìŒê³¼ ê°™ì´ epsilon-greedy ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë¬´ì‘ìœ„ ê°’ ë˜ëŠ” ê°€ì¥ í° qê°’ì„ ê°€ì§„ idx í–‰ë™ì„ ì„ íƒì´ë¯¸ì§€ ì¶œì²˜3.3 replay memory ì— ë°ì´í„° ì¶”ê°€ í•¨ìˆ˜ def append_sample(self, state, action, reward, next_state, done): self.memory.append((state, action, reward, next_state, done))replay momory ì— ê° ìƒíƒœ ê°’ë“¤ì„ ì¶”ê°€3.4 network parameter í•™ìŠµ ì‹œí‚¤ëŠ” í•¨ìˆ˜def train_model(self): batch = random.sample(self.memory, batch_size) # (1) state = np.stack([b[0] for b in batch], axis=0) # (2) action = np.stack([b[1] for b in batch], axis=0) reward = np.stack([b[2] for b in batch], axis=0) next_state = np.stack([b[3] for b in batch], axis=0) done = np.stack([b[4] for b in batch], axis=0) state, action, reward, next_state, done = map( lambda x: torch.FloatTensor(x).to(device), [state, action, reward, next_state, done] ) # (3) eye = torch.eye(action_size).to(device) # (4) one_hot_action = eye[action.view(-1).long()] # (5) q = (self.network(state) * one_hot_action).sum(1, keepdims=True) # (6) with torch.no_grad(): # (7) next_q = self.target_network(next_state) # (8) target_q = reward + next_q.max(1, keepdims=True).values * ((1 - done) * discount_factor) #(9) loss = F.smooth_l1_loss(q, target_q) # (10) # model update self.optimizer.zero_grad() # ê¸°ìš¸ê¸° ì´ˆê¸°í™” loss.backward() # ì—­ì „íŒŒë¥¼ í†µí•´ gradient ê³„ì‚° self.optimizer.step() # model parameter update # eps ê°ì†Œ (í›ˆë ¨ì´ ì§„í–‰ë¨ì— ë”°ë¼ ë¬´ì‘ìœ„ ì ìš© í™•ë¥ ë¥¼ ì°¨ì¸° ì¤„ì—¬ë‚˜ê°) self.epsilon = max(epsilon_min, self.epsilon - eplsilon_data) return loss.item()(1) batch = random.sample(self.memory, batch_size)replay memory ì— ì €ì¥ëœ ê°’ë“¤ ì¤‘ ì„ì˜ì˜ ê°’ì„ ê°€ì ¸ì˜´ìœ¼ë¡œì¨, ê°€ì ¸ì˜¤ëŠ” ë°ì´í„°ë“¤ ê°„ ìƒê´€ ê´€ê³„ê°€ ì¡´ì¬í•˜ì§€ ì•Šê²Œë˜ì–´, ê³¼ì í•© ë˜ëŠ” ì„ í˜• ê·¼ì‚¬ê°€ ë°œìƒí•˜ëŠ”ê²ƒì„ ë°©ì§€ í•œë‹¤.ì•„ë˜ ì´ë¯¸ì§€ëŠ” í•˜ë‚˜ì˜ episode ë˜ëŠ” ê·¼ë°©ì—ì„œ í›ˆë ¨ëœ step ê°„ ë™ì¼ ìƒ‰ìœ¼ë¡œ í‘œí˜„í•˜ì˜€ë‹¤. ê·¸ë¦¼ê³¼ ê°™ì´ ê·¼ë°©ì˜ step ë¼ë¦¬ í•™ìŠµì„ ì§„í–‰í•˜ë©´ ì „ì²´ ë°ì´í„°ì— ëŒ€í•œ ê·¼ì‚¬ í•¨ìˆ˜ê°€ ì•„ë‹Œ ê°ê°ì— ê·¼ì ‘í•œ step ì— ëŒ€í•œ í•¨ìˆ˜ë¡œ ê°ê° ê·¼ì‚¬ë˜ê²Œ ëœë‹¤.ì´ë¯¸ì§€ ì¶œì²˜ë”°ë¼ì„œ í•´ë‹¹ ë¬¸ì œë¥¼ ë§‰ê¸° ìœ„í•´ í•œë²ˆì— í•™ìŠµë˜ëŠ” step ë“¤ì„ ë¬´ì‘ìœ„ ë¶„í¬ì—ì„œ ì¶”ì¶œí•´ì•¼ ì•„ë˜ì™€ ê°™ì´ ì „ì²´ì— ëŒ€í•œ ê·¼ì‚¬í•¨ìˆ˜ë¥¼ ì–»ì„ ìˆ˜ ìˆê²Œ ëœë‹¤.ì´ë¯¸ì§€ ì¶œì²˜(2) state = np.stack([b[0] for b in batch], axis=0) ì¶”ì¶œëœ batch ê°’ì—ì„œ state, action, reward, next_state, done ê°’ë“¤ì„ ê°ê°ì˜ array ê°’ìœ¼ë¡œ ì¶”ì¶œí•œë‹¤.(3) state, action, reward, next_state, done = map( lambda x: torch.FloatTensor(x).to(device), [state, action, reward, next_state, done] ) ê° ìƒíƒœê°’ë“¤ì˜ array ê°’ë“¤ì„ ì‹¤ìˆ˜í˜• tensor ë¡œ íƒ€ì… ë³€í™˜ í›„, device ë©”ëª¨ë¦¬ì— ì¶”ê°€(4) eye = torch.eye(action_size).to(device) ì£¼ ëŒ€ê°ì„  ê°’ 1, ë‚˜ë¨¸ì§€ ìš”ì†ŒëŠ” 0ì¸ 2ì°¨ì› ë°°ì—´ (4 * 4 (action_size))ì„ ìƒì„±í•˜ì—¬ device ë©”ëª¨ë¦¬ì— ì¶”ê°€(5) one_hot_action = eye[action.view(-1).long()] action [0, 2, 3, 2, 1, 1, â€¦] (0~3) ì˜ ê°’ * 32 np array ì—ì„œ ê°ê°ì˜ ì›ì†Œë¥¼ long í˜• (int64) one_hot type * 32 í˜• ìœ¼ë¡œ ë³€ê²½ í•œë‹¤. ì¦‰ [0, 2, 3, 2, 1, 1, â€¦] -&gt; [[1, 0, 0, 0], [0, 0, 1, 0], [0, 0, 0, 1], [0, 0, 0, 1], â€¦.](6) q = (self.network(state) * one_hot_action).sum(1, keepdims=True)í˜„ì¬ ìƒíƒœì— ëŒ€í•œ ëª¨ë¸ qê°’ * one_hot_action = ì„ íƒëœ action ì— ëŒ€í•œ Q(x) ê°’ ì´ì™¸ ê°’ì€ 0 ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ê° qê°’ ([32.334, 0, 0, 0]) ê³¼ ê°™ì€ í˜•íƒœì—ì„œ ([[\\32.334]]) ë¡œë³€í™˜í•˜ì—¬ qì— ì €ì¥í•œë‹¤. (ì¦‰, one_hot data ì—ì„œ 0 ì¸ ë¶€ë¶„ì€ ëª¨ë‘ ì œê±° í•œë‹¤.)(7) with torch.no_grad(): loss ë¥¼ ê³„ì‚°í•˜ê¸° ìœ„í•´ì„œ target ê°’ì´ í•„ìš”í•˜ì§€ë§Œ, target ê°’ì— ëŒ€í•œ ì œì–´ëŠ” ë³„ë„ë¡œ ì´ë£¨ì–´ì§€ë¯€ë¡œ target ê°’ì„ ì–»ëŠ” ê³¼ì •ì´ network ì— ì˜í–¥ì„ ì£¼ì–´ì„œëŠ” ì•ˆë˜ë¯€ë¡œ with ë¬¸ ë‚´ë¶€ì—ì„œ torch.no_grad() (gradient ì¶”ì ì´ ë˜ì§€ ì•ŠëŠ”) ìƒíƒœì—ì„œ ê°’ì„ ì–»ëŠ”ë‹¤.(8) next_q = self.target_network(next_state) next_q : target network ì„ ì´ìš©í•˜ìš” ë‹¤ìŒìƒíƒœ sâ€™ ì—ëŒ€í•œ q ê°’ë“¤ì„ ì˜ˆì¸¡í•¨.(9) target_q = reward + next_q.max(1, keepdims=True).values * ((1 - done) * discount_factor) .max(1, keepdims=True).values : (0 ì°¨ì›: batch , 1 ì°¨ì›, action) ì—ì„œ action ì°¨ì›ì˜ ìµœëŒ€ê°’ì„ ê°€ì ¸ì˜´ (1 - done) : done == False ì´ë©´ 1 True ì´ë©´ í•´ë‹¹ ê°’ì€ 0 ì´ ë¨. discount_factor : ê°ê°€ìœ¨ì„ ê³±í•¨.ì¦‰ ë²¨ë§Œ ë°©ì •ì‹ ìµœì  q ë¥¼ ì–»ëŠ” ê³µì‹ target_q = ë³´ìƒê°’ + ê°ê°€ìœ¨(ë‹¤ìŒ ìƒíƒœì—ì„œì˜ ìµœëŒ€ Q(x)ê°’) ì„ êµ¬í•¨ + í˜¹ì‹œ ëë‚œ ìƒíƒœì¸ ê²½ìš° 0ìœ¼ë¡œ ë§Œë“¤ì–´ ì£¼ëŠ” ìˆ˜ì‹ì„ ê²°í•©í•œ ìƒíƒœ(10) loss = F.smooth_l1_loss(q, target_q) Huber loss ê³„ì‚°ì´ë¯¸ì§€ ì¶œì²˜3.5 target_network update í•¨ìˆ˜ def update_target(self): self.target_network.load_state_dict(self.network.state_dict()) self.network.state_dict() : ì¼ë°˜ (í›ˆë ¨) ë„¤íŠ¸ì›Œí¬ë¥¼ ê°€ì ¸ì˜´ self.target_network.load_state_dict() : ê°€ì ¸ìš´ ì¼ë°˜ ë„¤íŠ¸ì›Œí¬ë¥¼ target ë„¤íŠ¸ì›Œí¬ë¡œ ì €ì¥4. í”„ë¡œê·¸ë¨ ë™ì‘ êµ¬í˜„ (main)ì•„ë˜ ë„ì‹ì˜ ë™ì‘ì„ êµ¬í˜„ì´ë¯¸ì§€ ì¶œì²˜if __name__ == '__main__': # 4.1 unity ì™€ ìƒí˜¸ ì‘ìš©ì´ ê°€ëŠ¥í•œ UnityEnvironment ì¸ìŠ¤í„´ìŠ¤(env) ìƒì„± engine_configuration_channel = EngineConfigurationChannel() env = UnityEnbironment( file_name=env_name, side_channels=[engine_configuration_channel] ) env.reset() # 4.2 env ë¡œ ë¶€í„° ê´€ì¸¡/target ê³µê°„ ì •ë³´, step ì§„í–‰ í›„ ì •ë³´ ë° êµ¬ë™ í™˜ê²½(time scale) ì„¤ì • behavior_name = list(env.behavior_specs.keys())[0] spec = env.behavior_specs[behavior_name] engine_configuration_channel.set_configuration_parameters(time_scale=12.0) dec, term = env.get_steps(behavior_name) agent = DQNAgent() losses, scores, episode, score = [], [], 0, 0 # 4.3 ë°˜ë³µë¬¸ì„ í†µí•´ run_step + test_step ë™ì•ˆ í•™ìŠµì„ ì§„í–‰ì‹œí‚´ for step in range(run_step + test_step): # 4.3.1 (run_step ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œ ëª¨ë¸ì„ ì €ì¥í•˜ê³  test_mode ë¡œ ì „í™˜) if step == run_step: if train_mode: agent.save_model() print(\"TEST START\") train_mode = False engine_configuration_channel.set_configuration_parameters(time_scale=1.0) # 4.3.2 ì „ì²˜ë¦¬: ì‹œê°ì  ê´€ì¸¡ ì •ë³´ì™€ ëª©ì ì§€ ê´€ì¸¡ ì •ë³´ë¥¼ ì „ì²˜ë¦¬í•˜ì—¬ state ë¡œ ì €ì¥ preprocess = lambda obs, goal: np.concatenate((obs*goal[0][0], obs*goal[0][1]), axis=-1) state = preprocess(dec.obs[OBS], dec.obs[GOAL_OBS]) # 4.3.3 agent ë¥¼ í†µí•´ action ì„ ê²°ì •í•˜ê³ , í•´ë‹¹ action ìœ¼ë¡œ unity ì—ì„œ ë‹¤ìŒ step ì„ ì§„í–‰ì‹œí‚´ action = agent.get_action(state, train_mode) real_action = action + 1 action_tuple = ActionTuple() action_tuple.add_discrete(real_action) env.set_actions(behavior_name, action_tuple) env.step() # 4.3.4 ì§„í–‰ëœ í˜„ì¬ step ì •ë³´ ê°€ì ¸ì˜´ dec, term = env.get_steps(behavior_name) # 4.3.5 ì¢…ë£Œ(termination) í™•ì¸ ë° next_step -&gt; next_state ì •ë³´ë¡œ ì „ì²˜ë¦¬ done = len(term.agent_id) &gt; 0 reward = term.reward if done else dec.reward next_state = preprocess(term.obs[OBS], term.obs[GOAL_OBS]) if done \\ else preprocess(dec.obs[OBS], dec.obs[GOAL_OBS]) score += reward[0] # 4.3.6 (train mode ì¼ ê²½ìš°) next_state ë¥¼ replay memory ì— ì €ì¥ if train_mode: agent.append_sample(state[0], action[0], reward, next_state[0], [done]) # 4.3.7 ì¶©ë¶„íˆ ë©”ëª¨ë¦¬ì— state ì •ë³´ê°€ ì°¨ ìˆë‹¤ë©´, ëª¨ë¸ í•™ìŠµìœ¼ë¡œ ì†ì‹¤ê°’ì„ ê³„ì‚°í•˜ê³ , ì¼ì • ì£¼ê¸°ë¡œ target_model ì„ update í•¨. if train_mode and step &gt; max(batch_size, train_start_step): loss = agent.train_model() losses.append(loss) if step % target_update_step == 0: agent.update_target() # 4.3.8 episode ì¢…ë£Œ ì‹œ, í•„ìš”í•œ ì„¤ì •ê°’ì„ ì¡°ì •í•˜ê³ , tensorboard ì— ë³´ìƒ/ì†ì‹¤ ê°’ì„ ê¸°ë¡, í•„ìš” ì¡°ê±´ë§ˆë‹¤ í›ˆë ¨ëœ ëª¨ë¸ ì €ì¥ if done: episode += 1 scores.append(score) score = 0 if episode % print_interval == 0: mean_score = np.mean(scores) mean_loss = np.mean(losses) agent.write_summary(mean_score, mean_loss, agent.epsilon, step) losses, scores = [], [] print(f\"{episode} Episode / Step: {step} / Score: {mean_score:.2f} /\" + \\ f\"Loss: {mean_loss:.4f} / Epsilon: {agent.epsilon:.4f}\") if train_mode and episode % save_interval == 0: agent.save_model() env.close()4.1 unity ì™€ ìƒí˜¸ ì‘ìš©ì´ ê°€ëŠ¥í•œ UnityEnvironment ì¸ìŠ¤í„´ìŠ¤(env) ìƒì„± engine_configuration_channel = EngineConfigurationChannel() env = UnityEnvironment( file_name=env_name, side_channels=[engine_configuration_channel] ) env.reset()env (UnityEnvironment ì¸ìŠ¤í„´ìŠ¤)ì˜ ì—­í•  ë° ê¸°ëŠ¥ ìœ ë‹ˆí‹°ì™€ì˜ ì¸í„°í˜ì´ìŠ¤: UnityEnvironmentëŠ” ìœ ë‹ˆí‹° ì—”ì§„ê³¼ íŒŒì´ì¬ ì½”ë“œ ê°„ì˜ ì£¼ìš” ì¸í„°í˜ì´ìŠ¤. ì´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í†µí•´ ìœ ë‹ˆí‹° ê²Œì„ í™˜ê²½ì„ ì‹œì‘, ì¤‘ì§€ ë° ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. ë°ì´í„° êµí™˜: ìœ ë‹ˆí‹° ê²Œì„ í™˜ê²½ì—ì„œ ìƒì„±ëœ ë°ì´í„°(ì—ì´ì „íŠ¸ì˜ ê´€ì¸¡ê°’, ë³´ìƒ ë“±)ë¥¼ íŒŒì´ì¬ìœ¼ë¡œ ì „ì†¡í•˜ê³ , íŒŒì´ì¬ì—ì„œ ìƒì„±í•œ í–‰ë™ ì§€ì‹œë¥¼ ìœ ë‹ˆí‹°ë¡œ ë³´ë‚´ëŠ” ì—­í•  í™˜ê²½ ì œì–´: side_channelsì„ í†µí•´ ìœ ë‹ˆí‹° í™˜ê²½ì˜ ì„¸ë¶€ì ì¸ ì„¤ì •ì„ ì¡°ì •í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í†µí•´ í•™ìŠµ ì¤‘ ì‹œë®¬ë ˆì´ì…˜ì˜ ì†ë„ë¥¼ ì¡°ì ˆ, í…ŒìŠ¤íŠ¸ ì¤‘ì—ëŠ” ë³´ë‹¤ ì •ë°€í•œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰ ê°€ëŠ¥ file_name=env_name : ìœ ë‹ˆí‹° ê²Œì„ í™˜ê²½ì˜ ì‹¤í–‰ íŒŒì¼ ê²½ë¡œë¥¼ ì§€ì • side_channels=[engine_configuration_channel] : ìœ ë‹ˆí‹° í™˜ê²½ì˜ timescale, í•´ìƒë„, ê·¸ë˜í”½ í’ˆì§ˆ ë“±ì„ ìˆ˜ì •í•  ë•Œ ì‚¬ìš©4.2 env ë¡œ ë¶€í„° ê´€ì¸¡/target ê³µê°„ ì •ë³´, step ì§„í–‰ í›„ ì •ë³´ ë° êµ¬ë™ í™˜ê²½(time scale) ì„¤ì • (ìœ ë‹ˆí‹° ë¸Œë ˆì¸ ì„¤ì •) # ìœ ë‹ˆí‹° ë¸Œë ˆì¸ ì„¤ì • behavior_name = list(env.behavior_specs.keys())[0] # env.behavior_specs : ëª¨ë“  behavior ì •ë³´ (ì˜ˆ: ê´€ì¸¡ ê³µê°„ì˜ í¬ê¸°, í–‰ë™ì˜ ìœ í˜• ë° í¬ê¸° ë“±)ë¥¼ ê°€ì§€ê³  ìˆìŒ. # í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œëŠ” behavior_sepc ì¤‘ behavior_name ë§Œ ìˆìœ¼ë©´ ëœë‹¤. í•´ë‹¹ spec ì€ ì²«ë²ˆì©¨ ìš”ì†Œ ì´ë¯€ë¡œ [0] ì˜ ê°’ë§Œ ê°€ì ¸ì˜¨ë‹¤. spec = env.behavior_specs[behavior_name] # behavior_name ì— ëŒ€í•œ spec ì„ ê°€ì ¸ì˜¤ë©° ê´€ë ¨ ì •ë³´ëŠ” ì•„ë˜ì™€ ê°™ë‹¤. # 1. ê´€ì¸¡ ê³µê°„(Obervation Space) : ì—ì´ì „íŠ¸ê°€ í™˜ê²½ì—ì„œ ê´€ì¸¡í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ì˜ í˜•íƒœì™€ í¬ê¸°ë¥¼ ì„¤ëª… # ì¹´ë©”ë¼ ì´ë¯¸ì§€, ì†ë„ê³„ì˜ ê°’, ìœ„ì¹˜ ì¢Œí‘œ ë“± # # 2. í–‰ë™ ê³µê°„(Action Space) : ì—ì´ì „íŠ¸ê°€ ì·¨í•  ìˆ˜ ìˆëŠ” í–‰ë™ì˜ ìœ í˜•ê³¼ ë²”ìœ„ # ì—ì´ì „íŠ¸ê°€ ì¡°ì¢…í•  ìˆ˜ ìˆëŠ” ë°©í–¥, ì†ë„ ì¡°ì ˆ, ì í”„ ë“±ì˜ í–‰ë™ engine_configuration_channel.set_configuration_parameters(time_scale=12.0) # ì‹œê°„ 12 ë°°ì† (ë¹ ë¥´ê²Œ) ì„¤ì • dec, term = env.get_steps(behavior_name) # behavior_name ìœ¼ë¡œ ë¶€í„° step ì •ë³´ë¥¼ ì–»ìŒ # dec : decision step - decision request step ì •ë³´ # term : termination step - ì—í”¼ì†Œë“œ ì¢…ë£Œ ìŠ¤í… ì •ë³´ # DQNAgent í´ë˜ìŠ¤ë¥¼ agent ê°ì²´ ìƒì„± agent = DQNAgent() # c.0 í•™ìŠµì„ ì§„í–‰í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì •ë³´ ì´ˆê¸°í™” losses, scores, episode, score = [], [], 0, 04.3 ë°˜ë³µë¬¸ì„ í†µí•´ run_step + test_step ë™ì•ˆ í•™ìŠµì„ ì§„í–‰ì‹œí‚´4.3.1 (run_step ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œ ëª¨ë¸ì„ ì €ì¥í•˜ê³  test_mode ë¡œ ì „í™˜) for step in range(run_step + test_step): # run_step : í•™ìŠµ ëª¨ë“œ step # test_step: í…ŒìŠ¤íŠ¸ëª¨ë“œ step # test step ì§„í–‰ ì½”ë“œ if step == run_step: if train_mode: agent.save_model() print(\"TEST START\") train_mode = False engine_configuration_channel.set_configuration_parameters(time_scale=1.0) # test_step ì€ ì •ì†ìœ¼ë¡œ ìˆ˜í–‰4.3.2 ì „ì²˜ë¦¬: ì‹œê°ì  ê´€ì¸¡ ì •ë³´ì™€ ëª©ì ì§€ ê´€ì¸¡ ì •ë³´ë¥¼ ì „ì²˜ë¦¬í•˜ì—¬ state ë¡œ ì €ì¥ # ì „ì²˜ë¦¬ : ì‹œê°ì  ê´€ì¸¡ ì •ë³´ì™€ ëª©ì ì§€ ê´€ì¸¡ ì •ë³´ë¥¼ ì „ì²˜ë¦¬í•˜ì—¬ state ì— ì €ì¥ preprocess = lambda obs, goal: np.concatenate((obs*goal[0][0], obs*goal[0][1]), axis=-1) # a. obs*goal[0][0] : agent ê´€ì¦‰ ì´ë¯¸ì§€ * goal[0][0] (goal_plus ì´ë©´ 1, goal_ex ì´ë©´ 0) # b. obs*goal[0][1] : agent ê´€ì¸¡ ì´ë¯¸ì§€ * goal[0][1] (goal_plus ì´ë©´ 0, goal_ex ì´ë©´ 1) # ìœ„ ê°’ì„ concatenate # -&gt; 6 ì±„ë„ ì¤‘ goal_plus ì˜ ê²½ìš° ì „ë°˜ë¶€ 3 ì±„ë„ì— ëŒ€í•´ ê°’ì´ ì±„ì›Œì§€ê³ , ë‚˜ë¨¸ì§€ 3ì±„ë„ì— ëŒ€í•œ ê°’ì€ ëª¨ë‘ 0 ìœ¼ë¡œ ì²˜ë¦¬ # -&gt; 6 ì±„ë„ ì¤‘ goal_ex ì˜ ê²½ìš° í›„ë°˜ë¶€ 3 ì±„ë„ì— ëŒ€í•´ ê°’ì´ ì±„ì›Œì§€ê³ , ë‚˜ë¨¸ì§€ 3ì±„ë„ì— ëŒ€í•œ ê°’ì€ ëª¨ë‘ 0 ìœ¼ë¡œ ì²˜ë¦¬ state = preprocess(dec.obs[OBS], dec.obs[GOAL_OBS]) # dec.obs : ì§€ì •ëœ behavior_name ì„ ê°€ì§„ ëª¨ë“  agent ì— ëŒ€í•œ ëª¨ë“  ê´€ì¸¡ì„ í¬í•¨í•˜ëŠ” íŠœí”Œ # dec.obs[0] (OBS = 0 ì‹œê°ì  ê´€ì¸¡ idx) : ë¡œ ì‹œê°ì  ê´€ì¸¡ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŒ. # dec.obs[1] (GOAL_OBS = 1 (ì‹œê°ì ) ëª©ì ì§€ ê´€ì¸¡ idx) : ë¡œ ëª©ì ì§€ì˜ ì‹œê°ì  ì •ë³´ë¥¼ ì–»ìŒ. # dec.obs[GOAL_OBS] ì—ì„œ goal_plus : [[1., 0]] / goal_ex: [[0., 1.]]4.3.3 agent ë¥¼ í†µí•´ action ì„ ê²°ì •í•˜ê³ , í•´ë‹¹ action ìœ¼ë¡œ unity ì—ì„œ ë‹¤ìŒ step ì„ ì§„í–‰ì‹œí‚´ action = agent.get_action(state, train_mode) # get_action ì„ í†µí•´ í˜„ì¬ state ì˜ eps-greedy í–‰ë™ ì„ íƒ real_action = action + 1 # unity ì—ì„œ 0 ì€ ì •ì§€ action ì„ ì˜ë¯¸í•˜ê²Œ ë˜ë¯€ë¡œ , 0 ~3 -&gt; 1 ~ 4 ë¡œ +1 action_tuple = ActionTuple() action_tuple.add_discrete(real_action) # ì‹ ê²½ë§ì„ í†µí•´ ê²°ì •ëœ action ê°’ì„ ë™ì‘ ê°’ìœ¼ë¡œ ì €ì¥ env.set_actions(behavior_name, action_tuple) # action ì„ unity í™˜ê²½ì— ì „ë‹¬ env.step() # unity ì—ì„œ ì‹œë®¬ë ˆì´ì…˜ step ì§„í–‰4.3.4 ì§„í–‰ëœ í˜„ì¬ step ì •ë³´ ê°€ì ¸ì˜´ dec, term = env.get_steps(behavior_name) # ì§„í–‰í•œ í˜„ì¬ ìŠ¤í… ì •ë³´ ê°€ì ¸ì˜¤ê¸°4.3.5 ì¢…ë£Œ(termination) í™•ì¸ ë° next_step -&gt; next_state ì •ë³´ë¡œ ì „ì²˜ë¦¬ done = len(term.agent_id) &gt; 0 # í˜„ì¬ ì‹œë®¬ë ˆì´ì…˜ì€ agent ê°€ 1ê°œ ì´ë¯€ë¡œ termination agent_id ê°€ ì¡´ì¬í•˜ë©´ ì¢…ë£Œë˜ì—ˆìŒì„ ë°”ë¡œ í™•ì¸ ê°€ëŠ¥ reward = term.reward if done else dec.reward next_state = preprocess(term.obs[OBS], term.obs[GOAL_OBS]) if done \\ else preprocess(dec.obs[OBS], dec.obs[GOAL_OBS]) score += reward[0] # step ë³´ìƒ ëˆ„ì 4.3.6 (train mode ì¼ ê²½ìš°) next_state ë¥¼ replay memory ì— ì €ì¥ # replay memory ì— data ì €ì¥ (í•™ìŠµ ëª¨ë“œ) if train_mode: agent.append_sample(state[0], action[0], reward, next_state[0], [done])4.3.7 ì¶©ë¶„íˆ ë©”ëª¨ë¦¬ì— state ì •ë³´ê°€ ì°¨ ìˆë‹¤ë©´, ëª¨ë¸ í•™ìŠµìœ¼ë¡œ ì†ì‹¤ê°’ì„ ê³„ì‚°í•˜ê³ , ì¼ì • ì£¼ê¸°ë¡œ target_model ì„ update í•¨. if train_mode and step &gt; max(batch_size, train_start_step): # ì¶©ë¶„í•œ í•™ìŠµ ë°ì´í„°ê°€ ëª¨ì˜€ë‹¤ë©´ (ìµœì†Œ batch_size ì´ìƒ) # í•™ìŠµìˆ˜í–‰ loss = agent.train_model() losses.append(loss) # íƒ€ê²Ÿ ë„¤íŠ¸ì›Œí¬ ì—…ë°ì´íŠ¸ (íŠ¹ì • ìˆ˜ì˜ step íƒ€ì´ë° ë§ˆë‹¤) if step % target_update_step == 0: agent.update_target()4.3.8 episode ì¢…ë£Œ ì‹œ, í•„ìš”í•œ ì„¤ì •ê°’ì„ ì¡°ì •í•˜ê³ , tensorboard ì— ë³´ìƒ/ì†ì‹¤ ê°’ì„ ê¸°ë¡, í•„ìš” ì¡°ê±´ë§ˆë‹¤ í›ˆë ¨ëœ ëª¨ë¸ ì €ì¥ # episode ì™„ë£Œ ì‹œ, if done: episode += 1 scores.append(score) score = 0 # ì´ˆê¸°í™” # ê²Œì„ ì§„í–‰ ìƒí™© ì¶œë ¥ ë° í…ì„œ ë³´ë“œì— ë³´ìƒê³¼ ì†ì‹¤ í•¨ìˆ˜ ê°’ ê¸°ë¡ if episode % print_interval == 0: mean_score = np.mean(scores) mean_loss = np.mean(losses) agent.write_summary(mean_score, mean_loss, agent.epsilon, step) losses, scores = [], [] print(f\"{episode} Episode / Step: {step} / Score: {mean_score:.2f} /\" + \\ f\"Loss: {mean_loss:.4f} / Epsilon: {agent.epsilon:.4f}\") # ë„¤íŠ¸ì›Œí¬ ëª¨ë¸ ì €ì¥ if train_mode and episode % save_interval == 0: agent.save_model() env.close()ìµœì¢… ì „ì²´ ì½”ë“œimport numpy as npimport randomimport copyimport datetimeimport platform # system (OS) ê´€ë ¨import torchimport torch.nn.functional as Ffrom torch.utils.tensorboard import SummaryWriterfrom collections import dequefrom mlagents_envs.environment import UnityEnvironment, ActionTuple from mlagents_envs.side_channel.engine_configuration_channel import EngineConfigurationChannel state_size = [3*2, 64, 84] action_size = 4 load_model = False train_mode = True batch_size = 32mem_maxlen = 10000 discount_factor = 0.9learning_rate = 0.00025 run_step = 50000 if train_mode else 0 test_step = 5000 train_start_step = 5000 target_update_step = 500 print_interval = 10 save_interval = 100 epsilon_eval = 0.05 epsilon_init = 1.0 if train_mode else epsilon_eval epsilon_min = 0.1 explore_step = run_step * 0.8 eplsilon_data = (epsilon_init - epsilon_min) / explore_step if train_mode else 0.05VISUAL_OBS = 0 GOAL_OBS = 1 VECTOR_OBS = 2 OBS = VISUAL_OBS game = \"GridWorld\" os_name = platform.system() if os_name == 'Windows': env_name = f\"../envs/{game}_{os_name}/{game}\" elif os_name == 'Darwin': env_name = f\"../envs/{game}_{os_name}\"date_time = datetime.datetime.now().strftime(\"%Y%m%d%H%M%S\")save_path = f\"./saved_models/{game}/DQN/{date_time}\" load_path = f\"./saved_models/{game}/DQN/20240503201212\" device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\") class DQN(torch.nn.Module): def __init__(self, **kwargs): super(DQN, self).__init__(**kwargs) self.conv1 = torch.nn.Conv2d( in_channels=state_size[0], out_channels=32, kernel_size=8, stride=4 ) dim1 = ((state_size[1] - 8)//4 + 1, (state_size[2] - 8)//4 + 1) self.conv2 = torch.nn.Conv2d( in_channels=32, out_channels=64, kernel_size=4, stride=2 ) dim2 = ((dim1[0] - 4)//2 + 1, (dim1[1] - 4)//2 + 1) self.conv3 = torch.nn.Conv2d( in_channels=64, out_channels=64, kernel_size=3, stride=1 ) dim3 = ((dim2[0] - 3)//1 + 1, (dim2[1] - 3)//1 + 1) self.flat = torch.nn.Flatten() self.fc1 = torch.nn.Linear(64*dim3[0]*dim3[1], 512) self.q = torch.nn.Linear(512, action_size) def forward(self, x): x = x.permute(0, 3, 1, 2) x = F.relu(self.conv1(x)) x = F.relu(self.conv2(x)) x = F.relu(self.conv3(x)) x = self.flat(x) x = F.relu(self.fc1(x)) return self.q(x)class DQNAgent: def __init__(self): self.network = DQN().to(device) self.target_network = copy.deepcopy(self.network) self.optimizer = torch.optim.Adam(self.network.parameters(), lr=learning_rate) self.memory = deque(maxlen=mem_maxlen) self.epsilon = epsilon_init self.writer = SummaryWriter(save_path) if load_model == True: print(f\"... Load Model from {load_path}/ckpt\") checkpoint = torch.load(load_path+'/ckpt', map_location=device) self.network.load_state_dict(checkpoint[\"network\"]) self.target_network.load_state_dict(checkpoint[\"network\"]) self.optimizer.load_state_dict(checkpoint[\"optimizer\"]) def get_action(self, state, training=True): self.network.train(training) epsilon = self.epsilon if training else epsilon_eval if epsilon &gt; random.random(): action = np.random.randint(0, action_size, size=(state.shape[0], 1)) else: q = self.network(torch.FloatTensor(state).to(device)) action = torch.argmax(q, axis=-1, keepdim=True).data.cpu().numpy() return action def append_sample(self, state, action, reward, next_state, done): self.memory.append((state, action, reward, next_state, done)) def train_model(self): batch = random.sample(self.memory, batch_size) state = np.stack([b[0] for b in batch], axis=0) action = np.stack([b[1] for b in batch], axis=0) reward = np.stack([b[2] for b in batch], axis=0) next_state = np.stack([b[3] for b in batch], axis=0) done = np.stack([b[4] for b in batch], axis=0) state, action, reward, next_state, done = map( lambda x: torch.FloatTensor(x).to(device), [state, action, reward, next_state, done] ) eye = torch.eye(action_size).to(device) one_hot_action = eye[action.view(-1).long()] q = (self.network(state) * one_hot_action).sum(1, keepdims=True) with torch.no_grad(): next_q = self.target_network(next_state) target_q = reward + next_q.max(1, keepdims=True).values * ((1 - done) * discount_factor) loss = F.smooth_l1_loss(q, target_q) self.optimizer.zero_grad() loss.backward() self.optimizer.step() self.epsilon = max(epsilon_min, self.epsilon - eplsilon_data) return loss.item() def update_target(self): self.target_network.load_state_dict(self.network.state_dict()) def save_model(self): print(f\"... Save Model to {save_path}/ckpt ...\") torch.save({ \"network\" : self.network.state_dict(), \"optimizer\" : self.optimizer.state_dict(), }, save_path+'/ckpt') def write_summary(self, score, loss, epsilon, step): self.writer.add_scalar(\"run/score\", score, step) self.writer.add_scalar(\"model/loss\", loss, step) self.writer.add_scalar(\"model/epsilon\", epsilon, step)if __name__ == '__main__': engine_configuration_channel = EngineConfigurationChannel() env = UnityEnbironment( file_name=env_name, side_channels=[engine_configuration_channel] ) env.reset() behavior_name = list(env.behavior_specs.keys())[0] spec = env.behavior_specs[behavior_name] engine_configuration_channel.set_configuration_parameters(time_scale=12.0) dec, term = env.get_steps(behavior_name) agent = DQNAgent() losses, scores, episode, score = [], [], 0, 0 for step in range(run_step + test_step): if step == run_step: if train_mode: agent.save_model() print(\"TEST START\") train_mode = False engine_configuration_channel.set_configuration_parameters(time_scale=1.0) preprocess = lambda obs, goal: np.concatenate((obs*goal[0][0], obs*goal[0][1]), axis=-1) state = preprocess(dec.obs[OBS], dec.obs[GOAL_OBS]) action = agent.get_action(state, train_mode) real_action = action + 1 action_tuple = ActionTuple() action_tuple.add_discrete(real_action) env.set_actions(behavior_name, action_tuple) env.step() dec, term = env.get_steps(behavior_name) done = len(term.agent_id) &gt; 0 reward = term.reward if done else dec.reward next_state = preprocess(term.obs[OBS], term.obs[GOAL_OBS]) if done \\ else preprocess(dec.obs[OBS], dec.obs[GOAL_OBS]) score += reward[0] if train_mode: agent.append_sample(state[0], action[0], reward, next_state[0], [done]) if train_mode and step &gt; max(batch_size, train_start_step): loss = agent.train_model() losses.append(loss) if step % target_update_step == 0: agent.update_target() if done: episode += 1 scores.append(score) score = 0 if episode % print_interval == 0: mean_score = np.mean(scores) mean_loss = np.mean(losses) agent.write_summary(mean_score, mean_loss, agent.epsilon, step) losses, scores = [], [] print(f\"{episode} Episode / Step: {step} / Score: {mean_score:.2f} /\" + \\ f\"Loss: {mean_loss:.4f} / Epsilon: {agent.epsilon:.4f}\") if train_mode and episode % save_interval == 0: agent.save_model() env.close()"
    } ,
  
    {
      "title"       : "(Windows) CUDA ì‚¬ìš© tensorflow ì‘ì—… í™˜ê²½ ì„¤ì •",
      "category"    : "",
      "tags"        : "cuda, cudnn, tensorflow",
      "url"         : "./tensorflow_gpu_setting.html",
      "date"        : "2024-04-08 09:32:20 +0900",
      "description" : "(Windows 10) CUDA ì‚¬ìš© tensorflow ì‘ì—… í™˜ê²½ ì„¤ì •",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€tensflow ê¸°ë°˜ ë”¥ëŸ¬ë‹ í•™ìŠµì„ í•˜ëŠ”ë° cpu ê¸°ë°˜ ì‘ì—…ì´ ë„ˆë¬´ ëŠë ¤ì„œ GPU ë¥¼ ì‚¬ìš©í•˜ê³ ì í•˜ì˜€ìœ¼ë‚˜ ìµœì‹  ìë£ŒëŠ” ì—†ëŠ”ê²ƒ ê°™ì•„ ì´ë¥¼ ë‹¤ì‹œ ì •ë¦¬í•´ ë³´ì•˜ë‹¤. ë‹¤ë§Œ ìœˆë„ìš° í™˜ê²½ì—ì„œ ì§€ì›ë˜ëŠ” CUDA toolkit ë²„ì ¼ì€ ê·¸ë¦¬ ë³€í™”ê°€ ìˆì§€ëŠ” ì•Šì•˜ë‹¤. ì‚¬ìš©í™˜ê²½ OS: Windows 10 64bits GPU : RTX 3070 GPU driver : Nvidia Graphic Driver 537.13 CUDA Toolkit : 11.2 Visual Studio : 2019 cudnn : 8.2.1 (for cuda toolkit 11.x) python : 3.10 Anacoda ê°€ìƒí™˜ê²½ - jupyter notebook tensorflow-gpy : 2.102024ë…„ 4ì›” ê¸°ì¤€, ì•„ë˜ í˜ì´ì§€ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ìœˆë„ìš° í™˜ê²½ì—ì„œ Nvidia GPU ì‚¬ìš© í™˜ê²½ ì¡°ê±´ì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤. ë§í¬ : Tensorflow Build from source on Windows 1.Nvidia Graphic Driver ì„¤ì¹˜ í™•ì¸ ë° ì „ì²´ í™˜ê²½ ì„¤ì • ì¡°ê±´ í™•ì¸ì•„ë˜ì™€ ê°™ì´ ìš°ì„  cmd ì—ì„œ â€˜nvidia-smiâ€™ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ê·¸ë˜í”½ ë“œë¼ì´ë²„ë¼ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ë©°, ì´ ë•Œ â€˜CUDA Versionâ€™ ì„ í™•ì¸í•œë‹¤.ë§Œì•½ ë³¸ì¸ GPU CUDA ë²„ì „ê³¼ Tensorflow ê°€ì´ë“œì— ëª…ì‹œëœ ë²„ì ¼ì´ ë§ë‹¤ë©´ í•´ë‹¹ ë²„ì ¼ì— ë§ê²Œ ëª¨ë“  ì„¤ì •ì„ ì¡°ì •í•˜ë©´ ëœë‹¤. ê·¸ëŸ¬ë‚˜ ë‚´ ê²½ìš°ì™€ ê°™ì´ ì•„ì§ í•´ë‹¹ ë²„ì ¼ì´ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš°, ë‚®ì¶° ëª¨ë“  ì„¤ì •ì„ ì ìš©í•´ì•¼ í•œë‹¤. ë‚´ ê²½ìš°ëŠ” CUDA 11.2 ë¡œ ì ìš©í•˜ì˜€ë‹¤.2. CUDA Tookit &amp; cuDNN ì„¤ì¹˜ì•„ë˜ ë§í¬ì—ì„œ CUDA Tookit ì„ ë°›ì•„ ì„¤ì¹˜í•œë‹¤. CUDA Tookit 11.2 Downlaodsìƒìœ„ ë²„ì „ì˜ ê²½ìš°, í•„ìš”í•œ ê²½ìš° í•¨ê»˜ visual studio ë¥¼ ì„¤ì¹˜ì§€ë§Œ, í•´ë‹¹ ë²„ì ¼ì€ ë³„ë„ë¡œ ì„¤ì¹˜ í•´ì£¼ì–´ì•¼ í•œë‹¤. í•´ë‹¹ ë²„ì „ì— ë§ëŠ” visual studio ëŠ” 2019 ë¡œ ì•„ë˜ ë§í¬ì—ì„œ ë‹¤ìš´ë¡œë“œ ë°›ì•„ ì¶”ê°€ ì„¤ì¹˜í•´ì•¼ í•œë‹¤. Visual Studio 2019 Downloadê·¸ë¦¬ê³  ì•„ë˜ ë§í¬ì—ì„œ ë³¸ì¸ì—ê²Œ ë§ëŠ” ë²„ì „ì˜ cuDNN ì„ ë‹¤ìš´ ë°›ëŠ”ë‹¤. cuDNN downloadë‚´ ê²½ìš°, ì•„ë˜ ë²„ì ¼ìœ¼ë¡œ ë°›ì•„ ì„¤ì¹˜í•˜ì˜€ë‹¤.í•´ë‹¹ íŒŒì¼ì„ ë°›ì•„ ì••ì¶•ì„ í’€ê³  ë‚´ë¶€ íŒŒì¼ë“¤ì„ ëª¨ë‘ ë³µì‚¬í•˜ì—¬, CUDA Toolkit ì´ ì„¤ì¹˜ëœ í´ë” ( C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.2)ì— ë¶™ì—¬ ë„£ëŠ”ë‹¤.3. í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì•ì—ì„œ ì„¤ì¹˜í•œ CUDA Toolkit ì´ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸ê³¼ í•¨ê»˜ í™˜ê²½ ë³€ìˆ˜ ê²½ë¡œë¥¼ ì¶”ê°€ í•´ì¤€ë‹¤.ì‘ì—…í‘œì‹œì¤„ ê²€ìƒ‰ì°½ì—ì„œ â€œí™˜ê²½ ë³€ìˆ˜â€ ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜ í¸ì§‘ì„ ì°¾ì•„ ë“¤ì–´ê°„ë‹¤. í™˜ê²½ë³€ìˆ˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ë“¤ì–´ê°€ë©´ ì•„ë˜ì™€ ê°™ì´ ì°½ì´ ë‚˜ì˜¤ëŠ”ë° ì—¬ê¸°ì—ì„œ ì‹œìŠ¤í…œ ë³€ìˆ˜ë¡œ â€˜CUDA_PATHâ€™ ì™€ â€˜CUDA_PATH_í•´ë‹¹ë²„ì „â€™ ì´ í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.(ë‹¤ìŒ ì‘ì—…ì€ í•„ìš”í•œì§€ ì˜ ëª¨ë¥´ê² ë‹¤.)ì¶”ê°€ë¡œ ì‚¬ìš©ì ë³€ìˆ˜ - Path ì— ì•„ë˜ì™€ ê°™ì´ CUDA Toolkit ì„¤ì¹˜ ê²½ë¡œì— bin, include, lib í´ë” ê²½ë¡œë¥¼ ì¶”ê°€í•œë‹¤.4. ì•„ë‚˜ì½˜ë‹¤ ë‚´ ê°€ìƒí™˜ê²½ ì„¤ì • ë° tensorflow-gpu ì„¤ì¹˜ì•„ë‚˜ì½˜ë‹¤ë¥¼ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì„¤ì¹˜í•˜ê³ , Anaconda Prompt ë¥¼ ì‹¤í–‰í•œë‹¤. ì—¬ê¸°ì„œ ê°€ìƒí™˜ê²½ì„ ì¶”ê°€í•  ë•Œ phython ë²„ì ¼ì„ ì•ì—ì„œ í™•ì¸í•œ tensorflow-gpu ì§€ì› ë²„ì „ì„ ì„¤ì¹˜í•œë‹¤. ë‚´ ê²½ìš°ëŠ” 3.10 ìœ¼ë¡œ ì„¤ì¹˜í•˜ì—¬ ì§„í–‰í•˜ì˜€ë‹¤.conda create -n [ê°€ìƒí™˜ê²½ ì´ë¦„] python=3.10ì´í›„ í•´ë‹¹ ê°€ìƒí™˜ê²½ì„ í™œì„±í™” í•œë‹¤.conda activate [ê°€ìƒí™˜ê²½ì´ë¦„]ê·¸ë¦¬ê³  tensorflow-gpu ë¥¼ í™ˆí˜ì´ì§€ì—ì„œ í™•ì¸í•œ ë²„ì „ìœ¼ë¡œ ì„¤ì¹˜í•´ ì¤€ë‹¤.pip install tensorflow-gpu==2.10ê¸°íƒ€ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ì„¤ì¹˜í•˜ê³ , jupyter notebook ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ notebook ì„ ì„¤ì¹˜í•˜ê³  jupyter notebook ì„ ì‹¤í–‰í•œë‹¤.pip install notebook...jupyter notebook5. jupyter ì—ì„œ tensorflow-gpu ì •ìƒ ì‘ë™ í™•ì¸jupyter ì»¤ë„ì—ì„œ ìƒˆ notebook ì„ ì‹¤í–‰í•˜ì—¬ ì•„ë˜ code ë¥¼ ì…ë ¥í•˜ì—¬ gpu ê°€ ì •ìƒì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•œë‹¤.from tensorflow.python.client import device_libprint(device_lib.list_local_devices())ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì¶œë ¥ë˜ëŠ”ë°, ë§Œì•½ GPU ì—°ê²°ì´ ë˜ì§€ ì•Šì•˜ë‹¤ë©´, CPU ì •ë³´ë§Œ ì¶œë ¥ë˜ê³ , GPU ê´€ë ¨ ì •ë³´ëŠ” ì¶œë ¥ë˜ì§€ ì•ŠëŠ”ë‹¤.ë§Œì•½ ì—¬ê¸°ì—ì„œ CPU ë§Œ ì¡íŒ ìƒíƒœë¼ë©´, ì•ì˜ ê³¼ì •ì—ì„œ ë¬´ì–¸ê°€ ì˜ëª»ë˜ì—ˆë‹¤ëŠ” ì˜ë¯¸ì´ë¯€ë¡œ ë‹¤ì‹œ ì‘ì—…í•´ì•¼ í•œë‹¤. (ê°œì¸ì ìœ¼ë¡œë„ í•´ë‹¹ ì„¤ì¹˜ê¹Œì§€ ì—¬ëŸ¬ë²ˆ ë°˜ë³µí•˜ì˜€ìœ¼ë©°, íƒ€ ë¸”ë¡œê·¸ ê¸€ì—ë„ ìˆ˜ì°¨ë¡€ ì‹¤íŒ¨í–ˆë‹¤ëŠ” ê¸€ì´ ë§ë‹¤.)ìµœì¢…ì ìœ¼ë¡œ ì„±ê³µí–ˆë‹¤ë©´, ì´ì œ GPU ì‹¤í–‰ í™˜ê²½ìœ¼ë¡œ ì„¤ì •í•˜ê³  ì‚¬ìš©í•˜ë©´ ëœë‹¤. ìš°ì¸¡ ìƒë‹¨ì— â€˜Python 3(ipkernel)â€™ ë¡œ ë˜ì–´ ìˆë‹¤ë©´ í´ë¦­í•´ì„œ ë³¸ì¸ì´ ìƒì„±í•œ ê°€ìƒí™˜ê²… (ex. b2404) ë¡œ ì„ íƒí•˜ì—¬ ì‚¬ìš©í•˜ë©´ ëœë‹¤."
    } ,
  
    {
      "title"       : "IPC ì‹¤ìŠµ 05 - Named Semaphore",
      "category"    : "",
      "tags"        : "linux, IPC, daemon, shared systemd, socket",
      "url"         : "./service-daemon.html",
      "date"        : "2024-03-24 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 20",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. Systemd ë€?ì»¤ë„ì´ ê°€ì¥ ì²˜ìŒ ë„ìš°ëŠ” init í”„ë¡œì„¸ìŠ¤ (PID : 1) ì‹œìŠ¤í…œì„ ì´ˆê¸°í™” í•˜ì—¬ ì—¬ë ¤ê°€ì§€ ì„œë¹„ìŠ¤ ë°ëª¬ë“¤ì„ ë„ìš°ê³  ê´€ë¦¬í•¨. ì˜ˆë¥¼ ë“¤ì–´, ë””ë°”ì´ìŠ¤ ë…¸ë“œë¥¼ ìë™ì„ ìƒì„±í•˜ëŠ” udev ë°ëª¬ë„ systemd ì„œë¹„ìŠ¤ë¡œ êµ¬ë™ë¨. journalctl ì„ ì‚¬ìš©í•˜ì—¬ ê° ë°ëª¬ì˜ ë¡œê·¸ë„ ì €ì¥ ê´€ë¦¬í•¨. ê° ì„œë¹„ìŠ¤ ê°„ì˜ ì˜ì¡´ì„±ì„ ìë™ìœ¼ë¡œ ê´€ë¦¬ ê¸°ë³¸ Systemd ì„œë¹„ìŠ¤ ê´€ë¦¬ ëª…ë ¹ì–´ systemctl status : í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ ìƒíƒœ ì¡°íšŒ systemclt enable/disable : í•´ë‹¹ ì„œë¹„ìŠ¤ í™œì„±í™”/ë¹„í™œì„±í™” systemclt start/stop : í•´ë‹¹ ì„œë¹„ìŠ¤ ì‹œì‘/ì¢…ë£Œ systemclt daemon-reload : ì–´ë–¤ ì„œë¹„ìŠ¤ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì¶”ê°€í–ˆì„ ë•Œ í•´ë‹¹ ëª…ë ¹ë¥¼ í†µí•´ ë³€ê²½ì‚¬í•­ì„ ì ìš©í•´ì¤˜ì–‘ í•¨. systemctl list-unit : ëª¨ë“  ì„œë¹„ìŠ¤ ëª©ë¡ ì¶œë ¥ systemctl list-sockets : ì„œë¹„ìŠ¤ê°€ ì‚¬ìš”ì•„ëŠ” ì†Œì¼“ì˜ ëª©ë¡ì„ ì¶œë ¥ systemctl list-dependencies : ì„œë¹„ìŠ¤ë¥¼ tree êµ¬ì¡°ë¡œ ì˜ì¡´ì„±ì„ í‘œì‹œí•˜ì—¬ ì¶œë ¥ journalctl -fn : ëª¨ë“  systemd ì„œë¹„ìŠ¤ ë°ëª¬ë“¤ì˜ ë¡œê·¸ ì¶œë ¥ journalctl -fn -u .service : ëª¨ë“  systemd ì„œë¹„ìŠ¤ ë°ëª¬ë“¤ì˜ ë¡œê·¸ ì¶œë ¥2. Daemon ì´ë€?ì—¬ëŸ¬ ìš”ì²­ì— ë”°ë¼ì„œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ë°±ê·¸ë¼ìš´ë“œë¡œ ê¸¸ê²Œ ë–  ìˆëŠ” í”„ë¡œì„¸ìŠ¤ì‚¬ìš©ìê°€ ì§ì ‘ ì œì–´í•˜ì§€ ì•Šìœ¼ë©° init ì‹œìŠ¤í…œ ë“±ì´ ë°ëª¬ì„ ê´€ë¦¬í•˜ê²Œ ë¨. ë¶€ëª¨ì˜ PID ëŠ” 1 (systemd) ì´ë©° ì„¸ì…˜ ë° ê·¸ë£© ì•„ì´ë””ëŠ” ë³¸ì¸ ìì‹ ì´ì–´ì•¼ í•¨ - daemonize ê³¼ì • í•„ìš” init í”„ë¡œì„¸ìŠ¤ì— ì…ì–‘ì‹œí‚¨ë‹¤ê³  í‘œí˜„ë˜ê¸°ë„ daemon(nochdir, noclose)ë°ëª¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„± í•¨ìˆ˜. nochdir : 0 ì´ë©´, daemon í•¨ìˆ˜ëŠ” ë£¨íŠ¸ ë””ë ‰í† ë¦¬(/)ë¡œ í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬ë¥¼ ë³€ê²½, 1 ì´ë©´ í˜„ì¬ ë””ë ‰í† ë¦¬ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ì§„í–‰. ì¼ë°˜ì ìœ¼ë¡œ 0 ì˜ ì„¤ì •ê°’ì„ ê°€ì§€ë©° ê·¸ ì´ìœ ëŠ” ë°ëª¬ í”„ë¡œì„¸ìŠ¤ê°€ íŒŒì¼ ì‹œìŠ¤í…œì„ ë§ˆìš´íŠ¸ í•´ì œí•˜ëŠ”ë° ë°©í•´ê°€ ë˜ì§€ ì•Šë„ë¡ í•˜ê¸° ìœ„í•¨ì´ë‹¤. noclose : 0ì´ë©´, daemon í•¨ìˆ˜ëŠ” í‘œì¤€ ì…ë ¥(stdin), í‘œì¤€ ì¶œë ¥(stdout), ê·¸ë¦¬ê³  í‘œì¤€ ì—ëŸ¬(stderr)ë¥¼ /dev/nullë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸. ë§Œì•½ 1ì´ë¼ë©´, ì´ëŸ¬í•œ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë“¤ì„ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ì§€ ì•ŠìŒ. ì¼ë°˜ì ìœ¼ë¡œ 1ì˜ ê°’ìœ¼ë¡œ ì„¤ì •ë˜ë©° ê·¸ ì´ìœ ëŠ” ë°ëª¬ í”„ë¡œì„¸ìŠ¤ê°€ í„°ë¯¸ë„ê³¼ì˜ ì—°ê²°ì„ ëŠê³ , ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¡°ìš©íˆ ì‹¤í–‰ë˜ê²Œ í•˜ê³ ìí•¨ì´ë‹¤. ë°ëª¬ ìƒì„± ê³¼ì • í”„ë¡œì„¸ìŠ¤ ë¶„ê¸°: ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ê³  ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰í•˜ì—¬ ì„¸ì…˜ ë¦¬ë”ê°€ ë˜ê²Œ í•œë‹¤. ì„¸ì…˜ ìƒì„±: ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•˜ì—¬ í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹ ë¦¬ë”ê°€ ëœë‹¤. ì‘ì—… ë””ë ‰í† ë¦¬ ë³€ê²½: íŒŒì¼ ì‹œìŠ¤í…œì˜ ë§ˆìš´íŠ¸ í•´ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì‘ì—… ë””ë ‰í† ë¦¬ë¥¼ ë£¨íŠ¸(/)ë¡œ ë³€ê²½(nochdir 0 ì¸ ê²½ìš°). íŒŒì¼ ëª¨ë“œ ë§ˆìŠ¤í¬ ì´ˆê¸°í™”: ìƒˆë¡œ ìƒì„±ë˜ëŠ” íŒŒì¼ê³¼ ë””ë ‰í† ë¦¬ì˜ ê¶Œí•œì„ ì œì–´. í‘œì¤€ ì…ì¶œë ¥ ë¦¬ë‹¤ì´ë ‰íŠ¸: ë°ëª¬ í”„ë¡œì„¸ìŠ¤ê°€ í„°ë¯¸ë„ê³¼ì˜ ì…ì¶œë ¥ ì—°ê²°ì„ ëŠìŒ(noclose 1 ì¸ ê²½ìš°). 3. ì„œë¹„ìŠ¤ ë°ëª¬ ê°œë°œêµ¬í˜„í•˜ê³ ì í•˜ëŠ” ì„œë¹„ìŠ¤ ë°ëª¬ì€ systemd socket í™œì…©í™”í•˜ëŠ” ê²ƒì´ë‹¤.êµ¬í˜„ ë™ì‘ systemd ì†Œì¼“ì„ ì—´ê³  listen ìƒíƒœë¡œ ë‘ . ì†Œì¼“ì— ì ‘ì† ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, systemd ëŠ” ì„œë¹„ìŠ¤ ë°ëª¬ì„ ì‹¤í–‰ ì„œë¹„ìŠ¤ ë°ëª¬ì€ ì‹¤í–‰ë˜ì—ˆì„ ë•Œ, accept ë¶€í„° ì²˜ë¦¬í•˜ê²Œ ë¨. ì„œë¹„ìŠ¤ ë°ëª¬ì´ ë”ì´ìƒ ì²˜ë¦¬í•  ê²ƒì´ ì—†ìœ¼ë©´ ì¢…ë£Œí•¨. ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ 2~4ë²ˆ ì‘ì—…ì„ ë°˜ë³µí•¨.êµ¬í˜„ ì„œë¹„ìŠ¤ ë°ëª¬ ê´€ë ¨ ë‚´ìš© (ì´í•´ê°€ ì•ˆê°â€¦;;) ì†Œì¼“ìœ¼ë¡œì˜ ì ‘ì†ì´ ì—†ì„ ê²½ìš°ëŠ” ì„œë¹„ìŠ¤ ë°ëª¬ì„ ì—´ì§€ ì•Šì•„ ë©”ëª¨ë¦¬ ì ˆì•½ ê°€ëŠ¥ Accept = yse ê¹Œì§€ ì‚¬ìš©í•˜ë©´ accpet ë„ systemd ê°€ í•´ì£¼ë‚˜ ì„±ëŠ¥ìƒ ì´ìœ ë¡œ ì¶”ì²œë˜ì§€ëŠ” ì•ŠìŒ.4. ì½”ë“œ ì‘ì„±1.1. ë£¨íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì˜ /usr/lib/systemd/system ë°‘ì— .socket íŒŒì¼ ìƒì„±[Unit]Description=socket for Comento Exampleservice[Socket]ListenStream=/run/comento.sock[Install]WantedBy=sockets.target1.2. systemctl enable .socket : í•´ë‹¹ ì†Œì¼“ ì¼œê¸° ì†Œì¼“ì„ ì¼œê²Œ ë˜ë©´ ls -l /run/comento.sock íŒŒì¼ ìƒì„±2.1 ë£¨íŠ¸íŒŒì¼ ì‹œìŠ¤í…œì˜ /usr/lib/systemd/system ë°‘ì— .service íŒŒì¼ ìƒì„±[Unit]Description=Comento Example service[Service]Type=forkingExecStart=/usr/bin/comento-daemonStandardOutput=journalRestart=on-failureStartLimitIntervalSec=1sStartLimitBurst=32[Install]WantedBy=basic.target"
    } ,
  
    {
      "title"       : "IPC ì‹¤ìŠµ 05 - Named Semaphore",
      "category"    : "",
      "tags"        : "linux, IPC, inter-process communication, shared memory, semaphore",
      "url"         : "./IPC05.html",
      "date"        : "2024-03-22 14:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 19",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. Semaphoreë™ì‹œì— ìì›ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ìŠ¤ë ˆë“œì˜ ìˆ˜ë¥¼ ì œí•œí•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜. ì¼ì¢…ì˜ ì¹´ìš´í„°ë¡œ, íŠ¹ì • ìì›ì„ ì ‘ê·¼í•˜ë ¤ëŠ” ìŠ¤ë ˆë“œì˜ ìˆ˜ë¥¼ ì œì–´í•œë‹¤. ì„¸ë§ˆí¬ì–´ëŠ” ì£¼ë¡œ ë‘ ê°€ì§€ ìœ í˜•ìœ¼ë¡œ ë‚˜ë‰œë‹¤: ì´ì§„ ì„¸ë§ˆí¬ì–´(Binary Semaphore): ê°’ì´ 0 ë˜ëŠ” 1ë§Œ ë  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ë®¤í…ìŠ¤ì™€ ìœ ì‚¬í•œ ë°©ì‹, ìì›ì— ëŒ€í•œ ë…ì ì  ì ‘ê·¼ì„ ì œì–´í•˜ëŠ”ë° ì‚¬ìš©ë¨. ì¹´ìš´íŒ… ì„¸ë§ˆí¬ì–´(Counting Semaphore): ê°’ì´ ì •í•´ì§„ ë²”ìœ„ ë‚´ì—ì„œ ì¦ê°€í•˜ê±°ë‚˜ ê°ì†Œí•  ìˆ˜ ìˆìœ¼ë©°, ë™ì‹œì— ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ìì›ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•¨. (ì¹´ìš´íŒ…) ì„¸ë§ˆí¬ì–´ì˜ ë™ì‘ ê³¼ì • ì½ê¸° ì‘ì—… ì‹œì‘: ìŠ¤ë ˆë“œê°€ ì½ê¸° ì‘ì—…ì„ ì‹œì‘í•˜ê¸° ì „, ì“°ê¸° ì„¸ë§ˆí¬ì–´ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ì—¬ ì“°ê¸° ì‘ì—…ì´ ì§„í–‰ ì¤‘ì´ì§€ ì•Šì€ì§€ í™•ì¸í•œë‹¤. ê·¸ í›„ ì½ê¸° ì„¸ë§ˆí¬ì–´ì˜ ì¹´ìš´íŠ¸ë¥¼ ì¦ê°€ì‹œì¼œ ì½ê¸° ì‘ì—…ì„ ìˆ˜í–‰ ì¤‘ì¸ ìŠ¤ë ˆë“œì˜ ìˆ˜ë¥¼ ì €ì¥. ì½ê¸° ì‘ì—… ì¢…ë£Œ: ìŠ¤ë ˆë“œê°€ ì½ê¸° ì‘ì—…ì„ ë§ˆì¹˜ë©´, ì½ê¸° ì„¸ë§ˆí¬ì–´ì˜ ì¹´ìš´íŠ¸ë¥¼ ê°ì†Œì‹œì¼œ ì½ê¸° ì‘ì—…ì„ ìˆ˜í–‰ ì¤‘ì¸ ìŠ¤ë ˆë“œì˜ ìˆ˜ë¥¼ ê°ì†Œì‹œí‚¨ë‹¤. ì“°ê¸° ì‘ì—… ì‹œì‘: ìŠ¤ë ˆë“œê°€ ì“°ê¸° ì‘ì—…ì„ ì‹œì‘í•˜ê¸° ì „, ë¨¼ì € ì½ê¸° ì‘ì—…ì´ ì§„í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì½ê¸° ì„¸ë§ˆí¬ì–´ì˜ ì¹´ìš´íŠ¸ê°€ 0ì´ ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. ì´ëŠ” ëª¨ë“  ì½ê¸° ì‘ì—…ì´ ì™„ë£Œë¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ê·¸ ë‹¤ìŒ, ì“°ê¸° ì„¸ë§ˆí¬ì–´ë¥¼ ì ê¸ˆ ìƒíƒœë¡œ ì „í™˜í•˜ì—¬ ì“°ê¸° ì‘ì—…ì„ ì‹œì‘í•œë‹¤. ì“°ê¸° ì‘ì—… ì¢…ë£Œ: ì“°ê¸° ì‘ì—…ì„ ë§ˆì¹œ í›„, ì“°ê¸° ì„¸ë§ˆí¬ì–´ë¥¼ í•´ì œí•˜ì—¬ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì½ê¸° ë˜ëŠ” ì“°ê¸° ì‘ì—…ì„ ì‹œì‘í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤. ìœ„ì™€ ê°™ì€ ë°©ë²•ì„ í†µí•´ ë°ì´í„°ë¥¼ ì“°ê¸° ì‘ì—…ê³¼ ì½ê¸° ì‘ì—…ì˜ ì¶©ëŒì„ ì˜ˆë°©í•  ìˆ˜ ìˆë‹¤. ë‹¤ë§Œ ë°ì´í„°ì˜ ì¼ê´€ì„± (data consistency) ì˜ ê²½ìš°, ìœ„ì™€ ê°™ì€ ê¸°ë³¸ì ì¸ ì„¸ë§ˆí¬ì–´ë¡œëŠ” ë³´ì¥ë  ìˆ˜ ì—†ë‹¤.ì˜ˆë¥¼ ë“¤ì–´ ê¸°ì¡´ ë°ì´í„°ê°€ 0 ì¼ë•Œ, í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œì—ì„œ í•´ë‹¹ ê°’ì„ ì½ì–´ì„œ +1 ì„ í•˜ê³  ë‚˜ì„œ ì“°ê³ , ê·¸ ê²°ê³¼ (1)ì„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì½ì–´ì„œ -1 í•˜ì—¬ 0ìµœì¢… 0ì˜ ê²°ê³¼ ê°’ì„ ì˜ë„ í–ˆì„ ë•Œ, ë‹¨ìˆœíˆ ì½ëŠ” ê³¼ì •ì´ ë§ˆë¬´ë¦¬ë˜ì—ˆì„ ë•Œ ì“°ê¸°ë¥¼ í•˜ëŠ” í˜•íƒœë¡œ êµ¬í˜„í•œë‹¤ë©´, ìœ„ì˜ ê³¼ì •ì—ì„œ ìµœì¢… ê²°ê³¼ê°€ 0 ì¼ ìˆ˜ë„ ìˆê³  1 ì´ê±°ë‚˜ -1 ì¼ ìˆ˜ë„ ìˆëŠ” ë¶ˆí™•ì •í•œ ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.ì´ëŸ° ê³¼ì •ì€ í•´ë‹¹ ì‘ì—… ì „ì²´ (ì½ê¸°-ì—°ì‚°-ì“°ê¸°) ê³¼ì •ì— lock ì„ ì‚¬ìš©í•˜ì—¬, ëª¨ë“  ì‘ì—…ì´ ì‘ì—…ì˜ ì ˆì°¨ê°€ ë¶„ë¦¬ë˜ì§€ ì•Šê³  í•˜ë‚˜ì˜ ë©ì–´ë¦¬ë¥´ ì²˜ë¦¬ë˜ëŠ” ì›ìì„±ì´ ë³´ì¥ë˜ë„ë¡ ì²˜ë¦¬í•˜ê±°ë‚˜ í•˜ëŠ” ë“±ì˜ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬í•˜ì—¬ì•¼ ì¼ê´€ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.2. ì£¼ìš” í•¨ìˆ˜sem_t *sem_open(const char *name, int oflag, mode_t mode, unsigned int value);POSIX ì„¸ë§ˆí¬ì–´ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì—´ê¸° ìœ„í•œ í•¨ìˆ˜ name : ì„¸ë§ˆí¬ì–´ì˜ ì´ë¦„ oflag : O_CREAT (ì„¸ë§ˆí¬ì–´ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ìƒì„±), O_EXCL (í•¨ê»˜ O_CREATì™€ ì‚¬ìš©ë˜ë©°, ì„¸ë§ˆí¬ì–´ê°€ ì´ë¯¸ ì¡´ì¬í•  ê²½ìš° ì‹¤íŒ¨), ë“± mode : ì„¸ë§ˆí¬ì–´ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ì„¤ì • (e.g. 0600) valeu : ì„¸ë§ˆí¬ì–´ì˜ ì´ˆê¸°ê°’. ì´ ê°’ì€ ì„¸ë§ˆí¬ì–´ê°€ ìƒì„±ë  ë•Œë§Œ ì˜ë¯¸ê°€ ìˆìœ¼ë©°, ì„¸ë§ˆí¬ì–´ê°€ ë™ì‹œì— í—ˆìš©í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ ìˆ˜ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, 1ë¡œ ì„¤ì •í•  ê²½ìš°, í•´ë‹¹ ì„¸ë§ˆí¬ì–´ëŠ” ë®¤í…ìŠ¤(mutex)ì™€ ìœ ì‚¬í•˜ê²Œ ë™ì‘í•œë‹¤.int sem_wait(sem_t *sem);ì„¸ë§ˆí¬ì–´ì˜ ì œì–´ê¶Œ íšë“ sem : ì‘ì—…í•  ì„¸ë§ˆí¬ì–´ ê°ì²´ì— ëŒ€í•œ í¬ì¸í„°int sem_post(sem_t *sem);ì„¸ë§ˆí¬ì–´ì˜ ì œì–´ê¶Œ ë‚´ë ¤ ë†“ìŒ sem : ì‘ì—…í•  ì„¸ë§ˆí¬ì–´ ê°ì²´ì— ëŒ€í•œ í¬ì¸í„°3. code#include &lt;fcntl.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/mman.h&gt;#include &lt;sys/stat.h&gt;#include &lt;sys/wait.h&gt;#include &lt;semaphore.h&gt;#define SEM_NAME \"comento\"int main(int argc, char *argv[]) { int *ptr, i, sem_init = 1; sem_t *sem; pid_t pid; // ë™ì‹œ ì ‘ê·¼ ê°€ëŠ¥ ìŠ¤ë ˆë“œ : 2 // -&gt; ë‘ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì œì–´ê¶Œì„ ê°€ì§€ë¯€ë¡œì¨ ë°ì´í„° ì¼ê´€ì„±ì„ ìœ ì§€í•  ìˆ˜ ì—†ëŠ” ìƒíƒœë¡œ ë§Œë“¬. if(argc == 2 &amp;&amp; !strcmp(argv[1], \"-no-sem\")) { sem_init = 2; } sem_unlink(SEM_NAME); // Remove semaphore if exists sem = sem_open(SEM_NAME, O_CREAT | O_EXCL, 0600, sem_init); if (sem == SEM_FAILED) { fprintf(stderr, \"Failed to create semaphore\\n\"); return 1; } printf(\"Mapping an anonymous share memory\\n\"); // ìµëª…ì˜ ê³µìœ  ë©”ëª¨ë¦¬ // í”„ë¡œê·¸ë¨ ë‚´ì—ì„œ ë°”ë¡œ í•´ë‹¹ ë©”ëª¨ë¦¬ í¬ì¸í„°ë¥¼ ë°›ì•„ ë¶€ëª¨-ìì‹ ê°„ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ ì´ë¦„ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥ ptr = mmap(NULL, sizeof(*ptr), PROT_READ | PROT_WRITE, MAP_SHARED | MAP_ANONYMOUS, -1, 0); pid = fork(); // ìì‹ í”„ë¡œì„¸ìŠ¤ëŠ” 1ì”© 10000 ë²ˆ ë”í•˜ê¸° ìˆ˜í–‰ if(pid == 0) { for (i = 0; i &lt; 10000; i++) { sem_wait(sem); (*ptr)++; // í•´ë‹¹ ë”í•˜ê¸° ì‘ì—…ì€ ì‹¤ì œ ê¸°ê³„ì–´ ìˆ˜ì¤€ì—ì„œëŠ” // load *ptr, reg // inc reg, 1 // store reg, *ptr // ì´ë ‡ê²Œ ì„¸ë²ˆì˜ ëª…ë ¹ì–´ ìˆ˜í–‰ìœ¼ë¡œ ì´ë£¨ì–´ì§„ë‹¤. sem_post(sem); if(i % 1000 == 0) { printf(\"[Child] %d\\n\", *ptr); } } } // ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ëŠ” 1ì”© 10000 ë²ˆ ë¹¼ê¸° ìˆ˜í–‰ else { for (i = 0; i &lt; 10000; i++) { sem_wait(sem); (*ptr)--; // // í•´ë‹¹ ë¹¼ê¸° ì‘ì—…ì€ ì‹¤ì œ ê¸°ê³„ì–´ ìˆ˜ì¤€ì—ì„œëŠ” // load *ptr, reg // dec reg, 1 //store reg, *ptr // ì´ë ‡ê²Œ ì„¸ë²ˆì˜ ëª…ë ¹ì–´ ìˆ˜í–‰ìœ¼ë¡œ ì´ë£¨ì–´ì§„ë‹¤. sem_post(sem); if (i % 1000 == 0 ) { printf(\"[Parent] %d\\n\", *ptr); } } wait(NULL); printf(\"Final value: %d\\n\", *ptr); } return 0;}4. ì‹¤í–‰ìœ„ ì½”ë“œ íŒŒì¼ì„ ì»´íŒŒì¼í•˜ê³ , ë™ì‹œ ì ‘ê·¼ ìŠ¤ë ˆë“œë¥¼ 1ê°œë§Œ í—ˆìš©í•˜ì—¬ ì‹¤í–‰í•˜ë©´ ê·¸ ìµœì¢… ê²°ê³¼ ê°’ì€ í•­ìƒ 0ì´ ë‚˜ì˜¤ê²Œ ëœë‹¤.user@DESKTOP:~$ gcc -o sema sema.cuser@DESKTOP:~$ ./semaMapping an anonymous share memory[Parent] -1[Parent] -1001[Parent] -2001[Parent] -3000[Child] -2652[Parent] -3039[Child] -3000[Parent] -3175[Child] -3000[Parent] -3119[Child] -3000[Parent] -3287[Child] -3000[Parent] -3250[Child] -3000[Parent] -3060[Child] -3000[Child] -2999[Child] -1999[Child] -999Final value: 0ê·¸ëŸ¬ë‚˜ â€˜-no-semâ€™ ì˜µì…˜ì„ ì¨ì„œ ë¶€ëª¨ ìì‹ ìŠ¤ë ˆë“œ ë™ì‹œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •í•˜ë©´, ê·¸ ìµœì¢… ê²°ê³¼ëŠ” 0ì¼ ìˆ˜ë„ ìˆê³ , ì•„ë˜ì™€ ê°™ì´ 0 ì´ ì•„ë‹Œ ë‹¤ë¥¸ ê°’ì´ ë‚˜ì˜¬ ìˆ˜ ë„ ìˆê²Œ ëœë‹¤.user@DESKTOP:~$ ./sema -no-semMapping an anonymous share memory[Parent] -1[Parent] -992[Child] -177[Parent] -1005[Child] -999[Child] -626[Parent] -1001[Parent] -1006[Child] -1001[Parent] -1086[Child] -1007[Parent] -1034[Child] -1010[Parent] -1041[Child] -1021[Parent] -1078[Child] -1014[Parent] -1097[Child] -1013[Child] -1006Final value: -7"
    } ,
  
    {
      "title"       : "IPC ì‹¤ìŠµ 04 - Shared Memeory",
      "category"    : "",
      "tags"        : "linux, IPC, inter-process communication, shared memory",
      "url"         : "./IPC04.html",
      "date"        : "2024-03-22 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 18",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. ê³µìœ ë©”ëª¨ë¦¬ ë€?ë°ì´í„° ê³µìœ ë¥¼ ëª©ì ìœ¼ë¡œ ë¬¼ë¦¬ì ì¸ ë©”ëª¨ë¦¬ì˜ ë™ì¼í•œ ì˜ì˜ì„ ê° í”„ë¡œì„¸ìŠ¤ê°€ ë§¤í•‘ ì¼ë°˜ì ì¸ ë©”ëª¨ë¦¬ ì ‘ê·¼ê³¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥ ë³„ë™ì˜ ì‹œìŠ¤í…œì½œì´ë‚˜ í•¨ìˆ˜ ì—†ì´ ì§ì ‘ ë°ì´í„° ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë¯€ë¡œ ì‘ì—… ì†ë„ê°€ ë¹ ë¦„. ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— ê°™ì€ ì˜ì—­ì— ì‘ì—…í•˜ì—¬ ë°ì´í„°ì˜ ì¼ê´€ì„±ì´ ê¹¨ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ê¸°ë²• í•„ìš” (e.g. semaphore)2. ì£¼ìš” í•¨ìˆ˜void *mmap(void *start, size_t length, int prot, int flags, int fd, off_t offset);íŒŒì¼ì´ë‚˜ ì¥ì¹˜ì˜ ë‚´ìš©ì„ ë©”ëª¨ë¦¬ì— ë§¤í•‘í•˜ì—¬, ì´ë¥¼í†µí•´ í”„ë¡œì„¸ìŠ¤ëŠ” íŒŒì¼ì´ë‚˜ ì¥ì¹˜ë¥¼ ë§ˆì¹˜ ë©”ëª¨ë¦¬ ë°°ì—´ì¸ê²ƒì €ëŸ¼ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í•¨ìˆ˜. start : ë§¤í•‘ ì‹œì‘ ë©”ëª¨ë¦¬ ì£¼ì†Œ. NULL ë¡œ ì„¤ì •ì‹œ, ì»¤ë„ì´ ìë™ìœ¼ë¡œ ì„¤ì •. length: ë§¤í•‘í•  ë©”ë¡œë¦¬ í¬ê¸°(bytes) prot : ë§¤í•‘ëœ ë©”ëª¨ë¦¬ ì˜ì—­ì˜ ë³´í˜¸ ìˆ˜ì¤€ PROT_READ : ì½ê¸° ê°€ëŠ¥ PROT_WRITE: ì“°ê¸° ê°€ëŠ¥ PROT_EXEC : ì‹¤í–‰ ê°€ëŠ¥ PROT_NONE : ì ‘ê·¼ ê¸ˆì§€ flag : ë§¤í•‘ì˜ íŠ¹ì„±ì„ ì œì–´ MAP_SHARED : ë§¤í•‘ëœ ë©”ëª¨ë¦¬ ì˜ì—­ì— ëŒ€í•œ ë³€ê²½ì‚¬í•­ì´ íŒŒì¼ì´ ì§ì ‘ ë°˜ì˜ë˜ë©°, ë³€ê²½ì‚¬í•­ì€ ë‹¤ë¥¸ ëª¨ë“  ë§¤í•‘ì„ í†µí•´ì„œë„ ë³¼ ìˆ˜ ìˆìŒ. MAP_PRIVATE : ë§¤í•‘ëœ ë©”ëª¨ë¦¬ ì˜ì˜ì— ëŒ€í•œ ë³€ê²½ì‚¬í•­ì´ ë³µì‚¬ë³¸ì—ë§Œ ì ìš©ë˜ë©°, ì›ë³¸ íŒŒì¼ì€ ë³€ê²½ë˜ì§€ ì•ŠìŒ. ë³€ê²½ì‚¬í•­ì€ í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ì—ì„œë§Œ ë³¼ ìˆ˜ ìˆìŒ. MAP_FIXED : start ì— ì§€ì •ëœ ì£¼ì†Œì— ë§¤í•‘ì„ ê°•ì œ. fd : ë§¤í•‘í•  íŒŒì¼ì˜ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°. open í•¨ìˆ˜ë“±ì„ í†µí•´ ì–»ì„ ìˆ˜ ìˆìŒ. offset: íŒŒì¼ ë‚´ì—ì„œ ë§¤í•‘ì„ ì‹œì‘í•  offset. ì´ê°’ì€ ì‹œìŠ¤í…œì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ ê¸°ë³¸ë‹¨ìœ„ (í˜ì´ì§€ - ì¼ë°˜ì ìœ¼ë¡œ 4KB) ì˜ ë°°ìˆ˜ë¡œ í‘œê¸°int shm_open(const char *name, int flags, mode_t mode);POSIX (Portable Operating System Interface) ê¸°ë°˜ ì‹œìŠ¤í…œì—ì„œ ê³µìœ  ë©”ëª¨ë¦¬ ê°ì²´ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì—´ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜. ì´ í•¨ìˆ˜ëŠ” ê³µìœ  ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ (IPC)ì— í™œìš©ë  ìˆ˜ ìˆëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ ì œê³µ, í•´ë‹¹ í•¨ìˆ˜ë¡œ ìƒì„±ëœ ê°ì²´ëŠ” íŒŒì¼ì²˜ëŸ¼ ê´€ë¦¬ë˜ë©°, ì´ë¥¼ í†µí•´ í”„ë¡œì„¸ìŠ¤ë“¤ì´ ë©”ëª¨ë¦¬ ê³µê°„ì„ ê³µìœ í•  ìˆ˜ ìˆë‹¤. í•´ë‹¹ ê°ì²´ëŠ” â€˜/dev/shmâ€™ ë°‘ì— ìƒì„±, ì¬ë¶€íŒ…ì‹œ ì‚¬ë¼ì§. name : ê³µìœ  ë©”ëª¨ë¦¬ ê°ì²´ ì´ë¦„. â€˜/â€™ ë¡œ ì‹œì‘í•˜ëŠ” ê²½ë¡œ í˜•ì‹ì„ ì‚¬ìš© flags : O_RDONLY : ì½ê¸° ì „ìš© O_RDWR : ì½ê¸° ë° ì“°ê¸° O_CREAT : (ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°) ê°ì²´ ìƒì„± O_EXCL : (O_CREATE ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬), ë™ì¼ ê²½ë¡œì˜ ê°ì²´ê°€ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´ shm_openì€ -1ì„ ë°˜í™˜í•˜ê³ , errnoë¥¼ EEXISTë¡œ ì„¤ì • mode : ìƒì„±í•œ ê³µìœ ë©”ëª¨ë¦¬ ê°ì²´ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œ ì§€ì • (e.g. 0644ëŠ” ì†Œìœ ìëŠ” ì½ê¸°ì™€ ì“°ê¸° ê¶Œí•œ ë¶€ì—¬) ë°˜í™˜ê°’: íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°int ftruncate(int fd, off_t length)íŒŒì¼ í¬ê¸°ë¥¼ ë³€ê²½í•˜ëŠ”ë° ì‚¬ìš©í•˜ë©°, íŠ¹íˆ ê³µìœ  ë©”ëª¨ë¦¬ ê°ì²´ì˜ í¬ê¸°ë¥¼ ì¡°ì •í•  ë•Œ ì‚¬ìš©ë¨. fd : í¬ê¸°ë¥¼ ë³€ê²½í•˜ê³ ì í•˜ëŠ” íŒŒì¼ì˜ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° length: íŒŒì¼ì˜ ìƒˆë¡œìš´ í¬ê¸°ë¥¼ ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ì§€ì •3. code#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;sys/mman.h&gt; // mmap, munmap, PROT_READ, PROT_WRITE, MAP_SHARED, MAP_FAILED ë“±ì„ ì •ì˜#include &lt;sys/stat.h&gt; // shm_open, shm_unlink í•¨ìˆ˜ ì‚¬ìš© ì‹œ í•„ìš”í•œ mode ë§¤í¬ë¡œ(S_IRUSR, S_IWUSR ë“±)ë¥¼ ì •ì˜// POSIX í˜¸í™˜ ì‹œìŠ¤í…œì—ì„œ ì •ì˜ëœ, ì˜¤ë¥˜ë¥¼ ë³´ê³ í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì „ì—­ ë³€ìˆ˜ // í•´ë‹¹ ì½”ë“œì—ì„œ 'errno' ë³€ìˆ˜ì— í•¨ìˆ˜ ì‹¤í–‰ ì˜¤ë¥˜ ë°˜í™˜ ê°’ì„ ë°›ì•„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©#include &lt;errno.h&gt; #define SHM_NAME \"/comento_mem\"#define SHM_SIZE 4096int main(int argc, char *const argv[]) { int needs_init = 0, fd; char *ptr; // íŒŒì¼ ì‹¤í–‰ '-d' ì˜µì…˜ ì‹œ ê¸°ì¡´ ê³µìœ  ë©”ëª¨ë¦¬ ì‚­ì œ if (argc == 2 &amp;&amp; !strcmp(argv[1], \"-d\")) { printf(\"Delete the shared memory\\n\"); shm_unlink(SHM_NAME); return 0; } // '-l' : ìƒì„±ëœ ê°ì²´ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ í™•ì¸ // ls ëª…ë ¹ì–´ë¡œ \"/dev/shm\" ë‚´ íŒŒì¼ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒìœ¼ë¡œ êµ¬í˜„ else if (argc == 2 &amp;&amp; !strcmp(argv[1], \"-l\")) { static char *const ls_argv[] = { \"/bin/ls\", \"/dev/shm\", NULL }; printf(\"List the shared memory:\\n\"); execve(ls_argv[0], ls_argv, NULL); fprintf(stderr, \"Failed to run ls command\"); return 5; } // ìœ„ ì˜µì…˜ &amp;&amp; ì˜µì…˜ ì—†ëŠ” ìƒíƒœë¥¼ ì œì™¸í•˜ê³  ì˜ˆì™¸ ì²˜ë¦¬ else if(argc != 1) { fprintf(stderr, \"Usage : %s &lt;-d&gt; &lt;-l&gt;\\n\", argv[0]); return 4; } // ì˜µì…˜ì´ ì—†ëŠ” ìƒíƒœ - ê³µìœ  ë©”ëª¨ë¦¬ ê°ì²´ ì‚¬ìš© ëª¨ë“œ ì„¤ì • fd = shm_open(SHM_NAME, O_RDWR, 0600); if (fd == -1) { // 'ENOENT' : \"Error NO ENTry\" íŒŒì¼, ë””ë ‰í† ë¦¬ ë˜ëŠ” ì§€ì •ëœ ê°ì²´ê°€ ì¡´ì§€ í•˜ì§€ ì•Šì„ ë•Œ ë°˜í™˜ë˜ëŠ” ì˜¤ë¥˜ì½”ë“œ // 'shm_open' í•¨ìˆ˜ ì‹¤í–‰ ì˜¤ë¥˜ ì½”ë“œë¥¼ errno ì „ì—­ ë³€ìˆ˜ì— í• ë‹¹. if (errno == ENOENT) { printf(\"Create new shared memory\\n\"); // ê¸°ì¡´ì— ê°ì²´ê°€ ì—†ëŠ” ê²½ìš° ìƒˆë¡œ ìƒì„±í•˜ê³  ì‚¬ìš© ëª¨ë“œ ì„¤ì • fd = shm_open(SHM_NAME, O_CREAT | O_RDWR, 0600); printf(\"Set the size of shared memory\\n\"); if (ftruncate(fd, SHM_SIZE) == -1) { fprintf(stderr, \"Failed to ftruncate\\n\\n\"); return 2; } needs_init = 1; } else { fprintf(stderr, \"Failed to shm_open\\n\"); return 1; } } // ë©”ëª¨ë¦¬ ë§¤í•‘ ì„¤ì • printf(\"Mapping the shared memeory\\n\"); ptr = (char*) mmap(NULL, SHM_SIZE, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0); if (ptr == MAP_FAILED) { fprintf(stderr, \"Failed to mmap\\n\"); return 3; } // ê³µìœ  ë©”ëª¨ë¦¬ ê°ì²´ê°€ ìƒˆë¡œ ìƒì„±í•œ ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´, í•´ë‹¹ ë©”ëª¨ë¦¬ì— ê¸°ì¡´ì— ì €ì¥ëœ ë‚´ìš©ì„ ì¶œë ¥ if (!needs_init) { printf(\"before: %.4095s\\n\", ptr); // ìµœëŒ€ 4095 ê°œ ë¬¸ì ì¶œë ¥ } scanf(\"%4095s\", ptr); munmap(ptr, SHM_SIZE); close(fd); return 0;}4. ê³µìœ  ë©”ëª¨ë¦¬ ì‚¬ìš©ìœ„ ì†ŒìŠ¤ íŒŒì¼ì„ ì»´íŒŒì¼ í•˜ì—¬ ì‚¬ìš©user@DESKTOP:~$ gcc -o mmap mmap.cìš°ì„ , ì‚¬ìš©í•˜ê¸°ì „ ê³µìœ  ë©”ëª¨ë¦¬ ê°ì²´ ì €ì¥ ë””ë ‰í† ë¦¬ë¥¼ í™•ì¸í•˜ë©´, ì•„ë¬´ê²ƒë„ ì—†ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.user@DESKTOP:~$ ls -lah /dev/shmtotal 0drwxrwxrwt 2 root root 40 Mar 22 11:40 .drwxr-xr-x 16 root root 3.5K Mar 22 11:27 ..ê°ì²´ ìƒì„± íŒŒì¼ì„ ì‹¤í–‰í•˜ê³ , ë‹¤ì‹œ ls ëª…ë ¹ì–´ ë˜ëŠ” mmap -l ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë‘ ê°ì²´ê°€ ìƒì„±ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.user@DESKTOP:~$ ./mmapCreate new shared memorySet the size of shared memoryMapping the shared memeoryFirst!!!!!!!!!user@DESKTOP:~$ ls -lah /dev/shmtotal 4.0Kdrwxrwxrwt 2 root root 60 Mar 22 11:38 .drwxr-xr-x 16 root root 3.5K Mar 22 11:27 ..-rw------- 1 gon gon 4.0K Mar 22 11:38 comento_memuser@DESKTOP:~$ ./mmap -lList the shared memory:comento_memë§Œì•½ ë‹¤ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ ì í•˜ë©´ ê¸°ì¡´ ì €ì¥ëœ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.user@DESKTOP:~$ ./mmapMapping the shared memeorybefore: First!!!!!!!!!Second!!!!!!!ë§ˆì§€ë§‰ìœ¼ë¡œ í•´ë‹¹ ê°ì²´ë¥¼ ì œê±° ë° í™•ì¸user@DESKTOP:~$ ./mmap -dDelete the shared memoryuser@DESKTOP:~$ ls -lah /dev/shmtotal 0drwxrwxrwt 2 root root 40 Mar 22 11:40 .drwxr-xr-x 16 root root 3.5K Mar 22 11:27 ..ê·¸ëŸ¬ë‚˜, ì‹¤ì œ ê³µìœ  ë©”ëª¨ë¦¬ì˜ ê²½ìš°, ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ì ‘ê·¼í•˜ì—¬ ì½ê¸°, ì“°ê¸°ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì´ ì‘ì„±í•˜ë©´ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ ì¼ê´€ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•œ ì¶”ê°€ ì‘ì—… (e.g. semaphore êµ¬í˜„ ë“±) ì´ í•„ìš”í•˜ë‹¤."
    } ,
  
    {
      "title"       : "IPC ì‹¤ìŠµ 03 - Unix socket",
      "category"    : "",
      "tags"        : "linux, IPC, inter-process communication, unix socket",
      "url"         : "./IPC03.html",
      "date"        : "2024-03-20 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 17",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. Unix Socketì›¹ì„œë²„ ì„œë²„-í´ë¼ì´ì–¸íŠ¸ êµ¬ì¡°ì™€ ê°™ì´, ë‹¤ìˆ˜ì˜ í”„ë¡œì„¸ìŠ¤ê°„ ì–‘ë°©í–¥ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•¨. serever#include &lt;sys/socket.h&gt;#include &lt;sys/un.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;#define SOCKET_NAME \"/tmp/echo_socket\"int main() { pid_t pid; int sockfd, connfd; struct socketaddr_un addr; int recv_bytes; char buf[256]; sockfd = socket(AF_UNIX, SOCK_STREAM, 0); if(sockfd &lt; 0) { fprintf(stderr, \"[Server] Failed to create socket\\n\"); return 1; } memset(&amp;addr, 0, sizeof(addr)); addr.sun_family = AF_UNIX; snprintf(addr.sun_path, sizeof(addr.sun_path) - 1, SOCKET_NAME); unlink(addr.sun_path); // remove the socket file if exists if(bind(sockfd, (struct sockaddr*)&amp;addr, sizeof(addr)) &lt; 0) { fprintf(stderr, \"[Server] Failed to bind\\n\"); return 2; } if(listen(sockfd, 0) &lt; 0) { fprintf(stderr, \"[Server] Failed to listen\\n\"); return 2; } while(1) { connfd = accept(sockfd, NULL, NULL); if(connfd &lt; 0) { fprintf(stderr, \"[Server] Failed to accept\\n\"); break; } printf(\"[Server] Client connected!\\n\"); pid = fork(); if(pid == 0) { while(1) { recv_bytes = read(connfd, buf, sizeof(buf)); if(recv_bytes &lt;= 0) { break; } printf(\"[Server] Recv : %.*s\\n\", recv_bytes, buf); write(connfd, buf, recv_bytes); } close(connfd); printf(\"[Server] Client disconnected!\\n\"); return 0; } } close(sockfd); return 3; } client#include &lt;sys/socket.h&gt;#include &lt;sys/un.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;#define SOCKET_NAME \"/tmp/echo_socket\"int main() { pid_t pid; int socketfd, recv_bytes; struct sockaddr_un addr; char buf[256]; sockfd = socket(AF_UNIX, SOCK_STREAM, 0); if(sockfd &lt; 0) { fprintf(stderr, \"[Client] Failed to create socket\\n\"); return 1; } memset(&amp;addr, 0, sizeof(addr)); addr.sun_family = AF_UNIX; snprintf(addr.sun_path, sizeof(addr.sun_path) - 1, SOCKET_NAME); if(connect(sockfd, (strcut sockaddr*)&amp;addr, sizeof(addr)) &lt; 0) { fprintf(stderr, \"[Client] Failed to connect\\n\"); return 2; } while(1) { printf(\"'q' for exit&gt;\"); buf[0] = '\\0'; scanf(\"%255s\", buf); if(!strcmp(buf, \"q\")) { break; } write(sockfd, buf, strlen(buf)); recv_bytes = read(sockfd, buf, sizeof(buf)); if(recv_bytes &lt;= 0) { printf(\"[Client] Server shutdown!\\n\"); break; } printf(\"[Client] Recv: %.*s\\n\", recv_bytes, buf); } close(sockfd); printf(\"[Client] Exit!\\n\"); return 3;}"
    } ,
  
    {
      "title"       : "IPC ì‹¤ìŠµ 02 - pipe",
      "category"    : "",
      "tags"        : "linux, IPC, inter-process communication, pipe",
      "url"         : "./IPC02.html",
      "date"        : "2024-03-19 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 16",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. pipe êµ¬í˜„ì„ í†µí•œ ë¶€ëª¨ í”„ë¡œì„¸ì„œì™€ ìì‹ í”„ë¡œì„¸ì„œ IPCpipe ê°œë…ë„ #include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/wait.h&gt;int main() { pid_t pid; int pipe_from_parent_to_child[2]; int pipe_from_child_to_parent[2]; char buf[256]; pipe(pipe_from_parent_to_child); pipe(pipe_from_child_to_parent); pid = fork(); if(pid == 0) { // ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” fd ëŠ” ë‹«ì•„ì¤Œ. close(pipe_from_child_to_parent[0]); close(pipe_from_parent_to_child[1]); const char *msg = \"I'm child~!!\"; printf(\"[Child] send mes: %s\\n\", msg); write(pipe_from_child_to_parent[1], msg, strlen(msg) + 1); sleep(1); read(pipe_from_parent_to_child[0], buf, 256); printf(\"[Child] recv msg: %s\\n\", buf); close(pipe_from_child_to_parent[1]); close(pipe_from_parent_to_child[0]); } else { // ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” fd ëŠ” ë‹«ì•„ì¤Œ. close(pipe_from_child_to_parent[1]); close(pipe_from_parent_to_child[0]); const char *msg = \"I'm parent~!!\"; printf(\"[Parent] send mes: %s\\n\", msg); write(pipe_from_parent_to_child[1], msg, strlen(msg) + 1); sleep(1); read(pipe_from_child_to_parent[0], buf, 256); printf(\"[Parent] recv msg: %s\\n\", buf); close(pipe_from_child_to_parent[0]); close(pipe_from_parent_to_child[1]); } return 0;}ì‹¤í–‰user@DESKTOP:~$ vim pipe.cuser@DESKTOP:~$ gcc -o pipe pipe.cuser@DESKTOP:~$ ./pipe[Parent] send mes: I'm parent~!![Child] send mes: I'm child~!![Child] recv msg: I'm parent~!![Parent] recv msg: I'm child~!!2. íŒŒì´í”„ ëª…ë ¹ì–´ êµ¬í˜„ë¦¬ëˆ…ìŠ¤ì—ì„œ ì‚¬ìš”í•˜ëŠ” íŒŒì´í”„ ê¸°í˜¸ | ë„ ë™ì¼í•œ pipe IPC ë¥¼ ì‚¬ìš©í•œ ê¸°ëŠ¥ì´ë‹¤. ë”°ë¼ì„œ, ì˜ˆë¥¼ ë“¤ë©´ cat /etc/passwd | wc -l ì„ pipe IPC ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œê·¸ë¨ìœ¼ë¡œ êµ¬í˜„í•´ë³¼ ìˆ˜ ìˆë‹¤. #include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/wait.h&gt;/* cat /etc/passwd | wc -l */extern char** environ;char* const front_argv[] = { \"/bin/cat\", \"/etc/passwd\", NULL};char* const back_argv[] = { \"/bin/wc\", \"-l\", NULL};int main() { pid_t pid; int pipefd[2]; pipe(pipefd); pid = fork(); if(pid == 0) { close(pipefd[0]); // ì½ê¸° fd ì‚¬ìš© X dup2(pipefd[1], STDOUT_FILENO); // ì“°ê¸° fd ë¥¼ í‘œì¤€ì¶œë ¥ -&gt; ëª¨ë“  í‘œì¤€ì¶œë ¥ì€ ì“°ê¸° fd ë¡œ ì „ì†¡ë¨ close(pipefd[1]); // í‘œì¤€ ì¶œë ¥ ë³µì œ í›„ ë‹«ìŒ. execve(front_argv[0], front_argv, environ); } pid = fork(); if(pid == 0) { close(pipefd[1]); // ì½ê¸° fd ì‚¬ìš© X dup2(pipefd[0], STDIN_FILENO); // ì¼ê¸° fd ë¥¼ í‘œì¤€ì¶œë ¥ -&gt; ì½ê¸° fd ì—ì„œ ì½ã…‡ëŠ ê°’ì„ í‘œì¤€ì…ë ¥ìœ¼ë¡œ ì‚¬ìš© close(pipefd[0]); // í‘œì¤€ ì…ë ¥ ë³µì œ í›„ ë‹«ìŒ. execve(back_argv[0], back_argv, environ); } wait(NULL); // ë¶€ëª¨í”„ë¡œì„¸ìŠ¤ì—ì„œì˜ fd ëŠ” ë³„ê°œë¡œ ë‹«ì•„ì•¼ í•¨. close(pipefd[0]); // ì½ê¸° fd ê°€ ë‹«íˆë©´ 2ë²ˆì§¸ í”„ë¡œì„¸ìŠ¤ì˜ í‘œì¤€ ì…ë ¥ë„ close(pipefd[1]); // ë‹«íˆë©´ì„œ 2ë²ˆì§¸ í”„ë¡œì„¸ìŠ¤ë„ ì¢…ë£Œë¨. wait(NULL); return 0;}ê²°ê³¼ í™•ì¸ì•„ë˜ì™€ ê°™ì´ í•´ë‹¹ íŒŒì¼ì„ ì‹¤í–‰í•œ ê²°ê³¼ì™€ cat /etc/passwd | wc -l ì˜ ì‹¤í–‰ ê²°ê³¼ê°€ ë™ì¼í•¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.user@DESKTOP:~$ gcc -o pipe2 pipe2.cuser@DESKTOP:~$ ./pipe227user@DESKTOP:~$ cat /etc/passwd | wc -l273. ë„¤ì„ë“œ íŒŒì´í”„ë¶€ëª¨ ìì‹ê°„ì´ ì•„ë‹Œ í”„ë¡œì„¸ìŠ¤ê°„ FIFO íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì•Œ ìˆ˜ ìˆë‹¤ë©´ í†µì‹ ì´ ê°€ëŠ¥í•˜ë©°, ì´ëŠ” mkfifo(fifo_file, mode) ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜í–‰ ê°€ëŠ¥í•˜ë‹¤.ë”°ë¼ì„œ, ì•ì—ì„œ êµ¬í˜„í•œ cat /etc/passwd | wc -l ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë‘ê°œì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ì´ë¥¼ ì—°ê²°í•˜ì—¬ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤. í•´ë‹¹ ì‚¬í•­ì„ shell script ë¡œ êµ¬í˜„í•˜ë©´#!/bin/bashmkfifo -m 0600 fifowc -l &lt; fifo &amp;cat /etc/passwd &gt; fiform fifoì‹¤í–‰ê²°ê³¼user@DESKTOP:~$ chmod +x pipe3.shuser@DESKTOP:~$ ./pipe3.sh27user@DESKTOP:~$ cat /etc/passwd | wc -l27"
    } ,
  
    {
      "title"       : "IPC ì‹¤ìŠµ 01 - fork / execve",
      "category"    : "",
      "tags"        : "linux, IPC, inter-process communication, fork, execve",
      "url"         : "./IPC01.html",
      "date"        : "2024-03-18 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 15",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.fork ë¥¼ ì‚¬ìš©í•œ ìì‹ í”„ë¡œì„¸ìŠ¤ ìƒì„± ë° ì¢…ë£Œì•„ë˜ì™€ ê°™ì´ ì†ŒìŠ¤ì½”ë“œë¥¼ ì‘ì„±í•˜ì—¬ ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ ìƒì•  ì£¼ê¸° (ìƒì„± - ì‘ì—… - ì¢€ë¹„(ì‘ì—…ì™„ë£Œ) - ì •ë¦¬) ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/wait.h&gt;extern char **environ; // í™˜ê²½ë³€ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì „ì—­ ë³€ìˆ˜char ppid_str[32];char* const ps_argv[] = { \"/bin/ps\", \"-fx\", NULL,};int run_ps() { // í˜„ì¬ ì‘ì—… ì¤‘ì¸ ì‹œìŠ¤í…œ í”„ë¡œì„¸ìŠ¤ ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ ìì‹ í”„ë¡œì„¸ìŠ¤ ìƒì„± -- (b) int status; pid_t pid; printf(\"Process list &gt;\\n\"); pid = fork(); if (pid == 0) { execve(ps_argv[0], ps_argv, environ); // execve ì‹œìŠ¤í…œ ì½œ ì‹¤í–‰ -- (c) } waitpid(pid, &amp;status, 0/*no option*/); }int main() { // fork í”„ë¡œì„¸ìŠ¤ ìƒì•  ì£¼ê¸°ë¥¼ ë³´ê¸° ìœ„í•´ ìˆœì°¨ì  ì‘ì—… êµ¬í˜„ -- (a) int status; pid_t pid; pid = fork(); if (pid == 0) { // c. ìƒì„±ëœ ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ ì‘ì—… printf(\"[Child] pid-%d ppid-%d\\n\", getpid(), getppid()); sleep(1); // ë¶€ëª¨í”„ë¡œì„¸ìŠ¤ printf(\"[Child] exit\\n\"); return 3; // c-1. ìì‹ í”„ë¡œì„¸ìŠ¤ ì‘ì—… ì¢…ë£Œ } else { // p. ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ printf(\"[Parent] pid-%d\\n\", getpid()); run_ps(); // p-1 ì‘ì—… ìˆ˜í–‰ sleep(2); // ìì‹ í”„ë¡œì„¸ìŠ¤ ì‘ì—… ì™„ë£Œ ëŒ€ê¸° run_ps(); // p-2 ìì‹ í”„ë¡œì„¸ìŠ¤ ì‘ì—… ì™„ë£Œ í›„ ì „ì²´ ì‹œìŠ¤í…œ í”„ë¡œì„¸ìŠ¤ ìƒíƒœ í™•ì¸ waitpid(pid, &amp;status, 0/*no option*/); // p-3 ìì‹ í”„ë¡œì„¸ìŠ¤ ì‘ì—… ì™„ë£Œ ëŒ€ê¸° ë° ì¢€ë¹„ í”„ë¡œì„¸ìŠ¤ ì •ë¦¬ í›„ printf(\"[Parent] child exit: %d\\n\", WEXITSTATUS(status)); // ìì‹ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ìƒíƒœ í™•ì¸ run_ps(); // p-4 (ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ì™„ì „íˆ ì œê±°í•œ ì´í›„) í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ ìƒíƒœ í™•ì¸ printf(\"[Parent] exit\\n\"); return 0; }}a. fork í”„ë¡œì„¸ìŠ¤ ìƒì•  ì£¼ê¸°ë¥¼ ë³´ê¸° ìœ„í•´ ìˆœì°¨ì  ì‘ì—… êµ¬í˜„pid = fork(); ë¥¼ ìˆ˜í–‰í•˜ë©´ ë™ì¼í•œ ë‚´ìš©ì„ ê°€ì§„ ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ì™€ ìì‹ í”„ë¡œì„¸ìŠ¤ê°€ ìƒì„±ëœë‹¤. ë‹¤ë¥¸ ì ì€ í•´ë‹¹ ì‹œìŠ¤í…œì½œ ìˆ˜í–‰í›„ ë°˜í™˜ê°’ pid ëŠ” ìì‹í”„ë¡œì„¸ìŠ¤ëŠ” 0, ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ëŠ” ìì‹ í”„ë¡œì„¸ìŠ¤ PID ê°’ì„ ê°€ì§€ê²Œ ëœë‹¤.ë”°ë¼ì„œ ê·¸ë‹¤ìŒ ì¡°ê±´ë¬¸ì—ì„œ ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ ì‘ì—…ì´ ë‹¬ë¼ì§€ê²Œ ë˜ë©°, ê°ê°ì˜ ì‘ì—…ì€ ë™ì‹œì— ìˆ˜í–‰ë˜ë¯€ë¡œ, ì‘ì—…ì˜ ìš°ì„  ìˆœìœ„ë¥¼ í™•ì •í•  ìˆ˜ ì—†ë‹¤. ì—¬ê¸°ì„œëŠ” ê·¸ ì‘ì—…ì„ ì‹œê°„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ì‹œì¼œì„œ ê·¸ ìƒì•  ì£¼ê¸°ë¥¼ ì •í™•í•˜ê²Œ í™•ì¸í•˜ê¸° ìœ„í•´ í•„ìš”í•œ êµ¬ê°„ì— ê° í”„ë¡œì„¸ìŠ¤ì— sleep() ì¡°ê±´ì„ ì£¼ì–´ì„œ êµ¬í˜„í•˜ì˜€ë‹¤.ê·¸ ì‘ì—… ê³¼ì •ì„ ì‹œê°„ ìˆœì„œëŒ€ë¡œ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤. ë¶€ëª¨/ ìì‹ í”„ë¡œì„¸ìŠ¤ ê°ê° pid ì¶œë ¥ (ìš°ì„ ìˆœìœ„ ì—†ìŒ) ë¶€ëª¨ p-1 : ìì‹ í”„ë¡œì„¸ìŠ¤ê°€ ì•„ì§ ì‹¤í–‰ ì¤‘ì¸ ìƒíƒœì—ì„œ ì‹œìŠ¤í…œ í”„ë¡œì„¸ìŠ¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶œë ¥í•˜ëŠ” ì‘ì—… ìˆ˜í–‰ ìì‹ c-1 : ìì‹ í”„ë¡œì„¸ìŠ¤ ë‚´ë¶€ ì‘ì—…ì„ ì¢…ë£Œ. í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ëŠ” ë°˜í™˜ ê°’(3) ì„ ê°€ì§„ ì¢€ë¹„ ìƒíƒœë¡œ ì „í™˜ë¨. ë¶€ëª¨ p-2 : ì‹œìŠ¤í…œ í”„ë¡œì„¸ìŠ¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶œë ¥í•˜ëŠ” ì‘ì—… ìˆ˜í–‰. ì—¬ê¸°ì„œ ì•„ì§ ìì‹ í”„ë¡œì„¸ìŠ¤ê°€ ì¢€ë¹„(z) ìƒíƒœë¡œ ë‚¨ì•„ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤. ë¶€ëª¨ p-3 : ì¢€ë¹„ ìƒíƒœì˜ ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ì •ë¦¬í•˜ê³ , ìì‹ í”„ë¡œì„¸ìŠ¤ ë°˜í™˜ê°’(3)ì„ í™•ì¸. ë¶€ëª¨ p-4 : ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹œìŠ¤í…œ í”„ë¡œì„¸ìŠ¤ ë¦¬ìŠ¤íŠ¸ì—ì„œ ìì‹ í”„ë¡œì„¸ìŠ¤ê°€ ì‚¬ë¼ì§ì„ í™•ì¸.ìœ„ ë‚´ìš©ì„ ì‹¤ì œë¡œ ì‹¤í–‰í•˜ì—¬ ê·¸ ê²°ê³¼ë¥¼ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤user@DESKTOP:~$ gcc -o fork fork.cuser@DESKTOP:~$ ./fork[Parent] pid-7653Process list &gt;[Child] pid-7654 ppid-7653 PID TTY STAT TIME COMMAND 437 pts/1 S+ 0:00 -bash 372 pts/0 Ss 0:00 -bash 7653 pts/0 S+ 0:00 \\_ ./fork 7654 pts/0 S+ 0:00 \\_ ./fork 7655 pts/0 R+ 0:00 \\_ /bin/ps -fx 431 ? Ss 0:00 /lib/systemd/systemd --user 432 ? S 0:00 \\_ (sd-pam)[Child] exitProcess list &gt; PID TTY STAT TIME COMMAND 437 pts/1 S+ 0:00 -bash 372 pts/0 Ss 0:00 -bash 7653 pts/0 S+ 0:00 \\_ ./fork 7654 pts/0 Z+ 0:00 \\_ [fork] &lt;defunct&gt; 7664 pts/0 R+ 0:00 \\_ /bin/ps -fx 431 ? Ss 0:00 /lib/systemd/systemd --user 432 ? S 0:00 \\_ (sd-pam)[Parent] child exit: 3Process list &gt; PID TTY STAT TIME COMMAND 437 pts/1 S+ 0:00 -bash 372 pts/0 Ss 0:00 -bash 7653 pts/0 S+ 0:00 \\_ ./fork 7665 pts/0 R+ 0:00 \\_ /bin/ps -fx 431 ? Ss 0:00 /lib/systemd/systemd --user 432 ? S 0:00 \\_ (sd-pam)[Parent] exití•´ë‹¹ ì¶œë ¥ì¤‘ ì•„ë˜ì— í•´ë‹¹í•˜ëŠ” í•­ëª©ì„ ë³´ë©´, ìì‹ í”„ë¡œì„¸ìŠ¤ ì‘ì—…ì„ ì™„ë£Œí•œ ì´í›„ 7654 pts/0 Z+ 0:00 \\_ [fork] &lt;defunct&gt;state ëŠ” ì¢€ë¹„(z) ì´ë©° ì²˜ë¦¬ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.b. í˜„ì¬ ì‘ì—… ì¤‘ì¸ ì‹œìŠ¤í…œ í”„ë¡œì„¸ìŠ¤ ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ ìì‹ í”„ë¡œì„¸ìŠ¤ ìƒì„±run_ps() ëŠ” í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì‹œìŠ¤í…œ í”„ë¡œì„¸ìŠ¤ ëª©ë¡ì„ ì¶œë ¥í•˜ê¸° ìœ„í•œ ëª…ë ¹ì–´ ps ì„ í•´ë‹¹ ëª…ë ¹ì–´ íŒŒì¼ë¡œ ì‹¤í–‰ ì‹œí‚¤ëŠ” í•¨ìˆ˜ ì´ë‹¤.í•´ë‹¹ í•¨ìˆ˜ ë‚´ì—ì„œ ì‹¤ì œë¡œ ps ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” ì‘ì—…ì€ fork í•˜ì—¬ ìì‹ í”„ë¡œì„¸ìŠ¤ê°€ ì‘ì—…í•˜ë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ëŠ” ì•„ë˜ì™€ ê°™ì´ ì¶œë ¥ë¨ì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤. 7655 pts/0 R+ 0:00 \\_ /bin/ps -fxc. execve ì‹œìŠ¤í…œ ì½œ ì‹¤í–‰` execve(ps_argv[0], ps_argv, environ) ì‹œìŠ¤í…œ ì½œì´ ìì‹ í”„ë¡œì„¸ìŠ¤ê°€ ps` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ ì‹œí‚¤ëŠ” ë¶€ë¶„ì´ë‹¤.í•´ë‹¹ í•¨ìˆ˜ì˜ ë§¤ê°œ ë³€ìˆ˜ë¥¼ ë³´ë©´ ë‹¤ìŒê°€ ê°™ë‹¤.execve(filename, argv, env) filename : í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì‹¤í–‰ ì‹œí‚¬ íŒŒì¼ argv : ì‹¤í–‰ í”„ë¡œê·¸ë¨ì— ì „ë‹¬í•  ì¸ì ë°°ì—´. ë°°ì—´ ì²«ë²ˆì§¸ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì‹¤í–‰íŒŒì¼ì˜ ì´ë¦„, ì¤‘ê°„ ì¸ìë“¤ì€ í•´ë‹¹ í”„ë¡œê·¸ë¨ ì‹¤í–‰ì‹œ ì„¤ì • ì˜µì…˜, íŒŒë¼ë¯¸í„° ë“¤, ë§ˆì§€ë§‰ì€ NULL ë¡œ ì¢…ë£Œë¥¼ ì˜ë¯¸í•œë‹¤. env(í™˜ê²½ë³€ìˆ˜) : ì‹¤í–‰ í”„ë¡œê·¸ë¨ì—ê²Œ ì „ë‹¬ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜ ë°°ì—´ì´ë©°, ê° í™˜ê²½ ë³€ìˆ˜ëŠ” â€œKEY=valueâ€ í˜•íƒœì˜ ë¬¸ìì—´ì´ë©°, ë§ˆì§€ë§‰ ê°’ì€ NULL ì´ì–´ì•¼ í•œë‹¤. ë‹¤ë§Œ, í™˜ê²½ë³€ìˆ˜ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë  ë•Œ, ìì²´ì ìœ¼ë¡œ ì„¤ì •ë˜ë©°, í•´ë‹¹ ë³€ìˆ˜ë¥¼ extern char **environ; ì„ ì–¸ìœ¼ë¡œ í¬ì¸í„°ë¡œ ì§€ì •í•´ì„œ ì‚¬ìš©í•˜ê²Œ ëœë‹¤."
    } ,
  
    {
      "title"       : "udev ì™€ ì—°ë™í•˜ê¸°",
      "category"    : "",
      "tags"        : "linux, device driver, udev",
      "url"         : "./udev1.html",
      "date"        : "2024-03-02 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 14",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. udev ë€?ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì—ì„œ ì¥ì¹˜ ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì‚¬ìš©ì ê³µê°„ì˜ ë°ëª¬. ì´ëŠ” ì»¤ë„ì—ì„œ ì¥ì¹˜ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ê³ , ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¥ì¹˜ íŒŒì¼ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê±°ë‚˜ ì‚­ì œí•˜ë©°, ì¥ì¹˜ì— ëŒ€í•œ ê·œì¹™ì„ ì²˜ë¦¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤. udevì˜ ì£¼ìš” ëª©ì ì€ ì‹œìŠ¤í…œì´ ì‹¤í–‰ ì¤‘ì¼ ë•Œ ì¥ì¹˜ë¥¼ ê´€ë¦¬í•˜ê³ , ì¥ì¹˜ ê°„ì˜ ì¼ê´€ëœ ëª…ëª… ê·œì¹™ì„ ìœ ì§€í•˜ë©°, ì‚¬ìš©ìê°€ ì •ì˜í•œ ê·œì¹™ì— ë”°ë¼ ì¥ì¹˜ì— ëŒ€í•œ ì¶”ê°€ì ì¸ ì„¤ì •ì„ ìë™ìœ¼ë¡œ ì ìš©í•˜ëŠ” ê²ƒì´ë‹¤.ì£¼ìš” ê¸°ëŠ¥ ë™ì  ì¥ì¹˜ ê´€ë¦¬: udevëŠ” USB ë“œë¼ì´ë¸Œë‚˜ ë„¤íŠ¸ì›Œí¬ ì–´ëŒ‘í„° ê°™ì€ í•˜ë“œì›¨ì–´ ì¥ì¹˜ê°€ ì‹œìŠ¤í…œì— ì¶”ê°€ë˜ê±°ë‚˜ ì œê±°ë  ë•Œ, í•´ë‹¹ ë³€í™”ë¥¼ ê°ì§€í•˜ê³  ë°˜ì‘í•œë‹¤. ì´ë¥¼ í†µí•´, ì‹œìŠ¤í…œì€ ì‹¤í–‰ ì¤‘ì—ë„ ì¥ì¹˜ì˜ ì¶”ê°€ ë° ì œê±°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. íŠ¹íˆ í•´ë‹¹ ê²½ìš°ëŠ”, ë¯¸ë¦¬ ì•ì—ì„œ í•™ìŠµí•œ ë°©ë²•(major ë²ˆí˜¸ë¥¼ ë¯¸ë¦¬ ì…ë ¥)ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ì—†ë‹¤. (ex. USB ì¸ì‹) ì¥ì¹˜ íŒŒì¼ ìƒì„± ë° ì‚­ì œ: ì¥ì¹˜ê°€ ì‹œìŠ¤í…œì— ì—°ê²°ë  ë•Œ, udevëŠ” /dev ë””ë ‰í† ë¦¬ì— í•´ë‹¹ ì¥ì¹˜ë¥¼ ëŒ€í‘œí•˜ëŠ” ì¥ì¹˜ íŒŒì¼(ë˜ëŠ” ë…¸ë“œ)ì„ ìƒì„±í•©ë‹ˆë‹¤. ì¥ì¹˜ê°€ ì œê±°ë˜ë©´, í•´ë‹¹ íŒŒì¼ë„ ì‚­ì œë©ë‹ˆë‹¤. ì´ ê³¼ì •ì€ ìë™ìœ¼ë¡œ ìˆ˜í–‰ë˜ì–´ ì‚¬ìš©ìë‚˜ ì‹œìŠ¤í…œ ê´€ë¦¬ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì¥ì¹˜ íŒŒì¼ì„ ê´€ë¦¬í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ê·œì¹™ ê¸°ë°˜ ì¥ì¹˜ ê´€ë¦¬: udevëŠ” /etc/udev/rules.dì™€ ê°™ì€ ë””ë ‰í† ë¦¬ì— ì €ì¥ëœ ê·œì¹™ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì¥ì¹˜ì— ëŒ€í•œ ì„¸ë¶€ì ì¸ ê´€ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì´ ê·œì¹™ë“¤ì€ ì¥ì¹˜ì˜ ëª…ëª…, ê¶Œí•œ ì„¤ì •, ì¥ì¹˜ì— ëŒ€í•œ ì‚¬ìš©ì ì •ì˜ ì•¡ì…˜ ì‹¤í–‰ ë“±ì„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¥ì¹˜ ì •ë³´ ì œê³µ: udevëŠ” ì—°ê²°ëœ ì¥ì¹˜ì— ëŒ€í•œ ìƒì„¸í•œ ë©”íƒ€ë°ì´í„°ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ì‹œìŠ¤í…œì´ ì¥ì¹˜ë¥¼ ì •í™•íˆ ì‹ë³„í•˜ê³ , ì ì ˆí•œ ë“œë¼ì´ë²„ë¥¼ ë¡œë“œí•˜ë©°, ì‚¬ìš©ì ì •ì˜ ê·œì¹™ì„ ì ìš©í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì‚¬ìš©ì ì •ì˜ ì•¡ì…˜: ì‚¬ìš©ìëŠ” udev ê·œì¹™ì„ í†µí•´ íŠ¹ì • ì¥ì¹˜ì— ëŒ€í•´ íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì‹¤í–‰í•  ëª…ë ¹ì´ë‚˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì¥ì¹˜ê°€ ì‹œìŠ¤í…œì— ì—°ê²°ë  ë•Œ ìë™ìœ¼ë¡œ í•„ìš”í•œ ì„¤ì •ì„ ì ìš©í•˜ê±°ë‚˜, í•„ìš”í•œ ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¥ì¹˜ ì¸ì‹ processìƒˆë¡œìš´ ë””ë°”ì´ìŠ¤ê°€ ì¸ì‹ë˜ë©´, ì»¤ë„ì´ uevent ë¥¼ ë°œìƒì‹œì¼œì„œ udev ë°ëª¬ì—ê²Œ ì´ë¥¼ ì•Œë¦¼ udev ë°ëª¬ì€ /sys ë¥¼ í™•ì¸í•˜ì—¬ ë””ë°”ì´ìŠ¤ì— ëŒ€í•œ ì •ë³´ë¥¼ ì•Œì•„ëƒ„ ì»¤ë„ì´ /sys/devices ì™€ /sys/class ì— ìƒˆë¡œìš´ ë””ë°”ì´ìŠ¤ì— ëŒ€í•œ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„± ë””ë ‰í† ë¦¬ ë‚´ì˜ dev íŒŒì¼ì„ ì½ìœ¼ë©´ ì£¼ë²ˆí˜¸ì™€ ë¶€ë²ˆí˜¸ë¥¼ ì•Œ ìˆ˜ ìˆìŒ. udev ë°ëª¬ì€ ì•Œì•„ë‚¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ ë””ë°”ì´ìŠ¤ ë…¸ë“œë¥¼ /dev ì— ìƒì„±2. device classë¦¬ëˆ…ìŠ¤ ì»¤ë„ì˜ ë””ë°”ì´ìŠ¤ ëª¨ë¸ì—ì„œ â€œë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤(Device Class)â€ëŠ” ì‹œìŠ¤í…œ ë‚´ì˜ ë””ë°”ì´ìŠ¤ë“¤ì„ ë¶„ë¥˜í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜. ìœ ì‚¬í•œ ê¸°ëŠ¥ì´ë‚˜ ëª©ì ì„ ê°€ì§„ ë””ë°”ì´ìŠ¤ë“¤ì„ ê·¸ë£¹í™”í•˜ì—¬ ê´€ë¦¬ì˜ˆë¥¼ ë“¤ë©´, input í´ë˜ìŠ¤ : í‚¤ë³´ë“œ, ë§ˆìš°ìŠ¤ ë“±ì˜ ì…ë ¥ ì¥ì¹˜ë¥¼ í¬í•¨ net í´ë˜ìŠ¤ : ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì¹´ë“œ(NICs)ì™€ ê°™ì€ ë„¤íŠ¸ì›Œí‚¹ ì¥ì¹˜ë¥¼ í¬í•¨ë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤ ê¸°ëŠ¥ í†µí•©ëœ ê´€ë¦¬: ë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤ëŠ” íŠ¹ì • ìœ í˜•ì˜ ë””ë°”ì´ìŠ¤ë“¤(ì˜ˆ: ì…ë ¥ ë””ë°”ì´ìŠ¤, ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤, ì˜¤ë””ì˜¤ ì¥ì¹˜ ë“±)ì„ ë¬¶ì–´ì„œ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì‹œìŠ¤í…œ ë‚´ì—ì„œ ì‘ë™í•  ìˆ˜ ìˆë„ë¡ ê´€ë¦¬. ìë™ ë””ë°”ì´ìŠ¤ íŒŒì¼ ìƒì„±: /dev ë””ë ‰í† ë¦¬ì— ìˆëŠ” ë””ë°”ì´ìŠ¤ íŒŒì¼ë“¤ì€ ì‚¬ìš©ì ê³µê°„ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì»¤ë„ì˜ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì™€ í†µì‹ í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤. í´ë˜ìŠ¤ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ë©´, ìƒˆë¡œìš´ ë””ë°”ì´ìŠ¤ê°€ ì‹œìŠ¤í…œì— ì¶”ê°€ë  ë•Œ ìë™ìœ¼ë¡œ í•´ë‹¹ ë””ë°”ì´ìŠ¤ íŒŒì¼ì´ ìƒì„±ëœë‹¤. ì‹œìŠ¤í…œì˜ ê°€ì‹œì„± ë° ì ‘ê·¼ì„± í–¥ìƒ: /sys/class ë‚´ì—ëŠ” ê° ë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤ì— ëŒ€í•œ ë””ë ‰í† ë¦¬ê°€ ìˆìœ¼ë©° (ex. input, mem, pci_bus, net, tty ..), ì´ëŠ” ë””ë°”ì´ìŠ¤ì— ëŒ€í•œ ë©”íƒ€ë°ì´í„°ì™€ ìƒíƒœ ì •ë³´ë¥¼ ì œê³µí•œë‹¤. ì´ ì •ë³´ë¥¼ í†µí•´ ì‚¬ìš©ìë‚˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë””ë°”ì´ìŠ¤ì˜ í˜„ì¬ ìƒíƒœë¥¼ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆë‹¤. í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤ ì œê³µ: ë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤ëŠ” ê°œë°œìë“¤ì—ê²Œ í‘œì¤€í™”ëœ í”„ë¡œê·¸ë˜ë° ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤. ì´ë¥¼ í†µí•´ ê°œë°œìëŠ” íŠ¹ì • í´ë˜ìŠ¤ì— ì†í•˜ëŠ” ëª¨ë“  ë””ë°”ì´ìŠ¤ë“¤ê³¼ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤. 3. ë””ë°”ì´ìŠ¤ ìƒì„±ì„ udev ì—ê²Œ ì•Œë¦¬ê¸° class_create(owner, name): /sys/class ì— ìƒˆë¡œìš´ ë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤ ìƒì„± owner : ì–´ë–¤ ëª¨ë“ˆì— ì†í•´ ìˆëŠ”ê°€ë¥¼ ë‚˜íƒ€ëƒ„ (ìì²´ ëª¨ë“ˆì¸ ê²½ìš° THIS_MODULE ë¡œ ì§€ì •) device_create(class, parent, dev_no, data, name): ìƒˆë¡œìš´ ë””ë°”ì´ìŠ¤ ìƒì„± (/dev) parent : ë¶€ëª¨ ë””ë°”ì´ìŠ¤ (ì¼ë°˜ì ìœ¼ë¡œ ë²„ìŠ¤ ë””ë°”ì´ìŠ¤) ë¥¼ ë‚˜íƒ€ë‚´ë©° NULL ë¡œ ì§€ì • ê°€ëŠ¥ dev_no : MKDEV(major, minor) ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•˜ì—¬ ì£¼ë²ˆí˜¸, ë¶€ë²ˆí˜¸ ëª…ì‹œ. (MKDEV ë§¤í¬ë¡œëŠ” ì£¼/ë¶€ë²ˆí˜¸ë¥¼ í•˜ë‚˜ì˜ ë””ë°”ì´ìŠ¤ ë²ˆí˜¸ë¡œ ê²°í•©í•­ ë””ë°”ì´ìŠ¤ íŒŒì¼ ê³ ìœ  ì‹ë³„ì ì—­í• ì„ í•¨.) data : ë””ë°”ì´ìŠ¤ì™€ ê´€ë ¨ëœ ë°ì´í„°ë¥¼ ì§€ì • name : ë””ë°”ì´ìŠ¤ì˜ ì´ë¦„ì„ ì§€ì •. printf í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•˜ê²Œ, ë¬¸ìì—´ê³¼ ìˆ«ìë¥¼ ì¡°í•©í•˜ì—¬ ë””ë°”ì´ìŠ¤ ì´ë¦„ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤. (ex. \"%s%d\", DEVICE_NAME, minor) -&gt; /sys/devices/ ì— ìƒˆë¡œìš´ ë””ë ‰í† ë¦¬ì™€ dev íŒŒì¼ ìƒì„± 4. ë“œë¼ì´ë¸Œ ë…¸ë“œ ì†ŒìŠ¤ì½”ë“œ ì‘ì„±ê¸°ì¡´ /linux/drivers/comento/main.c íŒŒì¼ì˜ init í•¨ìˆ˜ ë‚´ìš©ì„ ìˆ˜ì •í•œë‹¤.ì•„ë˜ ì²«ë²ˆì§¸ ì½”ë“œëŠ” udev ë¥¼ ì‚¬ìš©í•˜ëŠ” í•´ë‹¹ í•¨ìˆ˜ì˜ ì •ì‹ì  êµ¬ì¡°ë¥¼ ë”°ë¼ ì‘ì„±ëœ ê²ƒì´ë©°, ê·¸ ì•„ë˜ ì½”ë“œëŠ” í•´ë‹¹ í¬ìŠ¤íŠ¸ ì‹¤ìŠµì—ì„œ ì‚¬ìš©í•œ ê°„ëµí™”ëœ ì½”ë“œ ì´ë‹¤. ì¼ë°˜ì  êµ¬ì¡° êµ¬í˜„ ì½”ë“œ```c#include &lt;linux/device.h&gt;#include &lt;linux/fs.h&gt;#define COMENTO_DEVICE_NAME â€œcomento-deviceâ€#define COMENTO_CLASS_NAME â€œcomentoâ€static struct file_operations comento_device_fops;static int comento_device_major;static struct class *comento_class;static struct device *comento_device;static int __init comento_module_init(void) { int minor = 0;comento_device_major = register_chardev( 0, COMENTO_DEVICE_NAME, &amp;comento_device_fops );if(comento_device_major &lt; 0) { printk(KENR_ERR \"%s: Failed to get major number\", COMENTO_DEVICE_NAME); ret = comento_device_major; goto err_register_chrdev;}comento_class = class_create(THIS_MODULE, COMENTO_CLASS_NAME);// ë°˜í™˜ê°’ì´ error ì¸ì§€ í™•ì¸ if(IS_ERR(comento_class)) { printk(KERN_ERR \"%s: Failed to create class\", COMENTO_DEVICE_NAME); ret = PTR_ERR(comento_class); goto err_class; // goto ë¬¸ì˜ ì‚¬ìš©ì€ ì¼ë°˜ì ìœ¼ë¡œ anti-pattern ì´ì§€ë§Œ, // ì˜ˆì™¸ì ìœ¼ë¡œ ì–´ë–¤ ìì›ì˜ íšë“ê³¼ í•´ì œ ê´€ë ¨(í•´ë‹¹ì˜ ê²½ìš°) ìì£¼ ì‚¬ìš©ë¨. }comento_device = device_create( comento_class, NULL, MKDEV(comento_device_major, minor), NULL, \"%s%d\", COMENTO_DEVICE_NAME, minor );if (IS_ERR(comento_device[minor])) { ret = PTR_ERR(comento_device[minor]); goto err_device;}// error ë°œìƒì‹œ class í•´ì œ device ë“±ë¡ í•´ì œ err_device: class_destroy(comento_class);err_class: unregister_chrdev(comento_device_major, COMENTO_DEVICE_NAME);err_register_chrdev: return ret; }module_init(comento_module_init);* ì‹¤ìŠµ êµ¬í˜„ ì½”ë“œ```c...#include &lt;linux/spinlock.h&gt;// ê¸°ì¡´ device name, major number ì„¤ì •ê°’ ì‚­ì œ// #define COMENTO_DEVICE_NAME \"comento-device\"// #define COMENTO_MAJOR_NUMBER 177#define COMENTO_BUF_SIZE 16...// í˜„ì¬ ì½”ë“œì—ì„œ êµ¬í˜„í•˜ì§€ ì•Šì•˜ì§€ë§Œ ì¼ë°˜ì ìœ¼ë¡œ exit í•  ë•Œ, // class / device ëª¨ë‘ destroy ì²˜ë¦¬í•´ì¤€ë‹¤. // ì´ ë•Œ goto ë¬¸ ì´ìš©í•˜ê¸°ë„ í•˜ë¯€ë¡œ ì´ëŸ° ì´ìœ ë¡œ ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸í•´ì¤€ë‹¤. static struct class* class;static struct device* device;static int __init comento_module_init(void){ printk(KERN_DEBUG \"%s\\n\", __func__); // udev ë¥¼ í†µí•´ì„œ major ë²ˆí˜¸ë¥¼ ìë™ ë¶€ì—¬ë°›ì„ ê²ƒì´ë¸Œë¡œ 0 (ìë™ ì§€ì •) ìœ¼ë¡œ ì„¤ì • int major = register_chrdev(0, \"comento\", &amp;fops); int minor = 17; // ì„ì˜ì˜ ìˆ«ì ë¶€ì—¬ // THIS_MODULE : ì´ ëª¨ë“ˆì´ í´ë˜ìŠ¤ì˜ ì£¼ì¸ (owner)ì„ì„ ëª…ì‹œ. (ìµœì‹  ì½”ë“œì—ì„œëŠ” ëª…ì‹œí•˜ì§€ ì•ŠìŒ?) // ownerì˜ ì˜ë¯¸ : ì´ ëª¨ë“ˆì´ ì‚¬ë¼ì¡Œì„ ë•Œ, class destroy ë¥¼ ë”°ë¼í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•˜ë”ë¼ë„ // í•´ë‹¹ í´ë˜ìŠ¤ëŠ” ì•Œì•„ì„œ ì‚¬ë¼ì§€ê²Œ ëœë‹¤. ì´ìœ ëŠ” owner ì¸ `THIS_MODULE` ì´ ì‚¬ë¼ì¡Œê¸° ë•Œë¬¸ì´ë‹¤. // ê·¸ë˜ë„ ì¼ë°˜ì ìœ¼ë¡œ exit í•  ë•Œ, í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ destroy í•´ì¤€ë‹¤. class = class_create(\"comento\"); // ë¶€ëª¨ ë””ë°”ì´ìŠ¤, data ëŠ” NULL // name : printf í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•˜ê²Œ, ë¬¸ìì—´ê³¼ ìˆ«ìë¥¼ ì¡°í•©í•˜ì—¬ ë””ë°”ì´ìŠ¤ ì´ë¦„ì„ ìƒì„± device = device_create(class, NULL, MKDEV(major, minor), NULL, \"%s%d\", \"comento\", minor); return 0; // ìë™ ì§€ì • ì´ë¯€ë¡œ 0 ìœ¼ë¡œ ì„¤ì •}...ë¹Œë“œ &amp; ko íŒŒì¼ rootfs ì´ë¯¸ì§€ ë‚´ ì¶”ê°€, QEMU ì‹¤í–‰user@DESKTOP:~/linux$ ARCH=arm64 CROSS_COMPILE=/home/gon/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu- makech64-none-linux-gnu/bin/aarch64-none-linux-gnu- make CALL scripts/checksyscalls.sh CC [M] drivers/comento/main.o LD [M] drivers/comento/comento.o MODPOST Module.symvers LD [M] drivers/comento/comento.kouser@DESKTOP:~/linux$ sudo mount -o loop buildroot/output/images/rootfs.ext4 /mntuser@DESKTOP:~/linux$ sudo cp drivers/comento/comento.ko /mnt/usr/lib/modules/.user@DESKTOP:~/linux$ sync user@DESKTOP:~/linux$ sudo umount /mntuser@DESKTOP:~/linux$ cd ..user@DESKTOP:~$ qemu-system-aarch64 -kernel linux/arch/arm64/boot/Image -drive format=raw,file=buildroot/output/images/rootfs.ext4,if=virtio -append \"root=/dev/vda console=ttyAMA0 nokaslr\" -nographic -M virt -cpu cortex-a72 -m 2G -smp 25. ì»¤ë„ ëª¨ë“ˆ ì‚½ì… ë° ì‹¤í–‰# cd /sys/class# lsata_device drm misc scsi_device ttyata_link graphics net scsi_disk vcata_port hwmon pci_bus scsi_generic virtio-portsbdi i2c-adapter power_supply scsi_host vtconsoleblock input pps thermal wakeupbsg iommu ptp tpmdevlink mem rtc tpmrmìœ„ì™€ ê°™ì´ /sys/class ì— ë“¤ì–´ê°€ë©´ ê¸°ì¡´ class ë””ë ‰í† ë¦¬ë“¤ì´ ìˆë‹¤.# insmod /usr/lib/modules/comento.ko# lsata_device devlink mem rtc tpmrmata_link drm misc scsi_device ttyata_port graphics net scsi_disk vcbdi hwmon pci_bus scsi_generic virtio-portsblock i2c-adapter power_supply scsi_host vtconsolebsg input pps thermal wakeupcomento iommu ptp tpm# cd comento# ls -lahtotal 0drwxr-xr-x 2 root root 0 Mar 3 08:48 .drwxr-xr-x 36 root root 0 Mar 3 08:46 ..lrwxrwxrwx 1 root root 0 Mar 3 08:53 comento17 -&gt; ../../devices/virtual/comento/comento17comento ì»¤ë„ ëª¨ë“ˆì„ ì‚½ì…í•´ì£¼ë©´ comento ë””ë ‰í† ë¦¬ê°€ ì¶”ê°€ëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ë””ë ‰í† ë¦¬ ì•ˆì— ì½”ë“œì—ì„œ ëª…ëª…í•œ ëŒ€ë¡œ comento17 (minor ë²ˆí˜¸ ì¶”ê°€) ë””ë°”ì´ìŠ¤ê°€ ìƒì„±ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. í•´ë‹¹ íŒŒì¼ì„ symbolic link ì‹¤ì œ íŒŒì¼ì€ /sys/devices/virtual/coment/comento17 ì— ì¡´ì¬í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤ í•´ë‹¹ ê²½ë¡œë¡œ ë‹¤ì‹œ ê°€ë³´ë©´,# cd /sys/devices/virtual/comento/comento17# ls -lahtotal 0drwxr-xr-x 3 root root 0 Mar 3 08:53 .drwxr-xr-x 3 root root 0 Mar 3 08:53 ..-r--r--r-- 1 root root 4.0K Mar 3 08:59 devdrwxr-xr-x 2 root root 0 Mar 3 08:59 powerlrwxrwxrwx 1 root root 0 Mar 3 08:59 subsystem -&gt; ../../../../class/comento-rw-r--r-- 1 root root 4.0K Mar 3 08:59 ueventì—¬ê¸°ì— dev íŒŒì¼ì´ ì¡´ì¬í•œë‹¤. ê·¸ ë‚´ìš©ì„ ì¶œë ¥í•´ë³´ë©´# cat dev248:17ì£¼ë²ˆí˜¸:ë¶€ë²ˆí˜¸ ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤. ì£¼ë²ˆí˜¸ ê°’ì€ udev ë°ëª¬ ê°€ í• ë‹¹í•œ ì„ì˜ì˜ ë²ˆí˜¸ì„ë„ í™•ì¸ ëœë‹¤. ì£¼ë²ˆí˜¸, ë¶€ë²ˆí˜¸ëŠ” /dev/coment ë‚´ ì¡´ì¬í•˜ëŠ” ë“œë¼ì´ë²„ ë…¸ë“œ ì •ë³´ë¡œë„ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.# ls -lah /dev/comento*crw------- 1 root root 248, 17 Mar 3 08:48 /dev/comento17ì•ì—ì„œ í™•ì¸í•œ ë‚´ìš©ê³¼ udev ë¥¼ ì‚¬ìš©í•˜ì—¬ ì–´ë–»ê²Œ ë””ë°”ì´ìŠ¤ íŒŒì¼ì´ ìƒì„±ë˜ëŠ”ì§€ ê³¼ì •ì„ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤. ì»¤ë„ ëª¨ë“ˆì„ ì‚½ì… (insmod): í•´ë‹¹ ëª¨ë“ˆì„ ì»¤ë„ì— ë¡œë“œ uevent ë°œìƒ: ì‹œìŠ¤í…œì— ìƒˆë¡œìš´ í•˜ë“œì›¨ì–´ê°€ ì¶”ê°€ë˜ì—ˆê±°ë‚˜, ìƒˆë¡œìš´ ë“œë¼ì´ë²„ê°€ ë¡œë“œë˜ì—ˆìŒì„ ì•Œë¦¼ udev class ìƒì„± (/sys/class/): ì»¤ë„ ëª¨ë“ˆ(ë˜ëŠ” ë“œë¼ì´ë²„) ë‚´ì—ì„œ class_create() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , ì´ ì •ë³´ëŠ” /sys/class/ì— ë°˜ì˜ udevëŠ” ì•ì—ì„œ ìƒì„±í•œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‘ì—…ì„ ìˆ˜í–‰ ì£¼ë²ˆí˜¸ ë° ë””ë°”ì´ìŠ¤ ìƒì„± (/sys/device/): ì»¤ë„ì— ì˜í•´ ì£¼ë²ˆí˜¸ê°€ ìƒì„±ë˜ë©°, ì»¤ë„ ëª¨ë“ˆì´ë‚˜ ë“œë¼ì´ë²„ëŠ” ë””ë°”ì´ìŠ¤ íŒŒì¼ì— ëŒ€í•œ ë©”ì´ì € ë²ˆí˜¸ì™€ ë§ˆì´ë„ˆ ë²ˆí˜¸ë¥¼ í• ë‹¹ë°›ì•„ ì‚¬ìš©. /sys/devices/ëŠ” ì‹¤ì œ ì¥ì¹˜ì™€ ê·¸ ì†ì„±ì„ ë°˜ì˜í•˜ëŠ” ì»¤ë„ì˜ ë””ë°”ì´ìŠ¤ íŠ¸ë¦¬ë¥¼ ë‚˜íƒ€ë‚´ë©°, ì—¬ê¸°ì„œ ë””ë°”ì´ìŠ¤ëŠ” ì»¤ë„ì´ë‚˜ ëª¨ë“ˆì— ì˜í•´ ë“±ë¡ë¨. ë“œë¼ì´ë²„ ìƒì„± (/dev/): /dev/ ë””ë ‰í† ë¦¬ì— ë””ë°”ì´ìŠ¤ íŒŒì¼ì´ ìƒì„±ë¨. ì´ ê³¼ì •ì€ udevì— ì˜í•´ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©°, /dev/ ë‚´ì˜ ë””ë°”ì´ìŠ¤ íŒŒì¼ì€ ì‚¬ìš©ì ê³µê°„ì—ì„œ í•´ë‹¹ ë””ë°”ì´ìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µ. udev ê·œì¹™ì— ë”°ë¼ ë””ë°”ì´ìŠ¤ íŒŒì¼ì˜ ì´ë¦„, ê¶Œí•œ ë“±ì´ ì„¤ì •."
    } ,
  
    {
      "title"       : "Device Driver ê°œë°œ 3 (íŒŒì¼ íŠ¹ìˆ˜ ì œì–´ (ioctl) êµ¬í˜„)",
      "category"    : "",
      "tags"        : "linux, device driver, device node, ioctl",
      "url"         : "./device_driver3.html",
      "date"        : "2024-03-02 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 13",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. íŒŒì¼ íŠ¹ìˆ˜ ì œì–´ (ioctl) ì´ë€?ioctlì€ ë¦¬ëˆ…ìŠ¤ì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì‹œìŠ¤í…œ ì½œ ì¤‘ í•˜ë‚˜ë¡œ, â€œInput/Output Controlâ€ì˜ ì•½ìì´ë‹¤. ë‹¨ìˆœ ì½ê¸°/ì“°ê¸° ì™¸ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì— íŠ¹ì • ëª…ë ¹ì„ ì „ë‹¬í•˜ê±°ë‚˜, ë“œë¼ì´ë²„ì˜ ìƒíƒœë¥¼ ë³€ê²½í•˜ê±°ë‚˜, ë‚´ë¶€ ë°ì´í„°ë¥¼ ì–»ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤. ì¼ë°˜ì ì¸ íŒŒì¼ ì…ì¶œë ¥ ì‹œìŠ¤í…œ ì½œê³¼ëŠ” ë‹¬ë¦¬, ioctlì„ í†µí•´ ë””ë°”ì´ìŠ¤ íŠ¹í™” ëª…ë ¹ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ í•˜ë“œì›¨ì–´ ë””ë°”ì´ìŠ¤ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ë° ë§¤ìš° ìœ ìš©í•˜ë‹¤.unlocked_ioctl í•¨ìˆ˜ í¬ì¸í„° í”„ë¡œí† íƒ€ì… : long (*unlocked_ioctl)(struct file *file, unsigned int cmd, unsigned long arg); struct file *file : í˜„ì¬ ì—´ë¦° íŒŒì¼(ë””ë°”ì´ìŠ¤)ì„ ë‚˜íƒ€ë‚´ëŠ” file êµ¬ì¡°ì²´ì— ëŒ€í•œ í¬ì¸í„°. ì´ êµ¬ì¡°ì²´ëŠ” íŒŒì¼ì— ëŒ€í•œ ì¤‘ìš”í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆìœ¼ë©°, ioctl í˜¸ì¶œ ì‹œ í•´ë‹¹ ë””ë°”ì´ìŠ¤ íŒŒì¼ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ì œê³µ. unsigned int cmd : ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì— ì „ë‹¬ëœ ëª…ë ¹. user spaceì—ì„œ ioctl í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ì§€ì •í•œ ëª…ë ¹ ì½”ë“œê°€ ì´ ì¸ìë¡œ ì „ë‹¬ëœë‹¤. ë“œë¼ì´ë²„ëŠ” ì´ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í• ì§€ ê²°ì •í•œë‹¤. ëª…ë ¹ ì½”ë“œëŠ” ë³´í†µ ë“œë¼ì´ë²„ì˜ í—¤ë” íŒŒì¼ì— ìƒìˆ˜ë¡œ ì •ì˜ë˜ì–´ ìˆë‹¤. cmd ì˜ ê²½ìš° ì¼ë°˜ì ì„ _IORê³¼ _IOW ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•´ì„œ ì •ì˜ í•œë‹¤. _IO(type, nr): arg ì—†ì´ ë‹¨ìˆœí•œ ëª…ë ¹ ë§¤í¬ë¡œ. typeì€ (ë””ë°”ì´ìŠ¤ ê³ ìœ ì˜) ëª…ë ¹ ìœ í˜•, nr ì€ ëª…ë ¹ì˜ ê³ ìœ  ë²ˆí˜¸ë¥¼ ì˜ë¯¸ _IOW(type, nr, size): arg ë¥¼ ì‚¬ìš©í•´ì„œ user space ì— size ë§Œí¼ì˜ ë°ì´í„°ë¥¼ kernel ì— ë„˜ê¹€. _IOR(type, nr, size): arg ë¥¼ ì‚¬ìš©í•´ì„œ kernel ë‚´ì—ì„œ ì½ê³ , í•´ë‹¹ data ë¥¼ size í¬ê¸° ë§Œí¼ ê°€ì ¸ì˜´. ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ì½ê¸°/ì“°ê¸°ì™€ëŠ” ë‹¤ë¥¸ ë””ë°”ì´ìŠ¤ì˜ ìƒíƒœ, êµ¬ì„±, ë˜ëŠ” ë‚´ë¶€ ì •ë³´ ë“±ì„ ì½ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤. unsigned long arg : ëª…ë ¹ì— ëŒ€í•œ ì¶”ê°€ ë°ì´í„°ë¥¼ í¬í•¨í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì ê³µê°„ì˜ í¬ì¸í„° ë˜ëŠ” ê°’. ëª…ë ¹ì˜ ì„±ê²©ì— ë”°ë¼ ì´ ê°’ì€ ì£¼ì†Œ ê°’ì¼ ìˆ˜ë„ ìˆê³ , ì§ì ‘ì ì¸ ë°ì´í„° ê°’ì¼ ìˆ˜ë„ ìˆë‹¤. ë“œë¼ì´ë²„ëŠ” ì´ ê°’ì„ í†µí•´ í•„ìš”í•œ ì¶”ê°€ ì •ë³´ë¥¼ ì–»ê±°ë‚˜ ì‚¬ìš©ì ê³µê°„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤. unlocked_ioctl í•¨ìˆ˜ëŠ” ì„±ê³µ ì‹œ 0 ë˜ëŠ” ì–‘ì˜ ì •ìˆ˜ë¥¼, ì‹¤íŒ¨ ì‹œ ìŒì˜ ì—ëŸ¬ ì½”ë“œë¥¼ ë°˜í™˜í•œë‹¤. ì´ ë°˜í™˜ ê°’ì€ ì‹œìŠ¤í…œ ì½œì„ í˜¸ì¶œí•œ ì‚¬ìš©ì ê³µê°„ í”„ë¡œì„¸ìŠ¤ì—ê²Œ ì „ë‹¬ëœë‹¤.(unlocked_ioctl ëŒ€ì‹  ioctl í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ  ì¤‘ í•˜ë‚˜ëŠ”, unlocked_ioctlì´ ë¹… ì»¤ë„ ë½(BKL, Big Kernel Lock)ì„ ì‚¬ìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤. ì´ëŠ” ë” ë‚˜ì€ ì„±ëŠ¥ê³¼ ë™ì‹œì„±ì„ ì œê³µí•˜ë©°, í˜„ëŒ€ì˜ ë©€í‹°ì½”ì–´ ì‹œìŠ¤í…œì—ì„œ ì¤‘ìš”í•œ íŠ¹ì§•ì´ë‹¤. ë”°ë¼ì„œ, ìƒˆë¡œìš´ ë“œë¼ì´ë²„ë¥¼ ì‘ì„±í•  ë•ŒëŠ” unlocked_ioctlì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ëœë‹¤.)2. íŒŒì¼ íŠ¹ìˆ˜ ì œì–´ (ioctl) êµ¬í˜„ê¸°ì¡´ì˜ main.c íŒŒì¼ì— ioctl ê´€ë ¨ êµ¬í˜„ ë‚´ìš©ì„ ì¶”ê°€í•´ ì¤€ë‹¤. í•´ë‹¹ ì½”ë“œëŠ” buffer ë‚´ìš©ì„ ì§€ìš°ëŠ” (clear) í•˜ëŠ” ì‘ì—…ì„ ì •ì˜í•˜ì˜€ë‹¤.#define COMENTO_MAGIC 'c' // type ( ioctl ëª…ë ¹ì„ ìœ ì¼í•˜ê²Œ ì‹ë³„í•˜ê¸° ìœ„í•œ ë¬¸ì)#define COMENTO_IOCTL_CLEAR _IO(COMENTO_MAGIC, 0) // nr: 0 í•¨ìˆ˜ ë‚´ë¶€ switch ë¬¸ì˜ êµ¬ë¶„ ë²ˆí˜¸static long comento_device_ioctl(struct file *fp, unsigned int cmd, unsigned long arg) { switch(cmd) { case COMENTO_IOCTL_CLEAR: memset(comento_device_buf, 0, COMENTO_BUF_SIZE); break; default: printk(KERN_DEBUG \"%s failed - %d\\n\", __func__, cmd); return -EINVAL; // ì •ì˜ë˜ì§€ ì•Šì€ ê°’ì´ ì…ë ¥ëœ ê²½ìš°, \"Invalid Argument\" ì˜¤ë¥˜ ë°˜í™˜ } return 0;}//...static struct file_operations comento_device_fops = { // ... .unlocked_ioctl = comento_device_ioctl,};í•œí¸, ì´ì „ post - íŒŒì¼ ì½ê¸°/ ì“°ê¸° ì—ì„œëŠ” íŒŒì¼ ì½ê¸°/ì“°ê¸° ê¸°ëŠ¥ë§Œ ì‚¬ìš©ë˜ë¯€ë¡œ, ê¸°ì¡´ì˜ ì½ê¸°/ì“°ê¸° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•˜ì˜€ë‹¤. ê·¸ëŸ¬ë‚˜ ioctl ì€ ì‚¬ìš©ì ì •ì˜ ëª…ë ¹ì„ í†µí•´ íŠ¹ì • ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì™€ ìƒí˜¸ì‘ìš©í•´ì•¼ í•˜ë¯€ë¡œ, ì´ë¥¼ ë³„ë„ë¡œ êµ¬í˜„í•´ ì£¼ì–´ì•¼ í•œë‹¤. ì´ì™€ ê´€ë ¨í•˜ì—¬ í•´ë‹¹ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.#include &lt;sys/ioctl.h&gt;#include &lt;linux/limits.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#define COMENTO_DEVICE_NAME \"comento\" // ë””ë°”ì´ìŠ¤ íŒŒì¼ëª… #define COMENTO_MAGIC 'c'// ë””ë°”ì´ìŠ¤ì— ëŒ€í•œ ioctl ëª…ë ¹ì„ ì •ì˜, _IO ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•˜ì—¬ COMENTO_IOCTL_CLEAR ëª…ë ¹ì„ ìƒì„±// í•´ë‹¹ ì •ì˜ëŠ” ì•ì— ì»¤ë„ ëª¨ë“ˆì˜ ì†ŒìŠ¤ì½”ë“œì—ì„œ ì •ì˜í•œ ê²ƒê³¼ ì¼ì¹˜í•´ì•¼ í•œë‹¤.#define COMENTO_IOCTL_CLEAR _IO(COMENTO_MAGIC, 0) int main(int argc, char *argv[]) { // open í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ /dev/comento-device ë””ë°”ì´ìŠ¤ íŒŒì¼ì„ ì½ê¸°/ì“°ê¸° ëª¨ë“œ(O_RDWR)ë¡œ ì—¼ // íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ëŠ” fd ë³€ìˆ˜ì— ì €ì¥ // íŒŒì¼ ì—´ê¸°ì— ì‹¤íŒ¨í•œ ê²½ìš°, ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê³  í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œ int fd = open(\"/dev/\" COMENTO_DEVICE_NAME, O_RDWR); if(fd &lt; 0) { printf(\"Failed to open device\\n\"); return -1; } // ioctl(fd, COMENTO_DEVICE_IOCTL_CLEAR, 0) í•´ë‹¹ í˜¸ì¶œì„ í†µí•´ // ì‹œìŠ¤í…œ ì½œì„ í†µí•´ ì»¤ë„ ê³µê°„ìœ¼ë¡œ ì „ë‹¬ë˜ê³ , ì»¤ë„ì€ ë“±ë¡ëœ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì˜ ioctl ì²˜ë¦¬ í•¨ìˆ˜ // 'comento_device_ioctl' - case COMENTO_DEVICE_IOCTL_CLEAR ì´ ì‹¤í–‰ë˜ê²Œ ëœë‹¤. // íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ëŠ” fd ë³€ìˆ˜ì— ì €ì¥ë˜ë©°, íŒŒì¼ ì—´ê¸°ì— ì‹¤íŒ¨í•œ ê²½ìš°, // ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê³  í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤. if(ioctl(fd, COMENTO_IOCTL_CLEAR, 0) &lt; 0) { printf(\"Failed to do ioctl command\\n\"); return -1; } return 0;}3. êµ¬í˜„ ì‘ì—…main.c ì„ ì—´ì–´ ìœ„ ì†ŒìŠ¤ ì½”ë“œ ì¶”ê°€user@DESKTOP:~/linux$ vim drivers/comento/main.cì†ŒìŠ¤ ì½”ë“œ ë¹Œë“œuser@DESKTOP:~/linux$ ARCH=arm64 CROSS_COMPILE=/home/gon/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu- make CALL scripts/checksyscalls.sh CC [M] drivers/comento/main.o LD [M] drivers/comento/comento.o MODPOST Module.symvers LD [M] drivers/comento/comento.koë¹Œë“œëœ ì»¤ë„ ëª¨ë“ˆì„ ì´ë¯¸ì§€ë‚´ ì‚½ì…user@DESKTOP:~/linux$ sudo mount -o loop ../buildroot/output/images/rootfs.ext4 /mntuser@DESKTOP:~/linux$ sudo cp drivers/comento/comento.ko /mnt/usr/lib/modules/.ì‚¬ìš©ì í”„ë¡œê·¸ë¨ ìƒì„± (ìœ„ ì‘ì„± ì½”ë“œ ë‚´ìš© ì‚¬ìš©)user@DESKTOP:~/linux$ cd ..user@DESKTOP:~$ vim ioctl.ctoolchain ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì í”„ë¡œê·¸ë¨ ë¹Œë“œuser@DESKTOP:~$ gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-gcc -o ioctl ioctl.cì‚¬ìš©ì í”„ë¡œê·¸ë¨ ì´ë¯¸ì§€ ë‚´ ì¶”ê°€user@DESKTOP:~$ sudo cp ioctl /mnt/usr/binuser@DESKTOP:~$ syncuser@DESKTOP:~$ sudo umount /mntQEMU ì‹¤í–‰user@DESKTOP:~$ qemu-system-aarch64 -kernel linux/arch/arm64/boot/Image -drive format=raw,file=buildroot/output/images/rootfs.ext4,if=virtio -append \"root=/dev/vda console=ttyAMA0 nokaslr\" -nographic -M virt -cpu cortex-a72 -m 2G -smp 24. ioclt ì‚¬ìš©ëª¨ë“ˆ ì‚½ì… ë° ë“œë¼ì´ë²„ ë…¸ë“œ íŒŒì¼ ìƒì„±# insmod /usr/lib/modules/comento.ko# cd /dev/# mkmod /dev/comento c 177 34# ls -lah comentocrw-r--r-- 1 root root 177, 34 Mar 2 07:12 comentonode file buffer ë¬¸ìì—´ ë„£ê¸° ë° í™•ì¸# echo \"hello~~!!\" &gt; /dev/comento# cat /dev/comentohello~~!!ì‚¬ìš©ì í”„ë¡œê·¸ë¨(ioctl) ì„ ì‹¤í–‰í•˜ì—¬ buffer ì´ˆê¸°í™” (clear) ì‹¤í–‰# ioctl# cat /dev/comento(ì¶œë ¥ ë‚´ìš© ì—†ìŒ)"
    } ,
  
    {
      "title"       : "Device Driver ê°œë°œ 2 (íŒŒì¼ ì½ê¸°/ ì“°ê¸°)",
      "category"    : "",
      "tags"        : "linux, device driver, device node, ssize_t()",
      "url"         : "./device_driver2.html",
      "date"        : "2024-03-01 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 12",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. íŒŒì¼ ì½ê¸°/ ì“°ê¸° êµ¬í˜„1.1 ssize_t typeë¦¬ëˆ…ìŠ¤ ë“œë¼ì´ë²„ì—ì„œ ssize_t íƒ€ì…ì€ ì¼ë°˜ì ìœ¼ë¡œ ë°ì´í„°ì˜ í¬ê¸°ë‚˜ ì–‘ì„ ë‚˜íƒ€ë‚´ëŠ” ë° ì‚¬ìš©ë˜ë©°, ë¶€í˜¸ ìˆëŠ” 64ë¹„íŠ¸(ì‹œìŠ¤í…œì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ) ì •ìˆ˜ë¥¼ ì˜ë¯¸í•œë‹¤. ssize_tëŠ” ì‹œìŠ¤í…œ í˜¸ì¶œì´ë‚˜ í•¨ìˆ˜ë“¤ì´ ì‹¤íŒ¨í•  ê²½ìš° ìŒìˆ˜ ê°’ì„ ë°˜í™˜í•  ìˆ˜ ìˆê²Œ í•˜ë©°, ì„±ê³µì ì¸ ê²½ìš°ì—ëŠ” ì–‘ì˜ ê°’ì„ ë°˜í™˜í•œë‹¤. ì´ëŠ” ì£¼ë¡œ íŒŒì¼ì´ë‚˜ ì†Œì¼“ì˜ ì½ê¸° ë° ì“°ê¸° ì—°ì‚°ì—ì„œ ë°˜í™˜ íƒ€ì…ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ëª¨ë“ˆì—ì„œ íŒŒì¼ ë˜ëŠ” ì¥ì¹˜ ë“œë¼ì´ë²„ì˜ ì½ê¸° ë° ì“°ê¸° ì—°ì‚°ì„ êµ¬í˜„í•  ë•Œ, readì™€ write ì‹œìŠ¤í…œ í˜¸ì¶œì— ëŒ€ì‘í•˜ëŠ” í•¨ìˆ˜ í¬ì¸í„°ë¥¼ file_operations êµ¬ì¡°ì²´ì— ì„¤ì •í•˜ê³  ssize_t ë¥¼ ë°˜í™˜ íƒ€ì…ìœ¼ë¡œ ì„¤ì •í•œë‹¤. ssize_t(*read)(file, buf, len, ppos) : íŒŒì¼ ì½ê¸° í•¨ìˆ˜ callback ssize_t(*write)(file, buf, len, ppos) : íŒŒì¼ ì“°ê¸° í•¨ìˆ˜ callback file (struct file *) : ì½ê¸°/ì“°ê¸° ì—°ì‚°ì„ ìˆ˜í–‰í•  íŒŒì¼ì— ëŒ€í•œ í¬ì¸í„°. struct fileì€ ì—´ë¦° íŒŒì¼ì˜ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ë©°, íŒŒì¼ì˜ í˜„ì¬ ìœ„ì¹˜(offset) ê°™ì€ ì •ë³´ë¥¼ í¬í•¨í•œë‹¤. ì´ êµ¬ì¡°ì²´ë¥¼ í†µí•´ ì»¤ë„ì€ ì–´ë–¤ íŒŒì¼ì— ëŒ€í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤. buf (char __user *) : user space ì˜ ë²„í¼ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°. ì»¤ë„ì€ ë°ì´í„°ë¥¼ ì½ì–´ user mode process ê°€ ì ‘ê·¼í•œ memory ì— ì „ë‹¬í•  ë•Œ, __user í¬ì¸í„°ê°€ ê°€ë¦¬í‚¤ëŠ” ìœ„ì¹˜ë¶€í„° ë²„í¼ ê³µê°„ì„ í™•ë³´. len (size_t) : ë²„í¼ì˜ í¬ê¸°. â€˜__userâ€™ í¬ì¸í„° ìœ„ì¹˜ë¡œë¶€í„° í•´ë‹¹ í¬ê¸°ë§Œí¼ì˜ buffer ë¥¼ user space ì— í™•ë³´í•˜ì—¬ data ì„ ì˜®ê¸° ìˆ˜ ìˆê²Œ í•œë‹¤. ppos (loff_t *) : íŒŒì¼ ë‚´ì˜ í˜„ì¬ ìœ„ì¹˜(offset)ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í¬ì¸í„°. loff_t íƒ€ì…ì€ ëŒ€ìš©ëŸ‰ íŒŒì¼ ì§€ì›ì„ ìœ„í•´ ì‚¬ìš©ë˜ë©°, íŒŒì¼ì˜ ì–´ëŠ ë¶€ë¶„ì—ì„œ ë°ì´í„°ë¥¼ ì½ì„ì§€ ê²°ì •í•œë‹¤. í•¨ìˆ˜ í˜¸ì¶œì´ ì„±ê³µí•˜ë©´, ì´ ìœ„ì¹˜ëŠ” ì½ì€ ë°”ì´íŠ¸ ìˆ˜ë§Œí¼ ì¦ê°€í•œë‹¤. ë”°ë¼ì„œ íŒŒì¼ë¡œë¶€í„° ì›í•˜ëŠ” ë¶€ë¶„ì— ëŒ€í•œ data ë¥¼ ì½ê¸° ìœ„í•´ì„œ ì´ì— ëŒ€í•œ ppos ì˜ ìˆ˜ì •/ê°±ì‹ ì´ í•„ìš”í•˜ë‹¤.ë°ì´í„°ì˜ ì´ë™ì´ kernel space ì™€ user space ê°„ ì´ë£¨ì§ìœ¼ë¡œ ì¼ë°˜ì ì¸ memcpy ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë©°, copy_from_user / copy_to_user ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ë³µì‚¬ë¥¼ ì§„í–‰í•´ì•¼ í•œë‹¤.1.2 source ì½”ë“œ ì‘ì„± ë° ë¹Œë“œê¸°ì¡´ì— ì‘ì„±í•œ Kernel Module ë§Œë“¤ê¸° 1 ì°¸ì¡° main.c íŒŒì¼ì„ ì½ê¸°/ì“°ê¸° í•¨ìˆ˜ë¥¼ ì¶”ê°€í•œë‹¤.user@DESKTOP:~/linux$ vim drivers/comento/main.c#include &lt;linux/device.h&gt;#include &lt;linux/fs.h&gt;#include &lt;linux/module.h&gt;#include &lt;linux/spinlock.h&gt;#define COMENTO_DEVICE_NAME \"comento-device\"#define COMENTO_MAJOR_NUMBER 177 #define COMENTO_BUF_SIZE 16static DEFINE_RWLOCK(comento_device_rwlock); // * rwlock ê´€ë ¨static char comento_device_buf[COMENTO_BUF_SIZE] = {0, }; // ì´ ë²„í¼ëŠ” ì»¤ë„ ëª¨ë“ˆì˜ ì¼ë¶€ë¡œì„œ, ì»¤ë„ ëª¨ë“ˆì´ ë¡œë“œë  ë•Œ ì»¤ë„ì˜ ë©”ëª¨ë¦¬ ì˜ì—­ì— í• ë‹¹ë˜ê³ , // ëª¨ë“ˆì´ ì–¸ë¡œë“œë  ë•Œ í•´ì œëœë‹¤. // char __user *buf : __user attribute (ìƒëµ ê°€ëŠ¥í•˜ì§€ë§Œ ê°€ë…ì„±/ëª…í™•ì„±ì„ ìœ„í•´ ì‚¬ìš©)static ssize_t comento_device_read(struct file *fp, char __user *buf, size_t len, loff_t *ppos) { ssize_t written_bytes = 0; read_lock(&amp;comento_device_rwlock); // * rwlock : read ìš© lock ì–»ê¸° // ë°ì´í„°ë¥¼ ì½ê±°ë‚˜ ì“¸ ë•Œ, ìš”ì²­ëœ ì‘ì—…ì´ ë””ë°”ì´ìŠ¤ ë˜ëŠ” ë²„í¼ì˜ ì‹¤ì œ í¬ê¸°ë¥¼ ë„˜ì–´ì„œì§€ ì•Šë„ë¡ ë³´ì¥ // í˜„ì¬ëŠ” *ppos 16 ì„ ë„˜ì–´ê°€ë©´ ì‹¤ì œë¡œ ì½ì§€ ëª»í•˜ëŠ” ìƒíƒœì„ (?) if(COMENTO_BUF_SIZE &lt;= len + *ppos) { len = COMENTO_BUF_SIZE - *ppos; } // ì‹¤ì œë¡œ ë³µì‚¬ëœ bytes = ì‚¬ìš©ìê°€ ìš”ì²­í•œ ë³µì‚¬ ê¸¸ì´ bytes - ì‹¤íŒ¨í•˜ê±°ë‚˜ ë³µì‚¬ë˜ì§€ ì•Šì€ bytes ìˆ˜ë¥¼ ë°˜í™˜ // copy_to_user(ëª©ì ì§€ space, ì¶œë°œì§€ pointer, ë³µì‚¬ ìš”ì²­ ê¸¸ì´ ) : ì¶œë°œì§€ pointer ì˜ ê²½ìš° ppos(offset) ê³ ë ¤í•´ì•¼ written_bytes = len - copy_to_user(buf, comento_device_buf + *ppos, len); *ppos += written_bytes; // offset ê°’ ê°±ì‹  read_unlock(&amp;comento_device_rwlock); // * rwlock : read ì™„ë£Œ í›„ unlock return written_bytes;}// const char __user *buf : ì“°ê¸°ì˜ ê²½ìš° kernel ì—ì„œ user space data ë¥¼ ì½ê¸°ë§Œ í•œë‹¤. // kernel ì´ í•´ë‹¹ ì£¼ì†Œë¥¼ ì„ì˜ë¡œ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ const ë¡œ ê³ ì •ì‹œì¼œ ì•ˆì •ì„±ì„ ë†’ì¸ë‹¤.// const ë¡œ ë¯¸ ì„ ì–¸ì‹œ error ë˜ëŠ” warning ë°œìƒstatic ssize_t comento_device_write(struct file *fp, const char __user *buf, size_t len, loff_t *ppos) { int read_bytes = 0; write_lock(&amp;comento_device_rwlock); // * rwlock : write ìš© lock ì–»ê¸° if (COMENTO_BUF_SIZE &lt;= len + *ppos) { len = COMENTO_BUF_SIZE - *ppos; } // copy_from_user(ëª©ì ì§€ space, ì¶œë°œì§€ pointer, ë³µì‚¬ ìš”ì²­ ê¸¸ì´ ) read_bytes = len - copy_from_user(comento_device_buf + *ppos, buf, len); *ppos += read_bytes; // offset ê°’ ê°±ì‹  write_unlock(&amp;comento_device_rwlock); // * rwlock : write ì™„ë£Œ í›„ unlock return read_bytes;}static int comento_device_open(struct inode *inode, struct file *file) { int minor = iminor(inode); printk(KERN_DEBUG \"%s - minor : %d/n\", __func__, minor); return 0;}struct file_operations fops= { .open = comento_device_open, // .open ìƒëµì‹œ open ë˜ì—ˆë‹¤ê³  ê°€ì •í•˜ê³  ì‹œìŠ¤í…œì—ì„œ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•ŠìŒ. .read = comento_device_read, .write = comento_device_write,};static int __init comento_module_init(void){ printk(KERN_DEBUG \"%s\\n\", __func__); int ret = register_chrdev(177, \"comento\", &amp;fops); return ret;}static void __exit comento_module_exit(void){ unregister_chrdev(177, \"comento\"); printk(KERN_DEBUG \"%s\\n\", __func__);}module_init(comento_module_init);module_exit(comento_module_exit);MODULE_AUTHOR(\"Hello&lt;hello@comento.com&gt;\");MODULE_DESCRIPTION(\"Example module\");MODULE_LICENSE(\"GPL v2\");2. íŒŒì¼ ë¹Œë“œ, ì¶”ê°€, QEMU ì‹¤í–‰íŒŒì¼ ë¹Œë“œ ë° ko íŒŒì¼ ìƒì„±user@DESKTOP:~/linux$ ARCH=arm64 CROSS_COMPILE=/home/gon/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu- make CALL scripts/checksyscalls.sh CC [M] drivers/comento/main.o LD [M] drivers/comento/comento.o MODPOST Module.symvers LD [M] drivers/comento/comento.koko íŒŒì¼ rootfs ì´ë¯¸ì§€ì— ë³µì‚¬user@DESKTOP:~/linux$ sudo mount -o loop ../buildroot/output/images/rootfs.ext4 /mntuser@DESKTOP:~/linux$ sudo cp drivers/comento/comento.ko /mnt/usr/lib/modules/.user@DESKTOP:~/linux$ syncuser@DESKTOP:~/linux$ sudo umount /mntQEMU ì‹¤í–‰user@DESKTOP:~/linux$ cd ..user@DESKTOP:~$ qemu-system-aarch64 -kernel linux/arch/arm64/boot/Image -drive format=raw,file=buildroot/output/images/rootfs.ext4,if=virtio -append \"root=/dev/vda console=ttyAMA0 nokaslr\" -nographic -M virt -cpu cortex-a72 -m 2G -smp 23. íŒŒì¼ ì½ê¸°, ì“°ê¸° ì‚¬ìš©ë“œë¼ì´ë²„ ëª¨ë“ˆ ì‚½ì… ë° í™•ì¸# insmod /usr/lib/modules/comento.ko# dmesg...comento_module_init# cd /dev# ls -lah comentocrw-r--r-- 1 root root 177, 34 Mar 1 05:50 comentodev ë””ë ‰í† ë¦¬ ë‚´ ë””ë°”ì´ìŠ¤ ë…¸ë“œ ìƒì„±# mknod /dev/comento c 177 34ê°’ ë„£ì–´ë³´ê¸°# echo \"wow\" &gt; /dev/comento# cat /dev/comentowowì¶”ê°€ëœ comento ë””ë°”ì´ìŠ¤ ë…¸ë“œì— â€œwowâ€ ë¬¸ìì—´ì„ redirection í•˜ê³ , í•´ë‹¹ ë””ë°”ì´ìŠ¤ ë…¸ë“œ ë‚´ìš©ì„ ì¶œë ¥í•˜ë©´ redirect ëœ ê°’ì´ ê·¸ëŒ€ë¡œ ì¶œë ¥ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.ì´ëŠ” ì•ì—ì„œ êµ¬í˜„í•œ ì†ŒìŠ¤ì½”ë“œ ì¤‘ comento_device_write í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì–´, user space ì—ì„œ ì‘ì„±í•œ ë¬¸ìì—´ì´ copy_from_user ë¥¼ ì‚¬ìš©í•˜ì—¬ kernel space memory (comento_device_buf)ì— ì“°ê¸°ê°€ ë˜ì—ˆìŒì„ ì˜ë¯¸í•œë‹¤.cat ëª…ë ¹ì„ ì‚¬ìš©í•˜ë©´, í•´ë‹¹ ë””ë°”ì´ìŠ¤ ë…¸ë“œì˜ ë²„í¼ ê³µê°„ ë‚´ìš©ì„ ì½ì–´ ì˜¨ë‹¤. ì¦‰ ì•ì—ì„œ êµ¬í˜„í•œ comento_device_read í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì—¬ copy_to_user ë¡œ comento_device_buf ì— ì €ì¥ëœ ë¬¸ìì—´ì„ í‘œì¤€ ì¶œë ¥ìœ¼ë¡œ ì œê³µí•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.4. strace ë¥¼ ì‚¬ìš©í•œ ì½ê¸° ê³¼ì • ê´€ì°°strace ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì»¤ë„ì„ ë¹ ì ¸ ë‚˜ì˜¨ ì´í›„, ì„ì˜ íŒŒì¼ì„ ìƒì„±í•˜ê³  ì´ë¥¼ strace ë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ ê³¼ì •ì„ ì¢€ë” ë¡œê·¸ë¡œ ì¶œë ¥í–ˆì„ë•Œ, ê·¸ ì¼ë¶€ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ë‹¤.user@DESKTOP:~$ touch emptyuser@DESKTOP:~$ strace cat empty...openat(AT_FDCWD, \"empty\", O_RDONLY) = 3newfstatat(3, \"\", {st_mode=S_IFREG|0644, st_size=0, ...}, AT_EMPTY_PATH) = 0fadvise64(3, 0, 0, POSIX_FADV_SEQUENTIAL) = 0mmap(NULL, 139264, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f854e8ec000read(3, \"\", 131072) = 0munmap(0x7f854e8ec000, 139264) = 0close(3) = 0close(1) = 0close(2) = 0exit_group(0) = ?+++ exited with 0 +++openat(AT_FDCWD, â€œemptyâ€, O_RDONLY) = 3 openat: íŒŒì¼ì´ë‚˜ ë””ë ‰í† ë¦¬ë¥¼ ì—´ê¸° ìœ„í•œ ì‹œìŠ¤í…œ í˜¸ì¶œ. AT_FDCWD: í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬ (at file descriptor current working directory) â€œemptyâ€: ì—´ê³ ì í•˜ëŠ” íŒŒì¼ì˜ ì´ë¦„ O_RDONLY: ì½ê¸° ì „ìš© ëª¨ë“œë¡œ ì—´ë¼ëŠ” ì˜µì…˜ 3: openat ì‹œìŠ¤í…œ í˜¸ì¶œì˜ ë°˜í™˜ ê°’. ë¦¬ëˆ…ìŠ¤ì™€ ìœ ë‹‰ìŠ¤ ì‹œìŠ¤í…œì—ì„œ íŒŒì¼ì€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¥¼ í†µí•´ ê´€ë¦¬ë˜ë©°, ì´ ê°’ì€ ì„±ê³µì ìœ¼ë¡œ íŒŒì¼ì„ ì—´ì—ˆì„ ë•Œ ì‹œìŠ¤í…œì´ í• ë‹¹í•œ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ì—¬ê¸°ì„œ 3ì€ ì—´ë¦° íŒŒì¼ì„ ë‚˜íƒ€ë‚´ëŠ” íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ë²ˆí˜¸ì´ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ 0, 1, 2ëŠ” ê°ê° í‘œì¤€ ì…ë ¥, í‘œì¤€ ì¶œë ¥, í‘œì¤€ ì—ëŸ¬ë¥¼ ìœ„í•´ ì˜ˆì•½ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ì‚¬ìš©ìê°€ ì—´ ìˆ˜ ìˆëŠ” ì²« ë²ˆì§¸ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ëŠ” 3ë¶€í„° ì‹œì‘í•œë‹¤.read(3, â€œâ€, 131072) = 0 ì•ì—ì„œ êµ¬í˜„í•œ íŒŒì¼ ì½ê¸°ì™€ ë™ì¼í•œ callback ì´ ë°œìƒí•¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° 3 ì— ëŒ€í•´ ê°’ â€œâ€ ì„ 131072 buffer size ë¥¼ ê°€ì§€ê³  read í•¨ìˆ˜ê°€ callback ëœë‹¤."
    } ,
  
    {
      "title"       : "Device Driver ê°œë°œ 1",
      "category"    : "",
      "tags"        : "linux, device driver, device node",
      "url"         : "./device_driver1.html",
      "date"        : "2024-02-29 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 11",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ì¢…ë¥˜ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ëŠ” í”Œë«í¼ ë³„ (ìœˆë„ìš° ë“œë¼ì´ë²„, ë¦¬ëˆ…ìŠ¤ ë“œë¼ì´ë²„, ë§¥ OS ë“œë¼ì´ë²„) ë“± ë˜ëŠ” OS ìˆ˜ì¤€ ë³„(ì»¤ë„ ëª¨ë“œ ë“œë¼ì´ë²„, ì‚¬ìš©ì ëª¨ë“œ ë“œë¼ì´ë²„) ë¡œ êµ¬ë¶„ë˜ê¸°ë„ í•˜ë©°, ì•„ë˜ì™€ ê°™ì´ í•˜ë“œì›¨ì–´ì˜ ìœ í˜•ê³¼ ê¸°ëŠ¥ì— ë”°ë¼ ì¥ì¹˜ë³„ ë“œë¼ì´ë²„ë¡œ êµ¬ë¶„ë˜ê¸°ë„ í•œë‹¤. ë¸”ë¡ ì¥ì¹˜ ë“œë¼ì´ë²„ë°ì´í„°ë¥¼ ë¸”ë¡ì´ë¼ëŠ” ê³ ì •ëœ í¬ê¸°ì˜ ë‹¨ìœ„ë¡œ ì €ì¥í•˜ê³  ê²€ìƒ‰í•˜ëŠ” ì €ì¥ ì¥ì¹˜ë¥¼ ê´€ë¦¬. ì´ëŸ¬í•œ ì¥ì¹˜ì—ëŠ” í•˜ë“œ ë””ìŠ¤í¬ ë“œë¼ì´ë¸Œ(HDD), ì†”ë¦¬ë“œ ìŠ¤í…Œì´íŠ¸ ë“œë¼ì´ë¸Œ(SSD), USB í”Œë˜ì‹œ ë“œë¼ì´ë¸Œ ë“±ì´ í¬í•¨ë˜ë©°. ë¸”ë¡ ì¥ì¹˜ ë“œë¼ì´ë²„ëŠ” íŒŒì¼ ì‹œìŠ¤í…œì„ ì§€ì›í•˜ì—¬, ì‚¬ìš©ìì™€ ì‹œìŠ¤í…œì´ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê²Œ í•œë‹¤. (ex. ë¸”ë¡ ì¥ì¹˜ ë“œë¼ì´ë²„ëŠ” ìš´ì˜ ì²´ì œê°€ ë””ìŠ¤í¬ì˜ íŠ¹ì • ë¸”ë¡ì„ ì½ê±°ë‚˜ ì“¸ ìˆ˜ ìˆë„ë¡ í•˜ë©°, ë””ìŠ¤í¬ ìƒì˜ ë°ì´í„°ì˜ ë¬¼ë¦¬ì  ìœ„ì¹˜ë¥¼ ì¶”ìƒí™”.) ë¬¸ì ì¥ì¹˜ ë“œë¼ì´ë²„ë°ì´í„°ë¥¼ ë¬¸ì ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•˜ëŠ” ì¥ì¹˜, ì¦‰ í•œ ë²ˆì— í•˜ë‚˜ì˜ ë¬¸ì(ë˜ëŠ” ë°”ì´íŠ¸)ë¥¼ ì „ì†¡í•˜ëŠ” ì¥ì¹˜ë¥¼ ê´€ë¦¬í•œë‹¤. ì´ì—ëŠ” í‚¤ë³´ë“œ, ë§ˆìš°ìŠ¤, ì‹œë¦¬ì–¼ í¬íŠ¸, í”„ë¦°í„° ë“±ì´ í¬í•¨ëœë‹¤. ë¬¸ì ì¥ì¹˜ ë“œë¼ì´ë²„ëŠ” ì‚¬ìš©ì ì…ë ¥ì„ ì²˜ë¦¬í•˜ê±°ë‚˜ ë¬¸ì ê¸°ë°˜ì˜ ë°ì´í„°ë¥¼ ì¥ì¹˜ë¡œ ì „ì†¡í•˜ëŠ” ì—­í• ì„ í•œë‹¤. (ex. í‚¤ë³´ë“œ ë“œë¼ì´ë²„ëŠ” ì‚¬ìš©ìê°€ ëˆ„ë¥¸ í‚¤ì˜ ì‹ í˜¸ë¥¼ ë°›ì•„ ìš´ì˜ ì²´ì œê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ì…ë ¥ ë°ì´í„°ë¡œ ë³€í™˜.) ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì¹´ë“œ(NIC)ë‚˜ ê¸°íƒ€ ë„¤íŠ¸ì›Œí‚¹ í•˜ë“œì›¨ì–´ ì¥ì¹˜ë¥¼ ê´€ë¦¬í•œë‹¤. ì´ ë“œë¼ì´ë²„ëŠ” ë°ì´í„° íŒ¨í‚·ì„ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì†¡ìˆ˜ì‹ í•˜ëŠ” ë° í•„ìš”í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ëŠ” ë„¤íŠ¸ì›Œí¬ í”„ë¡œí† ì½œ(ì˜ˆ: TCP/IP)ê³¼ ìƒí˜¸ ì‘ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì˜¬ë°”ë¥´ê²Œ í¬ë§·í•˜ê³ , ì£¼ì†Œë¥¼ ì§€ì •í•˜ë©°, ì—ëŸ¬ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œë‹¤. ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ëŠ” ë°ì´í„°ì˜ ì•ˆì •ì ì¸ ì „ì†¡ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ ì¤‘ìš”í•œ ì—­í• ì„ í•œë‹¤. ë²„ìŠ¤ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì»´í“¨í„° ë‚´ì˜ ë‹¤ì–‘í•œ í•˜ë“œì›¨ì–´ ì¥ì¹˜ë¥¼ ì—°ê²°í•˜ëŠ” í†µì‹  ê²½ë¡œì¸ ë²„ìŠ¤ë¥¼ ê´€ë¦¬í•œë‹¤. ëŒ€í‘œì ì¸ ì˜ˆë¡œëŠ” PCI(Peripheral Component Interconnect), USB(Universal Serial Bus), SATA(Serial ATA) ë“±ì´ ìˆìŠµë‹ˆë‹¤. ë²„ìŠ¤ ë“œë¼ì´ë²„ëŠ” í•˜ë“œì›¨ì–´ ì¥ì¹˜ ê°„ì˜ ë°ì´í„° ì „ì†¡ì„ ì¡°ì •í•˜ê³ , ì¥ì¹˜ ê°„ì˜ í˜¸í™˜ì„±ì„ ë³´ì¥í•œë‹¤. (ex. USB ë²„ìŠ¤ ë“œë¼ì´ë²„ëŠ” USB ì¥ì¹˜ê°€ ì»´í“¨í„°ì— ì—°ê²°ë  ë•Œ í•„ìš”í•œ ì „ë ¥ ê´€ë¦¬, ë°ì´í„° ì „ì†¡ ì†ë„ ì¡°ì •, ì—°ê²°ëœ ì¥ì¹˜ì˜ ì‹ë³„ ë° êµ¬ì„±ì„ ë‹´ë‹¹.) 2. ë””ë°”ì´ìŠ¤ ë…¸ë“œë””ë°”ì´ìŠ¤ ë…¸ë“œ(Device Node)ëŠ” ìœ ë‹‰ìŠ¤ ë° ìœ ë‹‰ìŠ¤ ê³„ì—´ ìš´ì˜ ì²´ì œì—ì„œ í•˜ë“œì›¨ì–´ ì¥ì¹˜ë¥¼ íŒŒì¼ ì‹œìŠ¤í…œ ë‚´ì˜ íŒŒì¼ë¡œ í‘œí˜„í•˜ëŠ” ë°©ë²•. ìœ ë‹‰ìŠ¤ ê³„ì—´ ì‹œìŠ¤í…œì€ â€˜ëª¨ë“  ê²ƒì€ íŒŒì¼â€™ì´ë¼ëŠ” ì² í•™ì„ ë”°ë¥´ëŠ”ë°, ì´ëŠ” í•˜ë“œì›¨ì–´ ì¥ì¹˜ë¥¼ í¬í•¨í•œ ëª¨ë“  ìì›ì„ íŒŒì¼ì²˜ëŸ¼ ì·¨ê¸‰í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. ë””ë°”ì´ìŠ¤ ë…¸ë“œë¥¼ í†µí•´, ì‚¬ìš©ìì™€ ì‘ìš© í”„ë¡œê·¸ë¨ì€ í‘œì¤€ íŒŒì¼ ì…ì¶œë ¥(IO) ì‹œìŠ¤í…œ í˜¸ì¶œì„ ì‚¬ìš©í•˜ì—¬ í•˜ë“œì›¨ì–´ ì¥ì¹˜ì™€ í†µì‹ í•  ìˆ˜ ìˆë‹¤.ë””ë°”ì´ìŠ¤ ë…¸ë“œì˜ ì¢…ë¥˜ (íƒ€ì…) ë¬¸ì ë””ë°”ì´ìŠ¤(Character Device) : c ë¸”ë¡ ë””ë°”ì´ìŠ¤(Block Device) : b (ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ì™€ ë²„ìŠ¤ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ëŠ” ë…¸ì¶œë˜ì§€ ì•Šê³  ë³„ë„ë¡œ ê´€ë¦¬ë¨.) ë””ë°”ì´ìŠ¤ ë…¸ë“œì˜ íŠ¹ì§• ë° ì‚¬ìš© ë°©ë²• mknod &lt;íŒŒì¼ì´ë¦„&gt; &lt;íƒ€ì…&gt; &lt;ì£¼ë²ˆí˜¸&gt; &lt;ë¶€ë²ˆí˜¸&gt; : ë””ë°”ì´ìŠ¤ ë…¸ë“œ íŒŒì¼ ìƒì„± íŒŒì¼ ì‹œìŠ¤í…œ ë‚´ ìœ„ì¹˜ ë””ë°”ì´ìŠ¤ ë…¸ë“œëŠ” ì£¼ë¡œ /dev ë””ë ‰í† ë¦¬ì— ìœ„ì¹˜í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, /dev/sdaëŠ” ì²« ë²ˆì§¸ SATA í•˜ë“œ ë“œë¼ì´ë¸Œë¥¼, /dev/ttyëŠ” í˜„ì¬ í„°ë¯¸ë„ì„ ë‚˜íƒ€ë‚¸ë‹¤. íŠ¹ìˆ˜ íŒŒì¼ ë””ë°”ì´ìŠ¤ ë…¸ë“œëŠ” íŠ¹ìˆ˜ íŒŒì¼ë¡œ ë¶„ë¥˜ëœë‹¤. ì¼ë°˜ íŒŒì¼ê³¼ ë‹¬ë¦¬, ì‹¤ì œ ë°ì´í„°ë¥¼ ë””ìŠ¤í¬ì— ì €ì¥í•˜ëŠ” ëŒ€ì‹ , ì»¤ë„ì˜ í•˜ë“œì›¨ì–´ ì¥ì¹˜ ë“œë¼ì´ë²„ì™€ í†µì‹ í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ ì—­í• ì„ í•œë‹¤. MAJOR/MINOR ë²ˆí˜¸ ê° ë””ë°”ì´ìŠ¤ ë…¸ë“œëŠ” MAJOR ë²ˆí˜¸ì™€ MINOR ë²ˆí˜¸ë¥¼ ê°€ì§„ë‹¤. MAJOR ë²ˆí˜¸(0 ~ 511)ëŠ” ì¥ì¹˜ ìœ í˜•(ì˜ˆ: í•˜ë“œ ë””ìŠ¤í¬, ì‹œë¦¬ì–¼ í¬íŠ¸)ì„ ì‹ë³„í•œë‹¤. ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ë§ˆë‹¤ ê³ ìœ í•˜ë©° ì»¤ë„ì´ ìë™ìœ¼ë¡œ í• ë‹¹í•˜ê¸°ë„ í•œë‹¤. MINOR ë²ˆí˜¸(0 ~ 1048576)ëŠ” í•´ë‹¹ ìœ í˜• ë‚´ì˜ ê°œë³„ ì¥ì¹˜ë¥¼ êµ¬ë¶„í•œë‹¤. ì¦‰ ë””ë°”ì´ìŠ¤ë§ˆë‹¤ ê³ ìœ í•˜ë©° ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ê°€ í• ë‹¹ì„ ê´€ë¦¬í•œë‹¤. ex. USB ë§ˆìš°ìŠ¤ë¥¼ ì—¬ëŸ¬ê°œ ê½‚ì•˜ì„ ê²½ìš° - ë””ë°”ì´ìŠ¤(minor ë²ˆí˜¸)ëŠ” ì—¬ëŸ¬ê°œ, ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„(major ë²ˆí˜¸) ëŠ” í•˜ë‚˜ ì‚¬ìš©ìì™€ ê·¸ë£¹ ê¶Œí•œ ë””ë°”ì´ìŠ¤ ë…¸ë“œëŠ” íŒŒì¼ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì‚¬ìš©ìì™€ ê·¸ë£¹ ê¶Œí•œì„ ê°€ì§„ë‹¤. ì´ë¥¼ í†µí•´ íŠ¹ì • ì‚¬ìš©ì ë˜ëŠ” ê·¸ë£¹ë§Œì´ ì¥ì¹˜ì— ì ‘ê·¼í•˜ê±°ë‚˜ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ì œì–´í•  ìˆ˜ ìˆë‹¤. 3. ë¬¸ì ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ë“±ë¡ ì‹¤ìŠµ3.1 ë¬¸ì ë””ë°”ì´ìŠ¤ ë“œëŸ¬ì´ë²„ êµ¬í˜„ ì‹œìŠ¤í…œì½œ íŒŒì¼ ìƒì„±(ì´ì „ post ì—ì„œ êµ¬í˜„í•œ linux/drivers/coment/main.c íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì§„í–‰)user@DESKTOP:~/linux/drivers/comento$ vim main.c#include &lt;linux/module.h&gt;// (1)static int comento_device_open(struct inode *inode, struct file *file) { int minor = iminor(inode); printk(KERN_DEBUG \"%s - minor : %d/n\", __func__, minor); return 0;} // (2)struct file_operations fops= { .open = comento_device_open,};static int __init comento_module_init(void) { printk(KERN_DEBUG \"%s\\n\", __func__); int ret = register_chrdev(177, \"comento\", &amp;fops); // (3) return ret;}static void __exit comento_module_exit(void) { unregister_chrdev(177, \"comento\"); printk(KERN_DEBUG \"%s\\n\", __func__);}module_init(comento_module_init);module_exit(comento_module_exit);MODULE_AUTHOR(\"Hello&lt;hello@comento.com&gt;\");MODULE_DESCRIPTION(\"Example module\");MODULE_LICENSE(\"GPL v2\");(1) static int comento_device_open(struct inode *inode, struct file *file) {} ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ë‚´ì—ì„œ ë””ë°”ì´ìŠ¤ íŒŒì¼ì„ ì—´ë ¤ê³  í•  ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜. ì´ í•¨ìˆ˜ëŠ” file_operations êµ¬ì¡°ì²´ ë‚´ì—ì„œ .open í¬ì¸í„°ì— ì˜í•´ ì°¸ì¡°ë˜ë©°, ì‚¬ìš©ì ê³µê°„ì—ì„œ ë””ë°”ì´ìŠ¤ íŒŒì¼(ì˜ˆ: /dev/comento)ì— ëŒ€í•œ open ì‹œìŠ¤í…œ ì½œì´ ë°œìƒí•  ë•Œ ì‹¤í–‰ëœë‹¤.í•´ë‹¹ í•¨ìˆ˜ëŠ” ë””ë°”ì´ìŠ¤ íŒŒì¼ì´ ì—´ë¦´ ë•Œ í•„ìš”í•œ ì´ˆê¸°í™”ë‚˜ ìƒíƒœ í™•ì¸ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„ì•  ì •ì˜ ëœë‹¤. struct file_operations ì˜ ì£¼ìš” í•„ë“œ callback í•¨ìˆ˜ì— ëŒ€í•œ ì •ì˜ë¥¼ ì‚´í´ë³´ë©´ struct file_operations { struct module *owner; loff_t (*llseek) (struct file *, loff_t, int); ssize_t (*read) (struct file *, char __user *, size_t, loff_t *); ssize_t (*write) (struct file *, const char __user *, size_t, loff_t *); int (*open) (struct inode *, struct file *); int (*release) (struct inode *, struct file *); // ë‹¤ë¥¸ í•„ë“œë“¤... };ì´ì™€ ê°™ì´ open í•„ë“œì˜ ê²½ìš°, inode í¬ì¸í„°ì™€ file í¬ì¸í„°ë¥¼ ì¸ìë¡œ ì·¨í•˜ëŠ” í•¨ìˆ˜ì´ì—¬ì•¼ í•œë‹¤. inode inodeëŠ” ìœ ë‹‰ìŠ¤ ë° ìœ ë‹‰ìŠ¤ ê³„ì—´ ì‹œìŠ¤í…œì—ì„œ íŒŒì¼ ì‹œìŠ¤í…œì˜ íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ì— ëŒ€í•œ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë°ì´í„° êµ¬ì¡° (êµ¬ì¡°ì²´ íƒ€ì…) ê° íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ëŠ” ê³ ìœ í•œ inodeë¥¼ ê°€ì§€ë©°, ì´ inodeì—ëŠ” íŒŒì¼ì˜ ì†Œìœ ì, íŒŒì¼ ëª¨ë“œ(ê¶Œí•œ), íŒŒì¼ í¬ê¸°, íŒŒì¼ì´ ì €ì¥ëœ ë””ìŠ¤í¬ ìƒì˜ ìœ„ì¹˜, ìƒì„± ë° ìˆ˜ì • ë‚ ì§œ ë“±ì˜ ì •ë³´ê°€ í¬í•¨ëœë‹¤. ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì˜ ì»¨í…ìŠ¤íŠ¸ì—ì„œ inode êµ¬ì¡°ì²´ëŠ” ë””ë°”ì´ìŠ¤ íŒŒì¼ì˜ ë©”íƒ€ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤. íŠ¹íˆ, ë””ë°”ì´ìŠ¤ íŒŒì¼ì„ ë‚˜íƒ€ë‚´ëŠ” inodeì—ì„œ Major ë²ˆí˜¸ì™€ Minor ë²ˆí˜¸ë¥¼ ì¶”ì¶œí•˜ì—¬, í•´ë‹¹ ë””ë°”ì´ìŠ¤ íŒŒì¼ì´ ì–´ë–¤ ë””ë°”ì´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ ì‹ë³„í•  ìˆ˜ ìˆë‹¤.(2) file_operations ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ë‚´ì—ì„œ íŒŒì¼ ì‘ì—…ì„ ìœ„í•œ callback í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ êµ¬ì¡°ì²´. ì»¤ë„ ëª¨ë“ˆì´ë‚˜ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ê°€ íŒŒì¼ ì‹œìŠ¤í…œì˜ íŒŒì¼ì´ë‚˜ ë””ë°”ì´ìŠ¤ íŒŒì¼ì— ëŒ€í•œ ë‹¤ì–‘í•œ ì‘ì—…(ì˜ˆ: ì—´ê¸°, ì½ê¸°, ì“°ê¸° ë“±)ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤. ê° í•„ë“œëŠ” íŠ¹ì • íŒŒì¼ ì‘ì—…ì„ ìœ„í•œ í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ê°€ë¦¬í‚¤ë©°, í•´ë‹¹ ì‘ì—…ì´ í˜¸ì¶œë  ë•Œ ì‹¤í–‰ë  í•¨ìˆ˜ë¥¼ ì§€ì •í•œë‹¤. .open : íŒŒì¼ì´ë‚˜ ë””ë°”ì´ìŠ¤ë¥¼ ì—´ ë•Œ í˜¸ì¶œë¨ .read : íŒŒì¼ì´ë‚˜ ë””ë°”ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ì½ì„ ë•Œ í˜¸ì¶œë¨ .write : íŒŒì¼ì´ë‚˜ ë””ë°”ì´ìŠ¤ì— ë°ì´í„°ë¥¼ ì“¸ ë•Œ í˜¸ì¶œë¨ .release: íŒŒì¼ì´ë‚˜ ë””ë°”ì´ìŠ¤ê°€ ë‹«í ë•Œ í˜¸ì¶œë¨ (ì¢…ì¢… close ì‘ì—…ìœ¼ë¡œ ì°¸ì¡°ë¨). .llseek : íŒŒì¼ ë‚´ì—ì„œ ì½ê¸°/ì“°ê¸° ìœ„ì¹˜ë¥¼ ë³€ê²½í•  ë•Œ í˜¸ì¶œë¨ .ioctl : ì¥ì¹˜ì— íŠ¹ì • ëª…ë ¹ì„ ë³´ë‚¼ ë•Œ ì‚¬ìš©ë¨ (ì¥ì¹˜ ì œì–´).(3) register_chrdev(major, name, fops) ìƒˆë¡œìš´ ë¬¸ì ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ë“±ë¡ì— ì‚¬ìš©ë˜ëŠ” API major : ì£¼ë²ˆí˜¸ë¡œ ì‚¬ìš©í•  ë²ˆí˜¸ë¥¼ ì§€ì •, (0ìœ¼ë¡œ ì§€ì •ì‹œ ì»¤ë„ì´ ìë™ í• ë‹¹) name : ë””ë°”ì´ìŠ¤ì˜ ì´ë¦„ fops : ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ê°€ êµ¬í˜„í•  file_operations ë“±ë¡ì´ ì„±ê³µí–ˆë‹¤ë©´ 0 ë˜ëŠ” í• ë‹¹ë°›ì€ major ë²ˆí˜¸ë¥¼ ë°˜í™˜, ì‹¤íŒ¨ì‹œ ìŒìˆ˜ ë°˜í™˜ì´ì œ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•œ ì†ŒìŠ¤ íŒŒì¼ì„ ë¹Œë“œí•˜ì—¬ ko dynamic linker íŒŒì¼ ìƒì„±í•œë‹¤.user@DESKTOP:~/linux$ ARCH=arm64 CROSS_COMPILE=/home/gon/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu- make CALL scripts/checksyscalls.sh CC [M] drivers/comento/main.o LD [M] drivers/comento/comento.o MODPOST Module.symvers LD [M] drivers/comento/comento.korootfs ì— ë§ˆìš´íŠ¸ í•´ë‹¹ íŒŒì¼ì„ ë§ˆìš°íŠ¸ ì´ë¯¸ì§€ì— ì‚½ì…user@DESKTOP:~/linux/$ sudo mount -o loop ../buildroot/output/images/rootfs.ext4 /mntuser@DESKTOP:~/linux/$ sudo cp drivers/comento/comento.ko /mnt/usr/lib/modules/.user@DESKTOP:~/linux/$ syncuser@DESKTOP:~/linux/$ sudo umount /mntQEMU ë¡œ ì»¤ë„ ì‹¤í–‰user@DESKTOP:~/linux/$ cd ..user@DESKTOP:~$ qemu-system-aarch64 -kernel linux/arch/arm64/boot/Image -drive format=raw,file=buildroot/output/images/rootfs.ext4,if=virtio -append \"root=/dev/vda console=ttyAMA0 nokaslr\" -nographic -M virt -cpu cortex-a72 -m 2G -smp 23.2 ë””ë°”ì´ìŠ¤ ë…¸ë“œ ë§Œë“¤ê¸°mknod ëª…ë ¹ì–´ë¡œ ë””ë°”ì´ìŠ¤ ë…¸ë“œë¥¼ ìƒì„±í•œë‹¤. ìˆœì„œëŒ€ë¡œ c (ë¬¸ì ë””ë°”ì´ìŠ¤), 177 (ê¸°ì¡´ì— ì§€ì •í•œ major ë²ˆí˜¸) 32 (ì„ì˜ì˜ minor ë²ˆí˜¸) ë¥¼ ì…ë ¥í•œë‹¤.# cd /dev/# mknod /dev/comento c 177 43# cat /dev/comentocat: can't open '/dev/comento': No such device or addressëª…ë ¹ì–´ ìˆ˜í–‰ ê²°ê³¼ë¥¼ í™•ì¸í–ˆì„ ë•Œ, ì•„ì§ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ê°€ ë¡œë“œë˜ì§€ ì•Šì•„ ì°¾ì§€ ëª»í•œë‹¤ê³  ë‚˜ì˜¨ë‹¤. ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´ í•´ë‹¹ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ë¥¼ ë“±ë¡ ì‹œí‚¤ê³  ë‹¤ì‹œ í™•ì¸í•´ë³´ë©´,3.3 ëª¨ë“ˆ ë¡œë“œ# insmod /usr/lib/modules/comento.ko# cat /dev/comentocat: read error: Invalid argumentí•´ë‹¹ ê²°ê³¼ì™€ ê°™ì´, ë“œë¼ì´ë²„ ë…¸ë“œëŠ” ì°¾ì€ ê²ƒ ê°™ë‹¤. ë‹¤ë§Œ read ëŒ€í•œ êµ¬í˜„ì´ ì—†ê¸° ë•Œë¬¸ì— í•´ë‹¹ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ë‹¤.# dmesg...comento_module_init# ls -lah comentocrw-r--r-- 1 root root 177, 43 Feb 29 07:20 comentodmesg ë¡œ init ë˜ì—ˆìŒì´ í™•ì¸ ë˜ì—ˆìœ¼ë©°, (ê·¸ëŸ°ë° comento_device_open í•¨ìˆ˜ ì‹¤í–‰ ë©”ì„¸ì§€ëŠ” ì•ˆë‚˜ì™”ë„¤ ;;) ls ëª…ë ¹ì–´ë¥¼ í†µí•´ comento íŒŒì¼ì´ ìƒì„± ë° major, minor ë²ˆí˜¸ê°€ ì •ìƒì ìœ¼ë¡œ ë¶€ì—¬ë˜ì—ˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤.ìœ„ ê³¼ì •ì—ì„œ ëª¨ë“ˆë¡œë“œê°€ ì •ìƒì ìœ¼ë¡œ ë˜ì–´ì•¼ ë“œë¼ì´ë²„ ë…¸ë“œê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•¨ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•´ mknod ë¡œ ë””ë°”ì´ìŠ¤ ë…¸ë“œë¥¼ ìƒì„±í•œ ì´í›„ ëª¨ë“ˆì„ ë¡œë“œ í–ˆì§€ë§Œ, ë…¼ë¦¬ì ìœ¼ë¡œ ì ˆì°¨ë¥¼ ìƒê°í•˜ë©´, ìš°ì„  ë””ë°”ì´ìŠ¤ ë…¸ë“œì˜ binary ê°’ì„ ë§¤ëª¨ë¦¬ì— ë¡œë“œí•˜ëŠ” ê²ƒì´ ìš°ì„ ìœ¼ë¡œ ì‹œí–‰ë˜ëŠ” ê²ƒì´ ë§ë‹¤. í•´ë‹¹ insmod ëª…ë ¹ì–´ ìˆ˜í–‰ì‹œ ì–´ë–¤ ì‘ì—…ì´ ìˆ˜í–‰ë˜ëŠ”ì§€ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤. ë©”ëª¨ë¦¬ ë¡œë“œinsmod ëª…ë ¹ì–´ëŠ” ë””ìŠ¤í¬ ìƒì˜ ì»¤ë„ ëª¨ë“ˆ(.ko íŒŒì¼)ì„ ì°¾ì•„ ë©”ëª¨ë¦¬ë¡œ ë¡œë“œ. ì´ íŒŒì¼ì—ëŠ” ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì˜ ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œê°€ í¬í•¨ë˜ì–´ ìˆë‹¤. ì´ˆê¸°í™” ë° ë“±ë¡ë“œë¼ì´ë²„ ëª¨ë“ˆì´ ë©”ëª¨ë¦¬ë¡œ ë¡œë“œë˜ë©´, ê·¸ ì•ˆì— ì •ì˜ëœ ì´ˆê¸°í™” í•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤. ì´ ì´ˆê¸°í™” ê³¼ì •ì—ì„œ ë“œë¼ì´ë²„ëŠ” ìì‹ ì´ ê´€ë¦¬í•  í•˜ë“œì›¨ì–´ ë””ë°”ì´ìŠ¤ë¥¼ ì„¤ì •í•˜ê³ , ì»¤ë„ì— í•„ìš”í•œ ì •ë³´(ì˜ˆ: ë“œë¼ì´ë²„ê°€ ì§€ì›í•˜ëŠ” ì—°ì‚°, ë©”ì´ì € ë²ˆí˜¸ ë“±)ë¥¼ ë“±ë¡í•œë‹¤. ì´ë¡œì¨ ì‹œìŠ¤í…œì€ í•´ë‹¹ ë“œë¼ì´ë²„ê°€ ì¡´ì¬í•˜ê³  ì‚¬ìš© ê°€ëŠ¥í•¨ì„ ì•Œê²Œ ëœë‹¤. ì‹œìŠ¤í…œê³¼ì˜ í†µí•©ë“œë¼ì´ë²„ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ê³  ì´ˆê¸°í™”ë˜ë©´, ì‹œìŠ¤í…œì˜ ë‹¤ë¥¸ ë¶€ë¶„ë“¤ì€ í•´ë‹¹ ë“œë¼ì´ë²„ë¥¼ í†µí•´ ì—°ê²°ëœ í•˜ë“œì›¨ì–´ ë””ë°”ì´ìŠ¤ì™€ í†µì‹ í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ì ê³µê°„ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ í‘œì¤€ íŒŒì¼ ì…ì¶œë ¥ ì—°ì‚°ì„ ì‚¬ìš©í•˜ì—¬ ë””ë°”ì´ìŠ¤ íŒŒì¼(/devì— ìœ„ì¹˜)ì„ í†µí•´ ë“œë¼ì´ë²„ì™€ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆë‹¤. ì´í›„ mknod ëª…ë ¹ì–´ ìš”ì²­ì‹œ ë¡œë“œëœ ëª¨ë“ˆì„ ê°€ì§€ê³  ì–´ë–¤ ì‘ì—…ë“¤ì´ ì§„í–‰ë˜ëŠ” ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤. íŒŒì¼ ìœ í˜• ë° ë©”ì´ì €/ë§ˆì´ë„ˆ ë²ˆí˜¸ ì§€ì •ì‚¬ìš©ìëŠ” mknod ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ë•Œ íŒŒì¼ì˜ ê²½ë¡œ, ìœ í˜•(ë¬¸ì ë””ë°”ì´ìŠ¤ ë˜ëŠ” ë¸”ë¡ ë””ë°”ì´ìŠ¤), ë©”ì´ì € ë²ˆí˜¸, ê·¸ë¦¬ê³  ë§ˆì´ë„ˆ ë²ˆí˜¸ë¥¼ ì§€ì •. ì´ ì •ë³´ëŠ” ìƒì„±ë  ë””ë°”ì´ìŠ¤ íŒŒì¼ì˜ íŠ¹ì„±ì„ ê²°ì •í•œë‹¤.(ì˜ˆ: mknod /dev/example c 240 0ì€ /dev ë””ë ‰í† ë¦¬ì— exampleì´ë¼ëŠ” ì´ë¦„ì˜ ë¬¸ì ë””ë°”ì´ìŠ¤ íŒŒì¼ì„ ìƒì„±í•˜ë©°, ì´ íŒŒì¼ì€ ë©”ì´ì € ë²ˆí˜¸ 240ê³¼ ë§ˆì´ë„ˆ ë²ˆí˜¸ 0ì„ ê°€ì§„ë‹¤.) ë””ë°”ì´ìŠ¤ íŒŒì¼ ìƒì„±ì§€ì •ëœ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ íŒŒì¼ ì‹œìŠ¤í…œì— ë””ë°”ì´ìŠ¤ íŒŒì¼ì„ ìƒì„±. ì´ íŒŒì¼ì€ ì‹¤ì œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ì§€ ì•Šê³ , ëŒ€ì‹  íŠ¹ì • ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì™€ì˜ í†µì‹  ê²½ë¡œ ì—­í• ì„ í•œë‹¤. ìƒì„±ëœ íŒŒì¼ì˜ ìœ í˜•(ë¬¸ì ë˜ëŠ” ë¸”ë¡), ë©”ì´ì € ë²ˆí˜¸, ë§ˆì´ë„ˆ ë²ˆí˜¸ëŠ” ì»¤ë„ì´ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ë¥¼ ì–´ë–»ê²Œ ì°¾ì•„ì•¼ í•˜ëŠ”ì§€ë¥¼ ê²°ì •í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤. íŒŒì¼ ì‹œìŠ¤í…œì— ë©”íƒ€ë°ì´í„° ë“±ë¡ìƒì„±ëœ ë””ë°”ì´ìŠ¤ íŒŒì¼ì— ëŒ€í•œ ë©”íƒ€ë°ì´í„°ê°€ íŒŒì¼ ì‹œìŠ¤í…œì— ë“±ë¡. ì´ ë©”íƒ€ë°ì´í„°ì—ëŠ” íŒŒì¼ì˜ ìœ í˜•, ê¶Œí•œ, ì†Œìœ ì, ê·¸ë£¹, ë©”ì´ì €/ë§ˆì´ë„ˆ ë²ˆí˜¸ ë“±ì´ í¬í•¨ë  ìˆ˜ ìˆë‹¤. ì´ ì •ë³´ëŠ” íŒŒì¼ ì‹œìŠ¤í…œì„ í†µí•´ íŒŒì¼ì— ì ‘ê·¼í•˜ë ¤ëŠ” í”„ë¡œì„¸ìŠ¤ì— ì˜í•´ ì°¸ì¡°ëœë‹¤. ì‹œìŠ¤í…œê³¼ì˜ í†µí•©ë””ë°”ì´ìŠ¤ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ë©´, ì‹œìŠ¤í…œì˜ ë‹¤ë¥¸ ë¶€ë¶„(ì˜ˆ: ì‚¬ìš©ì ê³µê°„ì˜ í”„ë¡œê·¸ë¨)ì€ ì´ íŒŒì¼ì„ í†µí•´ ì»¤ë„ì˜ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì™€ í†µì‹ í•  ìˆ˜ ìˆë‹¤. íŒŒì¼ì— ëŒ€í•œ ì…ì¶œë ¥ ì—°ì‚°ì€ ì»¤ë„ì— ì˜í•´ í•´ë‹¹ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì˜ ì ì ˆí•œ í•¨ìˆ˜ë¡œ ë¼ìš°íŒ…ëœë‹¤."
    } ,
  
    {
      "title"       : "Kernel Module ë§Œë“¤ê¸°",
      "category"    : "",
      "tags"        : "linux, kernel module",
      "url"         : "./kernelmodule01.html",
      "date"        : "2024-02-28 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 10",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. ê´€ë ¨ ì„¤ì • ì¶”ê°€ ë° source code ìƒì„±1.1 ë“œë¼ì´ë²„ ë””ë ‰í† ë¦¬ ìƒì„± ë° Makefile ì— í•´ë‹¹ ë””ë ‰í† ë¦¬ ì¶”ê°€user@DESKTOP:~$ cd linux/driversuser@DESKTOP:~/linux/drivers$ mkdir comentouser@DESKTOP:~/linux/drivers$ vim Makefile...obj-$(CONFIG_DRM_ACCEL) += accel/obj-$(CONFIG_CDX_BUS) += cdx/obj-$(CONFIG_DPLL) += dpll/obj-$(CONFIG_S390) += s390/# ì¶”ê°€ ë‚´ìš©oeeebj-y += comento/ 1.2 drivers Kconfig ì—ë„ ì¶”ê°€ë  ë””ë ‰í† ë¦¬ Kconfig í•­ëª© ì¶”ê°€user@DESKTOP:~/linux/drivers$ vim Kconfig...source \"drivers/cdx/Kconfig\"source \"drivers/dpll/Kconfig\"source \"drivers/comento/Kconfig\" # ì¶”ê°€ ë‚´ìš©endmenu1.3 í•´ë‹¹ ë””ë ‰í† ë¦¬ì— Kconfig íŒŒì¼ ì¶”ê°€user@DESKTOP:~/linux/drivers$ cd comentouser@DESKTOP:~/linux/drivers/comento$ vim Kconfig menu \"Comento Example Driver\"config COMENTO_EXAMPLE tristate \"Comento Example Dirver Module\" help This is an exampleendmenu config COMENTO_EXAMPLE : .config íŒŒì¼ì—ì„œëŠ” CONFIG prefix ë¥¼ ë¶™ì—¬ CONFIG_COMENTO_EXAMPLE ë¡œ ì‚¬ìš©ë¨.1.4 í•´ë‹¹ ë””ë ‰í† ë¦¬ ë‚´ main.c ë¡œ ëª©ì íŒŒì¼ì´ ë§Œë“¤ì–´ ì§ˆ ìˆ˜ ìˆë„ë¡ Makefile ì¶”ê°€user@DESKTOP:~/linux/drivers/comento$ vim Makefileobj-$(CONFIG_COMENTO_EXAMPLE) += comento.ocomento-objs += main.o1.5 linux kernel module ë‚´ìš©ì„ ë‹´ì€ ì†ŒìŠ¤ ì½”ë“œ main.c ì‘ì„±user@DESKTOP:~/linux/drivers/comento$ vim main.c#include &lt;linux/module.h&gt;static int __init comento_module_init(void) { printk(KERN_DEBUG \"%s\\n\", __func__); return 0;}static void __exit comento_module_exit(void) { printk(KERN_DEBUG \"%s\\n\", __func__);}module_init(comento_module_init);module_exit(comento_module_exit);MODULE_AUTHOR(\"Hello&lt;hello@comento.com&gt;\");MODULE_DESCRIPTION(\"Example module\");MODULE_LICENSE(\"GPL v2\");ëª¨ë“ˆ ì´ˆê¸°í™” ë° ì¢…ë£Œ í•¨ìˆ˜ __init í•¨ìˆ˜ (comento_module_init): ëª¨ë“ˆì´ ì»¤ë„ì— ë¡œë“œë  ë•Œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë¨. __init ë§¤í¬ë¡œëŠ” ì´ í•¨ìˆ˜ê°€ ì´ˆê¸°í™” ì½”ë“œì—ë§Œ ì‚¬ìš©ë˜ë©°, ì´ˆê¸°í™” í›„ì—ëŠ” ë©”ëª¨ë¦¬ì—ì„œ í•´ì œë  ìˆ˜ ìˆìŒì„ ì»¤ë„ì— ì•Œë¦°ë‹¤. ì´ ì˜ˆì—ì„œ, printk í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¤ë„ ë¡œê·¸ì— ë©”ì‹œì§€ (__func__ ë§¤í¬ë¡œëŠ” í˜„ì¬ í•¨ìˆ˜ ì´ë¦„ì˜ ë¬¸ìì—´ì„ ë°˜í™˜) ë¥¼ ì¶œë ¥í•œë‹¤. __init ì€ init ê´€ë ¨ í•¨ìˆ˜ì„ì„ í‘œì‹œí•œ attribute ì´ë‹¤. __exit í•¨ìˆ˜ (comento_module_exit): ëª¨ë“ˆì´ ì»¤ë„ì—ì„œ ì œê±°ë  ë•Œ ì‹¤í–‰ë¨. __exit ë§¤í¬ë¡œëŠ” ì´ í•¨ìˆ˜ê°€ ì¢…ë£Œ ì½”ë“œì—ë§Œ ì‚¬ìš©ë˜ë©°, ëª¨ë“ˆì´ ì»¤ë„ì— ê³„ì† ë¡œë“œë˜ì–´ ìˆëŠ” ê²½ìš° ë©”ëª¨ë¦¬ë¥¼ ì ˆì•½í•˜ê¸° ìœ„í•´ í•´ì œë  ìˆ˜ ìˆìŒì„ ë‚˜íƒ€ë‚¸ë‹¤. module_init ë§¤í¬ë¡œ ëª©ì : ì»¤ë„ ëª¨ë“ˆì´ ì‹œìŠ¤í…œì— ë¡œë“œë  ë•Œ ì‹¤í–‰ë  ì´ˆê¸°í™” í•¨ìˆ˜ë¥¼ ì§€ì • ë™ì‘: ì§€ì •ëœ ì´ˆê¸°í™” í•¨ìˆ˜ëŠ” ëª¨ë“ˆì´ ì»¤ë„ì— ì‚½ì…ë  ë•Œ(insmod ëª…ë ¹ì–´ ì‚¬ìš© ì‹œ) ìë™ìœ¼ë¡œ í˜¸ì¶œëœë‹¤. ì´ í•¨ìˆ˜ ë‚´ì—ì„œëŠ” ëª¨ë“ˆì´ ì œëŒ€ë¡œ ì‘ë™í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ í• ë‹¹, ìƒíƒœ ì´ˆê¸°í™”, ë””ë°”ì´ìŠ¤ ë“±ë¡ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. module_exit ë§¤í¬ë¡œ ëª©ì : ì»¤ë„ ëª¨ë“ˆì´ ì‹œìŠ¤í…œì—ì„œ ì œê±°ë  ë•Œ ì‹¤í–‰ë  ì¢…ë£Œ í•¨ìˆ˜ë¥¼ ì§€ì • ë™ì‘: ì§€ì •ëœ ì¢…ë£Œ í•¨ìˆ˜ëŠ” ëª¨ë“ˆì´ ì»¤ë„ì—ì„œ ì œê±°ë  ë•Œ(rmmod ëª…ë ¹ì–´ ì‚¬ìš© ì‹œ) ìë™ìœ¼ë¡œ í˜¸ì¶œëœë‹¤. ì´ í•¨ìˆ˜ ë‚´ì—ì„œëŠ” ëª¨ë“ˆì˜ ì •ìƒì ì¸ ì¢…ë£Œë¥¼ ìœ„í•´ í• ë‹¹ëœ ë¦¬ì†ŒìŠ¤ì˜ í•´ì œ, ë“±ë¡ëœ ë””ë°”ì´ìŠ¤ì˜ ë“±ë¡ í•´ì œ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. MODULE_AUTHOR: ëª¨ë“ˆì˜ ì‘ì„±ì. MODULE_DESCRIPTION: ëª¨ë“ˆì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…. MODULE_LICENSE: ëª¨ë“ˆì˜ ë¼ì´ì„ ìŠ¤ ìœ í˜•. â€œGPL v2â€ëŠ”, ëª¨ë“ˆì´ GNU General Public License ë²„ì „ 2ì— ë”°ë¼ ë°°í¬ë¨ì„ ë‚˜íƒ€ë‚¸ë‹¤. ì´ëŠ” ëª¨ë“ˆì´ GPL í˜¸í™˜ ì½”ë“œì™€ í•¨ê»˜ ì‚¬ìš©ë˜ì–´ì•¼ í•¨ì„ ì˜ë¯¸í•œë‹¤.1.6 menuconfig ì‹¤í–‰í•˜ì—¬ í•­ëª© ì¶”ê°€ë˜ì—ˆìŒì„ í™•ì¸í•˜ê³  ì„¤ì • ë°˜ì˜user@DESKTOP:~/linux/drivers/comento$ cd ..user@DESKTOP:~/linux/drivers$ cd ..user@DESKTOP:~/linux$ ARCH=arm64 make menuconfigDevice Driver í•­ëª© ë§¨ ì•„ë˜ ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.2. kernel build2.1 kernel builduser@DESKTOP:~/linux$ ARCH=arm64 CROSS_COMPILE=/home/gon/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu- make CALL scripts/checksyscalls.sh CC [M] drivers/comento/main.o LD [M] drivers/comento/comento.o ... CC [M] drivers/comento/comento.mod.o LD [M] drivers/comento/comento.ko ...í•´ë‹¹ kernel ì„ build í•˜ë©´ ìœ„ì™€ ê°™ì´ ì‚¬ìš©ìê°€ ì‘ì„±í•œ drivers/comento/main.o ê°€ gcc ì— ì˜í•´ ë¹Œë“œë˜ê³ , í•´ë‹¹ linker script ê°€ comento-objs += main.o ì— ëª…ì‹œëœ ëŒ€ë¡œ main.o ë¥¼ ëª¨ì•„ì„œ obj-$(CONFIG_COMENTO_EXAMPLE) += comento.o ëŒ€ë¡œ drivers/comento/comento.o ì„ ìƒì„±í•œë‹¤.ê·¸ë¦¬ê³  commento.o ê°€ ëª¨ë“ˆê´€ë ¨ ëª©ì  íŒŒì¼ drivers/comento/comento.mod.o ê³¼ í•¨ê»˜ link ë˜ì„œ linker ê°€ drivers/comento/comento.ko ë¥¼ ë§Œë“ ë‹¤.3. buildroot ì´ë¯¸ì§€ì— í•´ë‹¹ ko íŒŒì¼ ì¶”ê°€ ë° QEMU ì—ì„œ ëª¨ë“ˆ ë¡œë“œê°€ ì •ìƒì ìœ¼ë¡œ ë˜ì—ˆëŠ”ì§€ í™•ì¸3.1 buildroot ì´ë¯¸ì§€ì— í•´ë‹¹ ko íŒŒì¼ ì¶”ê°€user@DESKTOP:~/linux$ sudo mount -o loop ../buildroot/output/images/rootfs.ext4 /mntuser@DESKTOP:~/linux$ sudo mkdir /mnt/usr/lib/modulesuser@DESKTOP:~/linux$ sudo cp drivers/comento/comento.ko /mnt/usr/lib/modulesuser@DESKTOP:~/linux$ syncuser@DESKTOP:~/linux$ sudo umount /mnt3.2 QEMU ì‹¤í–‰user@DESKTOP:~/linux$ cd ..user@DESKTOP:~$ qemu-system-aarch64 -kernel linux/arch/arm64/boot/Image -drive format=raw,file=buildroot/output/images/rootfs.ext4,if=virtio -append \"root=/dev/vda console=ttyAMA0 nokaslr\" -nographic -M virt -cpu cortex-a72 -m 2G -smp 23.3 ëª¨ë“ˆ ì¶”ê°€ í™•ì¸# ls /usr/lib/modulescomento.koí•´ë‹¹ ì»¤ë„ì—ì„œ ì‚½ì…í•œ ê²½ë¡œì— ë³´ë©´ comento.ko ì´ ì •ìƒì ìœ¼ë¡œ ì¶”ê°€ë˜ì–´ ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤.4. moudule load / unload4.1 load# insmod /usr/lib/moduels/comento.ko# dmesg -ccomento_module_initinsmod í•˜ì—¬ ëª¨ë“ˆì„ ì‚½ì…í•˜ê³  dmesg ë¥¼ í•˜ë©´, main.c ì— ì‘ì„± í–ˆë˜ comento_module_init() ì—ì„œ ì‘ì„±í•œ ëŒ€ë¡œ í•¨ìˆ˜ëª… (comento_module_init) ì„ ì¶œë ¥í•˜ê²Œ ëœë‹¤. ì•„ë˜ì™€ ê°™ì´ lsmod ëª…ë ¹ì–´ë¡œ í˜„ì¬ ë¡œë“œëœ ëª¨ë“ˆë“¤ì„ ë³¼ ìˆ˜ë„ ìˆë‹¤.# lsmodModule Size Used bycomento 12288 04.2 unload# rmmod comento.ko# dmesg -ccomento_module_exitrmmod ë¥¼ í†µí•´ ì§€ì •ëœ ëª¨ë“ˆì„ ì œê±° í•œë‹¤. ì œê±°í•˜ë©´ì„œ â€œcomento_module_exitâ€ ë©”ì„¸ì§€ê°€ ì¶œë ¥ë˜ì—ˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤.# lsmodModule Size Used bylsmod ë¡œ ë³´ë©´ ì´ì œ ë¡œë“œëœ ëª¨ë“ˆì´ ì—†ìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤."
    } ,
  
    {
      "title"       : "GDB ë¥¼ ì‚¬ìš© ê¸°ì´ˆ ë° systemcall GDB ì ìš©",
      "category"    : "",
      "tags"        : "linux, systemcall, gdb-multiarch",
      "url"         : "./gdp01.html",
      "date"        : "2024-02-25 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 09",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.GDB ê¸°ì´ˆ GDB ì‚¬ìš©ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜user@DESKTOP:~$ sudo apt-get install gdb-multiarch GDB ë¡œ ê´€ì°°í•  systemcall ì‘ì„±user@DESKTOP:~$ vi fact.c test ìš© code#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int factorial(int n) { int ret = 1; if (n &gt; 1) { ret *= n; ret *= factorial(n - 1); } return ret;}int main(int argc, char *argv[]) { int i = atoi(argv[1]); int result = factorial(i); printf(\"result: %d\\n\", result); return 0;} gcc builduser@DESKTOP:~$ gcc -g fact.c -o fact # -g : ì»´íŒŒì¼ëœ ì‹¤í–‰ íŒŒì¼ì— ë””ë²„ê¹… ì •ë³´ë¥¼ í¬í•¨# GDBë¥¼ ì‚¬ìš©í•  ë•Œ ì†ŒìŠ¤ ì½”ë“œì˜ ë¼ì¸ ë²ˆí˜¸, ë³€ìˆ˜ ì´ë¦„ ë“±ì˜ ìƒì„¸í•œ ì •ë³´ì— ì ‘ê·¼ ê°€ëŠ¥ GDB ì‹¤í–‰user@DESKTOP:~$ gdb-multiarch factGNU gdb (Ubuntu 12.1-0ubuntu1~22.04) 12.1Copyright (C) 2022 Free Software Foundation, Inc.License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;This is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.Type \"show copying\" and \"show warranty\" for details.This GDB was configured as \"x86_64-linux-gnu\".Type \"show configuration\" for configuration details.For bug reporting instructions, please see:&lt;https://www.gnu.org/software/gdb/bugs/&gt;.Find the GDB manual and other documentation resources online at: &lt;http://www.gnu.org/software/gdb/documentation/&gt;.For help, type \"help\".Type \"apropos word\" to search for commands related to \"word\"...Reading symbols from fact...(gdb)(gdb) start 10 # --- (1)Temporary breakpoint 1 at 0x11bd: file fact.c, line 14. # --- (2)Starting program: /home/gon/fact 10 [Thread debugging using libthread_db enabled] --- (3)Using host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\". # --- (4)Temporary breakpoint 1, main (argc=2, argv=0x7fffffffe108) at fact.c:1414 int i = atoi(argv[1]);(1) start ëª…ë ¹ì€ í”„ë¡œê·¸ë¨ì„ ì‹œì‘í•˜ê³ , ì£¼ì–´ì§„ í”„ë¡œê·¸ë¨ì˜ ì²«ë²ˆì§¸ ì¸ì(10)ì™€ í•¨ê»˜ ë©”ì¸ í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ ë¼ì¸ì—ì„œ ì¼ì‹œì ì¸ ì¤‘ë‹¨ì ì„ ì„¤ì •. ì´ë ‡ê²Œ í•˜ë©´ í”„ë¡œê·¸ë¨ì´ ì‹¤ì œë¡œ ì‹¤í–‰ë˜ê¸° ì‹œì‘í•˜ë©°, ì‚¬ìš©ìê°€ í”„ë¡œê·¸ë¨ì˜ ì´ˆê¸° ìƒíƒœë¥¼ ê²€ì‚¬í•  ìˆ˜ ìˆê²Œ ëœë‹¤.(2) í˜„ì¬ ì¤‘ë‹¨ì  code ìƒ line ì˜ ìœ„ì¹˜ì™€ ë©”ëª¨ë¦¬ ì£¼ì†Œ. ì¦‰ main í•¨ìˆ˜ ë‚´ ì²«ë²ˆì§¸ ì¤„.(3) ë©€í‹°ìŠ¤ë ˆë”© í”„ë¡œê·¸ë¨ì„ ë””ë²„ê¹…í•˜ê¸° ìœ„í•´ libthread_db ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŒì„ í‘œì‹œ(4) í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ libthread_db ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŒì„ í‘œì‹œ. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ìŠ¤ë ˆë“œì™€ ê´€ë ¨ëœ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬ ë””ë²„ê±°ê°€ ìŠ¤ë ˆë“œë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë•ëŠ”ë‹¤.QEME GDB ì ìš© Debug mode ë¡œ ë¹Œë“œë˜ë„ë¡ Linux kernel ì„¤ì • ë³€ê²½user@DESKTOP:~$ cd linuxuser@DESKTOP:~/linux$ ARCH=arm64 make menuconfig kernel hacking -&gt; Kernel debugging ì„ íƒ kernel hacking -&gt; Compile-time checks and compiler options -&gt; Debug information (Disable debug information) -&gt; Rely on the toolchainâ€™s implicit default DWARF version ì„ íƒ re-builduser@DESKTOP:~/linux$ make -j&lt;cpu ìˆ˜&gt; QEMU ì‹¤í–‰user@DESKTOP:~/linux$ cd ..user@DESKTOP:~$ qemu-system-aarch64 -kernel linux/arch/arm64/boot/Image -drive format=raw,file=buildroot/output/images/rootfs.ext4,if=virtio -append \"root=/dev/vda console=ttyAMA0 nokaslr\" -nographic -M virt -cpu cortex-a72 -m 2G -smp 2 -s -S-s : gdb ê°€ ë¶™ì„ ìˆ˜ ìˆë„ë¡ 1234 í¬íŠ¸ë¥¼ ì—´ì–´ë‘ -S : QEMU ê°€ ì‹œì‘í•˜ìë§ˆì ë©ˆì¶°ìˆëŠ” ìƒíƒœë¡œ ë§Œë“¬. (break-point ë¥¼ ê±¸ìˆ˜ ìˆëŠ” ì‹œì ì„ ë§ˆë ¨í•˜ê¸° ìœ„í•¨)(ì‹¤í–‰ì‹œ -S ì˜µì…˜ìœ¼ë¡œ ì¸í•´ ë©ˆì¶°ìˆê²Œ ë¨. ê·¸ë˜ì„œ ë‹¤ë¥¸ cli ìƒì—ì„œ gdb-multiarchë¥¼ ì‚¬ìš©í•˜ì—¬ linux/vmlinux ê²½ë¡œì— ìœ„ì¹˜í•œ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ì´ë¯¸ì§€ë¥¼ ë””ë²„ê¹… ëª¨ë“œë¡œ ì—¼)user@DESKTOP:~$ gdb-multiarch linux/vmlinuxFor help, type \"help\".Type \"apropos word\" to search for commands related to \"word\"...Reading symbols from kernel/vmlinux...(gdb)ë”°ë¼ì„œ vmlinux ë‚´ debugging ì •ë³´ê°€ ì½ì–´ì§€ê²Œ ë¨. ê¸°ì¡´ buildroot ì´ë¯¸ì§€ì—ëŠ” ëª¨ë“  ì •ë³´ê°€ ë‹´ê²¨ìˆëŠ”ê²ƒì´ ì•„ë‹ˆë¼ kernel ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì½”ë“œë§Œ í¬í•¨ëœ ë‹¨ìˆœí™”ëœ íŒŒì¼ì´ë‹¤. ë”°ë¼ì„œ í•´ë‹¹ ì´ë¯¸ì§€ ë§Œìœ¼ë¡œ ëª¨ë“  ë””ë²„ê¹… ì •ë³´ë¥¼ ë³¼ ìˆ˜ëŠ” ì—†ëŠ” í™˜ê²½ì´ë‹¤. ê·¸ëŸ°ë° vmlinux íŒŒì¼ì˜ ê²½ìš°, ì»¤ë„ì˜ ë””ë²„ê¹… ì •ë³´, í•¨ìˆ˜ ë° ë³€ìˆ˜ ì´ë¦„ ì •ë³´, ì½”ë“œ ë¼ì¸ ì •ë³´ ë“±ì´ ëª¨ë‘ ë‹´ê¸´ ëª©ì  íŒŒì¼ì´ë¯€ë¡œ gdb-multiarch linux/vmlinux ì™€ ê°™ì´ í•´ë‹¹ íŒŒì¼ì„ ë””ë²„ê±° ì¸ìë¡œ ë„˜ê²¨ ì£¼ì–´ì•¼ í•œë‹¤.ê·¸ë¦¬ê³  gdb prompt ì°½ì— target remote :1234 ë¥¼ ì…ë ¥í•˜ì—¬ qemu ì—ì„œ ì—´ì–´ë‘” ë””ë²„ê¹… í¬íŠ¸ 1234 ì— ì ‘ì†í•œë‹¤. ì—°ê²°ëœ ì´í›„, ì›í•˜ëŠ” break-point ë¥¼ ê±¸ ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´,(gdb) break start_kernel ë¡œ ì…ë ¥í•˜ë©´ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì—ì„œ ì œì¼ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” c í•¨ìˆ˜ì— ì¤‘ë‹¨ì ì„ ìƒì„±í•˜ê³ ,(gdb)__do_sys_&lt;ì‹œìŠ¤í…œì½œ í•¨ìˆ˜ ì´ë¦„&gt; ì˜ ê²…ìš° ì•ì„œ ì‹¤ìŠµí•œ systemcall ì„ ë””ë²„ê¹… ê°€ëŠ¥í•˜ë‹¤. ì—¬ê¸°ì—ì„œ __do_sys_ ì ‘ë‘ì‚¬ëŠ” SYSCALL_DEFINE ë§¤í¬ë¡œê°€ ìë™ ìƒì„±í•œ ê²ƒì´ë‹¤. QEMU ê°€ ì—° í¬íŠ¸ì— ì ‘ê·¼(gdb) set architecture aarch64(gdb) target remote :1234Remote debugging using :1234warning: Selected architecture i386:x86-64 is not compatible with reported target architecture aarch64warning: Architecture rejected target-supplied description0x0000000000000000 in fixed_percpu_data () # bootloader ì˜ ì²« ì‹œì‘ ì£¼ì†Œ break-point ê±¸ê¸°start_kernel ì´ë¼ëŠ” ê°€ì¥ ì²˜ìŒì— ì‹œì‘ë˜ëŠ” í•¨ìˆ˜ì— break-point ê±¸ê¸°(gdb) break start_kernelBreakpoint 1 at 0xffffffff821889e0: file init/main.c, line 875.ìš°ë¦¬ê°€ ì¶”ê°€í•œ systemcall í•¨ìˆ˜ break-point ê±¸ê¸°(gdb) break __do_sys_new_syscallBreakpoint 2 at 0xffffffff811391c9: file kernel/new_syscall.c, line 6."
    } ,
  
    {
      "title"       : "systemcall ê¸°ì´ˆ 1",
      "category"    : "",
      "tags"        : "linux, systemcall",
      "url"         : "./systemcall01.html",
      "date"        : "2024-02-24 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 08",
      "content"     : "ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ ì—ëŸ¬ë°©ì§€ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. SYSCALL_DEFINE ë§¤í¬ë¡œ1.1 ìƒì„±í•  systemcall ì´ ì¶”ê°€ë  linux ë””ë ‰í† ë¦¬ ë‚´ í•´ë‹¹ source ì¶”ê°€user@DESKTOP:~$ cd linux/kerneluser@DESKTOP:~/linux/kernel$ vim new_syscall.c#include &lt;linux/kernel.h&gt; // kenel ì—ì„œ ì‚¬ìš©í•  soruce code ì— í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬#include &lt;linux/syscalls.h&gt; // SYSCALL_DEFINE ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬SYSCALL_DEFINE1(new_syscall, int, code) // SYSCALL_DEFINE ë§¤í¬ë¡œ + 1ê°œ ì¸ì (system call ì´ë¦„, (ì²«ë²ˆì§¸)ì¸ì íƒ€ì…, (ì²«ë²ˆì§¸)ì¸ì ì´ë¦„){ printk(KERN_INFO \"Hello World~!!!! %d\\n\", code); // syscall í˜¸ì¶œ í™•ì¸ì„ ìœ„í•´ log ì¶œë ¥ \\n ë¡œ ì¢…ë£Œí•´ì•¼ ì‹œìŠ¤í…œì´ í•´ë‹¹ ë¡œê·¸ message ê°€ ì¢…ë£Œ ë˜ì—ˆìŒì„ ì¸ì§€í•¨. (ì—†ìœ¼ë©´ ì¢…ë£Œ ìƒíƒœê°€ ê²°ì •ë˜ì§€ ì•Šì•„ ì›í•˜ëŠ” ì‹œì ì— ì¶œë ¥ ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ.) return code + 1; }1.2 Makefile ìˆ˜ì •user@DESKTOP:~/linux/kernel$ vi Makefileí•´ë‹¹ íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì´ ë°˜ë“œì‹œ ì‹¤í–‰ë˜ëŠ” ëª©ì  íŒŒì¼ë“¤ì´ obj-y ë¡œ ë‚˜ì—´ë˜ì–´ ìˆë‹¤.obj-y = fork.o exec_domain.o panic.o \\ cpu.o exit.o softirq.o resource.o \\ sysctl.o capability.o ptrace.o user.o \\ signal.o sys.o umh.o workqueue.o pid.o task_work.o \\ extable.o params.o \\ kthread.o sys_ni.o nsproxy.o \\ notifier.o ksysfs.o cred.o reboot.o \\ async.o range.o smpboot.o ucount.o regset.o ksyms_common.oì´ ë³€ìˆ˜ì— ì§€ì •ëœ ì˜¤ë¸Œì íŠ¸ íŒŒì¼ë“¤ì€ ì»¤ë„ ë¹Œë“œ ê³¼ì •ì—ì„œ í•­ìƒ í¬í•¨ëœë‹¤. ê·¸ ë°–ì—,obj-m: ëª¨ë“ˆë¡œ ë¹Œë“œë  ì˜¤ë¸Œì íŠ¸ íŒŒì¼ë“¤ì„ ì§€ì •í•œë‹¤. ì´ ë³€ìˆ˜ì— ì§€ì •ëœ í•­ëª©ë“¤ì€ ì»¤ë„ ëª¨ë“ˆë¡œ ì»´íŒŒì¼ë˜ë©°, í•„ìš”ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì»¤ë„ì— ë¡œë“œí•˜ê±°ë‚˜ ì–¸ë¡œë“œí•  ìˆ˜ ìˆë‹¤.obj-n: ë¹Œë“œì—ì„œ ì œì™¸ë  ì˜¤ë¸Œì íŠ¸ íŒŒì¼ì„ ì§€ì •í•œë‹¤. ì´ëŠ” í•´ë‹¹ í•­ëª©ì´ ì»¤ë„ ë¹Œë“œ ê³¼ì •ì—ì„œ ë¬´ì‹œë¨ì„ ì˜ë¯¸.obj-$(CONFIGëª…) í•­ëª©ë“¤ì˜ ê²½ìš°, ê´€ë ¨ CONFIG ì„¤ì •ì´ y ë¼ë©´ ì‹¤í–‰ë˜ì§€ë§Œ, ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.obj-$(CONFIG_USERMODE_DRIVER) += usermode_driver.oobj-$(CONFIG_MULTIUSER) += groups.oobj-$(CONFIG_VHOST_TASK) += vhost_task.oí•´ë‹¹ í•­ëª©ì˜ config ê°’ ì„¤ì •ì„ ë³´ë ¤ë©´ .config íŒŒì¼ì—ì„œ ì°¾ì•„ ë³¼ ìˆ˜ ìˆë‹¤.user@DESKTOP:~/linux/kernel$ vim ../.configí•´ë‹¹ íŒŒì¼ì„ ì—´ì–´ë³´ë©´, CONFIG_MULTIUSER=y ë§Œ ì¡´ì¬í•œë‹¤.ì´ê²ƒì€ ê³§, CONFIG_MULTIUSER ì˜ ê°’ì€ y ë¡œ obj-yë¡œ ì„¤ì •, ë¹Œë“œ ë° ì‹¤í–‰ì— ì ìš©ë˜ë‚˜, CONFIG_USERMODE_DRIVER, CONFIG_VHOST_TASK ëŠ” ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, obj- ìƒíƒœì´ë¯€ë¡œ kernel build ë° ì‹¤í–‰ ì‹œ ì˜í–¥ì´ ì—†ìœ¼ë¯€ë¡œ ì‚­ì œí•˜ì—¬ë„ ë™ì¼í•œ ìƒíƒœì„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.í•´ë‹¹ ìƒíƒœëŠ” menuconfig í™”ë©´ì—ì„œë„ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.user@DESKTOP:~/linux/kernel$ cd ..user@DESKTOP:~/linux$ ARCH=arm64 make menuconfigí™”ë©´ì—ì„œ / ë¥¼ ëˆŒëŸ¬ì„œ ì°¾ê²Œ ëª¨ë“œ ì‚¬ìš© (vi ì™€ ë™ì¼). CONFIG_MULTIUSER ê²€ìƒ‰ ì‹œ.í•´ë‹¹ Symbol ì„¤ì •ì´ =y ë¡œ ë˜ì–´ ìˆìœ¼ë‚˜,CONFIG_USERMODE_DRIVER ì˜ ê²½ìš° =n ì„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.ìœ„ì™€ ê°™ì´, obj-y ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œ ì‘ì„±í•œ â€˜new_syscall ì„ Makefile` ì— ì¶”ê°€í•´ ì¤€ë‹¤.CFLAGS_stackleak.o += $(DISABLE_STACKLEAK_PLUGIN)obj-$(CONFIG_GCC_PLUGIN_STACKLEAK) += stackleak.oKASAN_SANITIZE_stackleak.o := nKCSAN_SANITIZE_stackleak.o := nKCOV_INSTRUMENT_stackleak.o := nobj-$(CONFIG_SCF_TORTURE_TEST) += scftorture.o# obj- ì¶”ê°€ ê°€ì¥ ë§ˆì§€ë§‰ í•­ëª©ìœ¼ë¡œ ì‹ ê·œ systemcall ì¶”ê°€obj-y += new_syscall.o$(obj)/configs.o: $(obj)/config_data.gztargets += config_data config_data.gz$(obj)/config_data.gz: $(obj)/config_data FORCE $(call if_changed,gzip)filechk_cat = cat $&lt;2. ì»¤ë„ì— ìƒˆë¡œìš´ ì†ŒìŠ¤ ì½”ë“œ ì¶”ê°€2.1 systemcall ë²ˆí˜¸ í• ë‹¹linux/include/uapi/asm-generic/unistd.h íŒŒì¼ì€ í‘œì¤€ ì‹œìŠ¤í…œ í˜¸ì¶œ ë²ˆí˜¸ë¥¼ ì •ì˜í•˜ëŠ” íŒŒì¼ì´ë‹¤. Linux ì—ì„œ systemcall ì€ user í”„ë¡œê·¸ë¨ì´ ì»¤ë„ì˜ ê¸°ëŠ¥ì„ ìš”ì²­í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ë‹¤. ì´ëŸ¬í•œ systemcallì„ í†µí•´ íŒŒì¼ ì‘ì—…, í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬, í†µì‹  ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.user@DESKTOP:~/linux$ vim include/uapi/asm-generic/unistd.h...__SYSCALL(__NR_futex_wait, sys_futex_wait)#define __NR_futex_requeue 456__SYSCALL(__NR_futex_requeue, sys_futex_requeue) // (1)#undef __NR_syscalls#define __NR_syscalls 457 // ê¸°ì¡´ ë§ˆì§€ë§‰ syscall ë²ˆí˜¸(1) __NR_futex_requeue : ì •ì˜ëœ ì‹œìŠ¤í…œ í˜¸ì¶œì˜ ê³ ìœ  ë²ˆí˜¸ sys_futex_requeue : ì •ì˜ëœ ì‹œìŠ¤í…œ í˜¸ì¶œì— ëŒ€ì‘í•˜ëŠ” ì»¤ë„ í•¨ìˆ˜ì˜ ì´ë¦„457 ë²ˆ syscall ì„ ì¶”ê°€í•˜ê³  ë§ˆì§€ë§‰ ë²ˆí˜¸ë¥¼ 458 ë¡œ ë³€ê²½í•œë‹¤....__SYSCALL(__NR_futex_wait, sys_futex_wait)#define __NR_futex_requeue 456__SYSCALL(__NR_futex_requeue, sys_futex_requeue)#define __NR_new_syscall 457__SYSCALL(__NR_new_syscall, sys_new_syscall) // SYSCALL_DEFINE macro ë¥¼ ì‚¬ìš©í•¨#undef __NR_syscalls#define __NR_syscalls 458ì—¬ê¸°ì„œ ì‚¬ìš©í•œ SYSCALL_DEFINE macro ì˜ ë‚´ìš©ì€ syscall_wrapper.h ì— í¬í•¨ë˜ì–´ ìˆìœ¼ë©° architecture ë§ˆë‹¤ ë‹¤ë¥´ë¯€ë¡œ ì•„ë˜ ê²½ë¡œ íŒŒì¼ì—ì„œ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.user@DESKTOP:~/linux$ vi arch/arm64/include/asm/syscall_wrapper.h#define COMPAT_SYSCALL_DEFINEx(x, name, ...) \\ asmlinkage long __arm64_compat_sys##name(const struct pt_regs *regs); \\ ALLOW_ERROR_INJECTION(__arm64_compat_sys##name, ERRNO); \\ static long __se_compat_sys##name(__MAP(x,__SC_LONG,__VA_ARGS__)); \\ static inline long __do_compat_sys##name(__MAP(x,__SC_DECL,__VA_ARGS__)); \\ asmlinkage long __arm64_compat_sys##name(const struct pt_regs *regs) \\ { \\ return __se_compat_sys##name(SC_ARM64_REGS_TO_ARGS(x,__VA_ARGS__)); \\ } \\ static long __se_compat_sys##name(__MAP(x,__SC_LONG,__VA_ARGS__)) \\ { \\ return __do_compat_sys##name(__MAP(x,__SC_DELOUSE,__VA_ARGS__)); \\ } \\ static inline long __do_compat_sys##name(__MAP(x,__SC_DECL,__VA_ARGS__))3. ì»¤ë„ì— ìƒˆë¡œìš´ ì‹œìŠ¤í…œì½œ ì¶”ê°€3.1 build ì§„í–‰ (ì´ë¯¸ì§€ ìƒì„±)user@DESKTOP:~/linux$ ARCH=arm64 CROSS_COMPILE=/home/gon/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu- make -j164. ìƒˆë¡œìš´ ì‹œìŠ¤í…œì½œì„ ì‚¬ìš©í•˜ëŠ” ì‘ìš©í”„ë¡œê·¸ë¨ ë§Œë“¤ê¸°4.1 ì‘ìš© í”„ë¡œê·¸ë¨ ì¶”ê°€user@DESKTOP:~$ vi hello.c#include &lt;stdio.h&gt;#include &lt;unistd.h&gt; // syscall í•¨ìˆ˜ í¬í•¨#define __NR_new_syscall 457 // ì»¤ë„ ìª½ unistd.h ì—ëŠ” ì¶”ê°€í•˜ì˜€ìœ¼ë‚˜, toolchaing ì¸¡ unistd.h ì—ëŠ” ì¶”ê°€íˆì ì•Šì•˜ìœ¼ë©°ë¡œ ì—¬ê¸°ì—ì„œ ëª…ì‹œí•´ì¤Œint main() { int ret = syscall(__NR_new_syscall, 15); printf(\"ret : %d\\n\", ret); return 0;}4.2 ì‘ìš© í”„ë¡œê·¸ë¨ ë¹Œë“œì—¬ê¸°ì„œ ë¹Œë“œë  ì‘ìš© í”„ë¡œê·¸ë¨ì€ ì•ì—ì„œ ì‘ì—…í•œ ì»¤ë„ ì´ë¯¸ì§€ë¥¼ QEMU ë¥¼ í†µí•´ ì‹¤í–‰í•œ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ ë‹¨ìˆœ gcc ì•„ë‹Œ í•´ë‹¹ toolchain ì„ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œí•´ì•¼ í•œë‹¤.user@DESKTOP:~$ gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-gcc -o hello hello.cì œëŒ€ë¡œ ë¹Œë“œë˜ì—ˆëŠ”ì§€ ìƒì„œëœ ì‹¤í–‰íŒŒì¼ì˜ ì •ë³´ë¥¼ í™•ì¸í•œë‹¤.user@DESKTOP:~$ file hellohello: ELF 64-bit LSB executable, ARM aarch64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, for GNU/Linux 3.7.0, with debug_info, not strippedìœ„ì™€ ê°™ì´ ARM aarch64 ë¡œ ì •ìƒì ìœ¼ë¡œ ë¹Œë“œë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.5. ìƒˆë¡œìš´ ì‹œìŠ¤í…œì½œ ì‹¤í–‰í•˜ê¸°5.1 ë¹Œë“œí•œ í”„ë¡œê·¸ë¨ì„ rootfs ì´ë¯¸ì§€ ë‚´ë¡œ (/usr/bin) ì— ë³µì‚¬í•˜ê¸°í•´ë‹¹ ì‘ì—…ì€ mnt ë””ë ‰í† ë¦¬ì— mount í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì—¬ê¹ƒ /mnt ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì„ì‹œì ìœ¼ë¡œ mount í•  ê³µê°„ì´ í•„ìš”í•  ê²½ìš° ì‚¬ìš©ë˜ëŠ” ë””ë ‰í† ë¦¬ì´ë‹¤.user@DESKTOP:~$ sudo mount -o loop buildroot/output/images/rootfs.ext4 /mnt -o loop : loopëŠ” ì´ ì˜µì…˜ì˜ ì¸ìë¡œ, ì¼ë°˜ì ì¸ íŒŒì¼ ì‹œìŠ¤í…œì´ ì•„ë‹Œ íŒŒì¼(ì˜ˆ: ì´ë¯¸ì§€ íŒŒì¼)ì„ ë§ˆìš´íŠ¸í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ì˜µì…˜. loop ì¥ì¹˜ë¥¼ ì‚¬ìš©í•˜ë©´, íŒŒì¼ì„ ë§ˆì¹˜ ë³„ë„ì˜ ë¬¼ë¦¬ì  ë“œë¼ì´ë¸Œì¸ ê²ƒì²˜ëŸ¼ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆë‹¤. buildroot/output/images/rootfs.ext4 : ë¦¬ëˆ…ìŠ¤ ë£¨íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œ ì¤‘ ext4 íŒŒì¼ ì‹œìŠ¤í…œ í¬ë§·ì„ ì‚¬ìš©í•˜ëŠ” ì´ë¯¸ì§€ /mnt : ì´ëŠ” ë§ˆìš´íŠ¸ í¬ì¸íŠ¸ë¥¼ ì§€ì • ì´ëŸ¬ê²Œ ë§ˆìš°íŠ¸ëœ íŒŒì¼ ì‹œìŠ¤í…œì— ì•ì—ì„œ í•„ë“œí•œ hello ë¥¼ ë³µì‚¬í•œë‹¤.user@DESKTOP:~$ sudo cp hello /mnt/usr/binuser@DESKTOP:~$ syncsync ëª…ë ¹ì–´ëŠ” ë¦¬ëˆ…ìŠ¤ ë° ìœ ë‹‰ìŠ¤ ê³„ì—´ ìš´ì˜ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ë˜ë©°, ë©”ëª¨ë¦¬ì— ë²„í¼ë§ëœ íŒŒì¼ ì‹œìŠ¤í…œì˜ ì“°ê¸° ì‘ì—…ì„ ë””ìŠ¤í¬ì— ê°•ì œë¡œ ë™ê¸°í™”í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì…§ë‹¤ìš´ë˜ê¸° ì „ì´ë‚˜ ì¤‘ìš”í•œ íŒŒì¼ ì‹œìŠ¤í…œ ì‘ì—…ì„ ìˆ˜í–‰í•œ í›„ ë°ì´í„°ì˜ ì†ì‹¤ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.sync ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´, ì´ëŸ¬í•œ ë²„í¼ë§ëœ ëª¨ë“  ì“°ê¸° ì‘ì—…ì´ ì™„ë£Œë˜ê³  ë””ìŠ¤í¬ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. ëª…ë ¹ì–´ëŠ” ë³„ë„ì˜ ì¶œë ¥ ì—†ì´ ì‹¤í–‰ë˜ë©°, ëª…ë ¹ì´ ì™„ë£Œë˜ë©´ ëª¨ë“  ë³€ê²½ ì‚¬í•­ì´ ë””ìŠ¤í¬ì— ë°˜ì˜ëœ ìƒíƒœê°€ ëœë‹¤.ì´ë ‡ê²Œ ì‘ì—…ì´ hello ì‹¤í–‰ íŒŒì¼ì„ ì´ë¯¸ì§€ì— ì¶”ê°€ì‹œí‚¨ í›„ ë§ˆìš°íŠ¸ í•´ì œí•œë‹¤.user@DESKTOP:~$ sudo umount /mnt5.2 QEMU ì‹¤í–‰í•˜ê¸°user@DESKTOP:~$ qemu-system-aarch64 -kernel linux/arch/arm64/boot/Image -drive format=raw,file=buildroot/output/images/rootfs.ext4,if=virtio -append \"root=/dev/vda console=ttyAMA0 nokaslr\" -nographic -M virt -cpu cortex-a72 -m 2G -smp 2 buildroot ë‚´ì—ì„œ ì¶”ê°€í•œ systemcall ë™ì‘ í™•ì¸# helloHello World~!!!! 15ret : 16ìœ„ì™€ ê°™ì´, linux rootfs ì— ì¶”ê°€í•œ hello ì‹¤í–‰ íŒŒì¼ì„ ë°”ë¡œ ì‹¤í–‰ ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, ê·¸ ì‹¤í–‰ ê³¼ì •ì—ì„œ new_syscall ì˜ printk(KERN_INFO \"Hello World~!!!! %d\\n\", code); ê°€ ì‹¤í–‰ë˜ì–´ Hello World~!!!! 15 ê°€ ì¶œë ¥ ë˜ê³ , ë‹¤ì‹œ hello ì˜ printf(\"ret : %d\\n\", ret); ì‹¤í–‰ìœ¼ë¡œ ret : 16 ê°€ ì¶œë ¥ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.# dmesg...virtio_net virtio0 enp0s1: renamed from eth0random: crng init doneHello World~!!!! 15ì»¤ë„ì—ì„œ í”„ë¦°íŠ¸ ë˜ëŠ” ëª¨ë“  ë¡œê·¸ ë©”ì„¸ì§€ ì¶œë ¥í•´ë³´ë©´, í•´ë‹¹ systemcall ì´ ì‹¤í–‰ë˜ë©´ì„œ ì¶œë ¥ëœ ë¡œê·¸ê°’ì´ ë§ˆì§€ë§‰ì— ì¡´ì¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤."
    } ,
  
    {
      "title"       : "Buildroot ì„¤ì¹˜ ë° Kernel build",
      "category"    : "",
      "tags"        : "linux, buildroot, kernel build",
      "url"         : "./buildroot-setting01.html",
      "date"        : "2024-02-22 10:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 06",
      "content"     : "ì•„ë˜ ë‚´ìš©ì€ ê°œë°œìë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ(ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) (https://comento.kr/) ê°•ì˜ ë‚´ìš© ì¤‘ ì¼ë¶€ì— í•´ë‹¹í•¨.1. buildroot ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜1.1 buildroot ë‹¤ìš´ë¡œë“œroot@:~$ git clone git://git.buildroot.net/buildroot1.2 qemu ì„¤ì •root@:~$ sudo apt-get install libncurses-dev # í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜root@:~$ cd buildrootroot@:~/buildroot$ ls configs # config ì¢…ë¥˜ í™•ì¸root@:~/buildroot$ make qemu_aarch64_virt_defconfigroot@:~/buildroot$ make menuconfigë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •ì„ ì§„í–‰ system configuration -&gt; init system -&gt; systemd ì„ íƒ kernel -&gt; linux kernel í•´ì œ target packages -&gt; text editors -&gt; vim -&gt; target packages -&gt; libaries -&gt; Crypto -&gt; openssl support ì„ íƒ -&gt; openssl binary ë„ ì„ íƒ Filesystem images -&gt; ext2/3/4 -&gt; ext4 -&gt; exact size -&gt; 128M host utilities -&gt; ëª¨ë‘ ì„ íƒ í•´ì œ (í•´ì œ ë¶ˆê°€ í•­ëª©ì€ ê·¸ëŒ€ë¡œ ë‘ ) -&gt; ìµœì¢… exit -&gt; ì €ì¥root@:~/buildroot$ cat /proc/cpuinfo | grep processor | wc -l # cpu ê°¯ìˆ˜ í™•ì¸root@:~/buildroot$ make -j&lt;cpu ìˆ˜&gt;1.3 ì—ëŸ¬ ì²˜ë¦¬ë‹¤ë§Œ í•´ë‹¹ ì‹¤í–‰ ì‹œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ëŠ”ë° ê´€ë ¨ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.root@:~/buildroot$ make -j&lt;cpu ìˆ˜&gt;Your PATH contains spaces, TABs, and/or newline (\\n) characters.This doesn't work. Fix you PATH.make: *** [support/dependencies/dependencies.mk:27: dependencies] Error 1ì´ ì—ëŸ¬ ë©”ì‹œì§€ëŠ” Linux ì‹œìŠ¤í…œì˜ PATH í™˜ê²½ ë³€ìˆ˜ì— ê³µë°±, íƒ­(TABs), ë˜ëŠ” ì¤„ë°”ê¿ˆ ë¬¸ì(newline, \\n)ê°€ í¬í•¨ë˜ì–´ ìˆì–´ì„œ ë°œìƒí•œ ê²ƒì´ë‹¤. makeì™€ ê°™ì€ ë¹Œë“œ ì‹œìŠ¤í…œì—ì„œëŠ” PATH í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ í•„ìš”í•œ ì‹¤í–‰ íŒŒì¼ë“¤ì„ ì°¾ëŠ”ë‹¤. ë§Œì•½ PATHì— ì´ëŸ¬í•œ íŠ¹ìˆ˜ ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆë‹¤ë©´, ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ê°€ ì œëŒ€ë¡œ ì‹¤í–‰ íŒŒì¼ë“¤ì„ ì°¾ì§€ ëª»í•˜ê²Œ ë˜ì–´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.root@:~/buildroot$ echo $PATHì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ PATHì— ì„¤ì •ëœ ë””ë ‰í† ë¦¬ë“¤ì´ ì½œë¡ (:)ìœ¼ë¡œ êµ¬ë¶„ë˜ì–´ ì¶œë ¥ëœë‹¤. ì—¬ê¸°ì„œ ê³µë°±, íƒ­, ë˜ëŠ” ì¤„ë°”ê¿ˆ ë¬¸ìê°€ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ë‹ˆ ëª‡ êµ°ë° ê³µë°±ì´ í™•ì¸ ë˜ì—ˆë‹¤. ë”°ë¼ì„œ, PATHì—ì„œ ë¬¸ì œê°€ ë˜ëŠ” ë¬¸ìë¥¼ ì•„ë˜ì™€ ê°™ì´ ì œê±°í•¨.root@:~/buildroot$ export PATH=$(echo $PATH | tr -d ' \\t\\n')echo $PATH ë¡œ ì œê±°ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œ ì´í›„, ë‹¤ì‹œ make ì‹¤í–‰ì— unzip ì´ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šë‹¤ê³  ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬ ì´ë¥¼ ì„¤ì¹˜í•˜ì˜€ë‹¤.root@:~/buildroot$ sudo apt-get updateroot@:~/buildroot$ sudo apt-get install unzip1.4 buildroot ì„¤ì¹˜ê·¸ë¦¬ê³  ìµœì¢…ì ìœ¼ë¡œ make ë¥¼ ì‹¤í–‰í•˜ì—¬ ì„¤ì¹˜í•¨ (20 ì—¬ë¶„ ì†Œìš”)í•´ë‹¹ ì‘ì—…ì„ í†µí•´ Buildroot ëŠ” ìœ„ ì„¤ì •ì— ë”°ë¼ ë‹¤ìŒì˜ ì£¼ìš” ì‘ì—…ì„ ì§„í–‰, embedded system S/W stackt ì„ ë¹Œë“œ í•œë‹¤. êµ¬ì„± ê²€ì¦: BuildrootëŠ” .config íŒŒì¼ì´ë‚˜ ë‹¤ë¥¸ êµ¬ì„± íŒŒì¼ì— ì •ì˜ëœ ì„¤ì •ì„ ê²€ì¦í•œë‹¤. ì´ ì„¤ì •ì€ make menuconfig, make xconfig ë˜ëŠ” make nconfigì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‚¬ì „ì— ì‚¬ìš©ìì— ì˜í•´ ì •ì˜ ê²ƒë“¤ ì´ë‹¤.. íˆ´ì²´ì¸(Toolchain) ë¹Œë“œ ë˜ëŠ” ë‹¤ìš´ë¡œë“œ: íˆ´ì²´ì¸ì€ ì»´íŒŒì¼ëŸ¬, ë§ì»¤, ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“± ì„ë² ë””ë“œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì»´íŒŒì¼í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë„êµ¬ë“¤ì˜ ì§‘í•©ì´ë‹¤. BuildrootëŠ” ì„ íƒëœ ì„¤ì •ì— ë”°ë¼ ì ì ˆí•œ íˆ´ì²´ì¸ì„ ë¹Œë“œí•˜ê±°ë‚˜ ì‚¬ì „ì— ë¹Œë“œëœ íˆ´ì²´ì¸ì„ ë‹¤ìš´ë¡œë“œí•œë‹¤. ë‹¤ë§Œ í˜„ì¬ì˜ ì„¤ì •ì—ì„œ toolchain ë¹Œë“œëŠ” ë”°ë¡œ ì§„í–‰ëœë‹¤. ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ë¹Œë“œ: ì‚¬ìš©ìê°€ ì§€ì •í•œ ë²„ì „ì˜ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì„ ë‹¤ìš´ë¡œë“œí•˜ê³ , í•„ìš”í•œ íŒ¨ì¹˜ë¥¼ ì ìš©í•œ í›„ ì»¤ë„ì„ í¬ë¡œìŠ¤ ì»´íŒŒì¼í•œë‹¤. ì—­ì‹œ í˜„ì¬ì˜ ì„¤ì •ì—ì„œ ì»¤ë„ ë¹Œë“œëŠ” ë”°ë¡œ ì§„í–‰ëœë‹¤. ë£¨íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œ(Root Filesystem) êµ¬ì„±: BuildrootëŠ” ì‚¬ìš©ìê°€ ì„ íƒí•œ ëª¨ë“  ì†Œí”„íŠ¸ì›¨ì–´ íŒ¨í‚¤ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³ , ì´ë“¤ì„ í¬ë¡œìŠ¤ ì»´íŒŒì¼í•˜ì—¬ ë£¨íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì„ êµ¬ì„±. ì´ ê³¼ì •ì—ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬, ì‹œìŠ¤í…œ ìœ í‹¸ë¦¬í‹°, ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ì´ í¬í•¨ëœë‹¤. ë¶€íŠ¸ë¡œë”(Bootloader) ë¹Œë“œ: í•„ìš”í•œ ê²½ìš°, ì„ íƒëœ ë¶€íŠ¸ë¡œë”(ì˜ˆ: U-Boot)ë¥¼ ë¹Œë“œ. ì´ë¯¸ì§€ ìƒì„±: ëª¨ë“  ë¹Œë“œ ê³¼ì •ì´ ì™„ë£Œë˜ë©´, BuildrootëŠ” ì´ë“¤ì„ í†µí•©í•˜ì—¬ ì„ë² ë””ë“œ ì‹œìŠ¤í…œì„ ìœ„í•œ ìµœì¢… ì´ë¯¸ì§€(ì˜ˆ: SD ì¹´ë“œ ì´ë¯¸ì§€, NAND í”Œë˜ì‹œ ì´ë¯¸ì§€)ë¥¼ ìƒì„±í•œë‹¤. ì´ ì´ë¯¸ì§€ëŠ” ì‹¤ì œ í•˜ë“œì›¨ì–´ì—ì„œ ì§ì ‘ ë¶€íŒ…í•  ìˆ˜ ìˆë‹¤. 3 ë²ˆê³¼ ë§ˆì°¬ê°€ì§€ë¡œ í˜„ì¬ ì„¤ì •ì—ì„œ í•´ë‹¹ ê³¼ì •ì€ ë³„ë„ë¡œ ì»¤ë„ ë¹Œë“œ ë•Œ ì§„í–‰ëœë‹¤. 2. Kernel Build ë‹¤ìš´ë¡œë“œ ë° ì´ë¯¸ì§€ ìƒì„±2.1 kernel download (https://kernel.org/)í•´ë‹¹ ì‚¬ì´íŠ¸ git ì£¼ì†Œ -&gt; â€œstable/linuxâ€ ê²€ìƒ‰ í•´ì„œ ë‚˜ì˜¨ kernel/git/stable/linux.git ê²½ë¡œë¥¼ git clone í•˜ì—¬ ë‹¤ìš´ ë°›ìŒ.root@:~/buildroot$ cd ..root@:~$ git clone https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/-&gt; linux ë””ë ‰í† ë¦¬ì— í•´ë‹¹ repository íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ2.2 kernel build ì— í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜root@:~$ sudo apt-get install bison flex libelf-dev libssl-dev(ê° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“¤ì˜ ê¸°ëŠ¥ì— ëŒ€í•œ ì´í•´ëŠ” ë¶€ì¡±í•œ ìƒíƒœì„. ì¶”ê°€í•™ìŠµ í•„ìš”) Bison ìš©ë„: bisonì€ GNU í”„ë¡œì íŠ¸ì˜ êµ¬ë¬¸ ë¶„ì„ê¸° ìƒì„±ê¸°ë¡œ, ì»¤ë„ ì†ŒìŠ¤ ì½”ë“œ ë‚´ì˜ êµ¬ë¬¸ì„ ë¶„ì„í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤. ì»¤ë„ ë¹Œë“œ ê³¼ì •ì—ì„œëŠ” íŠ¹íˆ ì»¤ë„ì˜ êµ¬ì„± ì„¤ì • ë„êµ¬ì¸ kconfigì— ì˜í•´ ì‚¬ìš©ë¨. Flex ìš©ë„: flexëŠ” í…ìŠ¤íŠ¸ ìŠ¤ìº”ì„ ìœ„í•œ íŒ¨í„´ ë§¤ì¹­ì„ ìˆ˜í–‰í•˜ëŠ” ë ‰ì„œ(lexer) ë˜ëŠ” ìŠ¤ìºë„ˆ(scanner) ìƒì„±ê¸°. lexì˜ GNU ë²„ì „ìœ¼ë¡œ, í…ìŠ¤íŠ¸ ì…ë ¥ ìŠ¤íŠ¸ë¦¼ì—ì„œ íŒ¨í„´ì„ ì¸ì‹í•˜ê³  ì²˜ë¦¬í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ìƒì„±í•œë‹¤. bisonê³¼ í•¨ê»˜ kconfigì— ì˜í•´ ì‚¬ìš©ë˜ë©°, ì»¤ë„ì˜ ì„¤ì • ì˜µì…˜ì„ í•´ì„í•˜ê³  ì²˜ë¦¬í•˜ëŠ” ë° í•„ìš”. libelf-dev ìš©ë„: libelf-devëŠ” ELF(Executable and Linkable Format) (ì°¸ê³  ìë£Œ : ELF ë€?) íŒŒì¼ì„ ë‹¤ë£¨ê¸° ìœ„í•œ ê°œë°œ ë¼ì´ë¸ŒëŸ¬ë¦¬. ELF íŒŒì¼ í¬ë§·ì€ ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì—ì„œ ì‹¤í–‰ íŒŒì¼, ì˜¤ë¸Œì íŠ¸ ì½”ë“œ, ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬, ì½”ì–´ ë¤í”„ ë“±ì„ ìœ„í•´ ì‚¬ìš©. ì»¤ë„ ëª¨ë“ˆê³¼ ê°™ì€ ELF í˜•ì‹ì˜ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ ìƒì„±í•˜ê³  ì¡°ì‘í•˜ëŠ” ë° ì‚¬ìš©ë˜ë¯€ë¡œ ì»¤ë„ ëª¨ë“ˆì„ ë¹Œë“œí•˜ê³  ë¶„ì„í•˜ëŠ” ë° í•„ìˆ˜ì . libssl-dev ìš©ë„: libssl-devëŠ” OpenSSL ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê°œë°œ ë²„ì „ íŒ¨í‚¤ì§€. OpenSSLì€ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ëŒ€í•œ ì•”í˜¸í™” í†µì‹ ì„ ì œê³µí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, SSL(Secure Sockets Layer)ê³¼ TLS(Transport Layer Security) í”„ë¡œí† ì½œì„ êµ¬í˜„í•œë‹¤. ì»¤ë„ì—ì„œëŠ” ì˜ˆë¥¼ ë“¤ì–´, ë³´ì•ˆ í†µì‹ ì´ í•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ê¸°ëŠ¥ì„ ê°œë°œí•  ë•Œ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤.2.3 buildroot ì— ìˆëŠ” config ë³µì‚¬ ë° .config íŒŒì¼ ìƒì„±root@:~/linux$ cp ../buildroot/board/qemu/aarch64-virt/linux.config arch/arm64/configs/qemu_defconfigroot@:~/linux$ ARCH=arm64 make qemu_defconfig # ë°˜í™˜ê°’ìœ¼ë¡œ .config ìƒì„±2.4 kernel build ë¥¼ ìœ„í•œ toolchain download (https://developer.arm.com/)-&gt; Tools and Software -&gt; Compilers and Libraries -&gt; Arm GNU toolchain -&gt; GNU Toolchain releases for A-profile processors -&gt; GNU-A Downloads (https://developer.arm.com/downloads/-/gnu-a) -&gt; AArch64 GNU/Linux target (aarch64-none-linux-gnu) (gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu.tar.xz) ë‹¤ìš´ë¡œë“œ(í•´ë‹¹ ì‘ì—…ì„ wsl2 ë¡œ ì„¤ì¹˜í•œ ubuntu ë¡œ ì§„í–‰í•˜ëŠ” ê²½ìš° ë‹¤ìš´ë¡œë“œ íŒŒì¼ì€ windows file system) ë‚´ë¶€ë¡œ ë“¤ì–´ì˜¤ê²Œ ëœë‹¤. ì´ê²ƒì„ linux ë¡œ ë³µì‚¬í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë³µì‚¬ ë° ì••í’€ í•´ì œë¥¼ ì§„í–‰í•œë‹¤.root@:~/linux$ cd ..root@:~$ cp /mnt/c/Users/&lt;ì‚¬ìš©ì ì´ë¦„&gt;/Downloads/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu.tar.xz .ë˜ëŠ”root@:~$ wget https://developer.arm.com/-/media/Files/downloads/gnu-a/10.3-2021.07/binrel/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu.tar.xz2.5 toolchain ì••ì¶• í’€ê¸°root@:~$ tar xvf gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu.tar.xz2.6 build ì§„í–‰ (ì´ë¯¸ì§€ ìƒì„±)root@:~$ cd linuxroot@:~/linux$ ARCH=arm64 CROSS_COMPILE=/home/gon/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu- make -j16build ê°€ ì™„ë£Œë˜ë©´ ìœ„ì™€ ê°™ì´ vmlinux ë¥¼ ìƒì„±í•˜ê³  ì´ê²ƒì„ ê°€ì§€ê³  arch/arm64/boot/Image ê°€ ìƒì„±ëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.3. buildroot ì´ë¯¸ì§€ ì‹¤í–‰3.1 QEMU ì„¤ì¹˜root@:~$ sudo apt install qemu-system-arm3.2 ì´ë¯¸ì§€ ì‹¤í–‰root@:~$ qemu-system-aarch64 \\ -kernel linux/arch/arm64/boot/Image \\ -drive format=raw,file=buildroot/output/images/rootfs.ext4,if=virtio \\ -append \"root=/dev/vda console=ttyAMA0 nokaslr\" \\ -nographic -M virt -cpu cortex-a72 \\ -m 2G \\ -smp 23.3 ì´ë¯¸ì§€ ì¢…ë£Œí„°ë¯¸ë„ ì°½ì„ ë³„ë„ë¡œ ì—´ì–´ì„œ kill ëª…ë ¹ì–´ë¡œ ì¢…ë£Œkill -9 qemu-system-aarch64ë˜ëŠ” qemu ë‚´ì—ì„œ shutdown ëª…ë ¹ì–´ë¡œ ì¢…ë£Œshutdown -h now"
    } ,
  
    {
      "title"       : "Makefile ê¸°ë³¸ ë¬¸ë²• 01",
      "category"    : "",
      "tags"        : "linux, bash, makefile, incremental build, suffix rule",
      "url"         : "./makfile01.html",
      "date"        : "2024-02-21 14:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 05",
      "content"     : "Makefile ë³€ìˆ˜ (macro) ì‚¬ìš©ì˜ì¡´ì„± ë¶€ë¶„ì€ ì¼ë°˜ì ìœ¼ë¡œ ë§¤í¬ë¡œë¡œ ì„ ì–¸í•˜ì—¬ ì‚¬ìš©í•¨.ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•˜ì—¬ ê°’ì„ í• ë‹¹í•  ë•Œ, ì—¬ëŸ¬ê°€ì§€ í• ë‹¹ ë°©ë²•ì´ ì¡´ì¬= (Recursive Assignment)= ì—°ì‚°ìëŠ” ì¬ê·€ì  í• ë‹¹ì„ ìˆ˜í–‰í•œë‹¤. ì´ëŠ” ë§¤í¬ë¡œê°€ ì‚¬ìš©ë  ë•Œë§ˆë‹¤ í‰ê°€ë˜ì–´ í™•ì¥ëœë‹¤. ë§¤í¬ë¡œì˜ ê°’ì´ ë‹¤ë¥¸ ë§¤í¬ë¡œë¥¼ ì°¸ì¡°í•˜ëŠ” ê²½ìš°, ì°¸ì¡°ëœ ë³€ìˆ˜ì˜ ìµœì¢…ê°’ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤.FOO = ${BAR}BAR = bar_valueall: @echo $(FOO)í•´ë‹¹ Makefile ì„ ì‹¤í–‰í•˜ë©´ FOO ë§¤í¬ë¡œëŠ” BARì˜ ê°’ì„ ì°¸ì¡°í•œë‹¤. ë”°ë¼ì„œ ì‹¤í–‰ë  ë•Œ, BAR ì˜ ê°’ì€ bar_value ì´ë¯€ë¡œ bar_value ê°€ ì¶œë ¥ëœë‹¤.:= (Simle Assignment):= ì—°ì‚°ìë¥¼ ì‚¬ìš©í•œ ë‹¨ìˆœí• ë‹¹ì˜ ê²½ìš°, ë§¤í¬ë¡œì— ê°’ì´ í• ë‹¹ë  ë•Œ ì‹œì ì˜ ê°’ìœ¼ë¡œ ë°”ë¡œ í‰ê°€, í™•ì¥ëœë‹¤. ë”°ë¼ì„œ ì´í›„ ì°¸ì¡°í•˜ê³  ìˆëŠ” ë§¤í¬ë¡œì˜ ê°’ì´ ë³€ê²½ë˜ë”ë¼ë„, ìµœì´ˆì— í• ë‹¹ëœ ê°’ì„ ìœ ì§€í•œë‹¤.BAR = bar_valueFOO := $(BAR)BAR = new_valueall: @echo $(FOO)ì´ ê²½ìš°, FOO ëŠ” BAR ì˜ í˜„ì¬ê°’ì¸ bar_value ë¡œ ì´ˆê¸°í™” ë˜ê³ , ì´í›„ BAR ì˜ ê°’ì´ ë³€ê²½ë˜ë”ë¼ë„ FOO ì˜ ê°’ì€ ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ í•´ë‹¹ Makefile ì„ ì‹¤í–‰í•˜ë©´ ì¶œë ¥ê°’ì€ bar_value ê°€ ëœë‹¤.+= (Append)ê¸°ì¡´ ë³€ìˆ˜ì˜ ê°’ì— ê°’ì„ ì¶”ê°€í•¨. ë§Œì•½ ë§¤í¬ë¡œê°€ ì •ì˜ë˜ì–´ ìˆì§€ ì•Šì•˜ì—ˆë‹¤ë©´ í•´ë‹¹ ë§¤í¬ë¡œë¥¼ ìƒì„±í•œë‹¤.CFLAGS := -WallCFLAGS += -g # CFLAGSëŠ” ì´ì œ \"-Wall -g\"?= (Conditional Assignment)ë§¤í¬ë¡œê°€ ì•„ì§ ê°’ì´ í• ë‹¹ë˜ì–´ ìˆì§€ ì•Šì„ ê²½ìš°ì—ë§Œ ê°’ì„ í• ë‹¹. ì´ë¯¸ ê°’ì´ ìˆìœ¼ë©´ í• ë‹¹í•˜ì§€ ì•ŠìŒ.CC ?= gcc # CCê°€ ì´ì „ì— ì •ì˜ë˜ì§€ ì•Šì•˜ë‹¤ë©´ gccë¥¼ ì‚¬ìš©$@ (Target Name)$@ : í˜„ì¬ target ì˜ ì´ë¦„ì„ ëª…ì‹œall: programprogram: program.o gcc -o $@ $^ì´ ê²½ìš° program: program.o ì—ì„œ program ì´ í˜„ì¬ target ì´ë‹¤. ë”°ë¼ì„œ $@ ëŠ” program ìœ¼ë¡œ ëŒ€ì²´ ëœë‹¤.$&lt; (First Dependency)$&lt; ëŠ” ê·œì¹˜ì˜ ì²« ë²ˆì§¸ ì˜ì¡´ì„±ì„ ë‚˜íƒ€ëƒ„.program.o: program.c gcc -c $&lt; -o $@ì—¬ê¸°ì„œ $&lt; ëŠ” program.c ì„ ì˜ë¯¸í•˜ë¯€ë¡œ gcc -c $&lt; -o $@ ëŠ” gcc -c program.c -o program.o ë¥¼ ì˜ë¯¸í•œë‹¤.$^ (All Dependencies)í˜„ì¬ ê·œì¹™ì˜ ëª¨ë“  ì˜ì¡´ì„± ëª©ë¡ì„ ë‚˜íƒ€ë‚¸ë‹¤. ì¤‘ë³µëœ ì˜ì¡´ì„±ì€ ì œê±°ëœë‹¤.program: main.o lib.o util.o gcc -o $@ $^ì—¬ê¸°ì„œ $^ ëŠ” main.o lib.o util.o ì„ ì˜ë¯¸í•˜ë¯€ë¡œ gcc -o $@ $^ ëŠ” gcc -o program main.o lib.o util.o ë¥¼ ì˜ë¯¸í•œë‹¤.í™•ì¥ì ë£° (sffix rule) ê³¼ íŒ¨í„´ ê·œì¹™(pattern rule)Makefile ì˜ í™•ì¥ì ë£°ì€ ì˜¤ë˜ëœ ê·œì¹™ìœ¼ë¡œ, íŒŒì¼ ë³€í™˜ ê·œì¹™ì„ ì •ì˜í•˜ëŠ”ë° ì‚¬ìš©ë¨. ì£¼ë¡œ í•œ ì¢…ë¥˜ì˜ íŒŒì¼ì„ ë‹¤ë¥¸ ì¢…ë¥˜ë¡œ ë³€í™˜í•˜ëŠ”ë° ì‚¬ìš©ë˜ë©°, í™•ì¥ìë§Œìœ¼ë¡œ ì´ ë³€í™˜ ê³¼ì •ì„ ì‹ë³„í•œë‹¤. .SUFFIXES ë¦¬ìŠ¤íŠ¸ì— ì •ì˜ëœ í™•ì¥ìë“¤ì„ ì‚¬ìš©í•˜ì—¬, ì†ŒìŠ¤íŒŒì¼ì—ì„œ ëª©ì íŒŒì¼ë¡œ ë³€í™˜ì— ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤..SUFFIXES: .c .o.c.o: gcc -c $&lt; -o $@.c.o: ì€ .c íŒŒì¼ì„ .o íŒŒì¼ë¡œ ë³€í™˜í•˜ëŠ” ê·œì¹™ì„ ì •ì˜í•œ target ì´ë‹¤. ë”°ë¼ì„œ gcc -c $&lt; -o $@ ì€ ì²«ë²ˆì§¸ ì˜ì¡´ì„± .c íŒŒì¼ì„ ë™ì¼ íŒŒì¼ ì´ë¦„ì˜ .o íŒŒì¼ë¡œ compile í•˜ë¼ëŠ” ì˜ë¯¸ ì´ë‹¤. ê·¸ëŸ¬ë‚˜ í˜„ëŒ€ì˜ Makefile ì‘ì„±ì—ì„œëŠ” íŒ¨í„´ ê·œì¹™ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ê¶Œì¥ëœë‹¤. í™•ì¥ì ê·œì¹™ì€ ìœ ì—°ì„±ê³¼ ëª…í™•ì„±ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìœ¼ë©°, GNU Makeì™€ ê°™ì€ ìµœì‹  ë„êµ¬ì—ì„œëŠ” ë³´ë‹¤ ê°•ë ¥í•˜ê³  ìœ ì—°í•œ íŒ¨í„´ ê·œì¹™ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. íŒ¨í„´ ê·œì¹™ì€ íŠ¹ì • íŒŒì¼ ì„¸íŠ¸ì— ëŒ€í•´ ì ìš©í•  ìˆ˜ ìˆëŠ” ê·œì¹™ì„ ì •ì˜í•  ë•Œ % ì™€ì¼ë“œì¹´ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë³´ë‹¤ ì¼ë°˜ì ì¸ ê·œì¹™ì„ ì‘ì„±í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.%.o: %.c gcc -c $&lt; -o $@ì´ëŠ” ì•ì˜ í™•ì¥ì ë£°ê³¼ ë™ì¼í•œ ëª…ë ¹ì„ ìˆ˜í–‰í•˜ë©°, ì¢€ë” ëª…í™•í•˜ê³  ê°„ê²°í•˜ê²Œ í‘œí˜„ëœë‹¤.ê·¸ëŸ¬ë‚˜ ê²°ë¡ ì ìœ¼ë¡œ ë™ì¼í•œ íŒŒì¼ëª…ì˜ ì†ŒìŠ¤íŒŒì¼ì—ì„œ ëª©ì  íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ë£°ì€ Makefile ì— ê¸°ë³¸ìœ¼ë¡œ ë‚´ì¥ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš©ìê°€ ì •ì˜í•˜ëŠ” Makefile ì—ì„œëŠ” í•´ë‹¹ ë‚´ìš©ì„ ìƒëµí•´ë„ ì‹¤í–‰ëœë‹¤.executable: distance.o main.o ld -o executable *.o /usr/lib/x86_64-linux-gnu/crt1.o -lm -lc -dynamic-linker=/lib64/ld-linux-x86-64.so.2distance.o : distance.c gcc -c -o distance.o distance.cmain.o : main.c gcc -c -o main.o main.cìœ„ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ì´ ëª…ì‹œì ìœ¼ë¡œ ì‘ì„±í•˜ì§€ ì•Šì•„ë„,executable: distance.o main.o ld -o executable *.o /usr/lib/x86_64-linux-gnu/crt1.o -lm -lc -dynamic-linker=/lib64/ld-linux-x86-64.so.2ìµœì¢… ì‹¤í–‰ íŒŒì¼ ìƒì„±ë§Œ êµ¬í˜„í•˜ê³  makeë¥¼ ì‹¤í–‰í•´ë„ ì´ì „ê³¼ ë™ì¼í•˜ê²Œ ê° ì†ŒìŠ¤ì½”ë“œì—ì„œ ëª©ì íŒŒì¼ì´ ìƒì„±ë˜ê³  ìµœì¢…ì ìœ¼ë¡œ ì‹¤í–‰íŒŒì¼ì´ ìƒì„±ëœë‹¤. ë˜í•œ ì ì§„ì  ë¹Œë“œ (Incremental build) ë„ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•œë‹¤.buildroot_download:"
    } ,
  
    {
      "title"       : "Shell Script ì‚¬ìš©í•œ ì‹œìŠ¤í…œ êµ¬ì¶• 01 (ì‚¬ìš©ì ê³„ì • ìƒì„±)",
      "category"    : "",
      "tags"        : "linux, bash, shell scirpt",
      "url"         : "./shell-script04-systemsetting01-copy.html",
      "date"        : "2024-02-20 14:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 04",
      "content"     : "ì°¸ê³  ìë£Œ : ì²˜ìŒ ë°°ìš°ëŠ” ì…¸ ìŠ¤í¬ë¦½íŠ¸ 8ì¥ ì‹œìŠ¤í…œ êµ¬ì¶•shell script ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ê°œì •ì„ ìƒì„±í•˜ëŠ” íŒŒì¼ì„ ì‘ì„± ë° ì‹¤í–‰í”„ë¡œì„¸ìŠ¤ ì‚¬ìš©ì ê³„ì •ê³¼ íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥ ì…ë ¥ ì •ë³´ê°€ ì—†ìœ¼ë©´ ì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ ë³´ì—¬ì£¼ê³ , script ì¢…ë£Œ ì—¬ëŸ¬ëª…ì˜ ì‚¬ìš©ì ê³„ì •ì„ ìƒì„±í•  ê²½ìš° ë°˜ë³µë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ìˆœíšŒ ê° ê³„ì •ì´ ì´ë¯¸ ì‚¬ìš©ì ê³„ì •ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ í¬í•¨ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´, ê³„ì •ì„ ìƒì„±í•˜ê³  íŒ¨ìŠ¤ì›Œë“œ ì„¤ì • ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê³„ì •ì´ë¼ë©´, ì´ë¥¼ ë©”ì„¸ì§€ë¡œ ë³´ì—¬ì¤Œ.1. ë‹¤ìˆ˜ì˜ ì‚¬ìš©ì ê³„ì • ìƒì„±(1) if [[ -n $1 ]] &amp;&amp; [[ -n $2 ]]í•´ë‹¹ script ì‹¤í–‰ì‹œ ë§¤ê°œ ë³€ìˆ˜ë¡œ ì‚¬ìš©ì ê³„ì •($1)ê³¼ íŒ¨ìŠ¤ì›Œë“œ($2)ê°€ ëª¨ë‘ ì…ë ¥ ë˜ì—ˆëŠ”ì§€ í™•ì¸(-n : ë¹„ì›Œìˆì§€ ì•Šì•„ì•¼ í•¨) í•œë‹¤. $1 ê³¼ $2 ëª¨ë‘ ì™¸ë¶€ ì…ë ¥ê°’ì´ë¯€ë¡œ ì´ì¤‘ ì¤‘ê´„í˜¸ [[]] ë¥¼ ì‚¬ìš©í•œë‹¤.(2) IFS=' ' read -r -a UserList &lt;&lt;&lt; \"$1\" ì…ë ¥ëœ ë§¤ê°œë³€ìˆ˜ ê°’ì„ ê³µë°±ì„ ê¸°ì¤€ìœ¼ë¡œ ê°’ì„ slice í•˜ì—¬ ë°°ì—´ì˜ í˜•íƒœë¡œ shell script ë³€ìˆ˜ë¡œ ì €ì¥í•¨. IFS (Internal Field Separator) : IFS ëŠ” shell scirpt ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë‚´ë¶€ í•„ë“œ êµ¬ë¶„ì. ì´ ë³€ìˆ˜ëŠ” ë¬¸ìì—´ì„ ë¶„ë¦¬í•˜ì—¬ ë°°ì—´ì´ë‚˜ ê°œë³„ ë³€ìˆ˜ë¡œ ì½ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” êµ¬ë¶„ìì„ ì •ì˜í•œë‹¤. ê¸°ë³¸ê°’ì€ ê³µë°±, íƒ­, ê°œí–‰ ë¬¸ì. read : í‘œì¤€ ì…ë ¥ì´ë‚˜ íŒŒì¼ë¡œë¶€í„° ì…ë ¥ì„ ì½ì–´ë“œë¦¼. ì´ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ì— ê°’ì„ í• ë‹¹í•  ìˆ˜ ìˆë‹¤. -r : read ì˜µì…˜ ì¤‘ ë°±ìŠ¬ë˜ì‹œ(\\) ê°€ ì´ìŠ¤ì¼€ì´í”„ ë¬¸ìë¡œ ì²˜ë¦¬ë˜ì§€ ì•Šê³ , ê·¸ëŒ€ë¡œ ì½ì–´ë“œë¦¼. -a : read ëª…ë ¹ì–´ì— ì˜íˆ ì½íŒ ê°’ì„ ë°°ì—´ë¡œ ì €ì¥. &lt;&lt;&lt; (Here String) : â€œ$1â€ ë¡œ ë°›ì€ ì™¸ë¶€ ì…ë ¥ ê°’ì„ UserList ë³€ìˆ˜ ê°’ìœ¼ë¡œ ì·¨í•  ìˆ˜ ìˆë„ë¡ redirection í•´ì¤Œ. (3) for (( i=0 ; i &lt; ${#UserList[@]}; i++ )) ë°°ì—´ UserList ì˜ ê¸¸ì´ë§Œí¼ ë°˜ë³µí•  ìˆ˜ ìˆë„ë¡ ì„¤ì •(4) if [[ $(cat /etc/passwd | grep -w ${UserList[$i]} | wc -l) == 0 ]] $(cat /etc/passwd íŒŒì¼ì˜ ë‚´ìš©ì„ ê°€ì ¸ì™€ì„œ, UserList[$i] ì˜ ê°’ê³¼ ì •í™•íˆ (-w)ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ì ê³„ì •ì„ ì°¾ê³ , wc (word count) ì˜ ë¼ì¸ ìˆ˜(-l) ì„ ì¶œë ¥, í•´ë‹¹ ê°’ì´ 0 ì•„ë‹ˆë¼ë©´, ë™ì¼ ê³„ì •ì´ ì¡´ì¬í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•¨.(5) useradd ${UserList[$i]} ê¸°ì¡´ ê³„ì •ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°, í•´ë‹¹ ê°’ ${UserList{$i}} ì˜ ê³„ì •ì„ ìƒì„±í•¨. (6) echo \"${UserList[$i]}:${Password[$i]}\" | chpasswd ìƒˆë¡œ ìƒì„±í•œ ê³„ì •ì— ëŒ€í•œ íŒ¨ìŠ¤ì›Œë“œ ê°’ì„ ì‚¬ìš©í•˜ì—¬ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì„¤ì •#!/bin/bash# ì‚¬ìš©ì ê³„ì • ë° íŒ¨ìŠ¤ì›Œë“œê°€ ì…ë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸if [[ -n $1 ]] &amp;&amp; [[ -n $2 ]] # (1)then IFS=' ' read -r -a UserList &lt;&lt;&lt; \"$1\" # (2) IFS=' ' read -r -a Password &lt;&lt;&lt; \"$2\" # for ë¬¸ì„ ì´ìš©í•˜ì—¬ ì‚¬ìš©ì ê³„ì • ìƒì„± for (( i=0 ; i &lt; ${#UserList[@]}; i++ )) # (3) do # ifë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ê³„ì •ì´ ìˆëŠ”ì§€ í™•ì¸ if [[ $(cat /etc/passwd | grep -w ${UserList[$i]} | wc -l) == 0 ]] # (4) then # ì‚¬ìš©ì ìƒì„± ë° íŒ¨ìŠ¤ì›Œë“œ ì„¤ì • useradd ${UserList[$i]} # (5) echo \"${UserList[$i]}:${Password[$i]}\" | chpasswd # (6) else # ì‚¬ìš©ìê°€ ìˆë‹¤ê³  ë©”ì„¸ì§€ë¥¼ ë³´ì—¬ì¤Œ echo \"this user ${UserList[$i]} is existing.\" fi doneelse # ì‚¬ìš©ìê°€ ê³„ì •ê³¼ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ë¼ëŠ” ë©”ì„¸ì§€ë¥¼ ë³´ì—¬ì¤Œ echo -e 'Please input user id and password. \\nUsage: adduser-script.sh \"user01 user02\" \"pw01 pw02\"'fií•´ë‹¹ script ë¥¼ adduser-script.sh ì— ì €ì¥í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì‹¤í–‰gon@DESKTOP:~/book/ch08$ sudo bash adduser-script.sh \"user1 user2\" \"1111 2222\"ì—¬ê¸°ì—ì„œ sh ê°€ ì•„ë‹Œ bash ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ”, ì¼ë¶€ ë¦¬ëˆ…ìŠ¤ (ex. Ubuntu) shell ì´ bash ê°€ ì•„ë‹Œ dash ì—ì„œ ì‹¤í–‰ë˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ì´ëŸ° ê²½ìš°, dash ì—ì„œ ì§€ì›ë˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ (ex. redirection &lt;&lt;&lt;)ì„ shell script ë‚´ ì‚¬ìš©í•œ ê²½ìš°, ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.gon@DESKTOP:~/book/ch08$ sudo sh adduser-script.sh \"user1 user2\" \"1111 2222\"adduser-script.sh: 7: Syntax error: redirection unexpectedì´ë¥¼ í•´ê²°í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ, í•´ë‹¹ íŒŒì¼ì˜ ì‹¤í–‰ ê¶Œí•œì„ ì•„ì˜ˆ ë³€ê²½í•˜ê³ , ì§ì ‘ ì‹¤í–‰ ì‹œí‚¤ë©´ ëœë‹¤.gon@DESKTOP:~/book/ch08$ chmod +x adduser-script.shgon@DESKTOP:~/book/ch08$ ./adduser-script.sh \"user1 user2\" \"1111 2222\"ìµœì¢…ì ìœ¼ë¡œ, í•´ë‹¹ ì‹¤í–‰ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í–ˆëŠ”ì§€ë¥¼ ìœ„í•´ /etc/passwd íŒŒì¼ ë‚´ìš©ì„ í™•ì¸í•˜ë©´ ì•„ë˜ í•´ë‹¹ user ê°€ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.gon@DESKTOP:~/book/ch08$ cat /etc/passwd...user1:x:1001:1001::/home/user1:/bin/shuser2:x:1002:1002::/home/user2:/bin/sh2. ssh ë¥¼ í™œìš©í•˜ì—¬ ë‹¤ë¥¸ ì„œë²„ì— ì‚¬ìš©ì ê³„ì • ìƒì„±#!/bin/bashfor server in \"host01 host02 host03\"do # ì—¬ëŸ¬ ëŒ€ì˜ ì‹œìŠ¤í…œì— ì‚¬ìš©ì ìƒì„± ë° íŒ¨ìŠ¤ì›Œë“œ ì„¤ì • echo $server ssh root@$server \"useradd $1\" # (1) ssh root@$server \"echo $2:$1 | chpasswd\" done(1) ssh root@$server \"useradd $1\" ssh : SSH protocol ì„ ì‚¬ìš©í•˜ì—¬ ì›ê²© ì„œë²„ì— ì ‘ì†í•˜ê°€ë‚˜ ì›ê²© ì„œë²„ì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ client í”„ë¡œê·¸ë¨ root@$server : ì‚¬ìš©ìëª…@í˜¸ìŠ¤íŠ¸ëª… í˜•ì‹ìœ¼ë¡œ ì ‘ì†í•  ì›ê²© ì„œë²„ì˜ ìµœê³  ê´€ë¦¬ì ê³„ì •ì„ ì˜ë¯¸ \"useradd $1\" : ssh root ê³„ì •ìœ¼ë¡œ í•´ë‹¹ host ì— ì ‘ì†í•˜ì—¬ ì‚¬ìš©ì ê³„ì • ì¶”ê°€ë¥¼ ì‹¤í–‰"
    } ,
  
    {
      "title"       : "Shell Script ê¸°ë³¸ ë¬¸ë²• 03 (í°ë”°ì˜´í‘œ ì‘ì€ ë”°ìŒí‘œ)",
      "category"    : "",
      "tags"        : "linux, bash, shell scirpt, quates",
      "url"         : "./shell-script03-quates.html",
      "date"        : "2024-02-10 12:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 03",
      "content"     : "Bash ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í°ë”°ì˜´í‘œ(â€œâ€œ)ì™€ ì‘ì€ë”°ì˜´í‘œ(â€˜â€˜)ëŠ” ë¬¸ìì—´ì„ ë¬¶ëŠ” ë° ì‚¬ìš©ë˜ì§€ë§Œ, ê·¸ë“¤ì´ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì—ëŠ” ì¤‘ìš”í•œ ì°¨ì´ê°€ ìˆë‹¤.í°ë”°ì˜´í‘œ(â€œâ€) ë³€ìˆ˜ í™•ì¥(Expansion) í°ë”°ì˜´í‘œ ì•ˆì— ìˆëŠ” ë³€ìˆ˜ëŠ” ê·¸ ê°’ìœ¼ë¡œ í™•ì¥ë¨. ì˜ˆë¥¼ ë“¤ì–´, â€œ$VARIABLEâ€ì€ VARIABLEì˜ ê°’ì„ ë‚˜íƒ€ëƒ„. ëª…ë ¹ì–´ ì¹˜í™˜(Command Substitution) í°ë”°ì˜´í‘œ ì•ˆì—ì„œ ëª…ë ¹ì–´ ì¹˜í™˜. ì˜ˆë¥¼ ë“¤ì–´, â€œ$(date)â€ëŠ” í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ìœ¼ë¡œ ì¹˜í™˜ë¨. ê³µë°±ê³¼ íŠ¹ìˆ˜ ë¬¸ì í°ë”°ì˜´í‘œ ì•ˆì˜ ê³µë°±, íƒ­ ë“±ì€ ë¬¸ìì—´ì˜ ì¼ë¶€ë¡œ ìœ ì§€ë¨. ì´ëŠ” ì—¬ëŸ¬ ë‹¨ì–´ë‚˜ ê³µë°±ì„ í¬í•¨í•˜ëŠ” ë¬¸ìì—´ì„ í•˜ë‚˜ì˜ ì¸ìë‚˜ ê°’ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•  ë•Œ ìœ ìš©. ì‘ì€ë”°ì˜´í‘œ(â€˜â€™) ë¬¸ì ê·¸ëŒ€ë¡œì˜ ê°’ ì‘ì€ë”°ì˜´í‘œ ì•ˆì˜ ëª¨ë“  ë¬¸ìëŠ” ê·¸ëŒ€ë¡œì˜ ê°’ìœ¼ë¡œ ì²˜ë¦¬ë¨. ë³€ìˆ˜ í™•ì¥ì´ë‚˜ ëª…ë ¹ì–´ ì¹˜í™˜ ê°™ì€ ê²ƒì€ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, â€˜$VARIABLEâ€™ì€ í‘œê¸°ëœ ë¬¸ìì—´ â€œ$VARIABLEâ€ ê·¸ ìì²´ë¥¼ ì˜ë¯¸. ê³µë°±ê³¼ íŠ¹ìˆ˜ ë¬¸ì ì‘ì€ë”°ì˜´í‘œ ì•ˆì˜ ê³µë°±ê³¼ íŠ¹ìˆ˜ ë¬¸ìë„ ë¬¸ìì—´ì˜ ì¼ë¶€ë¡œ ìœ ì§€ë˜ë©°, ì´ ì—­ì‹œ ì—¬ëŸ¬ ë‹¨ì–´ë‚˜ ê³µë°±ì„ í¬í•¨í•˜ëŠ” ë¬¸ìì—´ì„ í•˜ë‚˜ì˜ ì¸ìë‚˜ ê°’ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³ ì í•  ë•Œ ìœ ìš©. ì‚¬ìš© ì˜ˆì‹œ ë³€ìˆ˜ í™•ì¥ì´ í•„ìš”í•œ ê²½ìš° â€œHello, $USERâ€ (USER ë³€ìˆ˜ì— í•´ë‹¹í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ í™•ì¥.) ëª…ë ¹ì–´ ì¹˜í™˜ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° â€œToday is $(date)â€ (í˜„ì¬ ë‚ ì§œë¡œ ì¹˜í™˜.) ë¬¸ì ê·¸ëŒ€ë¡œì˜ ê°’ì´ í•„ìš”í•œ ê²½ìš° â€˜Data $5 not processedâ€™ (ë¬¸ìì—´ì´ ê·¸ëŒ€ë¡œ ì¶œë ¥, ë³€ìˆ˜ í™•ì¥ì´ë‚˜ ì¹˜í™˜ ì—†ì´.) ê²°ë¡ ê°ê°ì˜ ì‚¬ìš©ë²•ì€ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë³€ìˆ˜ì˜ ê°’ì´ë‚˜ ëª…ë ¹ì–´ì˜ ê²°ê³¼ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤. ë¬¸ìì—´ ë‚´ì—ì„œ ë³€ìˆ˜ì˜ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ì§€ ì•Šê±°ë‚˜, íŠ¹ìˆ˜ ë¬¸ìë¥¼ ëª…ë ¹ì–´ì˜ ì¼ë¶€ë¡œ í•´ì„ë˜ì§€ ì•Šê²Œ í•˜ê³  ì‹¶ì„ ë•Œ ì‘ì€ë”°ì˜´í‘œë¥¼ ì‚¬ìš©í•œë‹¤. ë°˜ë©´, ë³€ìˆ˜ì˜ ê°’ì„ í™•ì¥í•˜ê±°ë‚˜ ëª…ë ¹ì–´ì˜ ê²°ê³¼ë¥¼ ì‚¬ìš©í•˜ê³ ì í•  ë•ŒëŠ” í°ë”°ì˜´í‘œë¥¼ ì‚¬ìš©í•œë‹¤."
    } ,
  
    {
      "title"       : "Shell Script ê¸°ë³¸ ë¬¸ë²• 02 (types)",
      "category"    : "",
      "tags"        : "linux, bash, shell scirpt",
      "url"         : "./shell-script02-types-copy.html",
      "date"        : "2024-02-10 08:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 02",
      "content"     : "Bash Shell Scriptì—ì„œëŠ” ë‹¤ë¥¸ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë“¤ì²˜ëŸ¼ ëª…ì‹œì ì¸ ë°ì´í„° íƒ€ì… ì„ ì–¸ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. BashëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ë³€ìˆ˜ë¥¼ ë¬¸ìì—´ë¡œ ì²˜ë¦¬í•˜ì§€ë§Œ, Bash ìŠ¤í¬ë¦½íŠ¸ ë‚´ì—ì„œ ë‹¤ì–‘í•œ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ë‹¤ë£° ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ ìœ„í•´ íŠ¹ì • ëª…ë ¹ì–´ë‚˜ êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ìˆ«ì, ë¬¸ìì—´, ë°°ì—´ ë“±ê³¼ ê°™ì€ ë‹¤ì–‘í•œ â€œí˜•íƒœâ€ì˜ ë°ì´í„°ë¥¼ ë‹¤ë£¨ê²Œ ëœë‹¤. ì•„ë˜ëŠ” Bashì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” ì£¼ìš” â€œë°ì´í„° íƒ€ì…â€ì˜ ê°œë…ê³¼ ì˜ˆì‹œì´ë‹¤.ë¬¸ìì—´ (String)Bashì—ì„œ ê°€ì¥ ê¸°ë³¸ì ì´ê³  ìì£¼ ì‚¬ìš©ë˜ëŠ” ë°ì´í„° íƒ€ì…. ë³€ìˆ˜ì— ê°’ì„ í• ë‹¹í•  ë•Œ ë”°ì˜´í‘œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜, ë‹¨ì¼ ë”°ì˜´í‘œ(â€˜)ë‚˜ ì´ì¤‘ ë”°ì˜´í‘œ(â€œ)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ìì—´ì„ í• ë‹¹.name=\"John Doe\"greeting='Hello, World!'ì •ìˆ˜(Integer)Bashì—ì„œëŠ” declare -i ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ë¥¼ ì •ìˆ˜ë¡œ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤. ë˜í•œ, ì‚°ìˆ  ì—°ì‚°ì—ì„œ BashëŠ” ë³€ìˆ˜ë¥¼ ìë™ìœ¼ë¡œ ì •ìˆ˜ë¡œ ì·¨ê¸‰declare -i numbernumber=10echo $((number + 5)) # 15 ì¶œë ¥ë°°ì—´(Array)Bashì—ì„œ ë°°ì—´ì€ ì—¬ëŸ¬ ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆëŠ” ë°ì´í„° êµ¬ì¡°. ë°°ì—´ì€ 0ë¶€í„° ì‹œì‘í•˜ëŠ” ì¸ë±ìŠ¤ë¥¼ ê°€ì§€ë©°, ()ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°°ì—´ì„ ì„ ì–¸.arr=(1 2 \"hello\" \"world\")echo ${arr[0]} # 1 ì¶œë ¥echo ${arr[3]} # world ì¶œë ¥ Bash ë°°ì—´ê³¼ ë‹¤ë¥¸ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ë°°ì—´ (ex. C)ê³¼ ë‹¤ë¥¸ì  index &amp; mata-data Bash ë°°ì—´ì˜ êµ¬í˜„ì€ C ë°°ì—´ê³¼ ë‹¬ë¦¬ ê³ ìˆ˜ì¤€ì—ì„œ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì—, ì›ì†Œê°€ ì €ì¥ëœ ë©”ëª¨ë¦¬ì— ëŒ€í•œ ì ‘ê·¼ ë°©ë²• ë“±ì„ ê³ ë ¤í•  í•„ìš”ê°€ ì—†ë‹¤. Bash ë°°ì—´ì€ ê° ì›ì†Œì•  ëŒ€í•œ index ì™€ mata-data ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ìœ ì§€í•˜ë©°, ì—¬ê¸°ì— ì›ì†Œì˜ ìœ„ì¹˜, ê¸¸ì´ ë“±ì´ í¬í•¨ë  ìˆ˜ ìˆë‹¤. ë™ì  í• ë‹¹ê³¼ ê´€ë¦¬BashëŠ” í•„ìš”ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³ , ë°°ì—´ì˜ ì›ì†Œë¥¼ ê´€ë¦¬í•œë‹¤. ì‚¬ìš©ìê°€ ë°°ì—´ì— ì›ì†Œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•  ë•Œ, BashëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì´ëŸ¬í•œ ë³€ê²½ì„ ì²˜ë¦¬í•˜ê³ , ë°°ì—´ì˜ ê° ì›ì†Œê°€ ì˜¬ë°”ë¥´ê²Œ ì ‘ê·¼ë  ìˆ˜ ìˆë„ë¡ í•œë‹¤. ì¶”ìƒí™”ëœ ì ‘ê·¼ ë°©ì‹ì‚¬ìš©ìê°€ ë°°ì—´ì˜ ì›ì†Œì— ì ‘ê·¼í•  ë•Œ, BashëŠ” ì¶”ìƒí™”ëœ ì¸í„°í˜ì´ìŠ¤(ì˜ˆ: ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©-í•œ ì ‘ê·¼)ë¥¼ ì œê³µã„¹. ì‚¬ìš©ìëŠ” ì¸ë±ìŠ¤ë¥¼ í†µí•´ ê°„ë‹¨í•˜ê²Œ ì›ì†Œì— ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, Bashê°€ ì›ì†Œì˜ ì‹¤ì œ ë©”ëª¨ë¦¬ ìœ„ì¹˜ì™€ ê²½ê³„ë¥¼ ê´€ë¦¬í•œë‹¤. ì—°ê´€ ë°°ì—´(Associative Arrays)ash 4 ì´ìƒì—ì„œëŠ” ì—°ê´€ ë°°ì—´(í‚¤-ê°’ ìŒì„ ì €ì¥í•˜ëŠ” ë°°ì—´)ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ. declare -Aë¥¼ ì‚¬ìš©í•˜ì—¬ ì—°ê´€ ë°°ì—´ì„ ì„ ì–¸.declare -A fruitsfruits[apple]=\"red\"fruits[banana]=\"yellow\"echo ${fruits[apple]} # red ì¶œë ¥ë¶€ë™ ì†Œìˆ˜ì (Floating Point Numbers)Bash ìì²´ëŠ” ë¶€ë™ ì†Œìˆ˜ì  ìˆ˜ë¥¼ ì§ì ‘ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. ë¶€ë™ ì†Œìˆ˜ì  ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë ¤ë©´ bcë‚˜ awkì™€ ê°™ì€ ì™¸ë¶€ ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨.result=$(echo \"3.5 + 4.2\" | bc)echo $result # 7.7 ì¶œë ¥í™˜ê²½ ë³€ìˆ˜(Environment Variables)í™˜ê²½ ë³€ìˆ˜ëŠ” ìš´ì˜ ì²´ì œì˜ í™˜ê²½ ì„¤ì •ì„ í¬í•¨í•˜ëŠ” ì „ì—­ ë³€ìˆ˜. Bash ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” ì´ëŸ¬í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì½ê³  ì„¤ì •í•  ìˆ˜ ìˆë‹¤.echo $PATHexport MY_VAR=\"SomeValue\""
    } ,
  
    {
      "title"       : "Shell Script ê¸°ë³¸ ë¬¸ë²• 01",
      "category"    : "",
      "tags"        : "linux, shell scirpt",
      "url"         : "./shell-script01.html",
      "date"        : "2024-02-10 08:32:20 +0900",
      "description" : "ê°œë°œìë¥¼ ìœ„í•œ ë°˜ë„ì²´ SWê°œë°œ ê¸°ì´ˆ (ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ê°œë°œ) ê´€ë ¨ í•™ìŠµ 01",
      "content"     : "1. ê°„ë‹¨í•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ script 1#!/bin/bash# í•¨ìˆ˜ ì •ì˜: ë‘ ì¸ìë¥¼ ë°›ì•„ ì¶œë ¥í•¨add_inner_numbers() { echo \"ì²« ë²ˆì§¸ ìˆ«ì: $1\" echo \"ë‘ ë²ˆì§¸ ìˆ«ì: $2\" local sum=0 sum=$(( $1 + $2 )) echo \"ë‘ ìˆ˜ì˜ í•©: $sum\"}# í•¨ìˆ˜ í˜¸ì¶œ: 5ì™€ 10ì„ ì¸ìë¡œ ì „ë‹¬add_inner_numbers 5 10 #!/bin/bash â€œshebangâ€ (ë˜ëŠ” â€œhashbangâ€) í•´ë‹¹ scriptë¥¼ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•  interpreter ì˜ ê²½ë¡œë¥¼ ì§„í–‰ ì—¬ê¸°ì„œëŠ” Bash shell ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰ë˜ì–´ì•¼ í•¨ì„ ì˜ë¯¸ subtract_num() {} script í•¨ìˆ˜ë¥¼ ì •ì˜í•  ë•Œ, ë§¤ê°œë³€ìˆ˜ëŠ” ëª…ì‹œí•˜ì§€ ì•ŠëŠ”ë‹¤. í•¨ìˆ˜ ë‚´ $1, $2, $3 â€¦ ê³¼ ê°™ì´ í•¨ìˆ˜ ë‚´ë¶€ì— ëª…ì‹œëœ value ì˜ ìˆ«ìê°’ì— ìˆœì„œëŒ€ë¡œ ë§¤ì¹­ë˜ì–´ ì…ë ¥ëœë‹¤. sum=$(( $1 + $2 )) ì²«ë²ˆì§¸ ê´„í˜¸ëŠ” $() ë¡œ ì—°ì‚° ê²°ê³¼ë¥¼ ê°’ìœ¼ë¡œ ì·¨í•¨ì„ ì˜ë¯¸ ë‘ë²ˆì§¸ ê´„í˜¸ëŠ” ì—°ì‚°ì— ëŒ€í•œ ê´„í˜¸ ë„ì–´ì“°ê¸°ëŠ” ì—¬ê¸°ì„œëŠ” ê²°ê³¼ì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ëŠ” ì•Šì§€ë§Œ ì¼ë°˜ì ì¸ ì‘ì„± ê¸°ì¤€ì„ ë”°ë¦„. ì‹¤í–‰ ê²°ê³¼root@DESKTOP:~$ ./example.shì²« ë²ˆì§¸ ìˆ«ì: 5ë‘ ë²ˆì§¸ ìˆ«ì: 10ë‘ ìˆ˜ì˜ í•©: 152. ê°„ë‹¨í•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ script 2 (ì™¸ë¶€ ì…ë ¥)#!/bin/bash# ë‘ìˆ˜ë¥¼ ë¹¼ëŠ” í•¨ìˆ˜ ì •ì˜subtract_num() { local sub=0 sub=$(( $2 - $1 )) echo \"ë‘ ìˆ˜ì˜ ì°¨: $sub\"}# ì‚¬ìš©ìë¡œë¶€í„° ë‘ìˆ˜ ì…ë ¥ ë°›ê¸°read -p \"ì²«ë²ˆì§¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”: \" num1read -p \"ë‘ë²ˆì§¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”: \" num2# í•¨ìˆ˜ í˜¸ì¶œsubtract_num $num1 $num2 read -p \"ì²«ë²ˆì§¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”: \" num1 read ëª…ë ¹ì–´ë¡œ í‘œì¤€ì…ë ¥ ê°’ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. -p ì˜µì…˜ìœ¼ë¡œ echo ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  í”„ë¡¬í”„íŠ¸ ë©”ì„¸ì§€ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤. ì‹¤í–‰ ê²°ê³¼root@DESKTOP:~$ ./example.shì²«ë²ˆì§¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”: 2ë‘ë²ˆì§¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”: -5ë‘ ìˆ˜ì˜ ì°¨: -73. ê°„ë‹¨í•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ script 3 (ì™¸ë¶€ ì…ë ¥, ì¡°ê±´ë¬¸)ì™¸ë¶€ ì…ë ¥ì„ í•¨ìˆ˜ì˜ ì‹¤í–‰ê³¼ í•¨ê»˜ ë°›ë„ë¡ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.#!/bin/bash# ë‘ìˆ˜ë¥¼ ë¹¼ëŠ” í•¨ìˆ˜ ì •ì˜subtract_num() { local sub=0 sub=$(( $2 - $1 )) echo \"ë‘ ìˆ˜ì˜ ì°¨: $sub\"}if [ $# -ne 2 ]; then echo \"ì‚¬ìš©ë°©ë²•: $0 ìˆ«ì1 ìˆ«ì2\" exit 1fi# í•¨ìˆ˜ í˜¸ì¶œsubtract_num $1 $2 if [ $# -ne 2 ]; then ... fi []; ë‚´ ì¡°ê±´ì´ ì°¸ì¼ ê²½ìš°, then ... fi ë‚´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ if, [];, then ì‚¬ì´ì—ëŠ” ë„ì–´ì“°ê¸°ë¥¼ ë°˜ë“œì‹œ í•´ì•¼ í•¨. $# -ne 2 $# ì€ script ì— ì „ë‹¬ëœ positional parameter ì˜ ê°¯ìˆ˜. ìœ„ ì˜ˆì œì˜ ê²½ìš°, ./example.sh 1 2 ì™€ ê°™ì´ ì‹¤í–‰ë˜ëŠ”ë°, ì´ ë•Œ $# ê°’ì€ 2 ì´ë‹¤. -ne ì€ â€œnot equalâ€ ì˜ ì•½ìë¡œ, ë‘ ê°’ì´ ì„œë¡œ ë‹¤ë¥¸ì§€ë¥¼ ë¹„êµ 2 ëŠ” ë¹„êµ ëŒ€ìƒì˜ ê°’ ì¦‰ í•´ë‹¹ script ë¶€ë¶„ì€ â€œì…ë ¥ëœ positional parameter ê°¯ìˆ˜ê°€ 2ê°œê°€ ì•„ë‹ˆë¼ë©´â€ ì´ë¼ëŠ” ì¡°ê±´ì„ ì •ì˜í•¨. echo \"...\" exit 1 í•´ë‹¹ ì¡°ê±´ì¼ ë•Œ, ë©”ì„¸ì§€ë¥¼ ì¶œë ¥í•˜ê³  ì—ëŸ¬ ìƒíƒœë¡œ script ë¥¼ ì¢…ë£Œ exit 0 ì¸ ê²½ìš°, ì •ìƒì ìœ¼ë¡œ ì‘ì—…ì´ ì„±ê³µë˜ê³  ì¢…ë£Œë¨ì„ ì˜ë¯¸, 0 ì´ ì•„ë‹Œ ê²½ìš°ëŠ”, ì—ëŸ¬ë‚˜ íŠ¹ì • ì¡°ê±´ìœ¼ë¡œ ì¸í•œ ì¢…ë£Œë¥¼ ì˜ë¯¸ ì‹¤í–‰ ê²°ê³¼ë§¤ê°œë³€ìˆ˜ë¥¼ ì…ë ¥í•˜ì§€ ì•Šì€ ê²½ìš°root@DESKTOP~$ ./example.shì‚¬ìš©ë°©ë²•: ./example.sh ìˆ«ì1 ìˆ«ì2ë§¤ê°œë³€ìˆ˜ ê°’ì„ í•¨ê»˜ ì…ë ¥í•œ ê²½ìš°root@DESKTOP:~$ ./example.sh 3 3ë‘ ìˆ˜ì˜ ì°¨: 04. íŒŒì¼ ì…ë ¥ &amp; ë°˜ë³µë¬¸ì„ ì´ìš© script#!/bin/bash# 'list' íŒŒì¼ì„ ì½ì–´ì™€ line ë³€ìˆ˜ì— ì €ì¥while read -r line; do # ê³µë°±ìœ¼ë¡œ êµ¬ë¶„ëœ ê°’ì„ ë°°ì—´ë¡œ ë³€í™˜ IFS=' ' read -ra ADDR &lt;&lt;&lt; \"$line\" # ë°°ì—´ì˜ ê° ìš”ì†Œë¥¼ ë°˜ë³µí•˜ì—¬ ì¶œë ¥ for i in \"${ADDR[@]}\"; do echo $i donedone &lt; \"list\"list íŒŒì¼1 2 3 4 5 while read -r line: do ... done &lt; \"list\" list íŒŒì¼ë¡œ ë¶€í„° í•´ë‹¹ ë‚´ìš©ì„ ì¤„ë³„ë¡œ ì½ì–´ì™€ì„œ ê° ì¤„ì˜ ê°’ì„ line ë³€ìˆ˜ì˜ ê°’ìœ¼ë¡œ ìƒì„±í•œë‹¤. -r ì˜µì…˜ì€ read ëª…ë ¹ì–´ê°€ \\ ì„ ì´ìŠ¤ì¼€ì´í”„ ë¬¸ìê°€ ì•„ë‹Œ ë°ì´í„° ì›ë³¸ ê·¸ëŒ€ë¡œ ë¬´ê²°ì„±ì„ ìœ ì§€í•œì±„ë¡œ ê°’ì„ ê°€ì§ˆ ìˆ˜ ìˆë„ë¡ ì¡°ê±´ì„ ë¶€ì—¬í•œë‹¤. IFS=' ' read -ra ADDR &lt;&lt;&lt; \"$line\" IFS ëŠ” â€œInternal Field Separatorâ€ ì˜ ì•½ì, Bash ì—ì„œ ë‹¨ì–´ ê²½ê³„ë¥¼ ì •ì˜í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜. ì´ êµ¬ë¶„ì—ì„œ IFS ëŠ” ê³µë°±ë¬¸ì ' ' ë¡œ ì„¤ì •ë˜ì–´ ë‹¨ì–´ì˜ êµ¬ë¶„ì„ ê³µë°±ìœ¼ë¡œ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ì˜ë¯¸. -ra ì—ì„œ a ì˜µì…˜ì€ ì…ë ¥ëœ data ë¥¼ ë°°ì—´ë¡œ ë³€ìˆ˜ ADDR ì— ì €ì¥í•¨ì„ ì˜ë¯¸ &lt;&lt;&lt; ì€ here string redirction ì„ ì˜ë¯¸. here string ì€ ë¬¸ìì—´ ë°ì´í„°ë¥¼ ëª…ë ¹ì–´ì˜ í‘œì¤€ì…ë ¥ìœ¼ë¡œ ì§ì ‘ ì „ë‹¬í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. ëª…ë ¹ì–´ &lt;&lt;&lt; \"ë¬¸ìì—´\" ê³¼ ê°™ì€ í˜•íƒœë¡œ, redirection ì„ ë’¤ì— ì˜¤ëŠ” ë¬¸ìì—´ ê°’ì„ ë°”ë¡œ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, root@DESKTOP:~$ grep \"ì°¾ëŠ”\" &lt;&lt;&lt; \"ì—¬ê¸°ì—ëŠ” ì°¾ëŠ” ë‹¨ì–´ê°€ ìˆì„ê¹Œìš”?\"ì—¬ê¸°ì—ëŠ” ì°¾ëŠ” ë‹¨ì–´ê°€ ìˆì„ê¹Œìš”? ì™€ ê°™ì´, ì™¸ë¶€ íŒŒì¼ ë“±ì—ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë’¤ì— ëª…ì‹œëœ ë¬¸ìì—´ ê°’ì„ ë°”ë¡œ redirection í•˜ì—¬ ê°€ì ¸ì™€ ì‚¬ìš©í•˜ê²Œ ëœë‹¤. ë”°ë¼ì„œ í•´ë‹¹ êµ¬ë¬¸ì„ ì •ë¦¬í•˜ë©´,(1). line ë³€ìˆ˜ ê°’ì„ ë¬¸ìì—´ë¡œ ìƒì„±í•œë‹¤.(2). (1) ë²ˆ ê°’ì„ redirection í•˜ì—¬ ê°€ì ¸ì˜¤ê³ , (3). \\ ë¥¼ ë³„ë„ ì²˜ë¦¬í•˜ì§€ ì•Šê³ , (4). ë„ì–´ì“°ê¸°(â€˜ â€˜) ë¡œ êµ¬ë¶„í•˜ì—¬ ìƒì„±ëœ ë°°ì—´ ê°’ì„ (5). ë°°ì—´ ë³€ìˆ˜ ADDR ì˜ ê°’ìœ¼ë¡œ ìƒì„±í•œë‹¤. for i in \"${ADDR[@]}\"; do ... done ë°˜ë³µë¬¸ for ëŠ” ë°°ì—´ ë³€ìˆ˜ ADDR ì˜ ì›ì†Œë¥¼ ìˆœíšŒí•˜ë©´ì„œ ì›ì†Œê°’ ì„ ëŒ€ì…í•˜ì—¬ do ... done ë‚´ script ë¥¼ ìˆ˜í–‰í•¨. ADDR[@] ëŠ” ê° ì›ì†Œë¥¼ ì˜ë¯¸ \"\" ê°ì‹¸ í•´ë‹¹ ì›ì†Œê°’ì„ ë¬¸ìì—´ë¡œ ë³€í™˜, í˜¹ì‹œ ë¬¸ìì—´ ë‚´ ë‹¤ë¥¸ ë¬¸ìì—´ì„ í¬í•¨í•œ ê²½ìš° (ex. â€œê°’ì€ ${ADDR[@]}â€) ë‹¤ë¥¸ ë¬¸ìì—´ê³¼ ë°°ì—´ ë³€ìˆ˜ ê°’ ë¶€ë¶„ì„ ëª…í™•íˆ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ${} ë¡œ ê°ì‹¸ì¤Œ. ì‹¤í–‰ ê²°ê³¼root@DESKTOP:~$ ./example.sh12345"
    } ,
  
    {
      "title"       : "Phoenix Live Generator",
      "category"    : "",
      "tags"        : "phoenix, generator",
      "url"         : "./phonix-generator.html",
      "date"        : "2024-01-26 08:32:20 +0900",
      "description" : "Phoenix Live Generator ëŠ” ì£¼ì–´ì§„ resource ì— ëŒ€í•œ ê¸°ë³¸ì ì¸ CRUD code ìƒì„±ì„ ë„ì™€ì£¼ëŠ” utility ì´ë‹¤. ì´ì— ëŒ€í•´ ì•Œì•„ë³´ì.",
      "content"     : "(ì•„ë˜ ë‚´ìš©ì€ programming-phoenix-liveview_B10.0 - chapter 3 Generators: Contexts and Schemas ë¥¼ ì •ë¦¬í•œ ê²ƒì„ì„ ë°í™ë‹ˆë‹¤.)Phoenix Live Generator ë€?Phoenix Live Generator ëŠ” ì£¼ì–´ì§„ resource ì— ëŒ€í•œ ê¸°ë³¸ì ì¸ CRUD code ìƒì„±ì„ ë„ì™€ì£¼ëŠ” utility ë¡œ ë‹¤ìŒ ì‘ì—…ì— ëŒ€í•œ ì„¤ì •ì„ ìë™ì„ ìƒì„±í•´ì¤€ë‹¤. backend : schema, context frontend : routs, LiveView, templatesë‹¤ë§Œ ìœ„ì—ì„œ í‘œí˜„í•œ â€˜code ìƒì„±â€™ ì˜ ì˜ë¯¸ëŠ” elixir ì—ì„œëŠ” ì¡°ê¸ˆ ë‹¤ë¥¸ ì˜ë¯¸ë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤. ì´ëŠ” Generator ê°€ ìì²´ì ìœ¼ë¡œ ìƒˆë¡œìš´ code ì„ ìƒì„± í•´ì¤€ë‹¤ê¸°ë³´ë‹¤, ì´ë¯¸ ì •ì˜ëœ macro ë¥¼ ì‚¬ìš©í•˜ì—¬ â€˜code ë¥¼ ìƒì„±í•˜ëŠ” codeâ€™ ë¥¼ ì‹¤í–‰ì‹œí‚´ìœ¼ë¡œì¨, ìµœì¢…ì ìœ¼ë¡œ ì‚¬ìš©ìê°€ ì •ì˜í•œ code ë¥¼ ì–»ì„ ìˆ˜ ìˆê²Œ ë˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.ê²°ê³¼ì ìœ¼ë¡œ Generator ë¥¼ ì‚¬ìš©í•˜ì—¬, ì‘ì„±ìì˜ ë°˜ë³µì  ì‘ì—…ì„ ì¤„ì—¬ ì¤Œìœ¼ë¡œì¨, ì‘ì„±ìëŠ” ê° ë¶€ë¶„ì˜ logic ë° ê³µí†µì ì´ì§€ ì•Šì€ ë¶€ë¶„ì˜ ì‘ì—…ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.Phoenix Live Generator ê¸°ë³¸ êµ¬ì¡°ê°„ë‹¨í•œ ì˜ˆì œë¡œ ìƒí’ˆì— ëŒ€í•œ ì •ë³´ë¥¼ DB ì— ì €ì¥í•˜ê³ , ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ í™”ë©´ì— ë³´ì—¬ì£¼ëŠ” view ë¥¼ ê°€ì§„ application ì„ ê°œë°œí•œë‹¤ê³  ê°€ì •í•´ë³´ë©´, í•´ë‹¹ application ì˜ êµ¬ì¡°ë¥¼ ì•„ë˜ì™€ ê°™ì´ ê·¸ë ¤ë³¼ ìˆ˜ ìˆë‹¤. frontend: web ì—ì„œ /product GET ìš”ì²­ì´ ìˆì„ ë•Œ, ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ì—¬ì£¼ëŠ” tempalte ì´ rendering ë¨. backend : phoenix application ì—ì„œ live view ëŠ” ì „ì²´ì ìœ¼ë¡œ context ì— ê´€ë¦¬ë˜ë©°, core part ì¸ schema ë¥¼ ê°ì‹¸ê³  ìˆë‹¤. ì¦‰, context ëŠ” frontend ë° DB ì™€ ìƒí˜¸ì‘ìš©ì„ ë‹´ë‹¹í•œë‹¤.Phoenix Live Generator ì˜ ì‹¤í–‰ê¸°ë³¸ ì›ë¦¬ì™€ ê°œë… ì´í•´ë¥¼ ìœ„í•´, ì•„ë˜ command ë¥¼ ì‹¤í–‰í•˜ì—¬, Generator ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.mix phx.gen.live Catalog Product products name:string \\description:string unit_price:float sku:integer:uniqueê·¸ëŸ¬ë©´ ìë™ìœ¼ë¡œ ê´€ë ¨ migration, schema ë¥¼ í¬í•¨í•œ context, template íŒŒì¼ë“¤ì´ ìƒì„±ë˜ë©°, command ì†ì„±ê°’ë“¤ì˜ ì˜ë¯¸ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. Catalog : boundary layer ì¸ context Product : applcation core ì¸ schema prodcuts: DB table name:string description:string unit_price:float sku:integer:unique : schema fields &amp; DB table columsGenerated Core ì˜ ì´í•´Generated Core (ex. Product) ëŠ”, í•­ìƒ ë™ì¼í•œ ì…ë ¥ì— ëŒ€í•´ ë™ì¼í•œ ì¶œë ¥ì„ ì œê³µí•˜ëŠ” ìˆœìˆ˜í•¨ìˆ˜ì´ì—¬ì•¼ í•œë‹¤. database ë¥¼ ê´€ë¦¬í•˜ë©° ìƒí˜¸ì‘ìš© í•œë‹¤. ì¦‰ database table ìƒì„±, data ê´€ë¦¬/ìœ ì§€ ì‘ì—…, transaction ê³¼ query ì¤€ë¹„ ì‘ì—…ì„ ë‹´ë‹¹í•œë‹¤.ì´ì™€ ê´€ë ¨ëœ íŒŒì¼ë“¤ì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.The Product Migrationdatabase table ì„ ì •ì˜í•œ migration íŒŒì¼ì„ pento/priv/repo/migrations/20230728120332_create_products.exsì™€ ê°™ì´ ìƒì„±ë˜ì–´ ì§„ë‹¤. í•´ë‹¹ code ë¥¼ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ command ì—ì„œ ëª…ì‹œí•œ table ì´ë¦„, column ëª…, data type ì´ ìƒì„±ë˜ì–´ ìˆë‹¤.defmodule Pento.Repo.Migrations.CreateProducts do use Ecto.Migration def change do create table(:products) do add :name, :string add :description, :string add :unit_price, :float add :sku, :integer timestamps() end create unique_index(:products, [:sku]) endendê·¸ë¦¬ê³  ì•„ë˜ command ì‹¤í–‰ì„ í†µí•´ DB ì— í•´ë‹¹ table ì´ ìƒì„±ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.mix ecto.migrateThe Product Schemaì•„ë˜ lib/pento/catalog/product.ex ìƒì„±ëœ íŒŒì¼ schema macro êµ¬í˜„ë¶€ë¥¼ í†µí•´ Elixir êµ¬ì¡°ì²´ì™€ databalse products table record ê°„ ë³€í™˜í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.defmodule Pento.Catalog.Product do use Ecto.Schema import Ecto.Changeset schema \"products\" do field :description, :string field :name, :string field :sku, :integer field :unit_price, :float timestamps()endê´€ë ¨ ì‘ì—…ì„ ìˆ˜í–‰í•´ì£¼ëŠ” í•¨ìˆ˜ì˜ ê²½ìš°, macro ì— ì˜í•´ ìë™ ìƒì„±ë˜ë©°, ê·¸ ëª©ë¡ì€ ì•„ë˜ì™€ ê°™ë‹¤.iex&gt; alias Pento.Catalog.Productiex&gt; exports Product__changeset__/0 __schema__/1 __schema__/2 __struct__/0__struct__/1 changeset/2ì´ì¤‘ schema í•¨ìˆ˜ê°€ elixir êµ¬ì¡°ì²´ë¥¼ ìƒì„±í•´ì„œ database table record ì™€ ì—®ëŠ” ì‘ì—…ì„ ë‹´ë‹¹í•œë‹¤.í•´ë‹¹ êµ¬ì¡°ì²´ ìƒì„±ì€ struct/1 ë¡œ ìƒì„±í•˜ë©°, ì´ë¥¼ CLI ìƒíƒœì—ì„œ ì‹¤í–‰í•˜ì—¬, ì§ì ‘ ê·¸ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.iex&gt; Product.__struct__(name: \"Exploding Ninja Cows\")%Pento.Catalog.Product{ __meta__: #Ecto.Schema.Metadata&lt;:built, \"products\"&gt;, description: nil, id: nil, inserted_at: nil, name: \"Exploding Ninja Cows\", sku: nil, unit_price: nil, updated_at: nil}ì—¬ê¸°ì—ì„œ id, inserted_at, updated_at field ì˜ ê²½ìš°, ìë™ ìƒì„±ë˜ëŠ” field ë¡œ record ê´€ë¦¬ì— í•„ìš”í•œ data (ex. id ì˜ ê²½ìš°, ê° record ê³ ìœ ê°’ìœ¼ë¡œ ì‹ë³„ì ì—­í• ) ë“¤ì„ ì €ì¥í•œë‹¤.changeest ì˜ ê²½ìš°, ê¸°ì¡´ì— ì •ë¦¬ëœ ë‚´ìš© ì°¸ê³ . (changeset/2 in Ecto Library)Generated Boundary ì˜ ì´í•´boundary ì˜ì—­ì— ëŒ€í•œ code ì„ Context ë¼ê³  í•˜ë©°, ì™¸ë¶€ì—ì„œ ì…ë ¥ëœ data ë¥¼ sanitizing, validating í•´ì„œ ë³€í™˜ëœ data ë¥¼ cord ì˜ì—­ìœ¼ë¡œ ë„˜ê²¨ì£¼ëŠ” ì‘ì—…ì„ ë‹´ë‹¹í•˜ë©° ì´ë¥¼ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤. Access External Services : ì™¸ë¶€ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ë‹¨ì¼ ì ‘ê·¼ ì§€ì ì„ ì œê³µ. application ì—ì„œ í•„ìš”í•œ ì™¸ë¶€ data ë‚˜ ê¸°ëŠ¥ì„ í†µí•©í•˜ê³ , ì´ëŸ¬í•œ ì„œë¹„ìŠ¤ë“¤ê³¼ ìƒí˜¸ ì‘ìš©ì„ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ê²Œ í•´ì¤Œ. Abstract Away Tedious Details : ë°˜ë³µì ì´ê±°ë‚˜ ë³µì¡í•œ ì‘ì—…ë“±ã„¹ì„ ìˆ¨ê¹€(ì¶”ìƒí™”) í•¨ìœ¼ë¡œì¨, ê°œë°œìê°€ ë³´ë‹¤ ì¤‘ìš”í•œ logic ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë„ë¡ í•¨. ì˜ˆë¥¼ ë“¤ì–´, data formating ì´ë‚˜ ë„¤íŠ¸ì›Œí¬ í†µì‹ ê³¼ ê°™ì€ ì‘ì—…ì„ ì‚¬ì „ì— ì²˜ë¦¬ Handle uncertainty : {:ok, result} ë˜ëŠ” {:error, message} ì™€ ê°™ì€ í˜•íƒœë¡œ ê·¸ ê²°ê³¼ë¥¼ ë°˜í™˜í•¨ìœ¼ë¡œì¨, ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨ë¥¼ ëª…í™•í•˜ê²Œ í•¨. ì´ë¥¼ í†µí•´, ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì˜ˆì™¸ ìƒí™©ì„ ë³´ë‹¤ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ. Present a single, common API : í•˜ë‚˜ì˜ database table ê´€ë ¨ service ë“¤ì— ëŒ€í•´ ë‹¨ì¼ ì ‘ê·¼ì ì„ ì œê³µí•˜ì—¬ application ë‚´ ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤ì„ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°, ì´ë¥¼ í†µí•´ application ì˜ ì‚¬ìš©ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„œì„ í–¥ìƒì‹œí‚´.ì™¸ë¶€ service ë¡œë¶€í„°ì˜ ì ‘ê·¼ì˜ ì˜ˆdatabase ì˜ ì ‘ê·¼ì€ applciation ì…ì¥ì—ì„œ ì™¸ë¶€ service ì— ëŒ€í•œ ì ‘ê·¼ì— í•´ë‹¹í•œë‹¤. ê´€ë ¨ Repo ì‘ì—…ì€ Ecto library í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©°, ë”°ë¼ì„œ Ecto code ë„ core ì™€ boundary ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì§€ê²Œ ëœë‹¤. Ecto core : query build &amp; transaction ì¤€ë¹„ ì‘ì—… (ì™¸ë¶€ í™˜ê²½ì— ì˜í–¥ ì—†ì´ ì…ë ¥ê°’ê³¼ ë‚´ë¶€ logic ì—ë§Œ ì˜í–¥ì„ ë°›ì•„ ê²°ê³¼ê°€ í•­ìƒ í™•ì •ì ì´ê³  ì˜ˆì¸¡ê°€ëŠ¥, ex. changeset) Ecto boundary : Ecto.Repo ì‘ì—…ì˜ ê²½ìš°, ì™¸ë¶€ ìƒí™© (ex. DB server ì—°ê²° ìƒíƒœ)ì— ë”°ë¼ ê·¸ ê²°ê³¼ê°€ ë°”ë€” ìˆ˜ ìˆìœ¼ë¯€ë¡œ, boundary ì— í•´ë‹¹"
    } ,
  
    {
      "title"       : "(App ê°œë°œ 03) Account context - users table ì— nickname í•­ëª© ì¶”ê°€",
      "category"    : "",
      "tags"        : "phoenix, liveview, migration, table_í•­ëª©_ì¶”ê°€, schema, changeset/2, applciation_ê°œë°œ1",
      "url"         : "./users-column-add.html",
      "date"        : "2024-01-25 10:32:20 +0900",
      "description" : "ê³„ì • ì •ë³´ì—ì„œ nickname ì •ë³´ê°€ í•„ìš”í•¨ì— ë”°ë¼, ì´ë¥¼ ê¸°ì¡´ì— ìƒì„±í•œ users table ì— ì¶”ê°€í•˜ê³ , ê³„ì • ìƒì„± ì‹œ, nickname ì„ ì…ë ¥í•˜ë„ë¡ í•¨.",
      "content"     : "Phoenix LiveView Authrization ì„¤ì •ì„ ìœ„í•´ lon in ê¸°ëŠ¥ì„ í™œì„±í™”ì— í•„ìš”í•œ ê³„ì • ìƒì„± ì‘ì—…ì´ í•„ìš”í•˜ë‹¤. ì´ ë•Œ, mix phx.gen.auth Accounts User users command ë¥¼ í†µí•´ ì‚¬ìš©ì email, password ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ authrization, session ê´¸ë¦¬ë¥¼ ìœ„í•œ service code, template, token ì €ì¥ table ê¹Œì§€ ëª¨ë‘ ì•Œì•„ì„œ ìƒì„±í•´ ì¤€ë‹¤.ë§¤ìš° í¸ë¦¬í•œ ê¸°ëŠ¥ì´ì§€ë§Œ, í•´ë‹¹ command ë¡œ ì¶”ê°€ ì •ë³´ë¥¼ ì €ì¥/ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ í•¨ê»˜ ìƒì„±í•  ìˆ˜ëŠ” ì—†ìŒì„ í™•ì¸í•˜ì˜€ë‹¤. ëŒ€ì‹  ì¶”ê°€ migration ìƒì„± ë° í•„ìš”í•œ ìš”ì†Œë¥¼ ê´€ë ¨ code ì— ì§ì ‘ ì¶”ê°€í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥í•˜ì˜€ë‹¤.í˜„ì¬ ì‘ì—…í•˜ê³  ìˆëŠ” application ì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë…¸ì¶œ ì‹œí‚¬ ë•Œ, email ë³´ë‹¤ nickname ìœ¼ë¡œ ë³´ì—¬ì§€ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  íŒë‹¨ë˜ì–´ ì´ë¥¼ ì¶”ê°€í•˜ê³  ì‹¤ì œ application ì— ë°˜ì˜í•˜ëŠ” ì‘ì—…ì„ ì •ë¦¬í•´ ë³´ì•˜ë‹¤.1. migration ìƒì„± ë° ì‹¤í–‰ë‹¤ìŒì˜ command ë¥¼ ì‹¤í–‰í•˜ì—¬ migration script íŒŒì¼ì„ ìƒì„±mix ecto.gen.migration add_nickname_to_usersì´ë¥¼ ì‹¤í–‰í•˜ë©´ priv/repo/migrations/(ìƒì„±ì¼ì‹œ)_add_nickname__to_users.exs íŒŒì¼ì´ ìƒì„±ëœë‹¤. í•´ë‹¹ íŒŒì¼ì—ì„œ nickname column ì„ ì¶”ê°€í•  code ë¥¼ ì‘ì„±í•œë‹¤.defmodule MyPjt1.Repo.Migrations.AddNicknameToUsers do use Ecto.Migration def change do alter table(:users) do add :nickname, :string end endendí•´ë‹¹ íŒŒì¼ì„ ì•„ë˜ì˜ command ë¡œ ì‹¤í–‰í•˜ê³ , database ì— ë³€ê²½ ì‚¬í•­ì´ ë°˜ì˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.mix ecto.migrate2. User module ì—ì„œ schema ë° changeset/2 ìˆ˜ì •ì•„ë˜ì™€ ê°™ì´ Usher module ì—ì„œ schema ì— field ë¥¼ ì¶”ê°€ì‹œì¼œ ì¤€ë‹¤. schema \"users\" do field :email, :string field :password, :string, virtual: true, redact: true field :hashed_password, :string, redact: true field :confirmed_at, :naive_datetime field :nickname, :string # field ì¶”ê°€ timestamps(type: :utc_datetime) endê·¸ëŸ¬ë‚˜, field ë¥¼ ì¶”ê°€í•˜ê³ , ê³„ì • ë“±ë¡ module (user_registration_live.ex) ì—ì„œ nickname ì…ë ¥ì„ êµ¬í˜„í•˜ì—¬ë„ ì‹¤ì œë¡œ ì €ì¥ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ ì´ìœ ëŠ” nickname ì •ë³´ê¹Œì§€ ëª¨ë‘ ì…ë ¥ í›„ ì €ì¥ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œ, ì…ë ¥ ê°’ì˜ ìœ íš¨ì„± ê²€ì¦ì´ ìš°ì„  ì§„í–‰ë˜ë©°, ê²€ì¦ì„ í†µê³¼ëœ ê²½ìš°, db ì— ì €ì¥ ë° authorization ì‘ì—…ì´ ì§„í–‰ë˜ê²Œ ëœë‹¤.ê·¸ëŸ°ë°, ê´€ë ¨ ìœ íš¨ì„± ê²€ì¦ ì‘ì—…, ì¦‰ changeset/2 code ë¥¼ í™•ì¸í•˜ë©´ def registration_changeset(user, attrs, opts \\\\ []) do user |&gt; cast(attrs, [:email, :password]) |&gt; validate_email(opts) |&gt; validate_password(opts) endì—¬ê¸°ì—ì„œ cast(attrs, [:email, :password]) í•¨ìˆ˜ëŠ” ë§¤ê°œë³€ìˆ˜ë¡œ ì…ë ¥ëœ key ë“¤ (:email, :password) ì— ëŒ€í•œ value ê°’ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ, í•´ë‹¹ í•­ëª©ì— ëŒ€í•œ changeset ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. ì¦‰ í•´ë‹¹ í•­ëª©ì— :nickname ì„ ì¶”ê°€í•´ ì£¼ì–´ì•¼ í•¨ê»˜ changeset ìœ¼ë¡œ ë³€í™˜ë˜ì–´, ìœ íš¨ì„±ì„ ê²€ì¦í•˜ê³ , ë‹¤ìŒ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆê²Œ ëœë‹¤. (:nicknameì— ëŒ€í•œ vaildation ì€ í•„ìš”í•˜ì§€ ì•Šì•„ì„œ ì¶”ê°€í•˜ì§€ ì•Šì•˜ìŒ.) def registration_changeset(user, attrs, opts \\\\ []) do user |&gt; cast(attrs, [:email, :password, :nickname]) # :nickname ì¶”ê°€ |&gt; validate_email(opts) |&gt; validate_password(opts) end3. ê³„ì • ìƒì„± ì‹œ nickname ì¶”ê°€ í™”ë©´ êµ¬í˜„user_registration_live.ex render/2 ë‚´ ì•„ë˜ì™€ ê°™ì´ nickname í•­ëª©ì„ ì¶”ê°€í•˜ë©´ ìµœì¢…ì ìœ¼ë¡œ ê³„ì • ìƒì„±ì‹œ nickname ì •ë³´ê¹Œì§€ ì…ë ¥í•´ì•¼ ì¡°ê±´ì„ ë§Œë“¤ì–´ ì¤„ ìˆ˜ ìˆë‹¤.... &lt;.simple_form ... &gt; ... &lt;.input field={@form[:email]} type=\"email\" label=\"Email\" required /&gt; &lt;.input field={@form[:password]} type=\"password\" label=\"Password\" required /&gt; &lt;.input field={@form[:nickname]} label=\"Nickname\" required /&gt; ... &lt;/.simple_form&gt;...users table"
    } ,
  
    {
      "title"       : "(App ê°œë°œ 02) root.html.heex ê³¼ app.html.heex ì— ëŒ€í•´",
      "category"    : "",
      "tags"        : "phoenix, liveview, root.html.heex, app.html.heex, applciation_ê°œë°œ1",
      "url"         : "./root-and-app.html",
      "date"        : "2024-01-25 08:32:20 +0900",
      "description" : "Phoenix LiveView ì—ì„œ ê¸°ë³¸ <head> ì„¤ì • ë° ê³µí†µìœ¼ë¡œ rendering ë  ìš”ì†Œë¥¼ ë„£ì„ ìˆ˜ ìˆëŠ” root.html.heex ê³¼ app.html.heex ì— ëŒ€í•´ ê°ê°ì˜ ìš©ë„ë¥¼ í™•ì¸í•˜ê³  ì´ë¥¼ ìˆ˜ì • ì‚¬ìš©í•˜ëŠ” ì‘ì—… ë°©ë²• í™•ì¸í•¨",
      "content"     : "í˜„ì¬ Phoenix LiveView application ì‘ì—…ì„ ì§„í–‰í•˜ë©´ì„œ, ì•„ë˜ì™€ ê°™ì´ page ìµœìƒë‹¨ì— ë©”ë‰´ë°”ë¥¼ ë„ìš°ê³ ì í•œë‹¤.ë‹¤ë§Œ / ê³¼ /games url ì— ëŒ€í•´ì„œëŠ” ë©”ë‰´ë°”ê°€ ìˆê³ , /games/:id url ì— ëŒ€í•´ì„œëŠ” ë©”ë‰´ë°”ê°€ ì—†ë„ë¡ êµ¬ì„±í•˜ê³  ì‹¶ë‹¤. í•´ë‹¹ ì‘ì—…ì„ ì§„í–‰í•˜ë©´ root.html.heex ì™€ app.html.heex íŒŒì¼ì„ ìˆ˜ì •í•˜ê³ , ìˆ˜ì •ëœ íŒŒì¼ì„ ì–´ë–»ê²Œí•˜ë©´ ì ì ˆí•˜ê²Œ ì´ìš©í•  ìˆ˜ ìˆì„ì§€ ìœ„ì—ì„œì˜ ê³ ë¯¼ì„ í† ëŒ€ë¡œ ê° íŒŒì¼ì— ëŒ€í•´ ì•Œì•„ë³¸ë‹¤.root.html.heex ì—­í• ì´ íŒŒì¼ì€ ì „ì²´ Phoenix ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìµœìƒìœ„ ë ˆì´ì•„ì›ƒì„ ì •ì˜í•˜ë©°, ë‹¤ë¥¸ í…œí”Œë¦¿ë“¤ì€ ì´ ì•ˆì— ì‚½ì…ë˜ì–´ ìµœì¢… HTML ë¬¸ì„œë¥¼ í˜•ì„±í•œë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ê±¸ì³ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” HTML ìš”ì†Œë¥¼ í¬í•¨í•œë‹¤.(&lt;head&gt; íƒœê·¸ ë‚´ì˜ meta data, stylesheet link, javascript íŒŒì¼ ë“±)router.ex ì—ì„œ pipeline :browser ë¥¼ í†µí•´ ì£¼ì…ë˜ë©°, ëª¨ë“  ì •ì  htmlì™€ LiveViewëŠ” ì´ íŒŒì¼ì˜ êµ¬ì¡° ì•ˆì—ì„œ ë Œë”ë§ëœë‹¤.ë§Œì•½ root1.html.heex íŒŒì¼ì—ì„œ í•´ë‹¹ ë©”ë‰´ë°”ë¥¼ êµ¬í˜„í•˜ê³ , root2.html.heex ì—ëŠ” ë©”ë‰´ë°”ë¥¼ êµ¬í˜„í•˜ì§€ ì•Šê³ , ì´ë ‡ê²Œ ë‘ ê°œì˜ íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ pipeline :browser1 , pipeline :browser2 ë¥¼ ê°ê° ì •ì˜í•˜ì—¬ ì´ë¥¼ ê°ê° í•„ìš”í•œ url ì— ë§ê²Œ ì‚¬ìš©í•˜ê³ ì ì‹œë„í•˜ì˜€ìœ¼ë‚˜, ì´ëŸ° ê²½ìš°, ë™ì¼í•œ ë§¤ê°œë³€ìˆ˜ë¥¼ ê°€ì§€ëŠ” live_session macro ê°€ ë‘ë²ˆ ì •ì˜ë˜ì–´ì•¼ í•œë‹¤. ì´ëŠ” ë‹¤ìŒì˜ ì—ëŸ¬ê°€ ë°œìƒì‹œí‚¨ë‹¤.** (RuntimeError) attempting to redefine live_session :require_authenticated_user.live_session routes must be declared in a single named block.ë”°ë¼ì„œ ë™ì¼í•œ scope macro ì—ì„œ ì •ì˜ë˜ì–´ì•¼ í•˜ëŠ” url page ì— ëŒ€í•´ì„œëŠ” ë™ì¼í•œ root.html.heex ê°€ ì ìš©ë˜ì–´ì•¼ í•œë‹¤.app.html.heex ì—­í• app.html.heexëŠ” root.html.heex ë‚´ì— ì‚½ì…ë˜ëŠ”, íŠ¹ì • ë¶€ë¶„ì˜ ë ˆì´ì•„ì›ƒì„ ì •ì˜í•˜ëŠ” íŒŒì¼ë¡œ, ì£¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì£¼ìš” ì»¨í…ì¸ ë¥¼ í¬í•¨í•˜ë©°, íŠ¹ì • í˜ì´ì§€ë‚˜ ì„¹ì…˜ì— ëŒ€í•œ ë ˆì´ì•„ì›ƒì„ ì •ì˜í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´, header, footer, sidebar ë“± í˜ì´ì§€ì˜ ì£¼ìš” ë¶€ë¶„ì„ êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë©°, í˜ì´ì§€ ë³„ë¡œ ë‹¤ë¥¸ ë‚´ìš©ì„ í‘œì‹œí•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤.ë”°ë¼ì„œ url ë³„ë¡œ header ì ìš© ì—¬ë¶€ë¥¼ ë‹¤ë¥´ê²Œ í•˜ê³  ì‹¶ë‹¤ë©´ app.html.heex íŒŒì¼ì„ ê°ê° ë§Œë“¤ì–´ì„œ ê° page mdoule ì—ì„œ ë‹¤ë¥¸ template ì„ ê°€ì ¸ì˜¤ë©´ ëœë‹¤.êµ¬í˜„ê¸°ì¡´ì— ì‘ì„±í•œ header ëŠ” root.html.heex ì— ìˆì—ˆë‹¤. ê·¸ë˜ì„œ í•´ë‹¹ code ë¥¼ app.html.heex ë¡œ ì´ë™ì‹œí‚¤ê³ , header ê°€ ì—†ì€ app_no_header.html.heex ë¥¼ ì¶”ê°€ ìƒì„±í•˜ì˜€ë‹¤.ê·¸ë¦¬ê³  app_no_header.html.heex ì„ liveview ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ my_pjt_web.ex ì— callback í•¨ìˆ˜ë¥¼ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.defmodule MyPjt1Web do ... # ê¸°ì¡´ app.html.heex ë¥¼ layout ë¡œ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ def live_view do quote do use Phoenix.LiveView, layout: {MyPjt1Web.Layouts, :app} unquote(html_helpers()) end end # ì¶”ê°€ëœ í•¨ìˆ˜. app_no_header.html.heex ë¥¼ layout ë¡œ ì‚¬ìš© def live_view_no_header do quote do use Phoenix.LiveView, layout: {MyPjt1Web.Layouts, :app_no_header} unquote(html_helpers()) end end ...endë‹¤ìŒìœ¼ë¡œ ê° url ëŒ€í•œ module ì—ì„œ use macro ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ì—ì„œ ì •ì˜í•œ callback ì„ ë§ê²Œ ê°€ì ¸ì˜´defmodule MyPjt1Web.GameLive.Index do use MyPjt1Web, :live_view ...enddefmodule MyPjt1Web.GameLive.Show do use MyPjt1Web, :live_view_no_header ...endë§ˆì§€ë§‰ìœ¼ë¡œ ë‚¨ì€ ê²ƒì€ get \"/\", PageController, :home ì—ì„œ ê°€ì ¸ì˜¤ëŠ” module ë§Œ ì²˜ë¦¬í•´ì£¼ë©´ ëœë‹¤. ê·¸ëŸ°ë°, ë¶„ëª… my_pjt1_webmodule controller callback ì— layout: {MyPjt1Web.Layouts, :app} ì´ ì •ì˜ë˜ì–´ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³ , application ì‹¤í–‰ì‹œ app.html.heex ì˜ header ê°€ í‘œì‹œë˜ì–´ì§€ì§€ ì•Šì•˜ë‹¤. ê·¸ë˜ì„œ ì–´ì©”ìˆ˜ ì—†ì´ home.html.heex ì— ë™ì¼í•œ header ë¥¼ ì¶”ê°€í•˜ì—¬ ìì²´ì ìœ¼ë¡œ header ë¥¼ rendering í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤."
    } ,
  
    {
      "title"       : "(App ê°œë°œ 01) Phoenix LiveView ì—ì„œ ì‚¬ìš©ì ì •ì˜ JS code ì‚¬ìš© ë°©ë²•",
      "category"    : "",
      "tags"        : "phoenix, liveview, custom javascript, node.js, applciation_ê°œë°œ1",
      "url"         : "./custom-js-phoenix.html",
      "date"        : "2024-01-24 08:32:20 +0900",
      "description" : "Phoenix LiveView ì—ì„œ ì‚¬ìš©ì ì •ì˜ JS code êµ¬í˜„ ë° ì ìš©ì„ ìœ„í•œ Node.js ì„¤ì • ë° render/1 ì— ì ìš©í•˜ëŠ” ê³¼ì •",
      "content"     : "Phoenix LiveView ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ ë²„íŠ¼ í´ë¦­ì‹œ ë²ˆê°ˆì•„ê°€ë©° ë²„íŠ¼ì˜ ë°°ê²½ìƒ‰ê³¼ ë‚´ìš©ì´ ë°”ë€ŒëŠ” toggle button ì„ ì‚¬ìš©í•˜ê³ ì í•˜ì˜€ë‹¤. ê·¸ëŸ°ë° ê¸°ì¡´ì˜ Phoenix LiveView ì œê³µ html tag ë° css ë¡œ ì´ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ì—ˆìœ¼ë©°, ë”°ë¼ì„œ ìì²´ì ìœ¼ë¡œ JS ë¥¼ ì‘ì„±í•˜ì—¬ ê¸°ì¡´ button ì— ì ìš©í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ë‹¤. í•´ë‹¹ ê³¼ì •ì—ì„œ í•„ìš”í•œ ì„¤ì • ë° render/1ì— ì ìš©í•˜ê¸°ê¹Œì§€ì˜ ê³¼ì •ì„ ì •ë¦¬í•˜ê³ ì í•œë‹¤. 1. Node module ì„¤ì¹˜ ë° ê´€ë ¨ package ì„¤ì¹˜(1) package.json ìƒì„±cd assetsnpm initë§Œì•½ package.json íŒŒì¼ì´ ì—†ë‹¤ë©´, ìƒˆë¡œ ìƒì„±í•´ì•¼ í•œë‹¤. ì´ë¥¼ ìœ„í•´ npm init ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ìƒˆë¡œìš´ package.json íŒŒì¼ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ì´ ê³¼ì •ì—ì„œ í”„ë¡œì íŠ¸ì— ëŒ€í•œ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì•¼ í•œë‹¤.(2) npm init ì‘ì—…ì„ ìœ„í•œ ê¸°ë³¸ ì •ë³´ ì…ë ¥npm init ì„ ì‹¤í–‰í•˜ë©´ í”„ë¡œì íŠ¸ ì´ë¦„, ë²„ì „, ì„¤ëª…, ì§„ì…ì (ì£¼ë¡œ index.js), í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´, ì €ì¥ì†Œ, í‚¤ì›Œë“œ, ë¼ì´ì„ ìŠ¤ ë“±ì„ ì…ë ¥ì„ ìš”ì²­ ë°›ëŠ”ë‹¤. ì…ë ¥ì„ ì™„ë£Œí•˜ë©´ package.json ì´ ìƒì„±ë˜ë©°, ì—¬ê¸°ì„œ í•´ë‹¹ ë‚´ìš© ë“±ì„ ìˆ˜ì •, ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. í•´ë‹¹ script ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.{ \"name\": \"***\", \"version\": \"1.0.0\", \"description\": \"phoenix liveview project\", \"main\": \"tailwind.config.js\", \"scripts\": { \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\", }, \"author\": \"***\", \"license\": \"ISC\", \"repository\": { \"type\": \"git\", \"url\": \"git+https://github.com/***/***.git\" }, \"keywords\": [ \"phoenix\" ], \"bugs\": { \"url\": \"https://github.com/***/***/issues\" }, \"homepage\": \"https://github.com/***/***#readme\"}(3) Webpack ì„¤ì¹˜ ì „ ì„¤ì • ì¶”ê°€package.json scripts ì„¹ì…˜ì— deploy ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•´ì•¼ ì›¹íŒ©ì„ ì‚¬ìš©í•˜ì—¬ build í•  ìˆ˜ ìˆë‹¤. script ì„¹ì…˜ ì„¤ì •ì„ í¬í•¨í•œ ë‹¤ìŒ ì½”ë“œë¥¼ package.json ì— ì¶”ê°€í•œë‹¤. \"scripts\": { ..., \"deploy\": \"webpack --mode production\" }Webpack ì„ ì„¤ì¹˜í•  ë•Œ, ì§„ì…ì ì´ í•„ìš”í•˜ë‹¤. assets/src ìœ„ì¹˜ì— index.js íŒŒì¼ì„ ìƒì„±í•˜ê³  í”„ë¡œì íŠ¸ì— í•„ìš”í•œ ê¸°ë³¸ JavaScript ì½”ë“œë‚˜ ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸°(import)ë¥¼ ì¶”ê°€í•œë‹¤.// ì˜ˆì‹œ: assets/src/index.jsimport \"phoenix_html\";// ë‹¤ë¥¸ í•„ìš”í•œ JavaScript ì½”ë“œë‚˜ ëª¨ë“ˆ import(4) Webpack ì„¤ì • config íŒŒì¼ ì¶”ê°€assets ë””ë ‰í† ë¦¬ ë‚´ì— webpack.config.jsì„ ìƒì„±í•˜ê³  ì§„ì…ì (entry point)ìœ¼ë¡œ index.js ì„ ì„¤ì •í•´ì¤€ë‹¤. ê·¸ ë°–ì— output, loader ë“±ì„ í¬í•¨í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±í•œë‹¤.const path = require('path');module.exports = { // ì§„ì…ì  ì„¤ì • entry: './js/app.js', // ì´ ê²½ë¡œëŠ” í”„ë¡œì íŠ¸ì— ë§ê²Œ ì¡°ì •í•´ì•¼ í•©ë‹ˆë‹¤ // ì¶œë ¥ ì„¤ì • output: { path: path.resolve(__dirname, '../priv/static/assets'), // ì¶œë ¥ ë””ë ‰í† ë¦¬ filename: 'app.js', // ì¶œë ¥ íŒŒì¼ëª… }, // ëª¨ë“ˆ ì„¤ì • module: { rules: [ { test: /\\.js$/, // .js íŒŒì¼ì— ëŒ€í•œ ì²˜ë¦¬ exclude: /node_modules/, // node_modules ë””ë ‰í† ë¦¬ ì œì™¸ use: { loader: 'babel-loader', // Babel ë¡œë” ì‚¬ìš© options: { presets: ['@babel/preset-env'], // Babel í”„ë¦¬ì…‹ ì„¤ì • }, }, }, // ì¶”ê°€ì ì¸ ë¡œë” ì„¤ì •(ì˜ˆ: CSS, ì´ë¯¸ì§€ íŒŒì¼ ë“±) ], },};2. Node ëª¨ë“ˆ ì„¤ì¹˜ ë° Node.js ì˜ì¡´ì„± ì„¤ì •(1) Node ëª¨ë“ˆ ì„¤ì¹˜assets ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•˜ì—¬ npm installì„ ì‹¤í–‰í•œë‹¤. ì´ ëª…ë ¹ì–´ëŠ” package.jsonì— ì •ì˜ëœ ëª¨ë“  Node ì˜ì¡´ì„±ì„ ì„¤ì¹˜í•œë‹¤. Phoenix í”„ë¡œì íŠ¸ì˜ ê²½ìš°,phoenix, phoenix_html, phoenix_live_view íŒ¨í‚¤ì§€ë“¤ì€ ìë™ìœ¼ë¡œ package.jsonì— ì¶”ê°€ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.cd assetsnpm install(2) Node.js í•„ìˆ˜ Package ì„¤ì¹˜- Webpack assets (HTML, CSS, JavaScript íŒŒì¼, ì´ë¯¸ì§€, í°íŠ¸ ë“± ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì„±í•˜ëŠ” ëª¨ë“  ì •ì  íŒŒì¼ë“¤) ì„ bundling (ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ì„ í•˜ë‚˜ ë˜ëŠ” ì†Œìˆ˜ì˜ íŒŒì¼ë¡œ ê²°í•©í•˜ëŠ” ê³¼ì •. ì´ë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ìµœì†Œí™”, application ìµœì í™”, ì˜ì¡´ì„± ê´€ë¦¬ì˜ ì´ì ì´ ìˆìŒ) í•˜ê¸° ìœ„í•´ í•„ìš”npm install webpack webpack-cli --save-dev- Babel JavaScript ì½”ë“œë¥¼ ë³€í™˜í•˜ê¸° ìœ„í•œ ì»´íŒŒì¼ëŸ¬. ES6 ì´ìƒì˜ ì½”ë“œë¥¼ ì´ì „ ë²„ì „ì˜ JavaScriptë¡œ ë³€í™˜í•˜ëŠ”ë° ì‚¬ìš©.npm install @babel/core @babel/preset-env babel-loader --save-dev- CSS ê´€ë ¨ packageCSSë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ í•„ìš”í•œ íŒ¨í‚¤ì§€ë“¤npm install css-loader style-loader mini-css-extract-plugin --save-dev- Tailwind CSSnpm install tailwindcss postcss autoprefixer --save-dev(3) Node.js Package ì¤‘ Phoenix LiveView ê´€ë ¨ ì„¤ì¹˜phoenix, phoenix_live_view, phoenix_html package ë¥¼ ì„¤ì¹˜í•˜ê¸° ì „, assets/js/app.js ë‹¤ìŒ ì½”ë“œê°€ ì—†ë‹¤ë©´ ì¶”ê°€í•´ì¤€ë‹¤.(phoenix_live_view 0.20.1 ê¸°ì¤€ ê¸°ë³¸ì ìœ¼ë¡œ ì¶”ê°€ë˜ì–´ ìˆìŒ.)import \"phoenix_html\";import { Socket } from \"phoenix\";import { LiveSocket } from \"phoenix_live_view\";assets ë””ë ‰í† ë¦¬ì—ì„œ í•´ë‹¹ package ë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.npm install --save phoenix phoenix_html phoenix_live_viewì œëŒ€ë¡œ ì„¤ì¹˜ë˜ì—ˆë‹¤ë©´, ì•ì—ì„œ ì„¤ì¹˜í•œ Node.js Package ë””ë ‰í† ë¦¬ê°€ assets/node_modulesì— ìƒì„±ëœë‹¤.3. JavaScript íŒŒì¼ ì‘ì„±ì•ì˜ ê³¼ì •ì—ì„œ ì‚¬ìš©ì ì •ì˜ JavaScript ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ê´€ë ¨ ì„¤ì •ì„ ì™„ë£Œí•˜ì˜€ìœ¼ë¯€ë¡œ, ì´ì œ í”„ë¡œì íŠ¸ì˜ assets/js ë””ë ‰í† ë¦¬ ì•ˆì— ì‚¬ìš©ì ì •ì˜ JavaScript íŒŒì¼ì„ ìƒì„± (ex. assets/js/custom.js) í•œë‹¤.export function toggleButton(btn) { btn.classList.toggle('bg-blue-500'); btn.classList.toggle('bg-gray-600'); if (btn.innerText === 'READY !!') { btn.innerText = 'WAIT ...... '; } else { btn.innerText = 'READY !!'; }}4. Phoenix í”„ë¡œì íŠ¸ì— JavaScript í†µí•©(1) app.jsì—ì„œ ì‚¬ìš©ì ì •ì˜ custom.js ê°€ì ¸ì˜¤ê¸°.assets/js/app.js íŒŒì¼ì„ ì—´ê³ , ë§Œë“¤ì–´ì§„ custom.js ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ import í•´ì¤€ë‹¤.// assets/js/app.jsimport { toggleButton } from \"./custom\";window.toggleButton = toggleButton;ì´ë ‡ê²Œ í•˜ë©´ customFunctionì„ ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ì—¬, HTMLì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ëœë‹¤.(2) Webpack buildì§€ê¸ˆê¹Œì§€ì˜ ë³€ê²½ì‚¬í•­ì„ ì ìš©í•˜ê¸° ìœ„í•´ assets ë””ë ‰í† ë¦¬ì—ì„œ npm run deployë¥¼ ì‹¤í–‰í•˜ì—¬ JavaScript íŒŒì¼ì„ ë¹Œë“œí•œë‹¤.5. LiveViewì—ì„œ JavaScript ì‚¬ìš©(1) LiveView í…œí”Œë¦¿ì— ìŠ¤í¬ë¦½íŠ¸ ì ìš©LiveViewì˜ render/1 í•¨ìˆ˜ì—ì„œ í•´ë‹¹ JavaScript í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” HTMLì„ ë°˜í™˜def render(assigns) do ~H\"\"\" ... ... &lt;button type=\"button\" onclick=\"window.toggleButton(this)\" class=\"text-white bg-blue-500 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2\"&gt; READY !! &lt;/button&gt; ... ... \"\"\"endê²°ë¡  ìœ„ ì‘ì—…ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ì˜ë„í•œëŒ€ë¡œ ì‚¬ìš©ì ì •ì˜ toggle button ì´ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤."
    } ,
  
    {
      "title"       : "impl attribute",
      "category"    : "",
      "tags"        : "elixir, impl, attribute",
      "url"         : "./impl_attribute.html",
      "date"        : "2024-01-23 15:32:20 +0900",
      "description" : "impl attribute",
      "content"     : "elixir code ë¥¼ ì‘ì„±í•  ë•Œ, behaviour ë‚˜ macro ì˜ callback ì˜ êµ¬í˜„ì²´ë¥¼ ì •ì˜í•˜ëŠ” êµ¬ì¡°ëŠ” ì¼ë°˜ í•¨ìˆ˜ì™€ ë™ì¼í•˜ë‹¤. ì´ë¥¼ êµ¬ë³„í•˜ê¸° ìœ„í•´ @impl trueë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²½ìš°, ì‘ì—…ì— ë¬¸ì œê°€ ë°œìƒí•˜ì§€ëŠ” ì•Šìœ¼ë‚˜ IDE ë‚˜ complier ê°€ ì•„ë˜ ë‚´ìš©ì˜ warning ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆë‹¤.module attribute @impl was not set for function init/1 callback (specified in GenServer). This either means you forgot to add the \"@impl true\" annotation before the definition or that you are accidentally overriding this callbackì•„ìš¸ëŸ¬ í•´ë‹¹ attribute ë¥¼ ì‚¬ìš©í–ˆì„ ë•Œì˜ ì¥ì ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. ëª…í™•ì„±: @impl trueëŠ” í•´ë‹¹ í•¨ìˆ˜ê°€ íŠ¹ì • í–‰ìœ„(behaviour)ì˜ callback í•¨ìˆ˜ì„ì„ ëª…í™•íˆ í•¨. ë”°ë¼ì„œ ê°€ë…ì„±ì´ ë†’ì•„ì§ˆ ìˆ˜ ìˆìŒ. ì»´íŒŒì¼ëŸ¬ ê²€ì¦: @impl trueë¥¼ ì‚¬ìš©í•˜ë©´ Elixir compilerê°€ í•´ë‹¹ í•¨ìˆ˜ê°€ ì‹¤ì œë¡œ ì§€ì •ëœ í–‰ìœ„ì˜ callback í•¨ìˆ˜ì¸ì§€ë¥¼ ê²€ì¦í•¨ìœ¼ë¡œ ì¨, ì˜ëª»ëœ callback í•¨ìˆ˜ì¼ ê²½ìš°, compile ë‹¨ê³„ì—ì„œ ì´ë¥¼ ê°ì§€í•  ìˆ˜ ìˆì–´ì§ ë¬¸ì„œí™”: @impl trueë¥¼ ì‚¬ìš©í•˜ë©´ ExDocê³¼ ê°™ì€ ë¬¸ì„œí™” ë„êµ¬ì—ì„œ í•´ë‹¹ í•¨ìˆ˜ê°€ ì½œë°± í•¨ìˆ˜ì„ì„ ìë™ìœ¼ë¡œ ì‹ë³„í•˜ì—¬ ë¬¸ì„œí™”í•  ìˆ˜ ìˆìŒ. ìœ ì§€ë³´ìˆ˜ ìš©ì´ì„±: ì½”ë“œì˜ ìœ ì§€ë³´ìˆ˜ë¥¼ ë‹´ë‹¹í•˜ëŠ” ë‹¤ë¥¸ ê°œë°œìë“¤ì—ê²Œ í•´ë‹¹ í•¨ìˆ˜ì˜ ì—­í• ê³¼ ì¤‘ìš”ì„±ì„ ì‰½ê²Œ ì „ë‹¬í•  ìˆ˜ ìˆìŒ. ì˜ˆì‹œdefmodule ImplAttribute do use GenServer ... ... @impl true def init(list) do {:ok, list} end @impl true def handle_call(:view, _from, list) do {:reply, list, list} end ... ...endë§Œì•½ callback ì´ ì•„ë‹Œ ì¼ë°˜ í•¨ìˆ˜ì— í•´ë‹¹ attribute ë¥¼ ì‚¬ìš©í•  ê²½ìš° ë‹¤ìŒê³¼ ê°™ì€ warning ì´ ë°œìƒí•œë‹¤.defmodule ImplAttribute do use GenServer ... ... @impl true def start_link() do GenServer.start_link(__MODULE__, []) end @impl true def view(pid) do GenServer.call(pid, :view) end ... ...endgot \"@impl true\" for function add/2 but no behaviour specifies such callback. The known callbacks are: ... ...ê·¸ë ‡ë‹¤ë©´ ë‹¤ë¥¸ @impl attribute ëŠ”?@impl Module: ì—¬ê¸°ì„œ Moduleì€ íŠ¹ì • í–‰ìœ„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ëª¨ë“ˆ. ì´ í˜•ì‹ì€ í•¨ìˆ˜ê°€ íŠ¹ì • í–‰ìœ„ì˜ ì¼ë¶€ì„ì„ ë” ëª…ì‹œì ìœ¼ë¡œ ë‚˜íƒ€ë‚´ëŠ” ë° ì‚¬ìš©ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´, @impl GenServerëŠ” í•´ë‹¹ í•¨ìˆ˜ê°€ GenServer í–‰ìœ„ì˜ callbackì„ì„ ë‚˜íƒ€ë‚¸ë‹¤.defmodule MyGenServer do use GenServer # Client API def start_link(args) do GenServer.start_link(__MODULE__, args, name: __MODULE__) end def add(pid, value) do GenServer.cast(pid, {:add, value}) end # Server Callbacks @impl GenServer def init(args) do {:ok, args} end @impl GenServer def handle_cast({:add, value}, state) do new_state = state + value {:noreply, new_state} endend@impl GenServer attributeëŠ” init/1 ë° handle_cast/2 í•¨ìˆ˜ê°€ GenServerì˜ callbackì„ì„ ëª…ì‹œ"
    } ,
  
    {
      "title"       : "Elixir GenServer",
      "category"    : "",
      "tags"        : "elixir, genserver, pubsub",
      "url"         : "./genserver.html",
      "date"        : "2024-01-23 10:32:20 +0900",
      "description" : "Elixir GenServer",
      "content"     : "Elixirì˜ GenServerëŠ” OTP(Open Telecom Platform) behaviour ì¤‘ í•˜ë‚˜ë¡œ, ì„œë²„ í”„ë¡œì„¸ìŠ¤ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ì¶”ìƒí™”ë¥¼ ì œê³µí•œë‹¤. GenServerëŠ” í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ê´€ê³„ì—ì„œ ì„œë²„ ë¶€ë¶„ì„ ë‹´ë‹¹í•˜ë©°, ìƒíƒœë¥¼ ìœ ì§€í•˜ê³ , ìš”ì²­ì„ ë™ê¸°ì  ë˜ëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” Elixir/Erlang ì‹œìŠ¤í…œì—ì„œ ë³‘ë ¬ì²˜ë¦¬ì™€ ìƒíƒœ ê´€ë¦¬ë¥¼ ìš©ì´í•˜ê²Œ í•˜ëŠ” ê°•ë ¥í•œ ë„êµ¬ì´ë‹¤.GenServer ì˜ ë‹¤ì–‘í•œ macro callback ì¤‘ ì£¼ìš”í•œ ê²ƒì„ì„ ì‚¬ìš©í•˜ì—¬ í†µì‹  moudule ì„ êµ¬í˜„í•˜ê³ ì í•œë‹¤. í•´ë‹¹ module ì˜ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. module ë‚´ êµ¬ì„±ì€ í¬ê²Œ client ì™€ server êµ¬í˜„ ë¶€ë¶„ìœ¼ë¡œ êµ¬ë¶„ ëœë‹¤. client ëŠ” ê²½ìš°, í•´ë‹¹ module ì´ ì‹¤í–‰ë˜ëŠ” application ìì²´ ë˜ëŠ” ì¼ë¶€ process ì—ì„œ ì‹¤í–‰ë  code ì´ë©°, í•´ë‹¹ code ë¥¼ í†µí•´ server process ë¥¼ ìƒì„±, ë™ê¸°/ë¹„ë™ê¸° ì‘ì—… ìš”ì²­ ë° ì‘ë‹µ, ì¢…ë£Œ ë“±ì˜ ì‘ì—…ì„ ì •ì˜í•œë‹¤.server ë¶€ë¶„ì˜ ê²½ìš°, client ì‘ì—… ìš”ì²­ì— ëŒ€ì‘í•˜ëŠ” ì‘ì—…ì— ëŒ€í•œ code ë¥¼ ì •ì˜í•œë‹¤. ìœ„ì— ì–¸ê¸‰ëœ GenServer callback ë“¤ì˜ ê²½ìš°, ëª¨ë‘ GenServer behaviourì˜ êµ¬í˜„ì²´ì´ë‹¤.client-server ì— ê° callback ë“¤ì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤. Server ìƒì„± start_link/3: ìƒˆë¡œìš´ GenServer í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•˜ê³  ì—°ê²° init/1: start_link/3 ìš”ì²­ì— ì˜í•´ GenServerê°€ ì‹œì‘ë  ë•Œ í˜¸ì¶œë˜ë©°, ì´ˆê¸° ìƒíƒœë¥¼ ì„¤ì • ë¹„ë™ê¸° ìš”ì²­/ì‘ë‹µ cast/2: ë¹„ë™ê¸°ì  í†µì‹ ì— ì‚¬ìš©. client ëŠ” server ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê³  ì¦‰ì‹œ ë°˜í™˜ë¨. ì´ ë©”ì†Œë“œëŠ” ì„œë²„ì˜ handle_cast/2 callbackì„ trigger. handle_cast/2: ë¹„ë™ê¸°ì  ìš”ì²­ì„ ì²˜ë¦¬. í´ë¼ì´ì–¸íŠ¸ëŠ” ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ. ë™ê¸° ìš”ì²­/ì‘ë‹µ call/3: ë™ê¸°ì  í†µì‹ ì— ì‚¬ìš©. clientëŠ” serverì— ìš”ì²­ì„ ë³´ë‚´ê³ , serverê°€ ì‘ë‹µí•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ë©°, serverì˜ handle_call/3s callbackì„ trigger. handle_call/3: ë™ê¸°ì  ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ clientdì—ê²Œ ì‘ë‹µ. Server ì¢…ë£Œ stop/3: GenServer í”„ë¡œì„¸ìŠ¤ë¥¼ ì•ˆì „í•˜ê²Œ ì¢…ë£Œí•˜ê¸° ìœ„í•´ ì‚¬ìš©. ì´ í•¨ìˆ˜ëŠ” ì¢…ë£Œ ì´ìœ (ex. 'normal', 'shutdown', 'kill' ë“±)ì™€ íƒ€ì„ì•„ì›ƒ(default : 5 sec)ì„ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, ì„œë²„ì˜ terminate/2 callbackì„ trigger. terminate/2: serverê°€ ì¢…ë£Œë˜ê¸° ì „ì— í˜¸ì¶œë˜ëŠ” callback GenServer í”„ë¡œì„¸ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë  ë•Œ í˜¸ì¶œë˜ë©°, ì¢…ë£Œ ì „ì— í•„ìš”í•œ ì •ë¦¬ ì‘ì—…(ex.ì¢…ë£Œë˜ê¸° ì „ì— ìƒíƒœë¥¼ ì €ì¥í•˜ê±°ë‚˜ ì—´ë ¤ ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ë‹«ëŠ” ë“±ì˜ ì‘ì—… ë“±)ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆì œ ì½”ë“œ defmodule ShopingList do use GenServer # ------ client API -------- def start_link() do GenServer.start_link(__MODULE__, []) end def add(pid, item) do GenServer.cast(pid, item) end def view(pid) do GenServer.call(pid, :view) end def remove(pid, item) do GenServer.cast(pid, {:remove, item}) end def stop(pid) do GenServer.stop(pid, :normal, :infinity) end # ----- server callback ----- def init(list) do {:ok, list} end def handle_cast({:remove, item}, list) do updated_list = Enum.reject(list, fn(i) -&gt; i == item end) {:noreply, updated_list} end def handle_cast(item, list) do updated_list = [item|list] {:noreply, updated_list} end def handle_call(:view, _from, list) do {:reply, list, list} end def terminate(_reason, list) do IO.puts(\"This Server is termniated.\") IO.inspect(list) endendì‹¤í–‰ ê²°ê³¼iex(1)&gt; {:ok, pid} = ShoppingList.start_link(){:ok, #PID&lt;0.422.0&gt;}ShoppingList.start_link() ë¥¼ í†µí•´ server process ë¥¼ ìƒì„±í•œë‹¤. server ì¸¡ init(list) í•¨ìˆ˜ callback ì´ ì‹¤í–‰ë˜ì–´ server process ë¥¼ ì´ˆê¸°í™” í•˜ê³  ê·¸ ê²°ê³¼ ë° pid ë¥¼ client ì—ê²Œ ë°˜í™˜í•œë‹¤.iex(2)&gt; ShoppingList.add(pid, \"eggs\") :okiex(3)&gt; ShoppingList.add(pid, \"milk\") :okiex(4)&gt; ShoppingList.add(pid, \"cheese\") :okiex(5)&gt; ShoppingList.view(pid) [\"cheese\", \"milk\", \"eggs\"]ShoppingList.add(pid, \"eggs\") ë“±ì˜ í•¨ìˆ˜ë¥¼ í†µí•´ server process ë¹„ë™ê¸° ì‘ì—…ì„ ìš”ì²­í•œë‹¤. :ok ì‘ë‹µì€ server ì‘ì—…ì˜ ì™„ë£Œì™€ ê´€ê³„ì—†ì´ ë°˜í™˜ëœë‹¤. handle_cast(item, list)ê°€ ì‘ì—…ì„ í•˜ì—¬ server ìì²´ list ì— client ê°€ ë³´ë‚¸ ë©”ì„¸ì§€ë¥¼ list ì— ì¶”ê°€í•œë‹¤.ShoppingList.view(pid) ë¥¼ í†µí•´ ë™ê¸°í™”ëœ ì‘ì—…ì„ ìš”ì²­í•œë‹¤. í•´ë‹¹ ìš”ì²­ìœ¼ë¡œ handle_call(:view, _from, list) callback ì´ trigger ëœë‹¤. í•´ë‹¹ callback ë°˜í™˜ê°’ íŠœí”Œ{:reply, list, list}ì˜ ê° ìš”ì†ŒëŠ” ë‹¤ìŒì˜ ì˜ë¯¸ë¥¼ ê°€ì§„ë‹¤. :reply: client ì—ê²Œ ë™ê¸°ì ìœ¼ë¡œ ì‘ë‹µì„ ë³´ë‚´ì•¼ í•¨ì„ ì˜ë¯¸ list: client ì—ê²Œ ë³´ë‚¼ ì‹¤ì œ ì‘ë‹µ data list: í•´ë‹¹ callback ì‘ì—… ì´í›„ server ê°€ ê°€ì§ˆ dataiex(6)&gt; ShoppingList.remove(pid, \"cheese\") :okiex(7)&gt; ShoppingList.view(pid)[\"milk\", \"eggs\"]ShoppingList.remove(pid, \"cheese\") ì˜ ê²½ìš° ì•ì—ì„œ ì‚¬ìš©í•œ ShoppingList.add(pid, \"eggs\") ì™€ ë™ì¼í•˜ê²Œ ë¹„ë™ê¸° ì‘ì—…ì„ ìš”ì²­í•˜ì§€ë§Œ í•¨ìˆ˜ ë‹¤í˜•ì„±(polymorphism) ì„ ì ìš©í•˜ì—¬ ë³„ë„ë¡œ ì •ì˜ëœ handle_cast({:remove, item}, list) callback ì„ trigger í•œë‹¤.iex(8)&gt; ShoppingList.stop(pid) This Server is termniated.[\"milk\", \"eggs\"]:okserver process ì„ ì¢…ë£Œ ìš”ì²­ì„ ë³´ë‚´ê³  triggering ëœ terminate(_reason, list) ì‘ì—…ì„ ì§„í–‰í•˜ê³  í•´ë‹¹ process ëŠ” ì¢…ë£Œëœë‹¤.Phoenix PubSub ê³¼ GenServer Phoenix PubSubì€ ë‚´ë¶€ì ìœ¼ë¡œ GenServerë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì¶•ëœë‹¤. Phoenix PubSubì€ Elixir ì–´í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì—ì„œ í”„ë¡œì„¸ìŠ¤ ê°„ì˜ ë©”ì‹œì§•ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì´ëŠ” ì£¼ë¡œ Phoenix framework ë‚´ì—ì„œ ì‹¤ì‹œê°„ ì›¹ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, ì›¹ì†Œì¼“ì„ í†µí•´ client-server ê°„ì˜ ë©”ì‹œì§€ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ êµí™˜í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. ê·¸ ì£¼ìš” ì—­í• ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. ìƒíƒœ ê´€ë¦¬: ê° PubSub ì„œë²„ëŠ” êµ¬ë… ì •ë³´ì™€ ê°™ì€ ìƒíƒœë¥¼ ìœ ì§€ ê´€ë¦¬. ë©”ì‹œì§€ ì²˜ë¦¬: ë°œí–‰ëœ ë©”ì‹œì§€ëŠ” GenServer í”„ë¡œì„¸ìŠ¤ë¥¼ í†µí•´ êµ¬ë…ìë“¤ì—ê²Œ ì „ë‹¬. ë™ê¸°í™” ë° ì œì–´: GenServer callbackì„ í†µí•´ ë©”ì‹œì§€ ì „ì†¡ ë° êµ¬ë… ê´€ë¦¬ë¥¼ ì œì–´.ì°¸ê³  ë¬¸í—Œ - ElixirCasts - #12: Intro to GenServer"
    } ,
  
    {
      "title"       : "changeset/2 in Ecto Library",
      "category"    : "",
      "tags"        : "ecto, changeset/2",
      "url"         : "./changeset.html",
      "date"        : "2024-01-15 10:32:20 +0900",
      "description" : "changeset/2 in Ecto Library",
      "content"     : "Phoenix LiveView ì—ì„œ DB ì²˜ë¦¬ ì‘ì—…ì€ Ecto library ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ì—…ì´ ì§„í–‰ëœë‹¤. ì´ì™€ ê´€ë ¨í•˜ì—¬, Ecto ì˜ ê¸°ëŠ¥ê³¼ êµ¬ì„±ìš”ì†Œì— ëŒ€í•´ ì•Œì•„ë³´ê³ , ì—¬ê¸°ì—ì„œ changeset/2 í•¨ìˆ˜ì— ëŒ€í•´ ì¢€ë” ì•Œì•„ ë³¸ë‹¤. Ecto ë€?Phoenix LiveView ì—ì„œ ì‚¬ìš©í•˜ëŠ” Ecto library ëŠ” Elixir ì–¸ì–´ë¥¼ ìœ„í•œ database wrapper ì´ë‹¤. ì£¼ë¡œ Elixir web-framewor ì¸ Phoenix ì™€ í•¨ê»˜ ì‚¬ìš©ë˜ë©°, ë°ì´í„°ë² ì´ìŠ¤ ìƒí˜¸ì‘ìš©ì„ íš¨ìœ¨ì ìœ¼ë¡œ ë§Œë“¤ì–´ ì¤€ë‹¤.êµ¬ì„±ìš”ì†Œ Repo (Repository) ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ëª¨ë“  ìƒí˜¸ì‘ìš©(CRUD)ì„ ì²˜ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ì— queryë¥¼ ë³´ë‚´ê³  ê²°ê³¼ë¥¼ ë°˜í™˜ ë°›ìŒ ì—¬ëŸ¬ Repo ë¥¼ ì§€ì› í•  ìˆ˜ ìˆì–´, ë‹¤ì–‘í•œ ë°ì´í„°ë² ì´ìŠ¤ì™€ ë™ì‹œì— ì‘ì—… ê°€ëŠ¥ Schema ë°ì´í„°ë² ì´ìŠ¤ table ê³¼ Elixir êµ¬ì¡°ì²´ ê°„ mapping ì„ ì •ì˜ ê° field ëŠ” Elixir data type ìœ¼ë¡œ ì„ ì–¸ë¨ schema ëŠ” data ìœ íš¨ì„± ê²€ì‚¬ì™€ ì œì•½ ì¡°ê±´ë„ í•¨ê»˜ ì •ì˜í•¨ Changeset data ë¥¼ ì‚½ì…í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•˜ê¸° ì „ì— ë°ì´í„°ë¥¼ ê²€ì¦í•˜ê³  ë³€í™˜í•˜ëŠ” ì—­í•  ìœ íš¨ì„± ê²€ì‚¬, ì œì•½ ì¡°ê±´ í™•ì¸, filtering, í˜•ì‹ ë³€í™˜ ë“±ì„ ì²˜ë¦¬ Query Elixir ì˜ êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ database query ë¥¼ ìƒì„± ë˜ëŠ” ì‚¬ìš©ì ì •ì˜ query êµ¬í˜„ ê°€ëŠ¥í•˜ë„ë¡ í•¨ query ëŠ” Ecto.Query module ì„ ì‚¬ìš©í•˜ì—¬ ì‘ì„±ë¨ query ëŠ” compile íƒ€ì„ì— ìƒì„±ë˜ë¯€ë¡œ, íš¨ìœ¨ì ì¸ ì„±ëŠ¥ì„ ë°œíœ˜í•¨ Ecto ì˜ íŠ¹ì§• Database Adapter : PostgreSQL, MySQL, SQLite ë“± ë‹¤ì–‘í•œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§€ì› Migration : ë°ì´í„°ë² ì´ìŠ¤ schema ë³€ê²½ì„ ìœ„í•œ migration ì„ ì‰½ê²Œ ê´€ë¦¬ Transaction: ë°ì´í„°ë² ì´ìŠ¤ transactionì„ í†µí•´ ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ì¥ Multi-Tenancy : í•„ìš”í•œ ê²½ìš°, ë™ì¼í•œ app ë‚´ì—ì„œ ì—¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë‹¤ë£° ìˆ˜ ìˆìŒchangset/2changset/2ì˜ ì—­í•  cast/3ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ êµ¬ì¡°ì²´ type ì˜ user data ë¥¼ êµ¬ì¡°ì²´ í˜•íƒœë¡œ ë³€í™˜í•˜ì—¬ Ecto ë°ì´í„°ë² ì´ìŠ¤ schema ì™€ ì•ˆì „í•œ ìƒíƒœë¡œ mapping ë  ìˆ˜ ìˆë„ë¡ ë³€í™˜ ê´€ë ¨ feild ê°’ì„ capture í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ê°’ê³¼ ë¹„êµ, ë³€ê²½ ì—¬ë¶€ë¥¼ í™•ì¸ í˜„ì¬ ì‘ì—… ì¤‘ì´ ê°’ì´ ìœ íš¨í•œì§€ë¥¼ ê²€ì¦í•œë‹¤. ë³€ê²½ëœ ê°’ì´ query ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ê°’ì´ ì €ì¥ ë˜ëŠ” ìˆ˜ì •ë˜ê¸° ì „ì—, ìœ íš¨ì„± (field type, ê¸¸ì´, ê°’ì˜ ë²”ìœ„, ì¡´ì¬ ì—¬ë¶€ ë“±) ì„ í™•ì¸í•˜ì—¬ ì˜ëª»ëœ í˜•ì‹ ë˜ëŠ” ì˜ëª»ëœ ê°’ì´ ì•„ë‹Œì§€ë¥¼ ë¨¼ì € íŒë‹¨í•œë‹¤. í•´ë‹¹ ê³¼ì •ì€ ê° field ì— ëŒ€í•´ í•­ìƒ ë™ì¼í•œ ê·œì¹™ê³¼ ì¡°ê±´ì„ ì ìš©í•œë‹¤. (consistent rule) ìœ íš¨ì„± í™•ì¸ì˜ ê²°ê³¼ë¡œ :ok ë˜ëŠ” :error ìƒíƒœë¥¼ ë°˜í™˜í•˜ì—¬ context ê°€ query ì‘ì—…ì„ ì§„í–‰í• ì§€ ì—¬ë¶€ì— ëŒ€í•œ state ë¥¼ ì œê³µí•œë‹¤.ì˜ˆì œ codedef changeset(product, attrs) do product |&gt; cast(attrs, [:name, :description, :unit_price, :sku]) |&gt; validate_required([:name, :description, :unit_price, :sku]) |&gt; unique_constraint(:sku) |&gt; validate_number(:unit_price, greater_than: 0.0)end cast/3 ë¥¼ í†µí•´ attr key-values ì¤‘ product êµ¬ì¡°ì²´ì˜ field ([:name, :description, :unit_price, :sku]) ì— í•´ë‹¹í•˜ëŠ” ê°’ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  í•´ë‹¹í•˜ëŠ” ê°’ì„ product êµ¬ì¡°ì²´ë¡œ ë³€í™˜ validate/2, unique_constraint/2, validate_number/2 í•¨ìˆ˜ë“¤ì„ í†µí•´ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì§„í–‰ ìµœì¢…ìœ¼ë¡œ í•´ë‹¹ ê°’ì´ ì¡´ì¬í•˜ê³ , ìœ íš¨ì„±ì— ë¬¸ì œê°€ ì—†ìœ¼ë©´ :ok ì•„ë‹ˆë©´ :error ìƒíƒœë¥¼ ë°˜í™˜í•œë‹¤. ì°¸ê³  ë¬¸í—Œ - programming-phoenix-liveview_B10.0"
    } ,
  
    {
      "title"       : "Lazy Collection ê³¼ Stream library",
      "category"    : "",
      "tags"        : "elixir, lazy collection, elixir stream",
      "url"         : "./lazy-collection.html",
      "date"        : "2024-01-07 10:32:20 +0900",
      "description" : "Lazy Collection ê³¼ Stream library",
      "content"     : "Lazy CollectionLazy Colleciton ì€ Elixirì™€ ê°™ì€ í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì—ì„œ ì¤‘ìš”í•œ ê°œë… ì¤‘ í•˜ë‚˜ë¡œ ë°ì´í„°ê°€ ì‹¤ì œë¡œ í•„ìš”í•  ë•Œê¹Œì§€ ê·¸ ì²˜ë¦¬ë¥¼ ì—°ê¸°í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ë™í•œë‹¤. ì´ ë°©ì‹ì€ íŠ¹íˆ ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ë‹¤ë£° ë•Œ ë©”ëª¨ë¦¬ ì‚¬ìš©ì„ ìµœì†Œí™”í•˜ê³  ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.stream = Stream.map(1..10000, &amp;(&amp;1 * &amp;1))ì´ ì½”ë“œëŠ” 1ë¶€í„° 10,000ê¹Œì§€ì˜ ìˆ«ì ê°ê°ì— ëŒ€í•´ ì œê³±ì„ í•˜ëŠ” ìŠ¤íŠ¸ë¦¼ì„ ìƒì„±í•œë‹¤. ê·¸ëŸ¬ë‚˜ ì‹¤ì œ ì œê³± ì—°ì‚°ì€ ìŠ¤íŠ¸ë¦¼ì„ ì—´ê±°í•˜ëŠ” ì‹œì , ì˜ˆë¥¼ ë“¤ì–´ Enum.to_list(stream)ì„ í˜¸ì¶œí•  ë•Œê¹Œì§€ ìˆ˜í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.íŠ¹ì§•ë¹„ë™ê¸° ì²˜ë¦¬: lazy collectionì€ ë°ì´í„°ì˜ ì „ì²´ ì§‘í•©ì„ ë©”ëª¨ë¦¬ì— í•œ ë²ˆì— ë¡œë“œí•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹ , ìš”ì†Œë“¤ì€ í•„ìš”í•  ë•Œ, ì¦‰ ì‹¤ì œë¡œ ì—´ê±°(enumerate)í•˜ê±°ë‚˜ ì ‘ê·¼í•  ë•Œ ì²˜ë¦¬ëœë‹¤.íš¨ìœ¨ì„±: lazy collectionì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ì„ ìµœì í™”í•œë‹¤. í° ë°ì´í„°ì…‹ì„ í•œ ë²ˆì— ì²˜ë¦¬í•˜ëŠ” ëŒ€ì‹ , ì‘ì€ ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆ„ì–´ í•„ìš”í•œ ë¶€ë¶„ë§Œ ì²˜ë¦¬í•œë‹¤. ì´ëŠ” íŠ¹íˆ íŒŒì¼ ì½ê¸°, ì™¸ë¶€ API í˜¸ì¶œ, ëŒ€ê·œëª¨ ê³„ì‚°ê³¼ ê°™ì€ ìƒí™©ì—ì„œ ìœ ìš©í•˜ë‹¤.Function Chaining: lazy collectionì€ ì—¬ëŸ¬ í•¨ìˆ˜ë¥¼ ì—°ê²°(chaining)í•˜ì—¬ ë³µì¡í•œ ë°ì´í„° ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•  ìˆ˜ ìˆë‹¤. ê° í•¨ìˆ˜ëŠ” ì´ì „ í•¨ìˆ˜ì˜ ì¶œë ¥ì„ ì…ë ¥ìœ¼ë¡œ ë°›ì•„ ì²˜ë¦¬í•œë‹¤.(ì•„ë˜ ë³´ì¶© ì„¤ëª… ì°¸ì¡°)Stream Module: Elixirì—ì„œ lazy collectionì„ êµ¬í˜„í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì£¼ìš” ëª¨ë“ˆì€ Streamì´ë‹¤. Stream ëª¨ë“ˆì€ ë‹¤ì–‘í•œ ì§€ì—° ì²˜ë¦¬ í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Stream.map/2ì€ ì»¬ë ‰ì…˜ì˜ ê° ìš”ì†Œì— ì£¼ì–´ì§„ í•¨ìˆ˜ë¥¼ ì ìš©í•˜ì§€ë§Œ, ì‹¤ì œ ê³„ì‚°ì€ ìŠ¤íŠ¸ë¦¼ì„ ì—´ê±°í•  ë•Œê¹Œì§€ ì—°ê¸°ëœë‹¤.ì¦‰ì‹œ ì—°ì‚° vs ì§€ì—° ì—°ì‚°ì•„ë˜ ë‘ ì˜ˆì œì˜ ê²½ìš°, ë°˜í™˜ê°’ì€ ë™ì¼í•˜ì§€ë§Œ, ì•„ë˜ì™€ ê°™ì´ ë‹¤ë¥¸ ê¸°ëŠ¥ì  íŠ¹ì§•ì„ ê°€ì§„ë‹¤.Stream.map(1..10000, &amp;(&amp;1 * &amp;1))ì§€ì—° ì—°ì‚°: Stream.mapì€ ì—°ì‚°ì„ ì¦‰ì‹œ ìˆ˜í–‰í•˜ì§€ ì•Šê³ , ê° ìš”ì†Œì— ëŒ€í•œ ì—°ì‚°ì„ ì •ì˜í•˜ëŠ” ìŠ¤íŠ¸ë¦¼ì„ ë°˜í™˜í•œë‹¤. ì´ ìŠ¤íŠ¸ë¦¼ì€ ì‹¤ì œë¡œ ì—´ê±°ë˜ê¸° ì „ê¹Œì§€ëŠ” ì–´ë–¤ ì—°ì‚°ë„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±: í° ë°ì´í„°ì…‹ì„ ì²˜ë¦¬í•  ë•Œ Stream.mapì€ ëª¨ë“  ìš”ì†Œë¥¼ í•œ ë²ˆì— ë©”ëª¨ë¦¬ì— ë¡œë“œí•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹ , ìŠ¤íŠ¸ë¦¼ì„ ì—´ê±°í•  ë•Œ ê° ìš”ì†Œë¥¼ ê°œë³„ì ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤. ì´ëŠ” ëŒ€ê·œëª¨ ë°ì´í„°ì…‹ì„ ë‹¤ë£° ë•Œ ë©”ëª¨ë¦¬ ì‚¬ìš©ì„ ìµœì†Œí™”í•œë‹¤.ì ìš© ì˜ˆ: ìœ„ code ì—ì„œ Enum.to_list(stream) ë˜ëŠ” ë‹¤ë¥¸ Enum í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤íŠ¸ë¦¼ì„ ì—´ê±°í•  ë•Œê¹Œì§€ ì‹¤ì œ ì—°ì‚°ì´ ì—°ê¸°ëœë‹¤.Enum.map(1..10000, &amp;(&amp;1 * &amp;1))ì¦‰ì‹œ ì—°ì‚°: Enum.mapì€ í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ” ì¦‰ì‹œ ëª¨ë“  ìš”ì†Œì— ëŒ€í•´ ì—°ì‚°ì„ ìˆ˜í–‰í•œë‹¤. ì—°ì‚° ê²°ê³¼ëŠ” ì¦‰ì‹œ ê³„ì‚°ë˜ê³  ë°˜í™˜ëœë‹¤.ë©”ëª¨ë¦¬ ì‚¬ìš©: ì´ ë°©ì‹ì€ ì—°ì‚°ì„ ìˆ˜í–‰í•œ ì „ì²´ ê²°ê³¼ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•œë‹¤. í° ë°ì´í„°ì…‹ì„ ì²˜ë¦¬í•  ê²½ìš°, ì´ëŠ” ìƒë‹¹í•œ ì–‘ì˜ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.ì ìš© ì˜ˆ: ì—°ì‚° ê²°ê³¼ê°€ ì¦‰ì‹œ í•„ìš”í•˜ê³  ë°ì´í„°ì…‹ì´ ë©”ëª¨ë¦¬ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆì„ ì •ë„ë¡œ ì‘ì„ ë•Œ ìœ ìš©.*****Function Chaining ìƒíƒœì—ì„œì˜ Lazy Collectionì•ì—ì„œ ê´€ë ¨ ì¥ì ì„ ì„¤ëª…í–ˆìœ¼ë‚˜, ë‹¤ì–‘í•œ í•¨ìˆ˜ë¥¼ ì—°ì†ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” function chaining ì—ì„œ í•­ìƒ í•´ë‹¹ ì¥ì ì´ ë°œíœ˜ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.ì˜ˆë¥¼ ë“¤ë©´,1..10000|&gt; Enum.map(&amp;(&amp;1 * 2))|&gt; Stream.filter(&amp;(&amp;1 &lt; 100))|&gt; Enum.to_list()ì˜ ì²˜ë¦¬ ê³¼ì •ì„ ë³´ë©´,chaining ê³¼ì •ì—ì„œ Stream ëª¨ë“ˆì˜ í•¨ìˆ˜ ë’¤ì— Enum ëª¨ë“ˆì˜ í•¨ìˆ˜ê°€ ì˜¤ë©´, ìŠ¤íŠ¸ë¦¼ì— ëŒ€í•œ ëª¨ë“  ì—°ì‚°ì´ Enum í•¨ìˆ˜ í˜¸ì¶œ ì‹œì ì— ì¦‰ì‹œ ìˆ˜í–‰ëœë‹¤. ì´ëŠ” Enum í•¨ìˆ˜ê°€ ì‹¤ì œ ë°ì´í„°ë¥¼ í•„ìš”ë¡œ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.ë°˜ëŒ€ë¡œ, Enum í•¨ìˆ˜ ë‹¤ìŒì— Stream í•¨ìˆ˜ê°€ ì˜¤ë©´, Enum í•¨ìˆ˜ëŠ” ì¦‰ì‹œ ì‹¤í–‰ë˜ê³ , ê·¸ ê²°ê³¼ëŠ” Stream í•¨ìˆ˜ì— ì˜í•´ ë‹¤ì‹œ ì§€ì—° ì²˜ë¦¬ëœë‹¤.ì´ ê²½ìš°, Enum.mapì€ ì¦‰ì‹œ ëª¨ë“  ìš”ì†Œì— ëŒ€í•´ ì—°ì‚°ì„ ìˆ˜í–‰í•œë‹¤. ì´ì–´ì„œ Stream.filterëŠ” ì§€ì—° ì²˜ë¦¬ ìŠ¤íŠ¸ë¦¼ì„ ìƒì„±í•˜ì§€ë§Œ, ìµœì¢…ì ìœ¼ë¡œ Enum.to_listì— ì˜í•´ ì´ ìŠ¤íŠ¸ë¦¼ì´ ì¦‰ì‹œ ì—´ê±°ë˜ì–´ ëª¨ë“  ë°ì´í„° ì²˜ë¦¬ê°€ ì™„ë£Œëœë‹¤.ê²°ë¡ ì ìœ¼ë¡œ, ì˜ˆì œì—ì„œ Stream.filter(&amp;(&amp;1 &lt; 100))ëŠ” ê²°êµ­ ì²´ì¸ì˜ ë§ˆì§€ë§‰ì— ìˆëŠ” Enum.to_list() í•¨ìˆ˜ ë•Œë¬¸ì— ì¦‰ì‹œ ì—°ì‚° ì²˜ë¦¬ëœë‹¤.chainingëœ í•¨ìˆ˜ë“¤ ì¤‘ í•˜ë‚˜ë¼ë„ ì¦‰ì‹œ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” Enum ëª¨ë“ˆì˜ í•¨ìˆ˜ë¥¼ í¬í•¨í•˜ê³  ìˆê³ , ì´ê²ƒì´ ì²´ì¸ì˜ ë§ˆì§€ë§‰ì— ìœ„ì¹˜í•œë‹¤ë©´, ì²´ì¸ì˜ ëª¨ë“  ì—°ì‚°ì€ ê²°êµ­ ì¦‰ì‹œ ìˆ˜í–‰ëœë‹¤. ì´ëŠ” Enum ëª¨ë“ˆì˜ í•¨ìˆ˜ê°€ ì‹¤ì œ ë°ì´í„°ë¥¼ í•„ìš”ë¡œ í•˜ê¸° ë•Œë¬¸ì—, ì§€ì—°ëœ ì—°ì‚°ë“¤ë„ ê°•ì œë¡œ ì‹¤í–‰ë˜ì–´ ê²°ê³¼ë¥¼ ì‚°ì¶œí•œë‹¤.*****"
    } ,
  
    {
      "title"       : "Elixir ì˜ Map, Struct ë“±ì€ ì™œ immutable data types ì¸ê°€?",
      "category"    : "",
      "tags"        : "elixir, map, struct, immutable data type",
      "url"         : "./immutable-data-type.html",
      "date"        : "2024-01-03 10:32:20 +0900",
      "description" : "Elixir ì˜ immutable data types (Map, Struct)",
      "content"     : "Elixir ì—ì„œ Map ì€ immutable type ì´ë‹¤. ë”°ë¼ì„œ Map.delete/2, Map.put/3, Map.update/4 ë“±ê³¼ ê°™ì€ í•¨ìˆ˜ëŠ” ì‹¤ì œë¡œ ê¸°ì¡´ map data ë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ìˆ˜ì •ë˜ëœ ê°’ìœ¼ë¡œ ìƒˆë¡œìš´ map data ë¥¼ ë§Œë“¤ê³  ì´ê²ƒì„ ì¬í• ë‹¹ í•˜ëŠ” ê²ƒì´ë‹¤.Struct ì˜ ê²½ìš°ë„, í•œë²ˆ ìƒì„±ëœ instance ì˜ ë‚´ë¶€ field ê°’ì„ ë³€ê²½í•˜ê³ ì í•˜ëŠ” ê²½ìš°, ì´ëŠ” ìˆ˜ì •ì´ ì•„ë‹Œ, ìƒˆë¡œìš´ data ìƒì„± ë° ì´ë¥¼ ì¬í• ë‹¹ í•˜ëŠ” ê²ƒì´ë‹¤. ê·¸ëŸ°ë° list, map ê³¼ ê°™ì´ ë§ì€ ë°ì´í„°ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê²½ìš°, ê·¸ì¤‘ í•˜ë‚˜ì˜ ê°’ì´ ë°”ë€” ë•Œë§ˆë‹¤ ë§¤ë²ˆ ëª¨ë“  ë¶€ë¶„ì— ëŒ€í•œ ì¬í• ë‹¹ì„ ì§„í–‰í•œë‹¤ë©´, ë©”ëª¨ë¦¬ ì‚¬ìš©ì´ë‚˜ ì„±ëŠ¥ìƒ ë‹¨ì ì´ ë§¤ ì»¤ë³´ì¸ë‹¤.ê·¸ë ‡ë‹¤ë©´, immutable data type ìœ¼ë¡œ ì²˜ë¦¬í•  ë•Œ ì–´ë–¤ ì´ì ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë©°, ì˜ˆìƒë˜ëŠ” ë¬¸ì œì ì€ ì–´ë–»ê²Œ í•´ê²°í• ê¹Œ?êµ¬ì¡°ì  ê³µìœ (Structural Sharing): ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ ë°ì´í„° êµ¬ì¡°ì—ì„œëŠ” ì¢…ì¢… êµ¬ì¡°ì  ê³µìœ  ì‘ì—…ì´ í•„ìš”í•˜ë‹¤. ì¦‰, ìƒˆë¡œìš´ ë§µì„ ìƒì„±í•  ë•Œ ì „ì²´ êµ¬ì¡°ë¥¼ ë³µì‚¬í•˜ëŠ” ëŒ€ì‹ , ë³€ê²½ë˜ì§€ ì•Šì€ ë¶€ë¶„ì€ ê¸°ì¡´ êµ¬ì¡°ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ í•„ìš”í•œ ë©”ëª¨ë¦¬ ì–‘ê³¼ ë³µì‚¬ ì‘ì—…ì´ í¬ê²Œ ì¤„ì¸ë‹¤. (ê²°êµ­ immutable data type ì´ë¼ë„ ë§¤ë²ˆ ëª¨ë“  data ì— ëŒ€í•œ memory í• ë‹¹ ë° ì“°ê¸° ì‘ì—…ì´ ì§„í–‰ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.)ì˜ˆì¸¡ ê°€ëŠ¥ì„±ê³¼ ì•ˆì •ì„±: ë°ì´í„°ì˜ ë¶ˆë³€ì„±ì€ í•¨ìˆ˜ì˜ ë¶€ì‘ìš©ì„ ì¤„ì—¬ì¤€ë‹¤. ì´ëŠ” í”„ë¡œê·¸ë¨ì˜ ë™ì‘ì„ ì˜ˆì¸¡í•˜ê¸° ì‰½ê²Œ ë§Œë“¤ê³ , ë””ë²„ê¹…ê³¼ ìœ ì§€ë³´ìˆ˜ë¥¼ ìš©ì´í•˜ê²Œ í•œë‹¤. ë³‘ë ¬ ì²˜ë¦¬: ë°ì´í„°ê°€ ë³€ê²½ ë¶ˆê°€ëŠ¥í•˜ë©´ ì—¬ëŸ¬ ìŠ¤ë ˆë“œë‚˜ í”„ë¡œì„¸ìŠ¤ì—ì„œ ë™ì‹œì— ë°ì´í„°ì— ì ‘ê·¼í•´ë„ ì•ˆì „í•˜ë¯€ë¡œ, ë³‘ë ¬ ì²˜ë¦¬ì™€ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì—ì„œ í° ì´ì ì„ ì œê³µí•œë‹¤.ìµœì í™”: í˜„ëŒ€ì˜ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜(GC) ì‹œìŠ¤í…œì€ ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ ë°ì´í„° êµ¬ì¡°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì–´ ìˆë‹¤. ë”°ë¼ì„œ ìƒˆë¡œìš´ êµ¬ì¡°ë¥¼ ìƒì„±í•˜ëŠ” ì˜¤ë²„í—¤ë“œëŠ” ì¢…ì¢… ìƒê°ë³´ë‹¤ ì‘ë‹¤."
    } ,
  
    {
      "title"       : "slot attribute ì‚¬ìš©",
      "category"    : "",
      "tags"        : "phoenix, liveview, slop",
      "url"         : "./phoenix-slot.html",
      "date"        : "2024-01-01 10:32:20 +0900",
      "description" : "slot attribute ì‚¬ìš©",
      "content"     : "Phoenix LiveView ì—ì„œ ë™ì ì¸ component ë¥¼ ì‚½ì… í•˜ê³ ì í•˜ëŠ” ê²½ìš°, í•´ë‹¹ component attribute ë¡œ `slot` ì„ ì •ì˜í•˜ê³  ì´ë¥¼ ì‚¬ìš©í•´ ì£¼ì–´ì•¼ í•œë‹¤. ì‚¬ìš© ë°©ë²•slot :ë¸”ë¡ëª…, required: truedef ì»´í¬ë„ŒíŠ¸ëª…(assigns) do ~H\"\"\" &lt;ë™ì ìœ¼ë¡œ êµ¬í˜„í•  ì»´í¬ë„ŒíŠ¸ íƒœê·¸&gt; &lt;&gt;..ì‚¬ìš©ì êµ¬í˜„...&lt;&gt; &lt;%= render_slot(@ë¸”ë¡ëª…) %&gt; &lt;/ë™ì ìœ¼ë¡œ êµ¬í˜„í•  ì»´í¬ë„ŒíŠ¸ íƒœê·¸&gt; \"\"\"end Slot ì •ì˜slot :ë¸”ë¡ëª… : ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ë™ì ìœ¼ë¡œ ì½˜í…ì¸ ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆëŠ” ë¸”ë¡ëª…ì´ë¼ëŠ” ì´ë¦„ì˜ ìŠ¬ë¡¯ì„ ì •ì˜.required: true: ì´ ìŠ¬ë¡¯ì´ ë°˜ë“œì‹œ ì œê³µë˜ì–´ì•¼ í•¨ì„ ì˜ë¯¸. ì´ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ë¸”ë¡ëª… ìŠ¬ë¡¯ì— ëŒ€í•œ ë‚´ìš©ì„ ì œê³µí•´ì•¼ í•œë‹¤.ì»´í¬ë„ŒíŠ¸ ì •ì˜def ì»´í¬ë„ŒíŠ¸ëª…(assigns) do ... end : ì»´í¬ë„ŒíŠ¸ë¥¼ ì •ì˜í•˜ëŠ” í•¨ìˆ˜. ì´ í•¨ìˆ˜ ë‚´ì—ì„œ HTML íƒœê·¸ì™€ Elixirì˜ í…œí”Œë¦¿ ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ì˜ êµ¬ì¡°ë¥¼ ì •ì˜í•œë‹¤.ë™ì  ì½˜í…ì¸ ì˜ ì‚½ì… ìœ„ì¹˜&lt;%= render_slot(@ë¸”ë¡ëª…) %&gt; : êµ¬ë¬¸ì€ ì •ì˜ëœ ë¸”ë¡ëª… ìŠ¬ë¡¯ì— ì „ë‹¬ëœ ì½˜í…ì¸ ë¥¼ í•´ë‹¹ ìœ„ì¹˜ì— ë Œë”ë§.ì´ ìœ„ì¹˜ëŠ” \"ë™ì ìœ¼ë¡œ êµ¬í˜„í•  ì»´í¬ë„ŒíŠ¸ íƒœê·¸\" ë‚´ë¶€ë¡œ ì´ íƒœê·¸ ì•ˆì—ì„œ ë¸”ë¡ëª… ìŠ¬ë¡¯ì— ì œê³µëœ ì½˜í…ì¸ ê°€ ë Œë”ë§ë¨.ì‚¬ìš©ì êµ¬í˜„ì‚¬ìš©ìëŠ” ì´ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•  ë•Œ ë¸”ë¡ëª… ìŠ¬ë¡¯ì— ì›í•˜ëŠ” ì½˜í…ì¸ ë¥¼ ì œê³µí•  ìˆ˜ ìˆë‹¤. ì´ ì½˜í…ì¸ ëŠ” ë‹¤ì–‘í•œ HTML ìš”ì†Œ, ë‹¤ë¥¸ LiveView ì»´í¬ë„ŒíŠ¸, ë˜ëŠ” ë™ì ì¸ ë°ì´í„°ë¥¼ í¬í•¨í•  ìˆ˜ ìˆë‹¤.ì‹¤ì œ ì½”ë“œ ì˜ˆì‹œattr :view_box, :stringslot :inner_block, required: truedef canvas(assigns) do ~H\"\"\" &lt;svg viewBox={ @view_box }&gt; &lt;defs&gt; &lt;%!-- ìœ„ì— ì •ì˜ëœ point component ì‚¬ìš©í•˜ì—¬ ì •ì‚¬ê°í˜• ìƒì„± --%&gt; &lt;rect id=\"point\" width=\"10\" height=\"10\" /&gt; &lt;/defs&gt; &lt;%= render_slot(@inner_block) %&gt; &lt;/svg&gt; \"\"\"end"
    } ,
  
    {
      "title"       : "Elixir - intance ìƒì„±",
      "category"    : "",
      "tags"        : "elixir, instance, struct",
      "url"         : "./create-instance.html",
      "date"        : "2023-12-29 13:32:20 +0900",
      "description" : "Elixir - intance ìƒì„±",
      "content"     : "Elixir ë¬¸ë²”ì—ì„œ struct ì— ëŒ€í•œ instaceë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ì´ ë‘ê°€ì§€ê°€ ì¡´ì¬í•œë‹¤. (ChatGPT ê°€ ì„¤ëª…í•œ ê·¸ ìš©ë„ì˜ ì°¨ì´ì ì— ëŒ€í•´ì„œ.. ì•„ì§ ì˜ ëª¨ë¥´ê² ë‹¤. ë‚´ëˆˆì—ëŠ” ê·¸ëƒ¥ ë™ì¼í•œ ìš©ë„ë¡œ ì‚¬ìš©ë˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì¸ë‹¤. ;;)__MODULE__ ì‚¬ìš©ì‚¬ìš©ë²•: %__MODULE__{} êµ¬ë¬¸ì€ ì£¼ë¡œ ëª¨ë“ˆ ë‚´ë¶€ì—ì„œ í•´ë‹¹ ëª¨ë“ˆì˜ êµ¬ì¡°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©. ì´ ê²½ìš°, ëª¨ë“ˆ ë‚´ë¶€ì—ì„œ ì§ì ‘ %__MODULE__{field1: value1, field2: value2}ì™€ ê°™ì´ êµ¬ì¡°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.ì˜ˆì‹œ: ëª¨ë“ˆ ë‚´ë¶€ì—ì„œ def new() í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³ , ì´ í•¨ìˆ˜ ì•ˆì—ì„œ %__MODULE__{}ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.def new(field \\\\ []), do: __struct__(field) ì •ì˜ì‚¬ìš©ë²•: ì´ ë°©ë²•ì€ ëª¨ë“ˆ ì™¸ë¶€ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ new í•¨ìˆ˜ëŠ” ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ê³µê°œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ê³ , __struct__ í˜¸ì¶œì„ í†µí•´ ë‚´ë¶€ì ìœ¼ë¡œ êµ¬ì¡°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.ì˜ˆì‹œ: ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ModuleName.new(field_values)ë¥¼ í˜¸ì¶œí•˜ì—¬ êµ¬ì¡°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ì—¬ê¸°ì„œ field_valuesëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ í•„ë“œë¥¼ ì´ˆê¸°í™”í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë¨.ê²°ë¡ ë‘ ë°©ì‹ ëª¨ë‘ Elixirì—ì„œ êµ¬ì¡°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•. __MODULE__ ë°©ì‹ì€ ì£¼ë¡œ ëª¨ë“ˆ ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ë©°, def new(field \\\\ []), do: __struct__(field) ë°©ì‹ì€ ëª¨ë“ˆ ì™¸ë¶€ì—ì„œ êµ¬ì¡°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ê³µê°œ í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤. ë‘ ê²½ìš° ëª¨ë‘, ëª¨ë“ˆëª….new(field ê°’)ê³¼ ê°™ì€ í˜•íƒœë¡œ í˜¸ì¶œí•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤."
    } ,
  
    {
      "title"       : "struct - instance ì— ëŒ€í•´ (Elixir vs OOP languages)",
      "category"    : "",
      "tags"        : "oop, instance, struct, phoenix, liveview, elixir",
      "url"         : "./instance-with-elixir.html",
      "date"        : "2023-12-29 10:32:20 +0900",
      "description" : "struct - instance ì— ëŒ€í•´ (Elixir vs OOP languages)",
      "content"     : "elixir ì—ì„œì˜ êµ¬ì¡°ì²´ëŠ” ìƒì†, ë‹¤í˜•ì„± ë“±ì´ ì§€ì›ë˜ì§€ ì•Šê³  í•œë²ˆ ì •ì˜ë˜ë©´ êµ¬ì¡°ì²´ ë‚´ë¶€ field ê°’ì„ ë³€ê²½í•  ìˆ˜ ì—†ëŠ”, ë‚´ë¶€ì— field ê°€ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ì ì •ì˜ type ì´ë©°, í•´ë‹¹ êµ¬ì¡°ì²´ type ì— ì‹¤ì œ data ë¥¼ ê°€ì§€ê²Œ í•˜ê³  ì´ë¥¼ ë³€ìˆ˜ ë§¤ì¹­ ì‹œí‚¨ê²ƒì´ elixir instance ì´ë‹¤. ìœ ì‚¬ì ë°ì´í„° ìº¡ìŠí™”: Elixirì˜ êµ¬ì¡°ì²´ì™€ Javaë‚˜ Pythonì˜ ì¸ìŠ¤í„´ìŠ¤ ëª¨ë‘ ë°ì´í„°ë¥¼ ìº¡ìŠí™”. ì—¬ëŸ¬ ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ êµ¬ì¡°ë¡œ ë¬¶ì–´ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.í•„ë“œ ì •ì˜: ë‘ ì–¸ì–´ì—ì„œëŠ” ìë£Œêµ¬ì¡°ì— í•„ë“œ(ë°ì´í„° ìš”ì†Œ)ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŸ¬í•œ í•„ë“œëŠ” ê°ê°ì˜ ìë£Œêµ¬ì¡°ì— ì†í•œ ì •ë³´ë¥¼ ë‚˜íƒ€ëƒ„.íƒ€ì… ì•ˆì •ì„±: Elixirì˜ êµ¬ì¡°ì²´ì™€ Javaì˜ ê°ì²´ëŠ” ë‘˜ ë‹¤ íŠ¹ì • íƒ€ì…ì— ì†í•˜ëŠ” ë°ì´í„°ë¥¼ ë‹´ëŠ”ë°, ì´ëŠ” ë°ì´í„° íƒ€ì…ì— ëŒ€í•œ ì•ˆì •ì„±ê³¼ ì˜ˆì¸¡ ê°€ëŠ¥ì„±ì„ ì œê³µ.ì°¨ì´ì ë¶ˆë³€ì„±(Immutability) vs ê°€ë³€ì„±(Mutability): Elixirì˜ êµ¬ì¡°ì²´ëŠ” ë¶ˆë³€ì„±ì„ ê°€ì§. í•œ ë²ˆ ìƒì„±ë˜ë©´ ê·¸ ìƒíƒœë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŒ. ë°˜ë©´, Javaë‚˜ Pythonì˜ ê°ì²´ëŠ” ê°€ë³€ì ì´ë©°, ê°ì²´ì˜ ìƒíƒœ(í•„ë“œ ê°’ ë“±)ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŒ.í•¨ìˆ˜í˜• vs ê°ì²´ì§€í–¥: ElixirëŠ” í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„ì„ ë”°ë¥´ê¸° ë•Œë¬¸ì—, ë°ì´í„°ì™€ í•¨ìˆ˜ê°€ ë¶„ë¦¬ë˜ì–´ ìˆìŒ. êµ¬ì¡°ì²´ëŠ” ë‹¨ì§€ ë°ì´í„°ë¥¼ ë‹´ëŠ” ìš©ë„ë¡œ ì‚¬ìš©ë˜ë©°, ëª¨ë“  ì‘ì—…ì€ ìˆœìˆ˜ í•¨ìˆ˜ë¥¼ í†µí•´ ì²˜ë¦¬ë¨. ë°˜ë©´, Javaë‚˜ Pythonì—ì„œëŠ” ê°ì²´ê°€ ë°ì´í„°ì™€ ê·¸ ë°ì´í„°ë¥¼ ì¡°ì‘í•˜ëŠ” ë©”ì†Œë“œë¥¼ ëª¨ë‘ í¬í•¨.ìƒì†ê³¼ ë‹¤í˜•ì„±: Javaë‚˜ Pythonì—ì„œëŠ” í´ë˜ìŠ¤ ìƒì†ê³¼ ë‹¤í˜•ì„±ì´ ì¤‘ìš”í•œ íŠ¹ì§•ìœ¼ë¡œ ê°ì²´ëŠ” ë¶€ëª¨ í´ë˜ìŠ¤ì˜ ì†ì„±ê³¼ ë©”ì†Œë“œë¥¼ ìƒì†ë°›ì„ ìˆ˜ ìˆìœ¼ë©°, ì¸í„°í˜ì´ìŠ¤ë‚˜ ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ í†µí•´ ë‹¤í˜•ì„±ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŒ. ë°˜ë©´, Elixirì˜ êµ¬ì¡°ì²´ëŠ” ì´ëŸ° ìƒì† ë©”ì»¤ë‹ˆì¦˜ì´ë‚˜ ë‹¤í˜•ì„±ì„ ì§€ì›í•˜ì§€ ì•ŠìŒ.ë©”ì†Œë“œì™€ í•¨ìˆ˜: Javaë‚˜ Pythonì—ì„œ ê°ì²´ëŠ” ìì‹ ì˜ ë©”ì†Œë“œë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ê°ì²´ì˜ ìƒíƒœë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŒ. Elixirì—ì„œëŠ” ëª¨ë“  ì‘ì—…ì´ í•¨ìˆ˜ë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë©°, ì´ í•¨ìˆ˜ë“¤ì€ êµ¬ì¡°ì²´ì˜ ë°ì´í„°ì— ëŒ€í•œ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ì§€ë§Œ, êµ¬ì¡°ì²´ ë‚´ë¶€ì— ì •ì˜ë˜ì§€ ì•ŠìŒ.ê²°ë¡ Elixirì˜ êµ¬ì¡°ì²´ëŠ” Javaë‚˜ Pythonì˜ ê°ì²´ì™€ ìœ ì‚¬í•˜ê²Œ ë°ì´í„°ë¥¼ ìº¡ìŠí™”í•˜ëŠ” ì—­í• ì„ í•˜ì§€ë§Œ, ë¶ˆë³€ì„±, í•¨ìˆ˜í˜• íŒ¨ëŸ¬ë‹¤ì„, ìƒì† ë° ë‹¤í˜•ì„± ë¶€ì¬, ë©”ì†Œë“œì™€ í•¨ìˆ˜ì˜ ì°¨ì´ë¼ëŠ” ì¸¡ë©´ì—ì„œ ë¶„ëª…í•œ ì°¨ì´ì ì´ ìˆë‹¤. ì´ëŸ¬í•œ ì°¨ì´ì ë“¤ì€ Elixirê°€ ê°€ì§„ í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì˜ íŠ¹ì§•ì„ ë°˜ì˜í•œë‹¤."
    } ,
  
    {
      "title"       : "tail recursion",
      "category"    : "",
      "tags"        : "tail recursion, elixir",
      "url"         : "./tail-recursion.html",
      "date"        : "2023-12-27 15:32:20 +0900",
      "description" : "tail recursion",
      "content"     : "ì¼ë°˜ ì¬ê·€ (Regular Recursion) ì˜ˆì œdefmodule RegularRecursion do def sum([]), do: 0 def sum([head | tail]), do: head + sum(tail)endì´ ì˜ˆì œì—ì„œ `sum/1` í•¨ìˆ˜ëŠ” ë¦¬ìŠ¤íŠ¸ì˜ ì²« ë²ˆì§¸ ìš”ì†Œë¥¼ ì·¨í•˜ê³ , ë‚˜ë¨¸ì§€ ë¦¬ìŠ¤íŠ¸ì— ëŒ€í•´ ì¬ê·€ì ìœ¼ë¡œ `sum/1`ì„ í˜¸ì¶œí•œ ë‹¤ìŒ, ê²°ê³¼ì— ì²« ë²ˆì§¸ ìš”ì†Œë¥¼ ë”í•œë‹¤. ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€ ì¬ê·€ í˜¸ì¶œ í›„ì— ì¶”ê°€ ì‘ì—…(ë”í•˜ê¸°)ì´ ìˆ˜í–‰ëœë‹¤ëŠ” ê²ƒ.ê¼¬ë¦¬ ì¬ê·€ (Tail Recursion) ì˜ˆì œë‹¤ìŒ ì˜ˆì œì—ì„œ `sum/2` ë³´ì¡° í•¨ìˆ˜ëŠ” ëˆ„ì ëœ í•©ê³„ë¥¼ ìœ ì§€í•˜ë©´ì„œ ì¬ê·€ì ìœ¼ë¡œ í˜¸ì¶œëœë‹¤. ê° ì¬ê·€ í˜¸ì¶œì€ ëˆ„ì ëœ í•©ê³„ì— í˜„ì¬ ìš”ì†Œë¥¼ ë”í•œ ê°’ê³¼ í•¨ê»˜ í˜¸ì¶œë˜ë©°, ì´ëŠ” ê¼¬ë¦¬ í˜¸ì¶œ ìµœì í™”ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.defmodule TailRecursion do def sum(list), do: sum(list, 0) defp sum([], total), do: total defp sum([head | tail], total) do sum(tail, head + total) endendì°¨ì´ì ì¼ë°˜ ì¬ê·€ì—ì„œëŠ” ê° ì¬ê·€ í˜¸ì¶œ í›„ì— ì¶”ê°€ì ì¸ ê³„ì‚° í•„ìš”(ì˜ˆ: head + sum(tail)).ê¼¬ë¦¬ ì¬ê·€ì—ì„œëŠ” ì¬ê·€ í˜¸ì¶œì´ í•¨ìˆ˜ì˜ ë§ˆì§€ë§‰ ì—°ì‚°ì´ë©°, ì¶”ê°€ ê³„ì‚°ì´ ì—†ìŒ(ì˜ˆ: sum(tail, head + total)).ì¼ë°˜ ì¬ê·€ëŠ” í˜¸ì¶œ ìŠ¤íƒì— ê° í˜¸ì¶œì˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì €ì¥í•´ì•¼ í•˜ë¯€ë¡œ ë©”ëª¨ë¦¬ ì‚¬ìš©ì´ ë” ë§ê³ , ê¹Šì€ ì¬ê·€ì—ì„œ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆë‹¤. ë°˜ë©´, ê¼¬ë¦¬ ì¬ê·€ëŠ” ìµœì í™”ë¥¼ í†µí•´ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í”¼í•  ìˆ˜ ìˆìœ¼ë©°, ê¹Šì€ ì¬ê·€ í˜¸ì¶œì—ì„œë„ íš¨ìœ¨ì ìœ¼ë¡œ ì‘ë™í•œë‹¤.(Regular) Recursion vs Tail Recursion - ì„±ëŠ¥ &amp; stack ì‚¬ìš© ë¹„êµ ê¼¬ë¦¬ ì¬ê·€ (Tail Recursion)Elixirì—ì„œ ê¼¬ë¦¬ ì¬ê·€ëŠ” ê¼¬ë¦¬ í˜¸ì¶œ ìµœì í™”(Tail-Call Optimization, TCO)ë¼ëŠ” ê¸°ìˆ ì„ í†µí•´ ìµœì í™”ëœë‹¤. ê¼¬ë¦¬ ì¬ê·€ í•¨ìˆ˜ì—ì„œëŠ” ì¬ê·€ í˜¸ì¶œì´ í•¨ìˆ˜ì˜ ë§ˆì§€ë§‰ ì‘ì—…ìœ¼ë¡œ, Elixir ì»´íŒŒì¼ëŸ¬ê°€ í˜„ì¬ì˜ ìŠ¤íƒ í”„ë ˆì„ì„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•œë‹¤. ì´ëŸ¬í•œ ìµœì í™”ëŠ” ìƒˆë¡œìš´ ìŠ¤íƒ í”„ë ˆì„ì„ ì¶”ê°€í•˜ëŠ” ëŒ€ì‹  í˜„ì¬ì˜ í”„ë ˆì„ì„ ì¬ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ìµœì†Œí™”í•œë‹¤. ëŒ€ê·œëª¨ ì‘ì—…ì´ë‚˜ ëŒ€ëŸ‰ì˜ ë°ì´í„° ì²˜ë¦¬ì— íŠ¹íˆ ë©”ëª¨ë¦¬ íš¨ìœ¨ì´ ì¢‹ìœ¼ë©°, ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš° ìœ„í—˜ì„ í”¼í•  ìˆ˜ ìˆë‹¤.ì¼ë°˜ ì¬ê·€ (Regular Recursion)ë°˜ë©´, Elixirì—ì„œ ì¼ë°˜ ì¬ê·€ëŠ” ê° í•¨ìˆ˜ í˜¸ì¶œë§ˆë‹¤ ìƒˆë¡œìš´ ìŠ¤íƒ í”„ë ˆì„ì„ ì¶”ê°€í•œë‹¤. ì´ëŠ” íŠ¹íˆ ê¹Šì€ ì¬ê·€ ë˜ëŠ” í° ë¦¬ìŠ¤íŠ¸ë¥¼ ë‹¤ë£° ë•Œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, ê° ì¬ê·€ í˜¸ì¶œì´ ìì²´ ìŠ¤íƒ í”„ë ˆì„ì„ ìš”êµ¬í•˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ ë¬¸ì œë‚˜ ê·¹ë‹¨ì ì¸ ê²½ìš° ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆë‹¤.ì„±ëŠ¥ì  ì˜í–¥ì¼ë°˜ì ìœ¼ë¡œ ê¼¬ë¦¬ ì¬ê·€ëŠ” Elixirì—ì„œ ë” ë¹ ë¥´ê³  ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì´ë©°, íŠ¹íˆ ë¦¬ìŠ¤íŠ¸ ì¶•ì†Œë‚˜ ëŒ€ê·œëª¨ ë°ì´í„° ì²˜ë¦¬ì— ìœ ë¦¬í•˜ë‹¤. í•˜ì§€ë§Œ ëª¨ë“  ê²½ìš°ì— ê¼¬ë¦¬ ì¬ê·€ê°€ ìš°ì›”í•œ ê²ƒì€ ì•„ë‹ˆë‹¤. íŠ¹ì • ìƒí™©, íŠ¹íˆ í•¨ìˆ˜ê°€ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶•ì†Œí•˜ì§€ ì•Šê³  ë‹¨ìˆœíˆ ë§¤í•‘í•˜ëŠ” ê²½ìš°, ì¼ë°˜ ì¬ê·€ê°€ ë” íš¨ìœ¨ì ì¼ ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë¦¬ìŠ¤íŠ¸ì˜ ìˆ«ìë¥¼ ë‘ ë°°ë¡œ í•˜ëŠ” í•¨ìˆ˜ëŠ” ì¼ë°˜ ì¬ê·€ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ë¹ ë¥¼ ìˆ˜ ìˆë‹¤.ë‹¤ë¥¸ ì–¸ì–´ì˜ logic ì²˜ë¦¬ (iteration) ê³¼ Tail Recursion ë¹„êµElixirì—ì„œ ê¼¬ë¦¬ ì¬ê·€ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë‹¤ë¥¸ ì–¸ì–´ì—ì„œì˜ ì¼ë°˜ì ì¸ ë°˜ë³µë¬¸(iteration)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•œ ìˆ˜ì¤€ì˜ ì„±ëŠ¥ê³¼ ë©”ëª¨ë¦¬ ì‚¬ìš©ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤. ê¼¬ë¦¬ ì¬ê·€ì˜ ì£¼ìš” ì¥ì  ì¤‘ í•˜ë‚˜ëŠ” ê¼¬ë¦¬ í˜¸ì¶œ ìµœì í™”(tail-call optimization, TCO)ë¡œ ì¸í•´ ë©”ëª¨ë¦¬ ì‚¬ìš©ì´ ìµœì†Œí™”ëœë‹¤ëŠ” ê²ƒ. ì´ ìµœì í™”ëŠ” ì¬ê·€ í˜¸ì¶œ ì‹œ ìƒˆë¡œìš´ ìŠ¤íƒ í”„ë ˆì„ì„ ìƒì„±í•˜ëŠ” ëŒ€ì‹  í˜„ì¬ ìŠ¤íƒ í”„ë ˆì„ì„ ì¬ì‚¬ìš©í•˜ê²Œ í•´, ê¹Šì€ ì¬ê·€ í˜¸ì¶œì—ì„œë„ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš° ìœ„í—˜ì„ ì¤„ì—¬ì¤€ë‹¤.ê¼¬ë¦¬ ì¬ê·€ì™€ ë°˜ë³µë¬¸ì˜ ì„±ëŠ¥ ë¹„êµë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ê¼¬ë¦¬ ì¬ê·€ë¥¼ ì‚¬ìš©í•˜ëŠ” Elixir í•¨ìˆ˜ëŠ” ì¼ë°˜ ë°˜ë³µë¬¸ì„ ì‚¬ìš©í•˜ëŠ” ë‹¤ë¥¸ ì–¸ì–´ì˜ í•¨ìˆ˜ë“¤ê³¼ ìœ ì‚¬í•˜ê²Œ, ë‚®ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤. ê° ì¬ê·€ í˜¸ì¶œì´ ìƒˆë¡œìš´ ìŠ¤íƒ í”„ë ˆì„ì„ ì¶”ê°€í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ê¹Šì€ ì¬ê·€ ìˆ˜ì¤€ì—ì„œë„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì œí•œì ì´ë‹¤. ì„±ëŠ¥: ê¼¬ë¦¬ ì¬ê·€ ìµœì í™” ë•ë¶„ì— Elixirì˜ ê¼¬ë¦¬ ì¬ê·€ í•¨ìˆ˜ëŠ” ì¼ë°˜ ë°˜ë³µë¬¸ì„ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ë“¤ê³¼ ë¹„ìŠ·í•œ ì„±ëŠ¥ì„ ë‚¼ ìˆ˜ ìˆë‹¤. ë°˜ë³µë¬¸ì€ ì¼ë°˜ì ìœ¼ë¡œ CPU ì‚¬ì´í´ì„ ëœ ì‚¬ìš©í•˜ê³ , ë°˜ë³µ ë¡œì§ì´ ëª…ì‹œì ì´ê¸° ë•Œë¬¸ì— ì¼ë¶€ ê²½ìš°ì—ì„œ ë” íš¨ìœ¨ì ì¼ ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ê¼¬ë¦¬ ì¬ê·€ëŠ” ì´ëŸ¬í•œ ì„±ëŠ¥ ì°¨ì´ë¥¼ ìƒë‹¹ ë¶€ë¶„ ì¤„ì¼ ìˆ˜ ìˆë‹¤."
    } ,
  
    {
      "title"       : "Phoenix Presence (by ChatGPT)",
      "category"    : "",
      "tags"        : "phoenix presence, phoenix, liveview",
      "url"         : "./phoenix-presence.html",
      "date"        : "2023-12-26 10:32:20 +0900",
      "description" : "Phoenix Presence (by ChatGPT)",
      "content"     : "Phoenix PresenceëŠ” Elixir ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” Phoenix í”„ë ˆì„ì›Œí¬ì˜ í•œ ë¶€ë¶„ìœ¼ë¡œ, ì‹¤ì‹œê°„ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì—°ê²° ìƒíƒœë¥¼ ì¶”ì í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ ì£¼ë¡œ ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜, ê²Œì„, ë¼ì´ë¸Œ ì´ë²¤íŠ¸ ë“±ì—ì„œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤.Phoenix Presenceì˜ í•µì‹¬ì€ ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œë„ ì‚¬ìš©ìì˜ í˜„ì¬ ìƒíƒœë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´, PhoenixëŠ” CRDT(Conflict-Free Replicated Data Type)ë¼ëŠ” ë°ì´í„° íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ì˜ ë‹¤ì–‘í•œ ë…¸ë“œ ê°„ì— ì‚¬ìš©ì ìƒíƒœ ì •ë³´ë¥¼ ë™ê¸°í™”í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë²„ ê°„ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ë©´ì„œë„, ë„¤íŠ¸ì›Œí¬ ë¶„í• ì´ë‚˜ ë‹¤ë¥¸ ì´ìŠˆë“¤ì´ ë°œìƒí•´ë„ ì‚¬ìš©ìì˜ ìƒíƒœë¥¼ ì •í™•í•˜ê²Œ ì¶”ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.Phoenix Presenceë¥¼ ì‚¬ìš©í•˜ë©´ ì–´ë–¤ ì‚¬ìš©ìê°€ ì˜¨ë¼ì¸ì¸ì§€, ì–´ëŠ ì±„ë„ì— ìˆëŠ”ì§€ ë“±ì˜ ì •ë³´ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì´ ê¸°ëŠ¥ì€ Elixirì˜ ê°€ë²¼ìš´ í”„ë¡œì„¸ìŠ¤ì™€ ë©”ì‹œì§€ ì „ë‹¬ ì‹œìŠ¤í…œì„ í™œìš©í•˜ì—¬ ë†’ì€ ì„±ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë§ì€ ìˆ˜ì˜ ì‚¬ìš©ìê°€ ë™ì‹œì— ì ‘ì†í•˜ëŠ” í™˜ê²½ì—ì„œë„ ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.Phoenix Presenceë¥¼ í™œìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ì‚¬ìš©ìê°€ ì–´ë–¤ ì±„ë„ì— ì ‘ì†í–ˆëŠ”ì§€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ì—¬ì£¼ê¸°.ì‚¬ìš©ìì˜ ìƒíƒœ ë³€í™”(ì˜ˆ: ì˜¨ë¼ì¸, ì˜¤í”„ë¼ì¸, ë°”ì¨ ë“±)ë¥¼ ì¶”ì í•˜ì—¬ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ì•Œë ¤ì£¼ê¸°.ê²Œì„ì´ë‚˜ ë‹¤ë¥¸ ì‹¤ì‹œê°„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ìê°„ì˜ ìƒí˜¸ ì‘ìš©ì„ ì´‰ì§„í•˜ê¸°.ì´ ê¸°ëŠ¥ì„ í™œìš©í•˜ë ¤ë©´, Phoenix í”„ë ˆì„ì›Œí¬ì— ëŒ€í•œ ì´í•´ë¿ë§Œ ì•„ë‹ˆë¼, Elixirì˜ ë™ì‹œì„±ê³¼ ë¶„ì‚° ì‹œìŠ¤í…œì— ëŒ€í•œ ì§€ì‹ë„ í•„ìš”í•©ë‹ˆë‹¤. ì´ë¯¸ Elixirë¥¼ ê³µë¶€í•˜ê³  ê³„ì‹ ë‹¤ë©´, Phoenix PresenceëŠ” ë°±ì—”ë“œ ì—”ì§€ë‹ˆì–´ë¡œì„œì˜ ì—¬ëŸ¬ë¶„ì˜ ì—­ëŸ‰ì„ í•œì¸µ ë” í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆëŠ” ì¢‹ì€ ë„êµ¬ê°€ ë  ê²ƒì…ë‹ˆë‹¤.CRDT(Conflict-Free Replicated Data Type) (by ChatGPT)CRDT(Conflict-Free Replicated Data Type)ëŠ” ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë°ì´í„° íƒ€ì…ì…ë‹ˆë‹¤. ì´ ê¸°ìˆ ì˜ ì£¼ìš” ëª©í‘œëŠ” ë„¤íŠ¸ì›Œí¬ì˜ ë‹¤ë¥¸ ë…¸ë“œì—ì„œ ë™ì¼í•œ ë°ì´í„°ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ê³ , ë‚˜ì¤‘ì— ì´ëŸ¬í•œ ë³€ê²½ ì‚¬í•­ë“¤ì„ í•©ì³ë„ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ë³´ì¥í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.CRDTì˜ íŠ¹ì§•:Conflict-Free: CRDTëŠ” ë‹¤ìˆ˜ì˜ ë…¸ë“œì—ì„œ ë™ì‹œì— ë°œìƒí•˜ëŠ” ì—…ë°ì´íŠ¸ ì‚¬ì´ì˜ ì¶©ëŒì„ ìë™ìœ¼ë¡œ í•´ê²°í•©ë‹ˆë‹¤. ì´ëŠ” ê° ë…¸ë“œê°€ ë„¤íŠ¸ì›Œí¬ì˜ ë‹¤ë¥¸ ë¶€ë¶„ê³¼ ì¼ì‹œì ìœ¼ë¡œ ì—°ê²°ì´ ëŠê²¨ë„ ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.Replicated: ë°ì´í„°ëŠ” ë„¤íŠ¸ì›Œí¬ ë‚´ì˜ ì—¬ëŸ¬ ë…¸ë“œì— ë³µì œë©ë‹ˆë‹¤. ì´ëŠ” ê° ë…¸ë“œê°€ ë¡œì»¬ ë°ì´í„°ì— ëŒ€í•´ ë…ë¦½ì ìœ¼ë¡œ ì‘ì—…í•  ìˆ˜ ìˆê²Œ í•˜ë©°, ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ë³µêµ¬ë˜ë©´ ë³€ê²½ ì‚¬í•­ì„ ë‹¤ì‹œ í•©ì¹©ë‹ˆë‹¤.Data Types: CRDTëŠ” ë‹¤ì–‘í•œ ë°ì´í„° íƒ€ì…ì„ ì§€ì›í•©ë‹ˆë‹¤, ì˜ˆë¥¼ ë“¤ì–´ ì„¸íŠ¸(set), ì¹´ìš´í„°(counter), ë§µ(map) ë“±ì´ ìˆìœ¼ë©°, ì´ëŸ¬í•œ ë°ì´í„° íƒ€ì…ë“¤ì€ ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œ ìë™ìœ¼ë¡œ ë™ê¸°í™”ë©ë‹ˆë‹¤.ì‹¤ì‹œê°„ íŠ¸ë˜í”½ ê´€ë¦¬ì— ëŒ€í•œ CRDTì˜ ê¸°ì—¬:ê³ ê°€ìš©ì„± ë° ë‚´ê²°í•¨ì„±: CRDTëŠ” ë„¤íŠ¸ì›Œí¬ ì¥ì• ë‚˜ ì¼ë¶€ ë…¸ë“œì˜ ì‹¤íŒ¨ì—ë„ ë¶ˆêµ¬í•˜ê³  ë°ì´í„°ì˜ ê°€ìš©ì„±ê³¼ ì¼ê´€ì„±ì„ ìœ ì§€í•©ë‹ˆë‹¤. ì´ëŠ” ì‹¤ì‹œê°„ íŠ¸ë˜í”½ì´ ë§ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¤‘ìš”í•©ë‹ˆë‹¤.ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”: ì‹¤ì‹œê°„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ì ìƒíƒœë‚˜ ë©”ì‹œì§€ì™€ ê°™ì€ ì •ë³´ëŠ” ì—¬ëŸ¬ ë…¸ë“œì— ê±¸ì³ ì‹ ì†í•˜ê²Œ ë™ê¸°í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. CRDTëŠ” ì´ëŸ¬í•œ ì‹¤ì‹œê°„ ë™ê¸°í™”ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì§€ì›í•©ë‹ˆë‹¤.íƒ„ë ¥ì ì¸ íŠ¸ë˜í”½ ê´€ë¦¬: ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œ íŠ¸ë˜í”½ ë¶€í•˜ê°€ í•œ ë…¸ë“œì—ì„œ ë‹¤ë¥¸ ë…¸ë“œë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. CRDTë¥¼ ì‚¬ìš©í•˜ë©´, ì´ëŸ¬í•œ ë¶€í•˜ ì´ë™ì´ ë°ì´í„° ì¼ê´€ì„±ì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•ŠìŠµë‹ˆë‹¤.í™•ì¥ì„±: CRDTëŠ” ì‹œìŠ¤í…œì´ í™•ì¥ë¨ì— ë”°ë¼ ìƒˆë¡œìš´ ë…¸ë“œë¥¼ ì‰½ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°, ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ë©´ì„œë„ ì‹œìŠ¤í…œì˜ í™•ì¥ì„±ì„ ì§€ì›í•©ë‹ˆë‹¤.CRDTëŠ” Phoenix Presenceì™€ ê°™ì€ ì‹¤ì‹œê°„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ìì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë° ë§¤ìš° ìœ ìš©í•©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ë…¸ë“œì— ê±¸ì³ ìˆê±°ë‚˜, ë„¤íŠ¸ì›Œí¬ ìƒíƒœê°€ ë³€ë™ì ì¼ ë•Œë„, ì‚¬ìš©ìì˜ ìƒíƒœ(ì˜ˆ: ì˜¨ë¼ì¸, ì˜¤í”„ë¼ì¸)ëŠ” ëª¨ë“  ë…¸ë“œì— ê±¸ì³ ì¼ê´€ì„± ìˆê²Œ ìœ ì§€ë©ë‹ˆë‹¤.* CRDT í•™ìŠµ ìë£Œ : CRDT Resources - crdt.tech."
    } ,
  
    {
      "title"       : "ë³µí•© ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì‹¤í–‰í•  ë•Œ ë°œìƒí•˜ëŠ” ê³¼ì •",
      "category"    : "",
      "tags"        : "complex query, database, phoenix, liveview",
      "url"         : "./complex-query.html",
      "date"        : "2023-12-24 13:32:20 +0900",
      "description" : "ë³µí•© ì¿¼ë¦¬ì˜ logic ì‹¤í–‰ì€ client ì¸¡ì—ì„œ ì§„í–‰ë˜ëŠ”ê°€, ì•„ë‹ˆë©´ database server ì¸¡ì—ì„œ ì§„í–‰ë˜ëŠ”ê°€?",
      "content"     : "ë³µí•© ì¿¼ë¦¬ì˜ logic ì‹¤í–‰ì€ client ì¸¡ì—ì„œ ì§„í–‰ë˜ëŠ”ê°€, ì•„ë‹ˆë©´ database server ì¸¡ì—ì„œ ì§„í–‰ë˜ëŠ”ê°€?ë³µí•© ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì‹¤í–‰í•  ë•Œ ë°œìƒí•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.ì¿¼ë¦¬ì˜ êµ¬ì„±: í´ë¼ì´ì–¸íŠ¸ ì¸¡(ì—¬ê¸°ì„œëŠ” Elixir/Ectoë¥¼ ì‚¬ìš©í•˜ëŠ” ì„œë²„)ì—ì„œ Ecto ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê³ , ì´ëŠ” SQL ì¿¼ë¦¬ë¡œ ë³€í™˜ëœë‹¤. ì´ ë³€í™˜ ê³¼ì •ì€ Ectoê°€ ì²˜ë¦¬í•˜ë©°, ì‘ì„±ëœ Ecto ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” SQL ì¿¼ë¦¬ë¡œ ë³€í™˜í•œë‹¤.SQL ì¿¼ë¦¬ì˜ ì „ì†¡: ë³€í™˜ëœ SQL ì¿¼ë¦¬ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ë¡œ ì „ì†¡. ì´ ë•Œ, í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œëŠ” ë³µì¡í•œ ë¡œì§ì„ ì²˜ë¦¬í•˜ì§€ ì•Šê³ , ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì¿¼ë¦¬ ìš”ì²­ë§Œ ì „ì†¡í•œë‹¤.ë°ì´í„°ë² ì´ìŠ¤ì˜ ì²˜ë¦¬: ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì—ì„œëŠ” ë°›ì€ SQL ì¿¼ë¦¬ë¥¼ ì‹¤í–‰. ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ì‹œìŠ¤í…œ(DBMS)ì€ ì¿¼ë¦¬ë¥¼ ë¶„ì„í•˜ê³  ìµœì í™”í•˜ì—¬ ì ì ˆí•œ ë°©ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•œë‹¤.ê²°ê³¼ì˜ ë°˜í™˜: ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì¿¼ë¦¬ ê²°ê³¼ë¥¼ í´ë¼ì´ì–¸íŠ¸ ì¸¡ìœ¼ë¡œ ë‹¤ì‹œ ë³´ëƒ„. ì´ ê²°ê³¼ëŠ” ìš”ì²­ëœ ì¡°ê±´ê³¼ ë§¤ì¹­ë˜ëŠ” ë°ì´í„°ë¥¼ í¬í•¨í•œë‹¤.ë³µí•© ì¿¼ë¦¬ì˜ ì²˜ë¦¬í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë¡œì§: í´ë¼ì´ì–¸íŠ¸ëŠ” ì¿¼ë¦¬ë¥¼ êµ¬ì„±í•˜ê³  ìµœì í™”í•˜ëŠ” ë¡œì§ì„ ì²˜ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤. í´ë¼ì´ì–¸íŠ¸ì˜ ì—­í• ì€ ì ì ˆí•œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê³  ìš”ì²­í•˜ëŠ” ê²ƒ.ë°ì´í„°ë² ì´ìŠ¤ ì¸¡ ìµœì í™”: ì‹¤ì œ ì¿¼ë¦¬ì˜ ì‹¤í–‰ê³¼ ìµœì í™”ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì—ì„œ ì²˜ë¦¬ë¨. ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì¿¼ë¦¬ í”Œëœì„ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ì—¬, ìš”ì²­ëœ ì‘ì—…ì„ ìµœì í™”ëœ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.ìš”ì•½ë”°ë¼ì„œ, ë³µí•© ì¿¼ë¦¬ì˜ ë¡œì§ ì²˜ë¦¬ì™€ ìµœì í™”ëŠ” ì£¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì—ì„œ ì´ë£¨ì–´ì§€ë©°, í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œëŠ” ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê³  ìš”ì²­í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ì´ ê³¼ì •ì€ ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ê³¼ íš¨ìœ¨ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ í•„ìš”í•˜ë‹¤.ëŒ€ìš©ëŸ‰ ì„œë¹„ìŠ¤ì— êµ¬í˜„ì—ì„œì˜ Database ë³‘ëª© ë°œìƒê³¼ ë³µí•© ì¿¼ë¦¬ì˜ ê´€ê³„ëŒ€ìš©ëŸ‰ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ í™˜ê²½ì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì˜ ì²˜ë¦¬ ëŠ¥ë ¥ì— í•œê³„ê°€ ìˆìœ¼ë©°, ì´ëŠ” ì¢…ì¢… ì‹œìŠ¤í…œì˜ ë³‘ëª© ì§€ì ì´ ë  ìˆ˜ ìˆë‹¤. ë³µì¡í•œ ì¿¼ë¦¬ ë¡œì§ì˜ ì²˜ë¦¬ê°€ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì—ì„œ ì´ë£¨ì–´ì§€ëŠ” ê²ƒì€ ì‚¬ì‹¤ì´ì§€ë§Œ, ì´ëŠ” ì„œë¹„ìŠ¤ ìš´ì˜ ì¸¡ë©´ì—ì„œ íš¨ìœ¨ì„±ì— ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆë‹¤. ì´ì— ëŒ€í•´ ëª‡ ê°€ì§€ ì¤‘ìš”í•œ ì ì„ ê³ ë ¤í•´ë³¼ í•„ìš”ê°€ ìˆë‹¤ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì˜ ë³‘ëª© í˜„ìƒëŒ€ìš©ëŸ‰ ì²˜ë¦¬: ëŒ€ê·œëª¨ ë°ì´í„°ì™€ ë³µì¡í•œ ì¿¼ë¦¬ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì— ìƒë‹¹í•œ ë¶€í•˜ë¥¼ ì£¼ê³ , ì„±ëŠ¥ ì €í•˜ì˜ ì›ì¸ì´ ë  ìˆ˜ ìˆë‹¤.ìì› ê´€ë¦¬: ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ëŠ” í•œì •ëœ ìì›(ë©”ëª¨ë¦¬, CPU)ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, íš¨ìœ¨ì ì¸ ì¿¼ë¦¬ ìµœì í™”ì™€ ìì› ê´€ë¦¬ê°€ í•„ìˆ˜ì .ëŒ€ìš©ëŸ‰ ì„œë¹„ìŠ¤ì— êµ¬í˜„ì—ì„œì˜ Database ë³‘ëª© ë°œìƒê³¼ ë³µí•© ì¿¼ë¦¬ì˜ ê´€ê³„ì¿¼ë¦¬ ìµœì í™”: í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì¿¼ë¦¬ë¥¼ ê°€ëŠ¥í•œ í•œ íš¨ìœ¨ì ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì´ ì¤‘ìš”. ë¶ˆí•„ìš”í•œ ë°ì´í„° ë¡œë“œë¥¼ í”¼í•˜ê³ , í•„ìš”í•œ ë°ì´í„°ë§Œ ì •í™•íˆ ìš”ì²­í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.ë¡œë“œ ë¶„ì‚°: ë°ì´í„°ë² ì´ìŠ¤ì— ê°€í•´ì§€ëŠ” ë¶€í•˜ë¥¼ ì¤„ì´ê¸° ìœ„í•´ ìºì‹±, ì½ê¸° ì „ìš© ë³µì œë³¸ ì‚¬ìš©, ë°ì´í„° ë¶„í•  ë“±ì˜ ì „ëµì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.ì„œë¹„ìŠ¤ ìš´ì˜ ì¸¡ë©´ì—ì„œì˜ ê³ ë ¤ì‚¬í•­ìŠ¤ì¼€ì¼ë§: ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ í•˜ë“œì›¨ì–´ ìŠ¤ì¼€ì¼ì—…(ë” ê°•ë ¥í•œ ì„œë²„ ì‚¬ìš©), ìŠ¤ì¼€ì¼ì•„ì›ƒ(ì—¬ëŸ¬ ì„œë²„ë¡œ ì‘ì—… ë¶„ì‚°).ì¿¼ë¦¬ ì„±ëŠ¥ ë¶„ì„: ì •ê¸°ì ì¸ ì¿¼ë¦¬ ì„±ëŠ¥ ë¶„ì„ê³¼ ìµœì í™”ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì˜ ë¶€í•˜ë¥¼ ê´€ë¦¬.ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë°ì´í„°ë² ì´ìŠ¤ ë¡œì§ì˜ ë¶„ë¦¬: ê°€ëŠ¥í•˜ë©´ ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ ì²˜ë¦¬í•˜ê³ , ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë°ì´í„° ì €ì¥ê³¼ ê°„ë‹¨í•œ ì¡°íšŒì— ì§‘ì¤‘í•˜ê²Œ í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•  ìˆ˜ ìˆë‹¤.ê²°ë¡ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì—ì„œì˜ ë³µì¡í•œ ì¿¼ë¦¬ ì²˜ë¦¬ëŠ” íš¨ìœ¨ì„±ì„ ì €í•´í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ” ì¿¼ë¦¬ ìµœì í™”, ì ì ˆí•œ ì¸í”„ë¼ ì„ íƒ, ê·¸ë¦¬ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ê³„ì˜ ìµœì í™”ê°€ í•„ìš”. ì´ëŸ¬í•œ ì „ëµë“¤ì€ ì„œë¹„ìŠ¤ì˜ ê·œëª¨ì™€ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤."
    } ,
  
    {
      "title"       : "Open-Closed Principle (OCP)",
      "category"    : "",
      "tags"        : "elixir, polymorphism, open-closed principle, overloading, behaviour",
      "url"         : "./open-closed-principal.html",
      "date"        : "2023-12-21 10:32:20 +0900",
      "description" : "Open-Closed Principle (OCP)",
      "content"     : "Elixirì—ì„œ ì˜¤í”ˆ-í´ë¡œì¦ˆë“œ ì›ì¹™(Open-Closed Principle, OCP)ì€ ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´ë§ì˜ SOLID ì›ì¹™ ì¤‘ í•˜ë‚˜ë¡œ, í´ë˜ìŠ¤, ëª¨ë“ˆ, í•¨ìˆ˜ ë“±ì´ í™•ì¥ì—ëŠ” ì—´ë ¤ ìˆìœ¼ë‚˜, ìˆ˜ì •ì—ëŠ” ë‹«í˜€ ìˆì–´ì•¼ í•œë‹¤ëŠ” ê°œë…. ì´ ì›ì¹™ì˜ ëª©ì ì€ ê¸°ì¡´ì˜ ì½”ë“œë¥¼ ë³€ê²½í•˜ì§€ ì•Šìœ¼ë©´ì„œë„ ì‹œìŠ¤í…œì˜ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒì´ë‹¤.ElixirëŠ” í•¨ìˆ˜í˜• ì–¸ì–´ì´ë©°, ëª¨ë“ˆê³¼ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ì›ì¹™ì„ ì ìš©í•  ìˆ˜ ìˆë‹¤. Elixirì—ì„œ OCPë¥¼ ì ìš©í•˜ëŠ” ëª‡ ê°€ì§€ ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤:1. ë‹¤í˜•ì„±(Polymorphism)ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•Elixirì—ì„œëŠ” í”„ë¡œí† ì½œ(Protocol)ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤í˜•ì„±ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. í”„ë¡œí† ì½œì€ ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„° íƒ€ì…ì— ëŒ€í•´ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ë©°, ìƒˆë¡œìš´ íƒ€ì…ì„ ì¶”ê°€í•  ë•Œ ê¸°ì¡´ ì½”ë“œë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³ ë„ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆë‹¤.ì•„ë˜ ì˜ˆì œì™€ ê°™ì´ `great/1` ì˜ ê²½ìš°, ëª¨ë‘ ë™ì¼í•œ parameter ê°¯ìˆ˜ë¥¼ ê°–ì§€ë§Œ ê°ê° type ì´ ë‹¤ë¥´ë¯€ë¡œ ê°ê° í•¨ìˆ˜ ìš”ì²­ì„ êµ¬ë¶„í•˜ì—¬, í•´ë‹¹ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë„ë¡ í•œë‹¤.defmodule PolymorphismExample do # ì¸ìê°€ ë§µì´ê³  í‚¤ :nameì„ ê°€ì§„ ê²½ìš° def greet(%{name: name}), do: \"Hello, #{name}!\" # ì¸ìê°€ ë¬¸ìì—´ì¼ ê²½ìš° def greet(name) when is_binary(name), do: \"Hello, #{name}!\" # ìœ„ì˜ ê²½ìš°ì— ëª¨ë‘ í•´ë‹¹í•˜ì§€ ì•Šì„ ë•Œ def greet(_), do: \"Hello, there!\" end2. í•¨ìˆ˜ ì˜¤ë²„ë¡œë”©í•¨ìˆ˜ ì˜¤ë²„ë¡œë”©ì„ í†µí•´ ê°™ì€ ì´ë¦„ì˜ í•¨ìˆ˜ì— ëŒ€í•´ ë‹¤ì–‘í•œ íŒ¨í„´ì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í†µí•´ ìƒˆë¡œìš´ ê²½ìš°ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•˜ëŠ” ëŒ€ì‹  ìƒˆë¡œìš´ í•¨ìˆ˜ ì •ì˜ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.ë‹¤ìŒì˜ ê²½ìš°, parameter ê°¯ìˆ˜ê°€ ë‹¤ë¦„ì— ë”°ë¼ ê° í•¨ìˆ˜ëŠ” êµ¬ë¶„ë˜ì–´ì§„ë‹¤.defmodule OverloadingExample do def sum(a, b), do: a + b # ë‘ ê°œì˜ ì¸ìë¥¼ ë°›ëŠ” í•¨ìˆ˜ def sum(list) when is_list(list), do: Enum.sum(list) # ë¦¬ìŠ¤íŠ¸ë¥¼ ì¸ìë¡œ ë°›ëŠ” í•¨ìˆ˜end3. í–‰ìœ„(Behaviour)ë¥¼ ì •ì˜í•˜ëŠ” ë°©ë²•Elixirì—ì„œëŠ” í–‰ìœ„(behaviour)ë¥¼ ì •ì˜í•˜ì—¬ ëª¨ë“ˆì´ íŠ¹ì • ì½œë°±ì„ êµ¬í˜„í•˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤. **(ì•„ì§ ì´í•´ê°€ ë¶€ì¡±í•˜ë¯€ë¡œ ì¶”ê°€ í•™ìŠµ í•„ìš”)** ì´ë¥¼ í†µí•´ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°€ì§„ ë‹¤ì–‘í•œ êµ¬í˜„ì„ ì œê³µí•  ìˆ˜ ìˆìœ¼ë©°, ìƒˆë¡œìš´ êµ¬í˜„ì„ ì¶”ê°€í•´ë„ ê¸°ì¡´ ëª¨ë“ˆì„ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ë‹¤.****** Behaviour ì— ëŒ€í•˜ì—¬Elixir ëŠ” í•¨ìˆ˜í˜• ì–¸ì–´ì´ë¯€ë¡œ JAVA, ë‚˜ Python ê³¼ ê°™ì€ ê°ì²´ì— ëŒ€í•œ ê°œë…ì´ ì¡´ì¬ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ìƒì† ë˜í•œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ëŸ¬ë‚˜ ì•½ê°„ ìœ ì‚¬í•˜ê²Œ ë™ì¼í•œ í•¨ìˆ˜ signiture ë¥¼ ì •ì˜í•˜ì—¬, ì´ë¥¼ í•„ìš”í•œ ìƒí™©ì— ë§ì¶° callback í•¨ìˆ˜ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ìˆìœ¼ë©°, ì´ê²ƒì´ ê³§ behaviour ì´ë‹¤. (OOP ì—ì„œ ë¶€ëª¨ ê°ì²´ 'animal' ì—ì„œ ìš¸ìŒì†Œë¦¬ì— ëŒ€í•œ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ê³ , ìì‹ ê°ì²´ 'cat', 'dog' ì—ì„œ ê°ê° í•¨ìˆ˜ë¥¼ ìƒì† ë°›ì•„ ë‚´ìš©ì„ ë‹¤ë¥´ê²Œ êµ¬í˜„í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.)ì•„ë˜ì˜ ì˜ˆì œë¥¼ ë³´ë©´, defmodule Worker do @callback work(data :: any) :: String.t()enddefmodule FileWorker do @behaviour Worker def work(data) do \"Processing file: #{data}\" endenddefmodule DatabaseWorker do @behaviour Worker def work(data) do \"Processing database entry: #{data}\" endend `Worker` module ì—ì„œ `work/1` callback í•¨ìˆ˜ë¥¼ ì •ì˜í•œë‹¤. ì´ ë•Œ, í•¨ìˆ˜ëª…, parameter &amp; return type ì— ëŒ€í•´ì„œë§Œ ì •ì˜í•œë‹¤.ê·¸ë¦¬ê³  í•¨ìˆ˜ì˜ ë‚´ìš©ì€ ë‹¤ë¥¸ module ì—ì„œ í•´ë‹¹ í•¨ìˆ˜ë¥¼ í•„ìš”í•  ë•Œ, `@behaviour Worker` ë¡œ callback ì„ ì •ì˜ í•˜ê³ , í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ì—¬ ì‚¬ìš©í•˜ë¯€ë¡œ, ê° module ì—ì„œ í•„ìš”í•œ logic ì„ ë§ì¶”ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. [ê³µì‹ ë¬¸ì„œ behaviour ì„¤ëª…] *****4. ì»¨í”¼ê·œë ˆì´ì…˜ì„ í†µí•œ í™•ì¥(ì¶”í›„í•™ìŠµ ì˜ˆì •)ì‹œìŠ¤í…œì„ êµ¬ì„±í•˜ëŠ” ìš”ì†Œë“¤ì„ ì»¨í”¼ê·œë ˆì´ì…˜ì„ í†µí•´ ì •ì˜í•˜ê³ , ìƒˆë¡œìš´ êµ¬ì„± ìš”ì†Œë¥¼ ì¶”ê°€í•˜ì—¬ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆë‹¤.(ì•„ì§ ì´í•´ê°€ ë¶€ì¡±í•˜ë¯€ë¡œ ì¶”ê°€ í•™ìŠµ í•„ìš”) ì´ ë°©ë²•ì€ ê¸°ì¡´ ì‹œìŠ¤í…œì˜ ì½”ë“œë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³ ë„ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•œë‹¤.ê²°ë¡ ì˜¤í”ˆ-í´ë¡œì¦ˆë“œ ì›ì¹™ì„ ì ìš©í•˜ë©´, ì‹œìŠ¤í…œì˜ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ì¥ì„±ì´ í–¥ìƒë˜ë©°, ê¸°ì¡´ ì½”ë“œì˜ ì•ˆì •ì„±ì„ ìœ ì§€í•˜ë©´ì„œ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤."
    } ,
  
    {
      "title"       : "LiveView preload/1 ì— ëŒ€í•´",
      "category"    : "",
      "tags"        : "preload/1, phoenix, liveview",
      "url"         : "./preload.html",
      "date"        : "2023-12-20 13:32:20 +0900",
      "description" : "LiveView - preload/1",
      "content"     : "Consider the preload/1 Callback (by ChatGPT)live_component/1ì´ ì²˜ìŒ í˜¸ì¶œë  ë•Œ, LiveViewëŠ” ì¼ë°˜ì ìœ¼ë¡œ mount/1, update/2, ê·¸ë¦¬ê³  render/1 ì½œë°±ì„ ìˆœì„œëŒ€ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ì½œë°±ë“¤ë§Œìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•Šì€ ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ, ì„±ëŠ¥ ë¬¸ì œ, ì˜ˆë¥¼ ë“¤ì–´ N + 1 ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ preload/1ì´ë¼ëŠ” ì¶”ê°€ ì½œë°±ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.N + 1 ë¬¸ì œë€? ì´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ì™€ ê´€ë ¨ëœ ì„±ëŠ¥ ë¬¸ì œë¡œ, í•œ ë²ˆì˜ í° ì¿¼ë¦¬ ëŒ€ì‹  ì‘ì€ ì¿¼ë¦¬ê°€ ì—¬ëŸ¬ ë²ˆ ë°œìƒí•˜ì—¬ ì „ì²´ì ì¸ ì„±ëŠ¥ì´ ì €í•˜ë˜ëŠ” í˜„ìƒì„ ë§í•©ë‹ˆë‹¤.preload/1 ì½œë°±ì€ mount/1ì´ë‚˜ render/1 ì „ì— í˜¸ì¶œë©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì‚¬ì „ì— ë¡œë“œí•˜ê³ , ì„±ëŠ¥ ì €í•˜ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë§ˆìš´íŠ¸/ë Œë” ì›Œí¬í”Œë¡œìš°ì˜ ê²½ìš°, LiveViewëŠ” preload/1ì„ í˜¸ì¶œí•œ ë‹¤ìŒ, mount/1, update/2, ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ render/1ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.ë³€ê²½ ê´€ë¦¬ ì›Œí¬í”Œë¡œìš°ì—ì„œëŠ” mount/1ì€ ìƒëµë˜ì§€ë§Œ, preload/1, update/2, ê·¸ë¦¬ê³  render/1ì˜ ìˆœì„œëŠ” ìœ ì§€ë©ë‹ˆë‹¤.preload/1 ì½œë°±ì˜ ì‘ë™ ë°©ì‹ê³¼ N + 1 ë¬¸ì œì™€ì˜ ê´€ê³„Phoenix LiveViewì—ì„œ preload/1 ì½œë°±ì€ ì»´í¬ë„ŒíŠ¸ì˜ ë¼ì´í”„ì‚¬ì´í´ì—ì„œ ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤. ì´ ì½œë°±ì€ ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë˜ê¸° ì „ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¡œë“œí•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ í•œ ë²ˆì˜ ë°°ì¹˜ë¡œ ë¯¸ë¦¬ ë¡œë“œí•˜ì—¬, ê°ê°ì˜ ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì€ preload(list_of_assigns) -&gt; mount(socket) -&gt; update(assigns, socket) -&gt; render(assigns)ì˜ ìˆœì„œë¡œ ì§„í–‰ë©ë‹ˆë‹¤â€‹â€‹.preload/1 ì½œë°±ì˜ ì£¼ìš” ëª©ì ì€ N + 1 ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ë¬¸ì œëŠ” ì—¬ëŸ¬ ë°ì´í„° ë ˆì½”ë“œì— ëŒ€í•œ ì˜ì¡´ì„± ìˆëŠ” ì¿¼ë¦¬ë¥¼ ë°˜ë³µì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ ë°œìƒí•˜ëŠ” ì„±ëŠ¥ ì €í•˜ ë¬¸ì œë¥¼ ë§í•©ë‹ˆë‹¤. preload/1ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ í•„ìš”í•œ ëª¨ë“  ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë¡œë“œí•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ë¶ˆí•„ìš”í•œ ì ‘ê·¼ì„ ì¤„ì´ê³  ì „ì²´ì ì¸ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.Phoenix LiveView ë¬¸ì„œì—ì„œëŠ” preload/1ê³¼ ê´€ë ¨ëœ êµ¬ì²´ì ì¸ ì½œë°± ëª©ë¡ì´ë‚˜ ì‚¬ìš© ë°©ë²•ì— ëŒ€í•´ ìì„¸íˆ ì„¤ëª…í•˜ì§€ ì•Šì§€ë§Œ, preload/1 ì½œë°±ì˜ ì‚¬ìš©ì´ ì»´í¬ë„ŒíŠ¸ ë¼ì´í”„ì‚¬ì´í´ì—ì„œ ì¤‘ìš”í•œ ì—­í• ì„ í•˜ê³ , ì„±ëŠ¥ ìµœì í™”ì— ê¸°ì—¬í•œë‹¤ëŠ” ì ì€ ë¶„ëª…í•©ë‹ˆë‹¤â€‹â€‹.ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ, preload/1 ì½œë°±ì´ ë°ì´í„° ì²˜ë¦¬ë¥¼ mount/1 ë˜ëŠ” update/2ì™€ ë¶„ë¦¬í•˜ì—¬ ì‹¤í–‰í•¨ìœ¼ë¡œì¨ ì„±ëŠ¥ ìµœì í™”ì— ê¸°ì—¬í•œë‹¤ëŠ” ê²ƒì„ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. mount/1 ì´ì „ì—ëŠ” ì´ˆê¸° ë¡œë”©ì— í•„ìš”í•œ ëª¨ë“  ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³ , update/2 ì´ì „ì—ëŠ” ë³€ê²½ëœ ë°ì´í„°ì— ëŒ€í•´ì„œë§Œ ë¡œë“œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì„±ëŠ¥ì„ ìµœì í™”í•©ë‹ˆë‹¤."
    } ,
  
    {
      "title"       : "ê¸°ë³¸ì ì¸ LiveView Authentication ì ìš©",
      "category"    : "",
      "tags"        : "authentication, phoenix, liveview",
      "url"         : "./authentication.html",
      "date"        : "2023-12-18 13:32:20 +0900",
      "description" : "LiveView ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µí•˜ëŠ” Authentication ì„ ì ìš©",
      "content"     : "Authentication Generator ì‚¬ìš©ì„ ìœ„í•œ phx.gen ì¶”ê°€&gt; mix phx.genì´ ì¤‘ auth ê´€ë ¨ generator ì‚¬ìš©&gt; mix phx.gen.auth Accounts User uersAuthentication Generator ì‚¬ìš©ì„ ìœ„í•œ phx.gen ì¶”ê°€&gt; mix phx.genì´ ì¤‘ auth ê´€ë ¨ generator ì‚¬ìš©&gt; mix phx.gen.auth Accounts User uers1. Context ('Accounts') ContextëŠ” Phoenixì—ì„œ ë„ë©”ì¸ íŠ¹ì • ë¡œì§ì„ ìº¡ìŠí™”í•˜ëŠ” ëª¨ë“ˆ. ì´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ìƒí˜¸ì‘ìš©ì„ ê´€ë¦¬í•˜ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì— ì„œë¹„ìŠ¤ APIë¥¼ ì œê³µí•œë‹¤. \"Accounts\"ëŠ” ì´ ì˜ˆì œì—ì„œ ìƒì„±ë  contextì˜ ì´ë¦„ìœ¼ë¡œ ì´ contextëŠ” ì¸ì¦ê³¼ ê´€ë ¨ëœ ëª¨ë“  í•¨ìˆ˜ì™€ ë¡œì§ì„ í¬í•¨í•˜ê²Œ ëœë‹¤.2. Schema ('User') SchemaëŠ” ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ êµ¬ì¡°ë¥¼ ì„¤ëª…í•˜ëŠ” Elixir ëª¨ë“ˆ. ì´ëŠ” í…Œì´ë¸”ì˜ ê° ì—´ì— í•´ë‹¹í•˜ëŠ” í•„ë“œì™€ ê·¸ íƒ€ì…ì„ ì •ì˜í•œë‹¤. \"User\"ëŠ” ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” schemaì˜ ì´ë¦„ìœ¼ë¡œ ì´ schemaëŠ” ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì¿¼ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.3. Plural name of the schema ('users') ì´ê²ƒì€ ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì—ì„œ ì‚¬ìš©ë  í…Œì´ë¸”ì˜ ì´ë¦„. PhoenixëŠ” ì¼ë°˜ì ìœ¼ë¡œ schema ì´ë¦„ì˜ ë³µìˆ˜í˜•ì„ í…Œì´ë¸” ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤. \"users\"ëŠ” \"User\" schemaì— ëŒ€ì‘í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ì´ë¦„.&gt; mix deps.getRun Migration&gt; mix ecto.migrateí•´ë‹¹ ì„¤ì • ì´í›„ ê¸°ì¡´ `live \"/guess\", WrongLive` ë¥¼ :require_authenticated_user plug ë¥¼ ì‹¤í–‰í•˜ëŠ” scope ë¡œ ì˜®ê²¨ì„œ ì¶”ê°€í•´ì¤€ë‹¤.ë”°ë¼ì„œ í•´ë‹¹ ê²½ë¡œ ì ‘ì†ì€ Authentication ì´ í•„ìš”í•˜ë©°, í•´ë‹¹ ì¸ì¦ì€ LiveView ì—ì„œ ì¬ê³µí•˜ëŠ” login / signup page ë¥¼ ì‚¬ìš©í•˜ì—¬ íšŒì› ë“±ë¡ì„ ì†ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤."
    } 
  
]
